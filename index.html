<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>EPhone</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="update-notification.css">
  <link rel="stylesheet" href="structured-memory.css">
  <link rel="stylesheet" href="online-app.css">
  <link rel="apple-touch-icon" href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758510900942_qdqqd_djw0z2.jpeg">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="EPhone">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" type="image/png" href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756312261242_qdqqd_g0eriz.jpeg">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script src="https://unpkg.com/dexie/dist/dexie.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
  <script src="https://phoebeboo.github.io/mewoooo/pp.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/streamsaver@2.0.6/StreamSaver.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js" defer></script>
  <script src="update-notification.js?v=0.0.16" defer></script>
  <script src="prompt-manager.js" defer></script>
  <script src="online-chat-manager.js" defer></script>
  <script src="online-chat-integration.js" defer></script>
  <script src="sticker-vision.js" defer></script>
  <script src="notification-manager.js" defer></script>
  <script src="character-generator.js" defer></script>
  <script src="structured-memory.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="script.js" defer="defer"></script>
  <script src="helper-assistant.js" defer></script>
  <script src="force-update.js" defer></script>
  
  <style>
    /* å®ˆæŠ¤ç”œå¿ƒé£æ ¼éªŒè¯ç•Œé¢ */
    @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@500;700&display=swap');

    #ephone-auth-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      /* æ·¡ç²‰è‰²æ¢¦å¹»æ¸å˜èƒŒæ™¯ */
      background: linear-gradient(135deg, #fff0f5 0%, #ffdbde 50%, #f8cdda 100%);
      /* å åŠ ä¸€ä¸ªæ ¼çº¹çº¹ç† */
      background-image: 
        linear-gradient(135deg, #fff0f5 0%, #ffdbde 50%, #f8cdda 100%),
        repeating-linear-gradient(45deg, rgba(255, 255, 255, 0.4) 0px, rgba(255, 255, 255, 0.4) 20px, transparent 20px, transparent 40px),
        repeating-linear-gradient(-45deg, rgba(255, 255, 255, 0.4) 0px, rgba(255, 255, 255, 0.4) 20px, transparent 20px, transparent 40px);
      background-blend-mode: overlay;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 99999;
      animation: fadeIn 0.5s ease-in-out;
      font-family: 'Quicksand', sans-serif;
    }

    #ephone-auth-screen.hidden {
      display: none;
    }

    .ephone-auth-container {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 30px;
      padding: 40px 30px;
      /* ç²‰è‰²å…‰æ™•é˜´å½± */
      box-shadow: 0 10px 40px rgba(255, 183, 197, 0.5), inset 0 0 20px rgba(255, 255, 255, 0.8);
      text-align: center;
      max-width: 320px;
      width: 85%;
      backdrop-filter: blur(5px);
      border: 4px solid #fff;
      position: relative;
      overflow: hidden;
    }

    /* é¡¶éƒ¨è£…é¥°æ¡ - æ¨¡ä»¿çš‡å† æˆ–èŠ±è¾¹ */
    .ephone-auth-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 10px;
      background: repeating-linear-gradient(90deg, #ffb7c5, #ffb7c5 10px, #ffffff 10px, #ffffff 20px);
    }

    /* å››è§’çš„æ‰‘å…‹ç‰ŒèŠ±è‰²è£…é¥° */
    .shugo-chara-decoration {
      position: absolute;
      width: 30px;
      height: 30px;
      opacity: 0.6;
      user-select: none;
      animation: float 3s ease-in-out infinite;
    }
    .deco-heart { top: 20px; left: 20px; color: #ff6b81; animation-delay: 0s; }
    .deco-spade { top: 20px; right: 20px; color: #70a1ff; animation-delay: 1s; }
    .deco-clover { bottom: 20px; left: 20px; color: #7bed9f; animation-delay: 2s; }
    .deco-diamond { bottom: 20px; right: 20px; color: #ffd32a; animation-delay: 3s; }

    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-5px) rotate(10deg); }
    }

    .ephone-auth-logo {
      width: 70px;
      height: 70px;
      margin: 0 auto 15px auto;
      color: #ff6b81;
      animation: heartbeat 2s ease-in-out infinite;
      filter: drop-shadow(0 2px 5px rgba(255, 107, 129, 0.3));
    }

    @keyframes heartbeat {
      0% { transform: scale(1); }
      14% { transform: scale(1.1); }
      28% { transform: scale(1); }
      42% { transform: scale(1.1); }
      70% { transform: scale(1); }
    }

    .ephone-auth-title {
      font-family: 'Fredoka One', cursive; /* å¯çˆ±çš„åœ†ä½“å­— */
      font-size: 26px;
      color: #ff6b81; /* å®ˆæŠ¤ç”œå¿ƒæ ‡å¿—æ€§çš„ç²‰çº¢è‰² */
      margin: 5px 0 15px 0;
      text-shadow: 2px 2px 0px #fff, 3px 3px 0px rgba(255, 183, 197, 0.5);
      letter-spacing: 1px;
    }

    .ephone-auth-subtitle {
      font-size: 13px;
      color: #ff9ca8;
      margin-bottom: 25px;
      background: #fff0f5;
      display: inline-block;
      padding: 5px 15px;
      border-radius: 15px;
    }

    .ephone-auth-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .ephone-auth-form input {
      padding: 12px 15px;
      border: 2px solid #ffe0e6;
      border-radius: 20px;
      font-size: 15px;
      transition: all 0.3s ease;
      outline: none;
      background: rgba(255, 255, 255, 0.8);
      color: #ff6b81;
      text-align: center;
    }

    .ephone-auth-form input::placeholder {
      color: #ffc2cd;
    }

    .ephone-auth-form input:focus {
      border-color: #ff6b81;
      background: #fff;
      box-shadow: 0 0 0 4px rgba(255, 107, 129, 0.1);
      transform: scale(1.02);
    }

    .ephone-auth-form button {
      padding: 12px;
      /* ç»å…¸çš„å®ˆæŠ¤ç”œå¿ƒç²‰çº¢æ¸å˜ */
      background: linear-gradient(90deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); 
      color: white;
      border: none;
      border-radius: 20px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
      box-shadow: 0 5px 15px rgba(255, 154, 158, 0.4);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      position: relative;
      overflow: hidden;
    }

    /* æŒ‰é’®ä¸Šçš„é—ªå…‰ç‰¹æ•ˆ */
    .ephone-auth-form button::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
      transform: rotate(45deg);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%) rotate(45deg); }
      100% { transform: translateX(100%) rotate(45deg); }
    }

    .ephone-auth-form button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 154, 158, 0.6);
    }

    .ephone-auth-form button:active {
      transform: translateY(0);
    }
    
    .ephone-auth-form button:disabled {
        background: #e0e0e0;
        box-shadow: none;
        cursor: not-allowed;
        transform: none;
    }

    .ephone-auth-error {
      color: #ff6b81;
      font-size: 13px;
      margin-top: 15px;
      min-height: 20px;
      font-weight: bold;
    }

    .ephone-auth-help {
      margin-top: 20px;
      padding: 12px 15px;
      background: rgba(255, 240, 245, 0.5);
      border-radius: 12px;
      font-size: 12px;
      line-height: 1.6;
    }

    .ephone-auth-help p {
      margin: 0;
      color: #ff9ca8;
    }

    .ephone-auth-help a {
      color: #ff6b81;
      text-decoration: none;
      font-weight: bold;
      border-bottom: 1px dashed #ff6b81;
      transition: all 0.3s ease;
    }

    .ephone-auth-help a:hover {
      color: #ff4757;
      border-bottom-style: solid;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    @keyframes fadeOut {
      from { opacity: 1; transform: scale(1); }
      to { opacity: 0; transform: scale(1.05); }
    }

    #ephone-auth-screen.fade-out {
      animation: fadeOut 0.5s ease-in-out forwards;
    }

    /* å¼€åœºåŠ¨ç”»ç•Œé¢ */
    #intro-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      /* ç™½é‡Œé€ç²‰ï¼šä¸­å¿ƒçº¯ç™½ -> ä¸­é—´ææ·¡ç²‰ç™½ -> è¾¹ç¼˜æ·¡ç²‰ */
      background: radial-gradient(circle at center, #ffffff 0%, #fffbfd 45%, #fff0f5 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100000;
      cursor: pointer;
      transition: opacity 0.5s ease-in-out;
    }

    #intro-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .intro-egg-container {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: floatEgg 3s ease-in-out infinite;
      /* æ•´ä½“å‘å…‰å¸¦ä¸€ç‚¹ç‚¹ç²‰è‰²å…‰æ™• */
      filter: drop-shadow(0 0 25px rgba(255, 240, 245, 0.9));
    }

    .intro-egg {
      width: 120px;
      height: 160px;
      /* è›‹èº«ç™½é‡Œé€ç²‰ */
      background: radial-gradient(circle at 35% 35%, #ffffff, #fff5f7);
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      box-shadow: 
        inset -5px -5px 15px rgba(255, 192, 203, 0.1), /* ææ·¡çš„ç²‰è‰²å†…é˜´å½± */
        0 0 25px rgba(255, 255, 255, 1), /* çº¯ç™½å¤–å‘å…‰ */
        0 15px 35px rgba(255, 182, 193, 0.15); /* è½åœ°æŠ•å½±å¸¦ç²‰ */
      position: relative;
      z-index: 2;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .egg-pattern {
      opacity: 0.3; /* å›¾æ¡ˆæ›´æ·¡ä¸€ç‚¹ï¼Œèå…¥ç™½è‰² */
    }

    .intro-wing {
      width: 90px;
      height: 90px;
      position: absolute;
      top: 35px;
      z-index: 1;
      /* ç¿…è†€é˜´å½±ææ·¡ï¼Œåƒç¾½æ¯›ä¸€æ ·è½»ç›ˆ */
      filter: drop-shadow(0 2px 8px rgba(255, 192, 203, 0.1));
    }

    .left-wing {
      left: -65px;
      transform-origin: right center;
      animation: flapLeft 2s ease-in-out infinite;
    }

    .right-wing {
      right: -65px;
      transform-origin: left center;
      animation: flapRight 2s ease-in-out infinite;
    }
    
    .intro-wing svg {
        fill: #ffffff;
        /* æç»†çš„ç²‰ç™½æè¾¹ */
        stroke: #ffeef2;
        stroke-width: 1.5px;
    }

    .intro-text {
      margin-top: 60px;
      font-family: 'Quicksand', sans-serif;
      /* æ–‡å­—æ”¹ä¸ºç²‰ç°è‰²ï¼Œæ¸©æŸ”ä¸€ç‚¹ */
      color: #d8c0c6; 
      font-size: 16px;
      letter-spacing: 4px;
      font-weight: 500;
      animation: pulseText 2s infinite;
      text-transform: uppercase;
      text-shadow: 0 2px 4px rgba(255, 255, 255, 0.8);
    }

    @keyframes floatEgg {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    @keyframes flapLeft {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(15deg); }
    }

    @keyframes flapRight {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(-15deg); }
    }

    @keyframes pulseText {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }
  </style>
</head>
<body>
  <div id="intro-screen">
    <div class="intro-egg-container">
        <div class="intro-wing left-wing">
            <svg viewBox="0 0 100 100" fill="white">
                <path d="M100,50 Q80,20 40,10 Q10,20 0,50 Q20,80 60,80 Q90,70 100,50 Z" />
            </svg>
        </div>
        <div class="intro-egg">
            <div class="egg-pattern">
                <svg viewBox="0 0 24 24" fill="#ffb7c5" style="width: 40px; height: 40px; opacity: 0.5;">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                </svg>
            </div>
        </div>
        <div class="intro-wing right-wing">
            <svg viewBox="0 0 100 100" fill="white">
                <path d="M0,50 Q20,20 60,10 Q90,20 100,50 Q80,80 40,80 Q10,70 0,50 Z" />
            </svg>
        </div>
    </div>
    <div class="intro-text">Tap to Start</div>
  </div>

  <div id="ephone-auth-screen" class="hidden">
    <div class="ephone-auth-container">
      <!-- è£…é¥°å…ƒç´  -->
      <div class="shugo-chara-decoration deco-heart">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
      </div>
      <div class="shugo-chara-decoration deco-spade">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C9 2 7 4.3 7 6.5C7 8.2 8.2 9.6 9.6 10C7.2 11.2 3 14.5 3 18.5C3 21.5 5.5 22 7 22C8.2 22 9.2 21.2 9.2 20.5C9.2 19.5 8.2 19 7.2 19C6.8 19 6.5 19.2 6.5 19.5C6.8 18.2 8.2 17 9.5 17C11 17 11.5 18 11.5 20V22H12.5V20C12.5 18 13 17 14.5 17C15.8 17 17.2 18.2 17.5 19.5C17.5 19.2 17.2 19 16.8 19C15.8 19 14.8 19.5 14.8 20.5C14.8 21.2 15.8 22 17 22C18.5 22 21 21.5 21 18.5C21 14.5 16.8 11.2 14.4 10C15.8 9.6 17 8.2 17 6.5C17 4.3 15 2 12 2Z"/></svg>
      </div>
      <div class="shugo-chara-decoration deco-clover">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M16.5 9c-.4 0-.7.1-1.1.2C16.2 8.1 16.5 6.9 16.5 5.5 16.5 2.5 14.5 0 12 0S7.5 2.5 7.5 5.5c0 1.4.3 2.6 1.1 3.7C8.2 9.1 7.9 9 7.5 9 4.5 9 2 11.5 2 14.5c0 2.6 1.8 4.7 4.2 5.3C6.1 19.9 6 20 6 20.2v3.8h12v-3.8c0-.2-.1-.3-.2-.4 2.4-.6 4.2-2.7 4.2-5.3C22 11.5 19.5 9 16.5 9z"/></svg>
      </div>
      <div class="shugo-chara-decoration deco-diamond">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 12l10 10 10-10L12 2z"/></svg>
      </div>
      
      <div class="ephone-auth-logo">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width: 100%; height: 100%;">
            <path d="M12 1C8.676 1 6 3.676 6 7v3H4v12h16V10h-2V7c0-3.324-2.676-6-6-6zm0 2c2.276 0 4 1.724 4 4v3H8V7c0-2.276 1.724-4 4-4zm0 10c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2z"/>
        </svg>
      </div>
      <h2 class="ephone-auth-title">Unlock My Heart</h2>
      <p class="ephone-auth-subtitle">Unlock with your Password!</p>
      <div class="ephone-auth-form">
        <input type="text" id="ephone-account" placeholder="Account" autocomplete="username">
        <input type="password" id="ephone-password" placeholder="Password" autocomplete="current-password">
        <button id="ephone-login-btn">Unlock!</button>
      </div>
      <div id="ephone-auth-error" class="ephone-auth-error"></div>
      <div class="ephone-auth-help">
        <p>é‡åˆ°ç™»å½•é—®é¢˜ï¼Ÿè¯·æŸ¥çœ‹ <a href="https://discord.com/channels/1379304008157499423/1417316084465270854/1463764186139197563" target="_blank">å¸®åŠ©æ–‡æ¡£</a></p>
      </div>
    </div>
  </div>

  <div id="phone-screen">
    <div id="status-bar"> <span id="status-bar-time">12:00</span>
      <div id="status-bar-battery" class="battery-container"> <span class="battery-text">--%</span>
        <div class="battery-icon">
          <div class="battery-level"></div>
        </div>
      </div>
    </div>
    <div id="lock-screen">
        <div id="lock-screen-content">
            <div class="lock-icon">ğŸ”“</div>
            <div class="lock-time-container">
                <div id="lock-date">1æœˆ1æ—¥ æ˜ŸæœŸä¸€</div>
                <div id="lock-time">12:00</div>
            </div>
            
            <div id="lock-password-area" style="display: none;">
                <div class="lock-instruction">è¾“å…¥å¯†ç </div>
                <div class="lock-dots">
                    <div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
                </div>
                <div class="lock-keypad">
                    <div class="key" data-num="1">1</div>
                    <div class="key" data-num="2">2<br><span>ABC</span></div>
                    <div class="key" data-num="3">3<br><span>DEF</span></div>
                    <div class="key" data-num="4">4<br><span>GHI</span></div>
                    <div class="key" data-num="5">5<br><span>JKL</span></div>
                    <div class="key" data-num="6">6<br><span>MNO</span></div>
                    <div class="key" data-num="7">7<br><span>PQRS</span></div>
                    <div class="key" data-num="8">8<br><span>TUV</span></div>
                    <div class="key" data-num="9">9<br><span>WXYZ</span></div>
                    <div class="key empty"></div>
                    <div class="key" data-num="0">0</div>
                    <div class="key delete" data-action="delete">âŒ«</div>
                </div>
                <div class="lock-cancel-btn">å–æ¶ˆ</div>
            </div>
            
            <div id="lock-swipe-area">
                <div class="swipe-bar"></div>
            </div>
        </div>
    </div>
    <div id="notification-bar"><img id="notification-avatar" src="">
      <div id="notification-content">
        <div class="name"></div>
        <div class="message"></div>
      </div>
    </div>
<div id="dynamic-island-content">
  <img id="island-album-art" src="">
  <div id="island-lyric-container">
    <span id="island-lyric-text"></span>
  </div>
</div>

    <div id="home-screen" class="screen active">
      <div id="home-screen-pages-container">
        <div id="home-screen-pages">
          <div class="home-screen-page">
            <div id="main-content-area">
              <div id="profile-widget"> <img id="profile-banner-img" src="https://i.imgur.com/1n3a43H.jpeg" class="editable-image">
                <div class="profile-avatar-container"> <img id="profile-avatar-img" src="https://i.postimg.cc/y8xWzCqj/anime-boy.jpg" class="editable-image"> </div>
                <div class="profile-info">
                  <p id="profile-username" class="editable-text" onclick="editBubbleText('profile-username')">@ insonneve ğŸª¦</p>
                  <p id="profile-sub-username" class="editable-text" onclick="editBubbleText('profile-sub-username')">@ insonneve</p>
                  <p id="profile-bio" class="editable-text" onclick="editBubbleText('profile-bio')">ä½ å¥½åƒè¿‡å¾—å¾ˆå¥½ è¿«ä¸åŠå¾…çš„æŠ¹å»æˆ‘å­˜åœ¨çš„ç—•è¿¹</p>
                  <p id="profile-location" class="editable-text" onclick="editBubbleText('profile-location')"> <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5-2.5-1.12 2.5-2.5 2.5z"></path>
                    </svg> <span>åŒ—æµ·é“</span> </p>
                </div>
              </div>
              <div id="desktop-layout">
                <div id="desktop-widget-column">
                  <div class="desktop-widget text-only">
                    <p id="widget-text-1" class="editable-text" onclick="editBubbleText('widget-text-1')">Be fearless in pursuit of happiness</p>
                  </div>
                  <div class="desktop-widget icon-left"> <img id="widget-avatar-1" src="https://i.imgur.com/1n3a43H.jpeg" class="editable-image"> <span id="widget-text-2" class="editable-text" onclick="editBubbleText('widget-text-2')">Dare to be different</span> </div>
                  <div class="desktop-widget icon-right"> <span id="widget-text-3" class="editable-text" onclick="editBubbleText('widget-text-3')">* Keep your spirit free</span> <img id="widget-avatar-2" src="https://i.imgur.com/5A0tE9a.jpeg" class="editable-image"> </div>
                </div>
                <div id="desktop-app-container">
                  <div class="desktop-app-icon" onclick="showScreen('chat-list-screen')">
                    <div class="icon-bg-desktop"><img id="icon-img-qq" src="https://i.postimg.cc/MTC3Tkw8/IMG-6436.jpg" alt="QQ"></div> <span class="label"data-lang-key="homeAppQQ">QQ</span>
                  </div>
                  <div class="desktop-app-icon" onclick="showScreen('world-book-screen')">
                    <div class="icon-bg-desktop"><img id="icon-img-world-book" src="https://i.postimg.cc/HWf1JKzn/IMG-6435.jpg" alt="ä¸–ç•Œä¹¦"></div> <span class="label"data-lang-key="homeAppWorldBook">ä¸–ç•Œä¹¦</span>
                  </div>
                  <div class="desktop-app-icon" onclick="showScreen('wallpaper-screen')">
                    <div class="icon-bg-desktop"><img id="icon-img-wallpaper" src="https://i.postimg.cc/T1j03pQr/IMG-6440.jpg" alt="å¤–è§‚è®¾ç½®"></div> <span class="label"data-lang-key="homeAppAppearance">å¤–è§‚è®¾ç½®</span>
                  </div>
                  <div class="desktop-app-icon" onclick="openRenderingRulesScreen()">
                    <div class="icon-bg-desktop"><img id="icon-img-renderer" src="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756312261242_qdqqd_g0eriz.jpeg" alt="æ¸²æŸ“å™¨"></div> <span class="label"data-lang-key="homeAppRenderer">æ¸²æŸ“å™¨</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="home-screen-page">
            <div class="polaroid-widget-container">
              <div class="polaroid-photos">
                <div class="polaroid-photo" style="transform: rotate(-6deg);" onclick="handleWidgetImageChange('polaroid-img-1')"> <img id="polaroid-img-1" src="https://i.imgur.com/Bv63o3h.jpg" alt="Photo 1"> </div>
                <div class="polaroid-photo" style="transform: rotate(2deg);" onclick="handleWidgetImageChange('polaroid-img-2')"> <img id="polaroid-img-2" src="https://i.imgur.com/GzPzBfF.jpg" alt="Photo 2"> </div>
                <div class="polaroid-photo" style="transform: rotate(5deg);" onclick="handleWidgetImageChange('polaroid-img-3')"> <img id="polaroid-img-3" src="https://i.imgur.com/Wp72cEM.jpg" alt="Photo 3"> </div>
              </div>
            </div>
            <div id="page-2-app-container">
              <div class="left-column-stack">
        <!-- åŸæ¥çš„å¤§ç»„ä»¶ -->
        <div class="large-widget" onclick="handleWidgetImageChange('large-widget-img')"> 
            <img class="large-widget-img" id="large-widget-img" src="https://i.imgur.com/Bv63o3h.jpg" alt="Colorful Widget"> 
        </div>
        
        <!-- æ–°å¢ï¼šå·¦ä¾§ App ç½‘æ ¼ -->
        <div class="left-app-grid">
            <!-- æ”¯ä»˜å®å›¾æ ‡ -->
            <div class="desktop-app-icon" onclick="openAlipayScreen()">
    <div class="icon-bg-desktop">
        <img id="icon-img-alipay" src="https://i.postimg.cc/SK31X0Bb/IMG_2231.png" alt="æ”¯ä»˜å®">
    </div> 
    <span class="label">æ”¯ä»˜å®</span>
</div>

<div class="desktop-app-icon" onclick="openAuctionScreen()">
    <div class="icon-bg-desktop"> 
        <img id="icon-img-auction" 
             src="https://i.postimg.cc/Hs7BLh76/alipay.png" 
             alt="é»‘å¸‚">
    </div>
    <span class="label">é»‘å¸‚</span>
</div>
<div class="desktop-app-icon" onclick="openGreenRiverScreen()">
    <div class="icon-bg-desktop"> 
        <img id="icon-img-green-river" 
             src="https://i.postimg.cc/0j55Pj1L/green-river-icon.png" 
             alt="ç»¿æ±Ÿ">
    </div>
    <span class="label">ç»¿æ±Ÿ</span>
</div>
<div class="desktop-app-icon" onclick="openEmailApp()">
    <div class="icon-bg-desktop"> 
        <img id="icon-img-mail" src="https://i.postimg.cc/PfR7f37x/mail.png" alt="Mail">
    </div>
    <span class="label">é‚®ç®±</span>
</div>
            <!-- æœªæ¥å¯ä»¥åœ¨è¿™é‡ŒåŠ æ›´å¤š App -->
        </div>
    </div>
              <div class="right-column-stack">
    
    <div class="app-subgrid">
        <div class="small-widget" onclick="openPresetScreen()">
            <div class="small-widget-icon-wrapper"> 
                <img class="small-widget-img" id="icon-img-preset" src="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758510900942_qdqqd_djw0z2.jpeg" alt="é¢„è®¾"> 
            </div> 
            <span class="small-widget-label" data-lang-key="homeAppPreset">é¢„è®¾</span>
        </div>
        <div class="small-widget" onclick="showScreen('tutorial-screen')">
            <div class="small-widget-icon-wrapper"> 
                <img class="small-widget-img" id="icon-img-tutorial" src="https://i.postimg.cc/d10GjC4g/IMG-7302.jpg" alt="æ•™ç¨‹"> 
            </div> 
            <span class="small-widget-label" data-lang-key="homeAppTutorial">æ•™ç¨‹</span>
        </div>
        <div class="small-widget" onclick="openWerewolfLobby('global')">
            <div class="small-widget-icon-wrapper"> 
                <img class="small-widget-img" id="icon-img-werewolf" src="https://i.postimg.cc/k401K5g7/IMG-7304.jpg" alt="ç‹¼äººæ€"> 
            </div> 
            <span class="small-widget-label" data-lang-key="homeAppWerewolf">ç‹¼äººæ€</span>
        </div>
        <div class="small-widget" onclick="showScreen('x-social-screen')">
            <div class="small-widget-icon-wrapper"> 
                <img class="small-widget-img" id="icon-img-x" src="https://i.postimg.cc/Y9d3BztC/1.png" alt="X"> 
            </div> 
            <span class="small-widget-label" data-lang-key="homeAppX">X</span>
        </div>
    </div>

    <div class="vinyl-transparent-widget">
                      <div class="vinyl-disc-bg">
                          <img id="vinyl-img" 
                               src="https://i.postimg.cc/y8xWzCqj/anime-boy.jpg" 
                               class="vinyl-cover editable-image" 
                               onclick="handleWidgetImageChange('vinyl-img')">
                      </div>
                      <div class="vinyl-arm-wrapper">
                          <svg width="50" height="120" viewBox="0 0 50 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <circle cx="35" cy="15" r="12" fill="white" stroke="#ddd" stroke-width="2"/>
                              <path d="M35 15 L40 80 L25 90" stroke="#ddd" stroke-width="6" stroke-linecap="round" fill="none"/>
                              <path d="M35 15 L40 80 L25 90" stroke="white" stroke-width="3" stroke-linecap="round" fill="none"/>
                              <rect x="18" y="88" width="14" height="22" rx="5" fill="white" stroke="#ddd" stroke-width="2"/>
                              <circle cx="25" cy="102" r="2" fill="#ccc"/>
                              <circle cx="25" cy="96" r="2" fill="#ccc"/>
                          </svg>
                      </div>
                  </div> </div> </div> </div>
          <div class="home-screen-page">
            <div id="page-3-content">
              <!-- é¡¶éƒ¨ä¸ªäººèµ„æ–™å°ç»„ä»¶ -->
              <div class="p3-profile-widget">
                <div class="p3-profile-left">
                  <div class="p3-name-tag">
                    <span id="p3-profile-name" class="editable-text" onclick="editBubbleText('p3-profile-name')">Mochi</span>
                  </div>
                  <div class="p3-avatar-wrapper">
                    <img id="p3-avatar-img" src="https://i.imgur.com/Bv63o3h.jpg" class="editable-image" onclick="handleWidgetImageChange('p3-avatar-img')">
                  </div>
                  <div class="p3-profile-title">
                    <span id="p3-profile-title-text" class="editable-text" onclick="editBubbleText('p3-profile-title-text')">æ˜Ÿå±‘æ”¶é›†è€…</span>
                  </div>
                </div>
                <div class="p3-profile-right">
                  <p class="p3-deco-line">
                    <span id="p3-deco-line-1" class="editable-text" onclick="editBubbleText('p3-deco-line-1')">âœ¦.âº æœˆãŒé™ã‹ã«æ­Œã£ã¦ã„ã‚‹ âœ¦.Â°</span>
                  </p>
                  <div class="p3-dotted-divider"></div>
                  <p class="p3-deco-line">
                    <span id="p3-deco-line-2" class="editable-text" onclick="editBubbleText('p3-deco-line-2')">ä»Šå¤©ä¹Ÿè¦å…ƒæ°”æ»¡æ»¡åœ°æ‘¸é±¼ğŸŸâœ¨</span>
                  </p>
                  <div class="p3-dotted-divider"></div>
                  <p class="p3-deco-line p3-studio-line">
                    <span id="p3-deco-line-3" class="editable-text" onclick="editBubbleText('p3-deco-line-3')">âœ•âœ• âœ•â¸³ Neko_lab â¸³âœ• âœ•âœ•</span>
                  </p>
                </div>
              </div>

              <!-- å·¦å³åˆ†æ ï¼šçºªå¿µæ—¥ + å¾®åšå°ç»„ä»¶ -->
              <div class="p3-split-row">
                <!-- å·¦ï¼šçºªå¿µæ—¥ç»„ä»¶ -->
                <div class="p3-anniversary-widget">
                  <div class="anni-day-counter">
                    <span id="p3-day-count" class="editable-text" onclick="editBubbleText('p3-day-count')">128</span>
                    <span class="anni-day-unit">å¤©</span>
                  </div>
                  <div class="anni-photos">
                    <div class="anni-photo" onclick="handleWidgetImageChange('p3-circle-img-left')">
                      <img id="p3-circle-img-left" src="https://i.imgur.com/Bv63o3h.jpg" class="editable-image">
                    </div>
                    <div class="anni-photo" onclick="handleWidgetImageChange('p3-circle-img-right')">
                      <img id="p3-circle-img-right" src="https://i.imgur.com/GzPzBfF.jpg" class="editable-image">
                    </div>
                  </div>
                  <div class="anni-caption">
                    <span id="p3-circle-caption" class="editable-text" onclick="editBubbleText('p3-circle-caption')">with kittyğŸ±</span>
                  </div>
                  <div class="anni-date">
                    <span id="p3-circle-date" class="editable-text" onclick="editBubbleText('p3-circle-date')">2025.10.08</span>
                  </div>
                </div>
                <!-- å³ï¼šå¾®åš/å°çº¢ä¹¦å¸–å­ç»„ä»¶ -->
                <div class="p3-weibo-widget">
                  <div class="weibo-header">
                    <img id="p3-weibo-avatar" src="https://i.imgur.com/Bv63o3h.jpg" class="weibo-avatar editable-image" onclick="handleWidgetImageChange('p3-weibo-avatar')">
                    <div class="weibo-user-info">
                      <span id="p3-weibo-username" class="editable-text" onclick="editBubbleText('p3-weibo-username')">MochiDiary</span>
                      <span id="p3-weibo-date" class="weibo-post-date editable-text" onclick="editBubbleText('p3-weibo-date')">02-10</span>
                    </div>
                  </div>
                  <div class="weibo-body">
                    <p id="p3-weibo-text" class="editable-text" onclick="editBubbleText('p3-weibo-text')">Â· çª—å¤–ã®ã€Œè–„æš®è‰²Twilightã€<br>Â· è—åœ¨äº‘å±‚èƒŒåçš„é‡‘è‰²è¾¹<br>Â· å¥½å¤šçš„æ•…äº‹åƒè’²å…¬è‹±é£˜æ•£<br>Â· é—­ä¸Šçœ¼ã®åˆ¹é‚£..<br>Â· éƒ½åŒ–æˆäº†ä¸€é¦–æ¸©æŸ”çš„æ™šå®‰æ›².</p>
                  </div>
                  <div class="weibo-footer">
                    <span id="p3-weibo-device" class="editable-text" onclick="editBubbleText('p3-weibo-device')">æ¥è‡ª iPhone 15 Pro Max</span>
                  </div>
                  <div class="weibo-image" onclick="handleWidgetImageChange('p3-weibo-img')">
                    <img id="p3-weibo-img" src="https://i.imgur.com/5A0tE9a.jpeg" class="editable-image">
                  </div>
                </div>
              </div>

              <!-- ç¬¬ä¸‰é¡µ App ç½‘æ ¼ - ä¸¤è¡Œå››åˆ— -->
              <div id="page-3-app-grid">
                <!-- ç¬¬ä¸€è¡Œ -->
                <div class="desktop-app-icon" onclick="openMyphoneScreen()">
                  <div class="icon-bg-desktop">
                    <img id="icon-img-myphone" src="https://i.postimg.cc/MTC3Tkw8/IMG-6436.jpg" alt="Myphone">
                  </div>
                  <span class="label">Myphone</span>
                </div>
                <div class="desktop-app-icon" onclick="openDrawAndGuess()">
                  <div class="icon-bg-desktop">
                    <img id="icon-img-draw-guess" src="https://i.postimg.cc/k5dG3B4p/draw-guess-icon.png" alt="ä½ ç”»æˆ‘çŒœ">
                  </div>
                  <span class="label">ä½ ç”»æˆ‘çŒœ</span>
                </div>
                <div class="desktop-app-icon" onclick="openCharacterGeneratorScreen()">
                  <div class="icon-bg-desktop">
                    <img id="icon-img-char-generator" src="https://i.postimg.cc/nzGYM8qb/character-gen.jpg" alt="è§’è‰²ç”Ÿæˆ">
                  </div>
                  <span class="label">è§’è‰²ç”Ÿæˆ</span>
                </div>
                <div class="desktop-app-icon" onclick="showScreen('online-app-screen')">
                  <div class="icon-bg-desktop">
                    <img id="icon-img-online-app" src="https://i.postimg.cc/MTC3Tkw8/IMG-6436.jpg" alt="è”æœº">
                  </div>
                  <span class="label">è”æœº</span>
                </div>
                <!-- ç¬¬äºŒè¡Œ - å ä½ -->
                <div class="desktop-app-icon p3-placeholder-app">
                  <div class="icon-bg-desktop"><div class="p3-placeholder-icon">?</div></div>
                  <span class="label">è®ºå›</span>
                </div>
                <div class="desktop-app-icon p3-placeholder-app">
                  <div class="icon-bg-desktop"><div class="p3-placeholder-icon">?</div></div>
                  <span class="label">å®¶å±…</span>
                </div>
                <div class="desktop-app-icon p3-placeholder-app">
                  <div class="icon-bg-desktop"><div class="p3-placeholder-icon">?</div></div>
                  <span class="label">å® ç‰©</span>
                </div>
                <div class="desktop-app-icon p3-placeholder-app">
                  <div class="icon-bg-desktop"><div class="p3-placeholder-icon">?</div></div>
                  <span class="label">æ–°ä¸–ç•Œ</span>
                </div>
              </div>
            </div>
          </div>
        </div> </div>
      <div id="home-screen-pagination">
        <div class="pagination-dot active"></div>
        <div class="pagination-dot"></div>
        <div class="pagination-dot"></div>
      </div>
      <div id="desktop-dock">
        <div class="desktop-app-icon" onclick="showScreen('api-settings-screen')">
          <div class="icon-bg-desktop"><img id="icon-img-api-settings" src="https://i.postimg.cc/MK8rJ8t7/IMG-6438.jpg" alt="APIè®¾ç½®"></div> <span class="label"data-lang-key="homeAppApiSettings">APIè®¾ç½®</span>
        </div>
        <div class="desktop-app-icon" onclick="showScreen('font-settings-screen')">
          <div class="icon-bg-desktop"><img id="icon-img-font" src="https://i.postimg.cc/pXxk1JXk/IMG-6442.jpg" alt="å­—ä½“"></div> <span class="label"data-lang-key="homeAppFont">å­—ä½“</span>
        </div>
        <div class="desktop-app-icon" onclick="openCharacterSelector()">
          <div class="icon-bg-desktop"><img id="icon-img-char-phone" src="https://i.postimg.cc/pXj9h20L/IMG-7275.jpg" alt="Cphone"></div> <span class="label"data-lang-key="homeAppCPhone">Cphone</span>
        </div>
        <div class="desktop-app-icon" onclick="showScreen('douban-screen')">
          <div class="icon-bg-desktop"><img id="icon-img-douban" src="https://i.postimg.cc/Pq2xJN1g/IMG-7301.jpg" alt="è±†ç“£"></div> <span class="label"data-lang-key="homeAppDouban">è±†ç“£</span>
        </div>
      </div>
    </div>
    <div id="character-selection-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">â€¹</span> <span data-lang-key="cphoneTitleSelect">é€‰æ‹©ä¸€éƒ¨æ‰‹æœº</span> <span style="width: 30px;"></span> </div>
      <div id="character-grid" class="list-container"> </div>
    </div>
    <div id="character-phone-screen" class="screen">
      <div id="char-home-screen" class="char-screen active">
        <div style="height: 50px;"></div>

        <div id="cphone-pages-container">
          <div id="cphone-pages">
            <div class="cphone-page">
              <div id="cphone-layout-container">
            
            <div class="cphone-staggered-group">
                <div class="cphone-bubble-pill top">
                    <div class="bubble-avatar-container">
                        <img id="cphone-widget-avatar-1" src="https://i.postimg.cc/y8xWzCqj/anime-boy.jpg" class="editable-image" onclick="handleWidgetImageChange('cphone-widget-avatar-1')">
                    </div>
                    <div class="bubble-content left-align" onclick="editBubbleText('cphone-text-1')">
                         
                         <p id="cphone-text-1">Cat radio stationâ˜†ï¾Ÿ.*ï½¥ï½¡</p>
                         
                    </div>
                </div>
                
                <div class="cphone-bubble-pill bottom">
                    <div class="bubble-content right-align" onclick="editBubbleText('cphone-text-2')">
                        <p id="cphone-text-2" style="font-family: 'Times New Roman', serif;">It's 17:03:42 Now, Good Afternoonâœ¨</p>
                    </div>
                    <div class="bubble-avatar-container">
                        <img id="cphone-widget-avatar-2" src="https://i.postimg.cc/VkQfgzGJ/1.jpg" class="editable-image" onclick="handleWidgetImageChange('cphone-widget-avatar-2')">
                    </div>
                </div>
            </div>

            <div class="cphone-fixed-row">
                <div class="cphone-fixed-app-grid">
                    <div class="app-icon small" onclick="openCharApp('qq')">
                        <div class="icon-bg"><img id="cphone-icon-img-qq" src=""></div><span class="label">QQ</span>
                    </div>
                    <div class="app-icon small" onclick="openCharApp('album')">
                        <div class="icon-bg"><img id="cphone-icon-img-album" src=""></div><span class="label" data-lang-key="cphoneAppAlbum">ç›¸å†Œ</span>
                    </div>
                    <div class="app-icon small" onclick="openCharApp('browser')">
                        <div class="icon-bg"><img id="cphone-icon-img-browser" src=""></div><span class="label" data-lang-key="cphoneAppBrowser">æµè§ˆå™¨</span>
                    </div>
                    <div class="app-icon small" onclick="openCharApp('taobao')">
                        <div class="icon-bg"><img id="cphone-icon-img-taobao" src=""></div><span class="label" data-lang-key="cphoneAppTaobao">æ·˜å®</span>
                    </div>
                </div>

                <div class="cphone-stack-polaroid">
                    <div class="polaroid-bg-layer"></div>
                    <div class="polaroid-main-layer">
                        <div class="polaroid-photo-frame">
                             <img id="cphone-polaroid-img" src="https://i.imgur.com/Bv63o3h.jpg" class="editable-image" onclick="handleWidgetImageChange('cphone-polaroid-img')">
                        </div>
                    </div>
                </div>
            </div>

            <div class="cphone-fixed-row">
                <div class="cphone-circle-widget-wrapper">
                    <div class="cphone-circle-bg">
                         <img id="cphone-circle-img" src="https://i.imgur.com/Wp72cEM.jpg" class="editable-image" onclick="handleWidgetImageChange('cphone-circle-img')">
                    </div>
                    <div class="circle-text-area">
    <p id="cphone-circle-text" onclick="editBubbleText('cphone-circle-text')">Super happy</p>
    <p id="cphone-circle-subtext" onclick="editBubbleText('cphone-circle-subtext')">Day & Night</p> 
</div>
                </div>

                <div class="cphone-fixed-app-grid">
                     <div class="app-icon small" onclick="openCharApp('memo')">
                        <div class="icon-bg"><img id="cphone-icon-img-memo" src=""></div><span class="label"data-lang-key="cphoneAppMemo">å¤‡å¿˜å½•</span>
                    </div>
                    <div class="app-icon small" onclick="openCharApp('diary')">
                        <div class="icon-bg"><img id="cphone-icon-img-diary" src=""></div><span class="label"data-lang-key="cphoneAppDiary">æ—¥è®°</span>
                    </div>
                    <div class="app-icon small" onclick="openCharApp('amap')">
                        <div class="icon-bg"><img id="cphone-icon-img-amap" src=""></div><span class="label"data-lang-key="cphoneAppAmap">é«˜å¾·åœ°å›¾</span>
                    </div>
                    <div class="app-icon small" onclick="openCharApp('usage')">
                        <div class="icon-bg"><img id="cphone-icon-img-usage" src=""></div><span class="label"data-lang-key="cphoneAppUsage">APPè®°å½•</span>
                    </div>
                </div>
            </div>

              </div>
            </div>

            <!-- CPhone ç¬¬äºŒé¡µ -->
            <div class="cphone-page">
              <div id="cphone-page-2-container">
                <div style="height: 80px;"></div>
                
                <div class="cphone-fixed-row">
                  <div class="cphone-fixed-app-grid">
                    <div class="app-icon small" onclick="openCharApp('settings')">
                      <div class="icon-bg"><img id="cphone-icon-img-settings" src="https://i.postimg.cc/mkmMRpqb/settings-icon.png"></div>
                      <span class="label" data-lang-key="cphoneAppSettings">è®¾ç½®</span>
                    </div>
                  </div>
                </div>

              </div>
            </div>

          </div>
        </div>

        <!-- é¡µé¢æŒ‡ç¤ºå™¨ -->
        <div class="cphone-pagination">
          <span class="cphone-pagination-dot active" data-page="0"></span>
          <span class="cphone-pagination-dot" data-page="1"></span>
        </div>

        <div class="cphone-dock-container">
            <div class="cphone-dock glass">
                <div class="app-icon" onclick="openCharApp('music')">
                    <div class="icon-bg"><img id="cphone-icon-img-music" src=""></div>
                    <span class="label" data-lang-key="cphoneAppMusic">éŸ³ä¹</span>
                </div>
                <div class="app-icon" onclick="openCharApp('bilibili')">
                    <div class="icon-bg" style="background-color: #FB7299;"><img id="cphone-icon-img-bilibili" src="https://i.postimg.cc/Wz5gV0jB/bilibili-icon.png" style="border-radius:0;"></div>
                    <span class="label">Bilibili</span>
                </div>
                <div class="app-icon" onclick="openCharApp('reddit')">
                    <div class="icon-bg"><img id="cphone-icon-img-reddit" src=""></div>
                    <span class="label">Reddit</span>
                </div>
                <div class="app-icon" onclick="switchToMyPhone()">
                    <div class="icon-bg"><img id="cphone-icon-img-ephone" src=""></div>
                    <span class="label">Ephone</span>
                </div>
            </div>
        </div>
      </div> 
      <div id="char-amap-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">â€¹</span> <span>è¶³è¿¹</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-amap-btn" title="é‡æ–°ç”Ÿæˆè¶³è¿¹"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-amap-list" class="list-container"> </div>
      </div>
      <div id="char-qq-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">â€¹</span> <span>QQ</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-qq-btn" title="é‡æ–°ç”Ÿæˆ"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-chat-list" class="list-container"></div>
      </div>
      <div id="char-qq-conversation-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="back-to-char-qq-list-btn">â€¹</span> <span id="char-conversation-partner-name"></span> <span style="width: 30px;"></span> </div>
        <div id="char-conversation-messages" class="list-container"> </div>
        <div id="char-conversation-input-area" style="padding: 8px; border-top: 1px solid var(--border-color); display: flex; gap: 8px; background-color: #f7f7f7;"> <input type="text" id="char-simulated-input" placeholder="è¿™æ˜¯æ¨¡æ‹Ÿå¯¹è¯ï¼Œæ— æ³•å‘é€æ¶ˆæ¯" data-lang-key-placeholder="cphoneSimulatedChatPlaceholder"disabled
            style="flex-grow: 1; padding: 10px; border-radius: 6px; border: 1px solid #ddd; background: #eee;"> <button id="char-simulated-send-btn" style="padding: 0 20px; border: none; background-color: var(--accent-color); color: white; border-radius: 6px; font-weight: 500;">å‘é€</button> </div>
      </div>
      <div id="char-album-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">â€¹</span> <span data-lang-key="cphoneAlbumTitle">TAçš„ç›¸å†Œ</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-album-btn" title="é‡æ–°ç”Ÿæˆç›¸å†Œå†…å®¹"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div class="list-container">
          <div id="char-album-grid"></div>
        </div>
      </div>
      <div id="char-browser-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">â€¹</span> <span data-lang-key="cphoneBrowserTitle">TAçš„æµè§ˆå™¨å†å²</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-browser-btn" title="é‡æ–°ç”Ÿæˆæµè§ˆè®°å½•"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-browser-history" class="list-container"> </div>
      </div>
      <div id="char-browser-article-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharScreen('char-browser-screen')">â€¹</span> <span id="char-article-title" style="max-width: 70%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">æ–‡ç« </span>
          <div class="header-actions"> <span class="action-btn" id="favorite-article-btn" title="æ”¶è—"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg> </span> <span class="action-btn" id="copy-article-content-btn" title="å¤åˆ¶å†…å®¹"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg> </span> </div>
        </div>
        <div id="char-article-content" class="list-container" style="padding: 20px; font-size: 16px; line-height: 1.8; overflow-y: auto;"></div>
      </div>
      <div id="char-taobao-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">â€¹</span> <span data-lang-key="cphoneTaobaoTitle">TAçš„æ·˜å®è®¢å•</span>
          <div class="header-actions"> <span class="action-btn" id="char-wallet-btn" title="æŸ¥çœ‹é’±åŒ…" onclick="openCharWallet()"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M20 12V8H4v4"></path>
                <path d="M4 8V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v2"></path>
                <path d="M18 12v6a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-6"></path>
              </svg> </span> <span class="action-btn" id="regenerate-char-taobao-btn" title="é‡æ–°ç”Ÿæˆè´­ä¹°è®°å½•"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-product-grid" class="list-container"></div>
      </div>
      <div id="char-wallet-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="char-wallet-back-btn">â€¹</span> <span data-lang-key="cphoneWalletTitle">é’±åŒ…</span> <span style="width: 30px;"></span> </div>
        <div id="char-wallet-content" class="list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
      </div>
      <div id="char-memo-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">â€¹</span> <span data-lang-key="cphoneMemoTitle">å¤‡å¿˜å½•</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-memo-btn" title="é‡æ–°ç”Ÿæˆå¤‡å¿˜å½•"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> <span class="action-btn" id="add-char-memo-btn">+</span> </div>
        </div>
        <div id="char-memo-list" class="list-container" style="padding: 10px;"></div>
      </div>
      <div id="char-memo-detail-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="char-memo-detail-back-btn">â€¹</span> <span id="char-memo-detail-title"></span>
          <div class="header-actions"> <span class="action-btn" id="favorite-memo-btn" title="æ”¶è—"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg> </span> <span class="action-btn" id="copy-memo-content-btn" title="å¤åˆ¶å†…å®¹"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg> </span> </div>
        </div>
        <div class="form-container" style="padding: 0;"> <textarea id="char-memo-detail-content" readonly></textarea> </div>
      </div>
      <div id="char-diary-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">â€¹</span> <span data-lang-key="cphoneDiaryTitle">æ—¥è®°</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-diary-btn" title="é‡æ–°ç”Ÿæˆæ—¥è®°æœ¬"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> <span class="action-btn" id="add-char-diary-btn">+</span> </div>
        </div>
        <div id="char-diary-list" class="list-container"></div>
      </div>
      <div id="char-diary-detail-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="char-diary-detail-back-btn">â€¹ </span> <span id="char-diary-detail-title"></span>
          <div class="header-actions"> <span class="action-btn" id="favorite-diary-btn" title="æ”¶è—"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg> </span> <span class="action-btn" id="copy-diary-content-btn" title="å¤åˆ¶å†…å®¹"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg> </span> </div>
        </div>
        <div id="char-diary-detail-content-wrapper" class="list-container">
          <div id="char-diary-detail-content"> </div>
        </div>
      </div>
      <div id="char-usage-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">â€¹</span> <span data-lang-key="cphoneUsageTitle">Appä½¿ç”¨è®°å½•</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-usage-btn" title="é‡æ–°ç”Ÿæˆè®°å½•"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-usage-list" class="list-container"> </div>
      </div>
      <div id="char-qq-transcript-modal" class="modal">
        <div class="modal-content" style="height: 80%;">
          <div class="modal-header"> <span id="transcript-modal-char-name"></span> </div>
          <div class="modal-body" id="transcript-modal-body" style="background-color: #f0f2f5; padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
          <div class="modal-footer"> <button class="save" id="close-transcript-modal-btn" style="width:100%;">å…³é—­</button> </div>
        </div>
      </div>
      <div id="char-music-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">â€¹</span> <span data-lang-key="cphoneMusicTitle">TAçš„æ­Œå•</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-music-btn" title="é‡æ–°ç”Ÿæˆæ­Œå•"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-music-list" class="list-container"> </div>
      </div>
<div id="char-reddit-screen" class="char-screen">
  <div class="header" >
    <span class="back-btn" onclick="switchToCharHomeScreen()">â€¹</span>
    <span>Reddit</span>
    
    <div class="header-actions"> 
        <span class="action-btn" id="regenerate-char-reddit-btn" title="æ ¹æ®äººè®¾ç”Ÿæˆæ¨èæµ"> 
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
            </svg> 
        </span> 
    </div>
    </div>
  
  <div class="search-bar-container" style="background-color: #fff; padding: 10px; border-bottom: 1px solid #eee;">
    <div style="display: flex; gap: 8px;">
      <input type="search" id="char-reddit-search-input" placeholder="æœç´¢ Reddit..." 
             style="flex-grow:1; padding: 8px 12px; border-radius: 20px; border: 1px solid #ddd; background: #f6f7f8;">
      <button id="char-reddit-search-btn" class="form-button" 
              style="width: auto; margin: 0; padding: 0 15px; background-color: #FF4500; border-radius: 20px; font-size: 14px;">Go</button>
    </div>
  </div>

  <div id="char-reddit-list" class="list-container" style="padding: 0; background-color: #DAE0E6;">
  </div>
</div>
      <div id="char-bilibili-screen" class="char-screen">
        <div class="header"> 
            <span class="back-btn" onclick="switchToCharHomeScreen()">â€¹</span> 
            <span>Bilibili</span> 
            <div class="header-actions"> 
                <span class="action-btn" id="regenerate-char-bilibili-btn" title="æ ¹æ®äººè®¾ç”Ÿæˆæ¨è"> 
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                        <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
                    </svg> 
                </span> 
            </div>
            </div>
        <div class="search-bar-container" style="padding: 10px; background: transparent;"> 
            <div style="display: flex; gap: 8px;">
                <input type="search" id="char-bilibili-search-input" placeholder="æœç´¢è§†é¢‘..." style="flex-grow:1; padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border-color);"> 
                <button id="char-bilibili-search-btn" class="form-button" style="width: auto; margin: 0; padding: 0 15px; background-color: #FB7299;">æœç´¢</button> 
            </div>
        </div>
        <div id="char-bilibili-list" class="list-container" style="padding: 10px;"> </div>
      </div>

      <div id="char-bilibili-player-screen" class="char-screen" style="background-color: var(--secondary-bg);">
    <div class="header"> 
        <span class="back-btn" onclick="closeCharBilibiliPlayer()">â€¹</span> 
        <span>è§†é¢‘è¯¦æƒ…</span> 
        <span style="width: 30px;"></span> 
    </div>
        <div style="display: flex; flex-direction: column; height: 100%;">
            <div style="width: 100%; aspect-ratio: 16/9; background: black; display: flex; align-items: center;">
                <video id="char-bilibili-video" controls playsinline style="width: 100%; max-height: 100%;"></video>
            </div>
            <div class="list-container" style="background-color: var(--secondary-bg); flex-grow: 1; padding: 15px;">
                <h2 id="char-bilibili-player-title" style="font-size: 18px; margin: 0 0 10px 0; line-height: 1.4;"></h2>
                <div id="char-bilibili-player-author" style="font-size: 14px; color: #FB7299; font-weight: 500; margin-bottom: 15px;"></div>
                <div style="height: 1px; background: var(--border-color); margin-bottom: 15px;"></div>
                <div id="char-bilibili-player-desc" style="font-size: 13px; color: var(--text-secondary); line-height: 1.6; white-space: pre-wrap;"></div>
            </div>
        </div>
      </div>
    </div>
    
    <!-- MY Phone è§’è‰²é€‰æ‹©å±å¹• -->
    <div id="myphone-selection-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">â€¹</span> <span data-lang-key="myphoneTitleSelect">è°å¯ä»¥æŸ¥çœ‹ä½ çš„æ‰‹æœº</span> <span style="width: 30px;"></span> </div>
      <div id="myphone-character-grid" class="list-container"> </div>
    </div>
    
    <!-- MY Phone ä¸»å±å¹• -->
    <div id="myphone-screen" class="screen">
      <div id="myphone-home-screen" class="char-screen active">
        <div style="height: 50px;"></div>

        <div id="myphone-pages-container">
          <div id="myphone-pages">
            <div class="myphone-page">
              <div id="myphone-layout-container">
            
            <div class="cphone-staggered-group">
                <div class="cphone-bubble-pill top">
                    <div class="bubble-avatar-container">
                        <img id="myphone-widget-avatar-1" src="https://i.postimg.cc/y8xWzCqj/anime-boy.jpg" class="editable-image" onclick="handleWidgetImageChange('myphone-widget-avatar-1')">
                    </div>
                    <div class="bubble-content left-align" onclick="editBubbleText('myphone-text-1')">
                         
                         <p id="myphone-text-1">My little world â™¡</p>
                         
                    </div>
                </div>
                
                <div class="cphone-bubble-pill bottom">
                    <div class="bubble-content right-align" onclick="editBubbleText('myphone-text-2')">
                        <p id="myphone-text-2" style="font-family: 'Times New Roman', serif;">Welcome to my phone~</p>
                    </div>
                    <div class="bubble-avatar-container">
                        <img id="myphone-widget-avatar-2" src="https://i.postimg.cc/VkQfgzGJ/1.jpg" class="editable-image" onclick="handleWidgetImageChange('myphone-widget-avatar-2')">
                    </div>
                </div>
            </div>

            <div class="cphone-fixed-row">
                <div class="cphone-fixed-app-grid">
                    <div class="app-icon small" onclick="openMyPhoneApp('qq')">
                        <div class="icon-bg"><img id="myphone-icon-img-qq" src=""></div><span class="label">QQ</span>
                    </div>
                    <div class="app-icon small" onclick="openMyPhoneApp('album')">
                        <div class="icon-bg"><img id="myphone-icon-img-album" src=""></div><span class="label" data-lang-key="cphoneAppAlbum">ç›¸å†Œ</span>
                    </div>
                    <div class="app-icon small" onclick="openMyPhoneApp('browser')">
                        <div class="icon-bg"><img id="myphone-icon-img-browser" src=""></div><span class="label" data-lang-key="cphoneAppBrowser">æµè§ˆå™¨</span>
                    </div>
                    <div class="app-icon small" onclick="openMyPhoneApp('taobao')">
                        <div class="icon-bg"><img id="myphone-icon-img-taobao" src=""></div><span class="label" data-lang-key="cphoneAppTaobao">æ·˜å®</span>
                    </div>
                </div>

                <div class="cphone-stack-polaroid">
                    <div class="polaroid-bg-layer"></div>
                    <div class="polaroid-main-layer">
                        <div class="polaroid-photo-frame">
                             <img id="myphone-polaroid-img" src="https://i.imgur.com/Bv63o3h.jpg" class="editable-image" onclick="handleWidgetImageChange('myphone-polaroid-img')">
                        </div>
                    </div>
                </div>
            </div>

            <div class="cphone-fixed-row">
                <div class="cphone-circle-widget-wrapper">
                    <div class="cphone-circle-bg">
                         <img id="myphone-circle-img" src="https://i.imgur.com/Wp72cEM.jpg" class="editable-image" onclick="handleWidgetImageChange('myphone-circle-img')">
                    </div>
                    <div class="circle-text-area">
    <p id="myphone-circle-text" onclick="editBubbleText('myphone-circle-text')">My Mood</p>
    <p id="myphone-circle-subtext" onclick="editBubbleText('myphone-circle-subtext')">Today</p> 
</div>
                </div>

                <div class="cphone-fixed-app-grid">
                     <div class="app-icon small" onclick="openMyPhoneApp('memo')">
                        <div class="icon-bg"><img id="myphone-icon-img-memo" src=""></div><span class="label"data-lang-key="cphoneAppMemo">å¤‡å¿˜å½•</span>
                    </div>
                    <div class="app-icon small" onclick="openMyPhoneApp('diary')">
                        <div class="icon-bg"><img id="myphone-icon-img-diary" src=""></div><span class="label"data-lang-key="cphoneAppDiary">æ—¥è®°</span>
                    </div>
                    <div class="app-icon small" onclick="openMyPhoneApp('amap')">
                        <div class="icon-bg"><img id="myphone-icon-img-amap" src=""></div><span class="label"data-lang-key="cphoneAppAmap">é«˜å¾·åœ°å›¾</span>
                    </div>
                    <div class="app-icon small" onclick="openMyPhoneApp('usage')">
                        <div class="icon-bg"><img id="myphone-icon-img-usage" src=""></div><span class="label"data-lang-key="cphoneAppUsage">APPè®°å½•</span>
                    </div>
                </div>
            </div>

              </div>
            </div>

          </div>
        </div>

        <div class="cphone-dock-container">
            <div class="cphone-dock glass">
                <div class="app-icon" onclick="openMyPhoneApp('music')">
                    <div class="icon-bg"><img id="myphone-icon-img-music" src=""></div>
                    <span class="label" data-lang-key="cphoneAppMusic">éŸ³ä¹</span>
                </div>
                <div class="app-icon" onclick="openMyPhoneSettings()">
                    <div class="icon-bg"><img id="myphone-icon-img-settings" src=""></div>
                    <span class="label">è®¾ç½®</span>
                </div>
                <div class="app-icon" onclick="openMyPhoneViewRecords()">
                    <div class="icon-bg"><img id="myphone-icon-img-records" src=""></div>
                    <span class="label">æŸ¥çœ‹è®°å½•</span>
                </div>
                <div class="app-icon" onclick="showScreen('home-screen')">
                    <div class="icon-bg"><img id="myphone-icon-img-ephone" src=""></div>
                    <span class="label">EPhone</span>
                </div>
            </div>
        </div>
      </div>
      
      <!-- MY Phone é«˜å¾·åœ°å›¾ -->
      <div id="myphone-amap-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">â€¹</span> <span>è¶³è¿¹</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-amap-btn" title="æ‰‹åŠ¨æ·»åŠ è¶³è¿¹"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-amap-btn" title="é‡æ–°ç”Ÿæˆè¶³è¿¹"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-amap-btn" title="åˆ é™¤"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div id="myphone-amap-list" class="list-container"> </div>
      </div>
      
      <!-- MY Phone QQ -->
      <div id="myphone-qq-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">â€¹</span> <span>QQ</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-qq-btn" title="æ‰‹åŠ¨æ·»åŠ å¯¹è¯"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-qq-btn" title="é‡æ–°ç”Ÿæˆ"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-qq-btn" title="åˆ é™¤"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div id="myphone-chat-list" class="list-container"></div>
      </div>
      
      <!-- MY Phone QQ å¯¹è¯ -->
      <div id="myphone-qq-conversation-screen" class="char-screen">
        <div class="header"> 
          <span class="back-btn" id="back-to-myphone-qq-list-btn">â€¹</span> 
          <span id="myphone-conversation-partner-name"></span> 
          <div class="header-actions" id="myphone-conversation-settings-btn" style="display: none;">
            <span class="action-btn" title="è®¾ç½®">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m-9-9h6m6 0h6"></path>
                <path d="M19.07 4.93l-4.24 4.24m0 5.66l4.24 4.24M4.93 4.93l4.24 4.24m0 5.66l-4.24 4.24"></path>
              </svg>
            </span>
          </div>
        </div>
        <div id="myphone-conversation-messages" class="list-container"> </div>
        <div id="myphone-conversation-input-area" style="padding: 8px; border-top: 1px solid var(--border-color); display: flex; gap: 8px; background-color: #f7f7f7;"> 
          <input type="text" id="myphone-simulated-input" placeholder="" style="flex-grow: 1; padding: 10px; border-radius: 6px; border: 1px solid #ddd; background: #eee;"> 
          <button id="myphone-simulated-send-btn" style="padding: 0 20px; border: none; background-color: var(--accent-color); color: white; border-radius: 6px; font-weight: 500;">å‘é€</button> 
        </div>
      </div>
      
      <!-- MY Phone è”ç³»äººè®¾ç½® -->
      <div id="myphone-contact-settings-screen" class="char-screen">
        <div class="header"> 
          <span class="back-btn" id="back-to-myphone-conversation-btn">â€¹</span> 
          <span>è”ç³»äººè®¾ç½®</span> 
          <span style="width: 30px;"></span> 
        </div>
        <div class="list-container" style="padding: 20px;">
          <div style="margin-bottom: 30px;">
            <div style="text-align: center; margin-bottom: 20px;">
              <div id="myphone-settings-avatar-preview" style="width: 80px; height: 80px; border-radius: 50%; margin: 0 auto; overflow: hidden; border: 2px solid var(--border-color);">
                <img id="myphone-settings-avatar-img" src="" style="width: 100%; height: 100%; object-fit: cover;">
              </div>
              <button id="myphone-change-avatar-btn" style="margin-top: 15px; padding: 8px 20px; background: var(--accent-color); color: white; border: none; border-radius: 6px; cursor: pointer;">æ›´æ¢å¤´åƒ</button>
            </div>
          </div>
          
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-color);">è”ç³»äººåç§°</label>
            <input type="text" id="myphone-settings-name" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--secondary-bg); color: var(--text-color); box-sizing: border-box;">
          </div>
          
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-color);">å¤‡æ³¨</label>
            <input type="text" id="myphone-settings-remark" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--secondary-bg); color: var(--text-color); box-sizing: border-box;">
          </div>
          
          <button id="myphone-save-contact-settings-btn" style="width: 100%; padding: 12px; background: var(--accent-color); color: white; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; margin-bottom: 15px;">ä¿å­˜è®¾ç½®</button>
          
          <div style="border-top: 1px solid var(--border-color); padding-top: 20px; margin-top: 20px;">
            <h3 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 500; color: var(--text-color);">å¯¹è¯è®°å½•</h3>
            <div id="myphone-conversation-list" style="max-height: 200px; overflow-y: auto;"></div>
            <button id="myphone-add-message-btn" style="width: 100%; padding: 10px; background: var(--secondary-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 6px; cursor: pointer; margin-top: 10px;">æ·»åŠ å¯¹è¯</button>
          </div>
        </div>
      </div>
      
      <!-- MY Phone ç›¸å†Œ -->
      <div id="myphone-album-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">â€¹</span> <span data-lang-key="myphoneAlbumTitle">æˆ‘çš„ç›¸å†Œ</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-album-btn" title="æ‰‹åŠ¨æ·»åŠ ç…§ç‰‡"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-album-btn" title="é‡æ–°ç”Ÿæˆç›¸å†Œå†…å®¹"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-album-btn" title="åˆ é™¤"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div class="list-container">
          <div id="myphone-album-grid"></div>
        </div>
      </div>
      
      <!-- MY Phone æµè§ˆå™¨ -->
      <div id="myphone-browser-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">â€¹</span> <span data-lang-key="myphoneBrowserTitle">æˆ‘çš„æµè§ˆå™¨å†å²</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-browser-btn" title="æ‰‹åŠ¨æ·»åŠ æµè§ˆè®°å½•"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-browser-btn" title="é‡æ–°ç”Ÿæˆæµè§ˆè®°å½•"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-browser-btn" title="åˆ é™¤"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div id="myphone-browser-list" class="list-container"> </div>
      </div>
      
      <!-- MY Phone æµè§ˆå™¨æ–‡ç« è¯¦æƒ… -->
      <div id="myphone-browser-article-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="back-to-myphone-browser-list-btn">â€¹</span> <span id="myphone-article-title-header"></span> <span style="width: 30px;"></span> </div>
        <div class="list-container" style="padding: 15px;">
          <h2 id="myphone-article-title" style="font-size: 20px; margin-bottom: 10px;"></h2>
          <div id="myphone-article-meta" style="font-size: 12px; color: var(--text-secondary); margin-bottom: 20px;"></div>
          <div id="myphone-article-content" style="font-size: 15px; line-height: 1.8; white-space: pre-wrap;"></div>
        </div>
      </div>
      
      <!-- MY Phone æ·˜å® -->
      <div id="myphone-taobao-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">â€¹</span> <span data-lang-key="myphoneTaobaoTitle">æˆ‘çš„æ·˜å®</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-taobao-btn" title="æ‰‹åŠ¨æ·»åŠ è´­ç‰©è®°å½•"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-taobao-btn" title="é‡æ–°ç”Ÿæˆè´­ç‰©è®°å½•"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-taobao-btn" title="åˆ é™¤"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div id="myphone-taobao-grid" class="list-container"> </div>
      </div>
      
      <!-- MY Phone é’±åŒ… -->
      <div id="myphone-wallet-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">â€¹</span> <span>é’±åŒ…</span> <span style="width: 30px;"></span> </div>
      </div>
      
      <!-- MY Phone å¤‡å¿˜å½• -->
      <div id="myphone-memo-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">â€¹</span> <span data-lang-key="myphoneMemoTitle">æˆ‘çš„å¤‡å¿˜å½•</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-memo-btn" title="æ‰‹åŠ¨æ·»åŠ å¤‡å¿˜å½•"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-memo-btn" title="é‡æ–°ç”Ÿæˆå¤‡å¿˜å½•"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-memo-btn" title="åˆ é™¤"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div id="myphone-memo-list" class="list-container"> </div>
      </div>
      
      <!-- MY Phone å¤‡å¿˜å½•è¯¦æƒ… -->
      <div id="myphone-memo-detail-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="back-to-myphone-memo-list-btn">â€¹</span> <span id="myphone-memo-title-header"></span> <span style="width: 30px;"></span> </div>
        <div class="list-container" style="padding: 15px;">
          <h3 id="myphone-memo-detail-title" style="font-size: 18px; margin-bottom: 10px;"></h3>
          <div id="myphone-memo-detail-date" style="font-size: 12px; color: var(--text-secondary); margin-bottom: 15px;"></div>
          <div id="myphone-memo-detail-content" style="font-size: 15px; line-height: 1.6; white-space: pre-wrap;"></div>
        </div>
      </div>
      
      <!-- MY Phone æ—¥è®° -->
      <div id="myphone-diary-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">â€¹</span> <span data-lang-key="myphoneDiaryTitle">æˆ‘çš„æ—¥è®°</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-diary-btn" title="æ‰‹åŠ¨æ·»åŠ æ—¥è®°"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-diary-btn" title="é‡æ–°ç”Ÿæˆæ—¥è®°"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-diary-btn" title="åˆ é™¤"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div id="myphone-diary-list" class="list-container"> </div>
      </div>
      
      <!-- MY Phone æ—¥è®°è¯¦æƒ… -->
      <div id="myphone-diary-detail-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="back-to-myphone-diary-list-btn">â€¹</span> <span id="myphone-diary-title-header"></span> <span style="width: 30px;"></span> </div>
        <div class="list-container" style="padding: 15px;">
          <h3 id="myphone-diary-detail-title" style="font-size: 18px; margin-bottom: 10px;"></h3>
          <div id="myphone-diary-detail-date" style="font-size: 12px; color: var(--text-secondary); margin-bottom: 5px;"></div>
          <div id="myphone-diary-detail-weather" style="font-size: 12px; color: var(--text-secondary); margin-bottom: 15px;"></div>
          <div id="myphone-diary-detail-preface" style="font-size: 14px; font-style: italic; color: var(--text-secondary); margin-bottom: 15px; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 8px;"></div>
          <div id="myphone-diary-detail-content" style="font-size: 15px; line-height: 1.6; white-space: pre-wrap;"></div>
        </div>
      </div>
      
      <!-- MY Phone APPä½¿ç”¨è®°å½• -->
      <div id="myphone-usage-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">â€¹</span> <span data-lang-key="myphoneUsageTitle">æˆ‘çš„APPä½¿ç”¨è®°å½•</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-usage-btn" title="æ‰‹åŠ¨æ·»åŠ ä½¿ç”¨è®°å½•"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-usage-btn" title="é‡æ–°ç”Ÿæˆä½¿ç”¨è®°å½•"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-usage-btn" title="åˆ é™¤"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div id="myphone-usage-list" class="list-container"> </div>
      </div>
      
      <!-- MY Phone éŸ³ä¹ -->
      <div id="myphone-music-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">â€¹</span> <span data-lang-key="myphoneMusicTitle">æˆ‘çš„éŸ³ä¹</span>
          <div class="header-actions"> 
            <span class="action-btn" id="add-myphone-music-btn" title="æ‰‹åŠ¨æ·»åŠ æ­Œæ›²"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> 
            </span>
            <span class="action-btn" id="regenerate-myphone-music-btn" title="é‡æ–°ç”Ÿæˆæ­Œå•"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> 
            </span>
            <span class="action-btn" id="delete-myphone-music-btn" title="åˆ é™¤"> 
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg> 
            </span> 
          </div>
        </div>
        <div id="myphone-music-list" class="list-container"> </div>
      </div>
      
      <!-- MY Phone è®¾ç½® -->
      <div id="myphone-settings-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">â€¹</span> <span>è®¾ç½®</span> <span style="width: 30px;"></span> </div>
        <div class="list-container" style="padding: 20px;">
          <div class="settings-section" style="background: var(--secondary-bg); border-radius: 12px; padding: 0; overflow: hidden;">
            <div class="settings-item" style="padding: 15px; border-bottom: 0.5px solid rgba(0,0,0,0.1);">
              <label style="font-size: 15px;">å¯ç”¨é”å±å¯†ç </label>
              <label class="toggle-switch">
                <input type="checkbox" id="myphone-lock-screen-toggle">
                <span class="slider"></span>
              </label>
            </div>
            
            <!-- é”å±è¯¦æƒ… (JSæ§åˆ¶æ˜¾ç¤ºéšè—) -->
            <div id="myphone-lock-screen-settings-detail" style="display: none;">
              <div class="settings-item" style="padding: 15px; background-color: rgba(0,0,0,0.02); border-bottom: 0.5px solid rgba(0,0,0,0.1);">
                <div style="display: flex; flex-direction: column; gap: 8px; width: 100%;">
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <label style="font-size: 14px; color: var(--text-secondary);">4ä½æ•°å­—å¯†ç </label>
                    <input type="tel" id="myphone-lock-screen-password-input" maxlength="4" placeholder="1234" 
                           style="width: 100px; padding: 8px 12px; border: 1px solid rgba(0,0,0,0.1); border-radius: 8px; 
                                  font-size: 14px; letter-spacing: 3px; text-align: center; background: white;">
                  </div>
                  <div style="font-size: 12px; color: var(--text-secondary); padding-left: 0;">
                    å¼€å¯åï¼Œç‚¹å‡»MyPhoneå›¾æ ‡æ—¶éœ€è¦è¾“å…¥å¯†ç æ‰èƒ½è¿›å…¥
                  </div>
                </div>
              </div>
              
              <div class="settings-item" style="padding: 15px; background-color: rgba(0,0,0,0.02);">
                <div style="display: flex; flex-direction: column; gap: 8px; width: 100%;">
                  <label style="font-size: 14px; color: var(--text-secondary);">é”å±å£çº¸</label>
                  <div style="display: flex; align-items: center; gap: 10px;">
                    <div id="myphone-lock-wallpaper-preview" class="wallpaper-thumbnail" 
                         style="width: 60px; height: 80px; border-radius: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; text-align: center;">
                      æ— 
                    </div>
                    <div style="display: flex; gap: 8px;">
                      <button class="settings-mini-btn" onclick="document.getElementById('myphone-lock-wallpaper-input').click()">æœ¬åœ°</button>
                      <button id="myphone-upload-lock-wallpaper-url-btn" class="settings-mini-btn">URL</button>
                    </div>
                    <input type="file" id="myphone-lock-wallpaper-input" accept="image/*" style="display: none;">
                  </div>
                  <div style="font-size: 12px; color: var(--text-secondary);">
                    è®¾ç½®æ­¤è§’è‰²MyPhoneçš„é”å±å£çº¸
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- MY Phone æŸ¥çœ‹è®°å½•ï¼ˆå ä½ï¼‰ -->
      <div id="myphone-view-records-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToMyPhoneHomeScreen()">â€¹</span> <span>æŸ¥çœ‹è®°å½•</span> <span style="width: 30px;"></span> </div>
        <div class="list-container" style="padding: 50px 20px; text-align: center; color: var(--text-secondary);">
          <p>æ­¤åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...</p>
        </div>
      </div>
    </div>
    
    <!-- è§’è‰²ç”Ÿæˆå™¨å±å¹•å°†ç”±character-generator.jsåŠ¨æ€åˆ›å»º -->
    
    <div id="world-book-screen" class="screen">
      <div class="header">
        <div class="header-left-actions"> <span class="back-btn" onclick="showScreen('home-screen')">â€¹</span> <span class="action-btn" id="import-world-book-btn" title="å¯¼å…¥ä¸–ç•Œä¹¦"data-lang-key-title="worldBookImportTitle"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg> </span> <span class="action-btn" id="export-world-book-btn" title="å¯¼å‡ºä¸–ç•Œä¹¦"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg> </span> </div> <span data-lang-key="worldBookTitle">ä¸–ç•Œä¹¦</span>
        <div class="header-actions"> <span class="action-btn" id="manage-world-book-categories-btn" title="ç®¡ç†åˆ†ç±»"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg> </span> <span class="action-btn" id="add-world-book-btn">+</span> </div>
      </div>
      <div id="world-book-tabs"></div>
      <div id="world-book-content-container"></div>
    </div>
    <div id="world-book-editor-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('world-book-screen')">â€¹</span> <span id="world-book-editor-title"data-lang-key="worldBookEditorTitle"data-lang-key="edit">ç¼–è¾‘ä¸–ç•Œä¹¦</span> <span class="save-btn" id="save-world-book-btn"data-lang-key="save">ä¿å­˜</span> </div>
      <div class="form-container">
        <div class="form-group"> <label for="world-book-name-input"data-lang-key="worldBookNameLabel">ä¹¦å</label> <input type="text" id="world-book-name-input" placeholder="è¯·è¾“å…¥ä¸–ç•Œä¹¦çš„åç§°..."data-lang-key-placeholder="worldBookNamePlaceholder"> </div>
        <div class="form-group"> <label for="world-book-category-select"data-lang-key="worldBookCategoryLabel">åˆ†ç±»</label> <select id="world-book-category-select"></select> </div>
        <div class="form-group">
          <label style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;">
            <span>
              <span style="font-weight: 500;">å…¨å±€ä¸–ç•Œä¹¦</span>
              <span style="font-size: 12px; color: var(--text-secondary); display: block; margin-top: 4px;">å¼€å¯åï¼Œæ‰€æœ‰è§’è‰²å°†è‡ªåŠ¨å…³è”æ­¤ä¸–ç•Œä¹¦</span>
            </span>
            <input type="checkbox" id="world-book-global-switch" style="width: 44px; height: 24px; cursor: pointer;">
          </label>
        </div>
        <div class="form-group" id="world-book-inject-position-group">
          <label for="world-book-inject-position-select">
            <span style="font-weight: 500;">æ³¨å…¥ä½ç½®</span>
            <span style="font-size: 12px; color: var(--text-secondary); display: block; margin-top: 4px;">é€‰æ‹©ä¸–ç•Œä¹¦å†…å®¹åœ¨æç¤ºè¯ä¸­çš„æ³¨å…¥ä½ç½®</span>
          </label>
          <select id="world-book-inject-position-select" style="margin-top: 8px; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--input-bg); color: var(--text-primary); font-size: 14px;">
            <option value="before">å‰ - æç¤ºè¯å‰é¢</option>
            <option value="middle">ä¸­ - æç¤ºè¯ä¸­é—´</option>
            <option value="after">å - æç¤ºè¯æœ€å</option>
          </select>
        </div>
        <div class="form-group" style="flex-grow: 1; display: flex; flex-direction: column;"> <label data-lang-key="worldBookEntriesLabel">å†…å®¹æ¡ç›®</label>
          <div id="world-book-entries-container" style="display: flex; flex-direction: column; gap: 15px; overflow-y: auto; padding: 5px; flex-grow: 1;"> </div>
        </div> <button id="add-world-book-entry-btn" class="form-button form-button-secondary"data-lang-key="worldBookAddEntryBtn"> [+] æ·»åŠ æ–°æ¡ç›® </button>
      </div>
    </div>
    <div id="preset-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">â€¹</span> <span data-lang-key="presetTitle">é¢„è®¾</span>
        <div class="header-actions"> <span class="action-btn" id="import-preset-btn" title="å¯¼å…¥é¢„è®¾æ–‡ä»¶" data-lang-key-title="presetImportTitle"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg> </span> <span class="action-btn" id="manage-preset-categories-btn" title="ç®¡ç†åˆ†ç±»"data-lang-key-title="presetManageCategoriesTitle"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
            </svg> </span> <span class="action-btn" id="add-preset-btn">+</span> </div>
      </div>
      <div id="preset-tabs"></div>
      <div id="preset-content-container"></div>
    </div>
    <div id="tutorial-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">â€¹</span> <span data-lang-key="tutorialTitle">æ•™ç¨‹</span> <span style="width: 30px;"></span> </div>
      <div class="list-container" style="padding: 0; overflow: hidden;"> <iframe id="tutorial-iframe" src="tutorial.html" style="width: 100%; height: 100%; border: none;"></iframe> </div>
    </div>
    <div id="preset-editor-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('preset-screen')">â€¹</span> <span id="preset-editor-title"data-lang-key="presetEditorTitle">ç¼–è¾‘é¢„è®¾</span> <span class="save-btn" id="save-preset-btn"data-lang-key="save">ä¿å­˜</span> </div>
      <div class="form-container">
        <div class="form-group"> <label for="preset-name-input"data-lang-key="presetNameLabel">é¢„è®¾åç§°</label> <input type="text" id="preset-name-input" placeholder="è¯·è¾“å…¥é¢„è®¾çš„åç§°..."data-lang-key-placeholder="presetNamePlaceholder"> </div>
        <div class="form-group"> <label for="preset-category-select"data-lang-key="presetCategoryLabel">åˆ†ç±»</label> <select id="preset-category-select"></select> </div>
        <div class="form-group" style="flex-grow: 1; display: flex; flex-direction: column;"> <label data-lang-key="presetEntriesLabel">å†…å®¹æ¡ç›®</label>
          <div id="preset-entries-container" style="display: flex; flex-direction: column; gap: 15px; overflow-y: auto; padding: 5px; flex-grow: 1;"> </div>
        </div> <button type="button" id="add-preset-entry-btn" class="form-button form-button-secondary"data-lang-key="presetAddEntryBtn"> [+] æ·»åŠ æ–°æ¡ç›® </button>
      </div>
    </div>
    <div id="api-settings-screen" class="screen ios-settings-screen">
      <div class="header"> 
        <span class="back-btn" onclick="showScreen('home-screen')">â€¹</span> 
        <span data-lang-key="apiSettingsTitle">è®¾ç½®</span> 
        <span class="save-btn" id="save-api-settings-btn" data-lang-key="save">å®Œæˆ</span> 
      </div>
      
      <div class="settings-container ios-scroll-container">
        
        <!-- è¯­è¨€è®¾ç½® -->
        <div class="settings-section">
            <div class="settings-item">
                <label for="language-select" data-lang-key="languageLabel">è¯­è¨€</label>
                <div class="settings-right">
                    <select id="language-select" class="settings-select">
                        <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                        <option value="en">English</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- è°ƒè¯•æ§åˆ¶å° -->
        <div class="settings-header">è°ƒè¯•å·¥å…·</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>ç§»åŠ¨ç«¯æ§åˆ¶å°</label>
                <div class="settings-right">
                    <button id="open-console-btn" class="settings-mini-btn">æ‰“å¼€æ§åˆ¶å°</button>
                </div>
            </div>
        </div>

        <!-- API é¢„è®¾ -->
        <div class="settings-header" data-lang-key="apiPresetManagement">é…ç½®é¢„è®¾</div>
        <div class="settings-section">
            <div class="settings-item">
                 <!-- ä¸‹æ‹‰æ¡†å®¹å™¨ï¼šflex-grow å æ»¡å·¦ä¾§ç©ºé—´ï¼Œå†…éƒ¨å·¦å¯¹é½ -->
                 <div style="flex-grow: 1; display: flex; align-items: center; justify-content: flex-start; overflow: hidden;">
                     <select id="api-preset-select" class="settings-select">
                         <!-- JS å¡«å……é€‰é¡¹ -->
                     </select>
                 </div>
                 
                 <!-- æŒ‰é’®ç»„ï¼šå›ºå®šåœ¨å³ä¾§ -->
                 <div class="settings-right" style="flex-grow: 0; width: auto; margin-left: 10px;">
                     <button id="save-api-preset-btn" class="settings-mini-btn">ä¿å­˜</button>
                     <button id="delete-api-preset-btn" class="settings-mini-btn">åˆ é™¤</button>
                 </div>
            </div>
        </div>

        <!-- ä¸» API è®¾ç½® -->
        <div class="settings-header" data-lang-key="apiPrimarySettings">ä¸» API (å¯¹è¯)</div>
        <div class="settings-section">
            <!-- 1. æç¤ºæ¡ (è¿˜åŸæˆªå›¾æ•ˆæœ) -->
            <div class="settings-tip-wrapper">
                <div class="settings-tip-content">
                    æç¤º: è‹¥è¦ä½¿ç”¨â€œå‘é€å›¾ç‰‡â€åŠŸèƒ½ï¼Œè¯·åŠ¡å¿…é€‰æ‹©æ”¯æŒ Vision(è§†è§‰) çš„æ¨¡å‹ï¼Œå¦‚ <code>gpt-4o</code> æˆ– <code>gpt-4-vision-preview</code>ã€‚
                </div>
            </div>

            <!-- 2. è¾“å…¥æ¡†éƒ¨åˆ† -->
            <div class="settings-item">
                <label>åä»£åœ°å€</label>
                <div class="settings-right">
                    <input type="text" id="proxy-url" placeholder="https://api.openai.com">
                </div>
            </div>
            <div class="settings-item">
                <label>API Key</label>
                <div class="settings-right">
                    <input type="password" id="api-key" placeholder="sk-...">
                </div>
            </div>
            <div class="settings-item">
                <label>æ¨¡å‹ï¼ˆæ‰‹å†™ï¼‰</label>
                <div class="settings-right">
                    <input type="text" id="model-input" placeholder="å¯æ‰‹å†™æ¨¡å‹åç§°æˆ–ä»ä¸‹æ–¹æ‹‰å–è‡ªåŠ¨å¡«å…¥" style="flex-grow: 1;">
                </div>
            </div>
            <div class="settings-item">
                <label>æ‹‰å–æ¨¡å‹</label>
                <div class="settings-right">
                    <select id="model-select" class="settings-select" style="flex-grow: 1; width: auto;"></select>
                    <button id="fetch-models-btn" class="settings-mini-btn">æ‹‰å–</button>
                </div>
            </div>
        </div>

        <!-- å‰¯ API è®¾ç½® -->
        <div class="settings-header" data-lang-key="apiSecondarySettings">å‰¯ API (é•¿è®°å¿†æ€»ç»“)</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>åä»£åœ°å€</label>
                <div class="settings-right">
                    <input type="text" id="secondary-proxy-url" placeholder="ç•™ç©ºä½¿ç”¨ä¸»API">
                </div>
            </div>
            <div class="settings-item">
                <label>API Key</label>
                <div class="settings-right">
                    <input type="password" id="secondary-api-key" placeholder="å¯é€‰">
                </div>
            </div>
            <!-- ä¿®æ”¹ç‚¹ï¼šæ¨¡å‹å’Œæ‹‰å–æŒ‰é’®åœ¨ä¸€è¡Œ -->
            <div class="settings-item">
                <label>æ¨¡å‹ï¼ˆæ‰‹å†™ï¼‰</label>
                <div class="settings-right">
                    <input type="text" id="secondary-model-input" placeholder="å¯æ‰‹å†™æ¨¡å‹åç§°æˆ–ä»ä¸‹æ–¹æ‹‰å–è‡ªåŠ¨å¡«å…¥" style="flex-grow: 1;">
                </div>
            </div>
            <div class="settings-item">
                <label>æ‹‰å–æ¨¡å‹</label>
                <div class="settings-right">
                     <!-- ä¸‹æ‹‰æ¡†å æ®å‰©ä½™ç©ºé—´ -->
                    <select id="secondary-model-select" class="settings-select" style="flex-grow: 1; width: auto;"></select>
                    <!-- æŒ‰é’®æ”¾åœ¨æ—è¾¹ -->
                    <button id="fetch-secondary-models-btn" class="settings-mini-btn">æ‹‰å–</button>
                </div>
            </div>
        </div>

        <!-- å‚æ•°è®¾ç½® -->
        <div class="settings-header">å‚æ•°è®¾ç½®</div>
        <div class="settings-section">
             <div class="settings-item">
                <label>æ¸©åº¦ (Temperature) <span id="api-temperature-value" style="color:var(--accent-color);">0.8</span></label>
                <div class="settings-right" style="width: 50%;">
                    <input type="range" id="api-temperature-slider" min="0" max="2" step="0.1" value="0.8">
                </div>
            </div>
        </div>

        <!-- åå°ä¸è‡ªåŠ¨åŒ– -->
        <div class="settings-header" data-lang-key="apiBgActivitySettings">åå°æ´»åŠ¨</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>å¯ç”¨åå°è§’è‰²æ´»åŠ¨</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="background-activity-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-item">
                <label>æ£€æµ‹é—´éš” (ç§’)</label>
                <div class="settings-right">
                    <input type="number" id="background-interval-input" min="30" value="60" class="settings-num-input">
                </div>
            </div>
            <div class="settings-item">
                <label>æ‹‰é»‘å†·é™æœŸ (å°æ—¶)</label>
                <div class="settings-right">
                    <input type="number" id="block-cooldown-input" min="0.1" step="0.1" value="1" class="settings-num-input">
                </div>
            </div>
        </div>
        <div class="settings-desc">å¼€å¯åå°æ´»åŠ¨ä¼šå¢åŠ  API è´¹ç”¨ã€‚</div>

        <!-- è¯­éŸ³è®¾ç½® -->
        <div class="settings-header" data-lang-key="apiTtsSettings">Minimax TTS è¯­éŸ³</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>Group ID</label>
                <div class="settings-right">
                     <input type="text" id="minimax-group-id" placeholder="è¾“å…¥ Group ID">
                </div>
            </div>
            <div class="settings-item">
                <label>API Key</label>
                <div class="settings-right">
                     <input type="password" id="minimax-api-key" placeholder="è¾“å…¥ API Key">
                </div>
            </div>
            <!-- åˆ†è¡Œ 1: æ¨¡å‹ -->
            <div class="settings-item">
                <label>æ¨¡å‹</label>
                <div class="settings-right">
                    <select id="minimax-model-select" class="settings-select">
                        <!-- JS ä¼šå¡«å……é€‰é¡¹ -->
                    </select>
                </div>
            </div>
            <!-- åˆ†è¡Œ 2: æ¥å£åŸŸå (æ‰‹åŠ¨å†™æ­»åœ¨è¿™é‡Œï¼Œä¸å†ä¾èµ– JS åŠ¨æ€æ’å…¥) -->
            <div class="settings-item">
                <label>æ¥å£åŸŸå</label>
                <div class="settings-right">
                    <select id="minimax-domain-select" class="settings-select">
                        <option value="https://api.minimax.chat">ğŸ‡¨ğŸ‡³ å›½å†… (api.minimax.chat)</option>
                        <option value="https://api.minimaxi.chat">ğŸŒ æµ·å¤– (api.minimaxi.chat)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- ç”Ÿå›¾è®¾ç½® (AI & NovelAI) -->
        <div class="settings-header" data-lang-key="apiImageGenSettings">å›¾åƒç”Ÿæˆ</div>
        <div class="settings-section">
            <!-- é€šç”¨ç”Ÿå›¾ -->
            <div class="settings-item">
                <label>å¯ç”¨é€šç”¨ AI ç”Ÿå›¾</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="enable-ai-drawing-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <!-- NovelAI -->
            <div class="settings-item">
                <label>å¯ç”¨ NovelAI</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="novelai-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <!-- Google Imagen -->
            <div class="settings-item">
                <label>å¯ç”¨ Google Imagen</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="google-imagen-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <!-- Google Imagen è¯¦æƒ… (JSæ§åˆ¶æ˜¾ç¤º/éšè—) -->
            <div id="google-imagen-details" style="display:none; background-color: #f9f9f9; border-top: 0.5px solid #ebedf0;">
                <div class="settings-item">
                    <label>API åœ°å€</label>
                    <div class="settings-right">
                        <input type="text" id="google-imagen-endpoint" placeholder="https://generativelanguage.googleapis.com" style="width:100%; font-size:12px;">
                    </div>
                </div>
                <div class="settings-item">
                    <label>API Key</label>
                    <div class="settings-right">
                        <div style="position:relative; width:100%;">
                             <input type="password" id="google-imagen-api-key" placeholder="AIzaSy...">
                             <span id="google-imagen-key-toggle" style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); cursor: pointer;">ğŸ§</span>
                        </div>
                    </div>
                </div>
                <div class="settings-item">
                    <label>æ¨¡å‹</label>
                    <div class="settings-right" style="display:flex; gap:6px; align-items:center;">
                         <select id="google-imagen-model" class="settings-select" style="flex:1;">
                            <option value="imagen-4.0-generate-001">Imagen 4 Standard</option>
                            <option value="imagen-4.0-ultra-generate-001">Imagen 4 Ultra</option>
                            <option value="imagen-4.0-fast-generate-001">Imagen 4 Fast</option>
                        </select>
                        <button id="google-imagen-fetch-models-btn" class="settings-mini-btn" style="white-space:nowrap; padding:4px 8px; font-size:12px;">ğŸ”„ æ‹‰å–</button>
                    </div>
                </div>
                <div class="settings-item">
                    <label>å®½é«˜æ¯”</label>
                    <div class="settings-right">
                         <select id="google-imagen-aspect-ratio" class="settings-select">
                            <option value="1:1">1:1 (æ–¹å½¢)</option>
                            <option value="3:4">3:4 (ç«–å±)</option>
                            <option value="4:3">4:3 (æ¨ªå±)</option>
                            <option value="9:16">9:16 (ç«–å±å®½)</option>
                            <option value="16:9">16:9 (æ¨ªå±å®½)</option>
                        </select>
                    </div>
                </div>
                <div class="settings-item" style="justify-content: space-around;">
                    <button id="google-imagen-test-btn" class="settings-mini-btn">ğŸ§ª æµ‹è¯•ç”Ÿæˆ</button>
                </div>
                <div id="google-imagen-test-result" style="display: none; padding: 10px 15px;">
                    <div style="font-weight: bold; color: #333; margin-bottom: 10px;">ç”Ÿæˆç»“æœï¼š</div>
                    <div style="text-align: center; background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef;">
                        <img id="google-imagen-result-image" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    </div>
                </div>
            </div>

            <!-- NovelAI è¯¦æƒ… (JSæ§åˆ¶æ˜¾ç¤º/éšè—) -->
            <div id="novelai-details" style="display:none; background-color: #f9f9f9; border-top: 0.5px solid #ebedf0;">
                <div class="settings-item">
                    <label>æ¨¡å‹</label>
                    <div class="settings-right">
                         <select id="novelai-model" class="settings-select">
                            <option value="nai-diffusion-4-curated-preview">V4.5 Curated</option>
                            <option value="nai-diffusion-4-5-full">V4.5 Full</option>
                            <option value="nai-diffusion-3">Anime V3</option>
                        </select>
                    </div>
                </div>
                <div class="settings-item">
                    <label>API Key</label>
                    <div class="settings-right">
                        <div style="position:relative; width:100%;">
                             <input type="password" id="novelai-api-key" placeholder="pst-...">
                             <span id="novelai-key-toggle" style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); cursor: pointer;">ğŸ§</span>
                        </div>
                    </div>
                </div>
                <div class="settings-item" style="justify-content: space-around;">
                    <button id="novelai-settings-btn" class="settings-mini-btn">âš™ï¸ ç”Ÿæˆå‚æ•°</button>
                    <button id="novelai-test-btn" class="settings-mini-btn">ğŸ§ª æµ‹è¯•ç”Ÿæˆ</button>
                </div>
            </div>
        </div>

        <!-- äº‘æœåŠ¡ä¸å­˜å‚¨ -->
        <!-- äº‘æœåŠ¡ä¸å­˜å‚¨ (ç°æ¡ä¸‹æ²‰ç‰ˆ) -->
        <div class="settings-header">äº‘æœåŠ¡ä¸å­˜å‚¨</div>
        <div class="settings-section">
             
             <!-- === ImgBB === -->
             <!-- 1. å…ˆæ”¾å¼€å…³è¡Œ -->
             <div class="settings-item">
                <label>ImgBB å›¾åºŠ</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="imgbb-enable-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <!-- 2. å†æ”¾è¯¦æƒ…å®¹å™¨ (ç°æ¡ç§»å…¥æ­¤å¤„) -->
            <div id="imgbb-settings-details" style="display:none;">
                 <!-- ç°æ¡è¢«ç§»åˆ°äº†è¿™é‡Œ -->
                 <div class="settings-tip-wrapper">
                    <div class="settings-tip-content">
                        å¼€å¯åï¼Œæœ¬åœ°å›¾ç‰‡å°†è‡ªåŠ¨ä¸Šä¼ åˆ° ImgBB å›¾åºŠä»¥å‡å°ä½“ç§¯ã€‚<br>
                        âš ï¸ å›¾ç‰‡å°†ä¸Šä¼ åˆ°å…¬å…±äº’è”ç½‘ï¼Œè¯·å‹¿ä¸Šä¼ ç§å¯†ç…§ç‰‡ï¼<br>
                        ğŸ”— <a href="https://api.imgbb.com/" target="_blank">ç‚¹å‡»æ­¤å¤„æ³¨å†Œå¹¶è·å– API Key</a>
                    </div>
                </div>
                
                 <div class="settings-item">
                    <label>API Key</label>
                     <div class="settings-right">
                        <div style="position:relative; width:100%;">
                            <input type="password" id="imgbb-api-key" placeholder="è¾“å…¥ ImgBB Key">
                            <span id="imgbb-key-toggle" style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); cursor: pointer;">ğŸ§</span>
                        </div>
                     </div>
                 </div>
            </div>

            <!-- === Catbox === -->
             <!-- 1. å¼€å…³ -->
             <div class="settings-item">
                <label>Catbox æ‰˜ç®¡</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="catbox-enable-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <!-- 2. è¯¦æƒ…å®¹å™¨ (ç°æ¡ç§»å…¥æ­¤å¤„) -->
            <div id="catbox-settings-details" style="display:none;">
                 <!-- ç°æ¡è¢«ç§»åˆ°äº†è¿™é‡Œ -->
                 <div class="settings-tip-wrapper">
                    <div class="settings-tip-content">
                        å¼€å¯åï¼Œæ­Œæ›²æ–‡ä»¶å°†ä¸Šä¼ åˆ° Catbox.moe æ‰˜ç®¡ã€‚<br>
                        ğŸ”— <a href="https://catbox.moe/user/manage.php" target="_blank">ç™»å½• Catbox æŸ¥çœ‹ User Hash</a>
                    </div>
                </div>

                 <div class="settings-item">
                    <label>User Hash</label>
                     <div class="settings-right">
                        <div style="position:relative; width:100%;">
                            <input type="password" id="catbox-userhash" placeholder="è¾“å…¥ User Hash">
                            <span id="catbox-key-toggle" style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); cursor: pointer;">ğŸ§</span>
                        </div>
                     </div>
                 </div>
            </div>

             <!-- === GitHub === -->
             <!-- 1. å¼€å…³ -->
             <div class="settings-item">
                <label>GitHub äº‘å¤‡ä»½</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="github-enable-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <!-- 2. è¯¦æƒ…å®¹å™¨ (ç°æ¡ç§»å…¥æ­¤å¤„) -->
            <div id="github-settings-details" style="display:none;">
                <!-- ç°æ¡è¢«ç§»åˆ°äº†è¿™é‡Œ -->
                <div class="settings-tip-wrapper">
                    <div class="settings-tip-content">
                        å°†æ•°æ®å¤‡ä»½åˆ°ç§æœ‰ GitHub ä»“åº“ï¼Œæ–¹ä¾¿è·¨è®¾å¤‡åŒæ­¥ã€‚<br>
                        1. <a href="https://github.com/new" target="_blank">åˆ›å»ºæ–°ä»“åº“</a> (å»ºè®®è®¾ä¸º Private)<br>
                        2. <a href="https://github.com/settings/tokens" target="_blank">è·å– Token</a> (å¿…é¡»å‹¾é€‰ <strong>repo</strong> æƒé™)
                    </div>
                </div>

                <div class="settings-item">
                    <label>è‡ªåŠ¨å¤‡ä»½ (åˆ†é’Ÿ)</label>
                    <div class="settings-right" style="gap: 5px;">
                         <input type="number" id="github-backup-interval" value="30" class="settings-num-input">
                         <label class="toggle-switch" style="transform: scale(0.8);">
                            <input type="checkbox" id="github-auto-backup-switch">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                 <div class="settings-item"><label>ç”¨æˆ·å</label><div class="settings-right"><input type="text" id="github-username" placeholder="å¦‚: yourname"></div></div>
                 <div class="settings-item"><label>ä»“åº“å</label><div class="settings-right"><input type="text" id="github-repo" placeholder="å¦‚: my-backup"></div></div>
                 <div class="settings-item"><label>Token</label><div class="settings-right"><div style="position:relative; width:100%;"><input type="password" id="github-token"><span id="github-token-toggle" style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); cursor: pointer;">ğŸ§</span></div></div></div>
                 <div class="settings-item"><label>æ–‡ä»¶å</label><div class="settings-right"><input type="text" id="github-filename" value="ephone_backup.json"></div></div>
                 
                 <!-- GitHub Proxy -->
                 <div class="settings-item">
                    <label>ä»£ç† (Worker)</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="github-proxy-switch">
                        <span class="slider"></span>
                    </label>
                </div>
                 <div id="github-proxy-input-group" style="display:none;">
                     <div class="settings-tip-wrapper" style="padding-top:10px !important;">
                        <div class="settings-tip-content">
                            å›½å†…ç½‘ç»œå»ºè®®å¼€å¯ã€‚éœ€è‡ªå»º Cloudflare Workerã€‚<br>
                            ğŸ”— <a href="https://dash.cloudflare.com/" target="_blank">å‰å¾€ Cloudflare æ§åˆ¶å°</a>
                        </div>
                    </div>
                    <div class="settings-item">
                        <label>ä»£ç†åœ°å€</label>
                        <div class="settings-right"><input type="text" id="github-proxy-url" placeholder="https://..."></div>
                    </div>
                 </div>
                 
                 <!-- GitHub æŒ‰é’® -->
                 <div class="settings-item" style="justify-content: space-around; flex-wrap: wrap; gap: 6px;">
                    <button id="github-upload-btn" class="settings-mini-btn">â˜ï¸ ä¸Šä¼ å¤‡ä»½</button>
                    <button id="github-upload-large-btn" class="settings-mini-btn">ğŸš€ å¤§æ•°æ®å¤‡ä»½</button>
                    <button id="github-download-btn" class="settings-mini-btn">ğŸ“¥ æ¢å¤å¤‡ä»½</button>
                </div>
            </div>
        </div>
        <!-- æ€§èƒ½ -->
        <div class="settings-header">æ€§èƒ½ä¸æ˜¾ç¤º</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>èŠå¤©åˆ—è¡¨åŠ è½½æ•°</label>
                <div class="settings-right">
                    <input type="number" id="chat-list-render-window-input" class="settings-num-input">
                </div>
            </div>
             <div class="settings-item">
                <label>èŠå¤©å†…åŠ è½½æ•°</label>
                <div class="settings-right">
                    <input type="number" id="chat-render-window-input" class="settings-num-input">
                </div>
            </div>
            <div class="settings-item">
                <div>
                    <div style="font-weight: 500;">å¯ç”¨APIå†å²è®°å½•</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">ç”¨äºè°ƒè¯•APIè¯·æ±‚ï¼Œå…³é—­å¯å‡å°æ•°æ®åº“ä½“ç§¯ï¼ˆæ¨èå…³é—­ï¼‰</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="enable-api-history-switch">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <!-- AIè¡Œä¸ºæ§åˆ¶ (å…¨å±€é»˜è®¤) -->
        <div class="settings-header">AIè¡Œä¸ºæ§åˆ¶ï¼ˆå…¨å±€é»˜è®¤ï¼‰</div>
        <div class="settings-section">
            <div class="settings-item">
                <div>
                    <div style="font-weight: 500;">å¯ç”¨å¿ƒå£°åŠŸèƒ½</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">AIä¼šåœ¨æ¯æ¬¡å›å¤åç”Ÿæˆå†…å¿ƒç‹¬ç™½ï¼ˆå¿ƒå£°å’Œæ•£è®°ï¼‰</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="global-enable-thoughts-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="settings-item">
                <div>
                    <div style="font-weight: 500;">å¯ç”¨åŠ¨æ€åŠŸèƒ½</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">AIå¯ä»¥ä¸»åŠ¨å‘åŠ¨æ€ã€è¯„è®ºã€ç‚¹èµ</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="global-enable-qzone-actions-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="settings-item">
                <div>
                    <div style="font-weight: 500;">æŸ¥çœ‹Useræ‰‹æœº</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">AIå¯ä»¥ä¸»åŠ¨æŸ¥çœ‹ä½ çš„æ‰‹æœºAPPï¼ˆQQã€ç›¸å†Œã€æ·˜å®ã€é«˜å¾·ç­‰ï¼‰ï¼Œå¹¶ç»™å‡ºæ„Ÿæƒ³</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="global-enable-view-myphone-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div style="font-size: 12px; color: #666; margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 6px;">
                ğŸ’¡ æç¤ºï¼šè¿™æ˜¯å…¨å±€é»˜è®¤è®¾ç½®ã€‚ä½ å¯ä»¥åœ¨æ¯ä¸ªè§’è‰²çš„èŠå¤©è®¾ç½®ä¸­å•ç‹¬è¦†ç›–è¿™äº›é€‰é¡¹ã€‚
            </div>
        </div>


        <!-- è”æœºåŠŸèƒ½å·²è¿ç§»åˆ°ç‹¬ç«‹çš„è¿æ¥APP -->

        <!-- æˆªå›¾æ°´å° -->
        <div class="settings-header">æˆªå›¾æ°´å°</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>
                    <span style="display: block;">å¯ç”¨æˆªå›¾æ°´å°</span>
                    <span style="font-size: 12px; color: var(--text-secondary); display: block; margin-top: 4px;">æˆªå›¾æ—¶è‡ªåŠ¨æ·»åŠ å…¨å±æ°´å°æ•ˆæœ</span>
                </label>
                <label class="toggle-switch">
                    <input type="checkbox" id="watermark-enabled-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div id="watermark-settings-container" style="display: none;">
                <!-- æ°´å°æ–‡å­— -->
                <div class="settings-item">
                    <label>æ°´å°æ–‡å­—</label>
                    <input type="text" id="watermark-text" class="settings-input" placeholder="è¾“å…¥æ°´å°æ–‡å­—" value="ä¿å¯†å†…å®¹ è¯·å‹¿å¤–ä¼ " style="width: 200px; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                </div>
                
                <!-- æ°´å°å¸ƒå±€æ–¹å¼ -->
                <div class="settings-item">
                    <label>å¸ƒå±€æ–¹å¼</label>
                    <select id="watermark-layout" class="settings-select" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; min-width: 150px;">
                        <option value="diagonal">æ–œå‘æ’åˆ—</option>
                        <option value="grid">ç½‘æ ¼æ’åˆ—</option>
                        <option value="sparse">ç¨€ç–æ’åˆ—</option>
                        <option value="dense">å¯†é›†æ’åˆ—</option>
                    </select>
                </div>
                
                <!-- æ°´å°é¢œè‰² -->
                <div class="settings-item">
                    <label>æ°´å°é¢œè‰²</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="color" id="watermark-color" value="#000000" style="width: 50px; height: 35px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer;">
                        <span id="watermark-color-display" style="font-size: 12px; color: #666;">#000000</span>
                    </div>
                </div>
                
                <!-- æ°´å°é€æ˜åº¦ -->
                <div class="settings-item">
                    <label>é€æ˜åº¦</label>
                    <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                        <input type="range" id="watermark-opacity" min="0.05" max="0.5" step="0.05" value="0.1" style="flex: 1;">
                        <span id="watermark-opacity-display" style="min-width: 40px; text-align: right; font-size: 14px;">10%</span>
                    </div>
                </div>
                
                <!-- å­—ä½“å¤§å° -->
                <div class="settings-item">
                    <label>å­—ä½“å¤§å°</label>
                    <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                        <input type="range" id="watermark-font-size" min="12" max="48" step="2" value="20" style="flex: 1;">
                        <span id="watermark-font-size-display" style="min-width: 40px; text-align: right; font-size: 14px;">20px</span>
                    </div>
                </div>
                
                <!-- å­—ä½“é€‰æ‹© -->
                <div class="settings-item">
                    <label>å­—ä½“</label>
                    <select id="watermark-font-family" class="settings-select" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; min-width: 150px;">
                        <option value="Arial, sans-serif">Arial</option>
                        <option value="'Microsoft YaHei', sans-serif" selected>å¾®è½¯é›…é»‘</option>
                        <option value="'SimSun', serif">å®‹ä½“</option>
                        <option value="'KaiTi', serif">æ¥·ä½“</option>
                        <option value="'Courier New', monospace">Courier New</option>
                        <option value="Georgia, serif">Georgia</option>
                        <option value="'Comic Sans MS', cursive">Comic Sans</option>
                    </select>
                </div>
                
                <!-- é¢„è§ˆæŒ‰é’® -->
                <div class="settings-item">
                    <label></label>
                <button id="watermark-preview-btn" class="primary-btn" style="padding: 8px 16px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; font-size: 14px;">
                    é¢„è§ˆæ°´å°æ•ˆæœ
                </button>
                </div>
                
                <div style="font-size: 12px; color: #666; margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 6px;">
                    ğŸ’¡ æç¤ºï¼šå¼€å¯åï¼Œä½¿ç”¨ç³»ç»Ÿæˆªå›¾åŠŸèƒ½æ—¶ä¼šè‡ªåŠ¨æ˜¾ç¤ºæ°´å°ã€‚æ°´å°ä»…ç”¨äºæˆªå›¾ï¼Œä¸å½±å“æ­£å¸¸ä½¿ç”¨ã€‚
                </div>
            </div>
        </div>

        <!-- åå°ä¿æ´» -->
        <div class="settings-header">åå°ä¿æ´»</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>
                    <span style="display: block;">å¯ç”¨åå°ä¿æ´»</span>
                    <span style="font-size: 12px; color: var(--text-secondary); display: block; margin-top: 4px;">é˜²æ­¢æµè§ˆå™¨å’ŒPWAè¢«æ‰‹æœºç³»ç»Ÿåå°æ€æ‰</span>
                </label>
                <label class="toggle-switch">
                    <input type="checkbox" id="background-keep-alive-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="settings-item" id="keep-alive-status" style="display:none;">
                <label>ä¿æ´»çŠ¶æ€</label>
                <div class="settings-right">
                    <span id="keep-alive-status-text" style="color: #999;">æœªå¯ç”¨</span>
                </div>
            </div>
            
            <!-- ä¿æ´»éŸ³é¢‘æ§åˆ¶æŒ‰é’® -->
            <div class="settings-item" id="keep-alive-audio-btn-container" style="display:none;">
                <label>ä¿æ´»éŸ³é¢‘</label>
                <button id="keep-alive-audio-btn" class="primary-btn" style="padding: 8px 16px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; font-size: 14px;">
                    é…ç½®ä¿æ´»éŸ³é¢‘
                </button>
            </div>
            
            <!-- ä¿æ´»éŸ³é¢‘æ’­æ”¾å™¨é¢æ¿ï¼ˆå®ˆæŠ¤ç”œå¿ƒ/æ¸¸æˆæœºé£æ ¼ï¼‰ -->
            <div id="keep-alive-audio-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 240, 245, 0.4); backdrop-filter: blur(5px); z-index: 10000; justify-content: center; align-items: center;">
                <style>
                    .sc-player-device {
                        width: 320px;
                        background: linear-gradient(135deg, #fff0f5 0%, #ffe4e1 100%);
                        border-radius: 40px;
                        border: 6px solid #fff;
                        box-shadow: 
                            0 0 0 4px #ffb7c5,
                            0 20px 50px rgba(255, 182, 193, 0.6),
                            inset 0 -10px 20px rgba(255,105,180, 0.1);
                        padding: 20px;
                        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
                        position: relative;
                        overflow: hidden;
                        animation: sc-float 6s ease-in-out infinite;
                    }
                    @keyframes sc-float {
                        0%, 100% { transform: translateY(0); }
                        50% { transform: translateY(-6px); }
                    }
                    .sc-pattern {
                        position: absolute; top: 0; left: 0; right: 0; bottom: 0;
                        background-image: 
                            linear-gradient(45deg, #ffdee9 25%, transparent 25%, transparent 75%, #ffdee9 75%, #ffdee9),
                            linear-gradient(45deg, #ffdee9 25%, transparent 25%, transparent 75%, #ffdee9 75%, #ffdee9);
                        background-position: 0 0, 10px 10px;
                        background-size: 20px 20px;
                        opacity: 0.3;
                        pointer-events: none;
                        z-index: 0;
                    }
                    .sc-content { position: relative; z-index: 1; }
                    .sc-header {
                        display: flex; justify-content: space-between; align-items: center;
                        margin-bottom: 15px;
                    }
                    .sc-title-badge {
                        background: #ff69b4; color: white;
                        padding: 4px 12px; border-radius: 20px;
                        font-size: 12px; font-weight: bold;
                        letter-spacing: 1px;
                        box-shadow: 0 4px 10px rgba(255,105,180, 0.4);
                        border: 2px solid white;
                    }
                    .sc-win-actions { display: flex; gap: 8px; }
                    .sc-win-btn {
                        width: 28px; height: 28px; border-radius: 50%; border: 2px solid white;
                        display: flex; align-items: center; justify-content: center;
                        cursor: pointer; color: white; transition: transform 0.2s;
                        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                    }
                    .sc-btn-min { background: #ffd700; }
                    .sc-btn-close { background: #ff6b6b; }
                    .sc-win-btn:hover { transform: scale(1.1); }
                    .sc-screen {
                        background: #fff;
                        border-radius: 20px;
                        padding: 15px;
                        box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
                        border: 3px solid #fff;
                        margin-bottom: 20px;
                        position: relative;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                    }
                    .sc-screen-label {
                        align-self: flex-start;
                        font-size: 10px; color: #ffb7c5; font-weight: bold; margin-bottom: 5px;
                    }
                    .sc-audio-wrapper { width: 100%; }
                    .sc-audio-wrapper audio {
                        width: 100%;
                        height: 36px;
                        border-radius: 18px;
                        outline: none;
                    }
                    .sc-audio-wrapper audio::-webkit-media-controls-enclosure {
                        background-color: #f0f7ff;
                        border-radius: 18px;
                    }
                    .sc-control-panel {
                        background: rgba(255,255,255,0.6);
                        border-radius: 20px;
                        padding: 15px;
                        border: 2px solid white;
                    }
                    .sc-input-row { margin-bottom: 12px; }
                    .sc-file-label {
                        display: flex; align-items: center; justify-content: center; width: 100%; padding: 10px;
                        background: white; border-radius: 12px;
                        text-align: center; color: #ff69b4; font-size: 13px; font-weight: bold;
                        border: 2px dashed #ffb7c5; cursor: pointer;
                        transition: all 0.3s;
                        box-sizing: border-box;
                    }
                    .sc-file-label:hover { background: #fff0f5; border-color: #ff69b4; }
                    .sc-url-group { display: flex; gap: 8px; }
                    .sc-url-input {
                        flex: 1; padding: 8px 12px; border-radius: 12px;
                        border: 2px solid #ffdeeb; background: white;
                        color: #666; font-size: 12px; outline: none;
                        transition: border-color 0.3s;
                    }
                    .sc-url-input:focus { border-color: #ff69b4; }
                    .sc-load-btn {
                        background: #87ceeb; color: white; border: 2px solid white;
                        border-radius: 12px; padding: 0 15px; font-weight: bold; font-size: 12px;
                        cursor: pointer; box-shadow: 0 4px 0 #5fb8d9;
                        transition: transform 0.1s, box-shadow 0.1s;
                        height: 36px;
                    }
                    .sc-load-btn:active { transform: translateY(4px); box-shadow: 0 0 0 #5fb8d9; }
                    .sc-hint {
                        margin-top: 15px; font-size: 11px; color: #ff8da1;
                        text-align: center;
                        display: flex; align-items: center; justify-content: center; gap: 6px;
                        font-weight: 500;
                    }
                    .sc-hint-icon {
                        width: 16px; height: 16px; background: #ffd700; border-radius: 50%;
                        color: white; font-weight: bold; display: flex; align-items: center; justify-content: center; font-size: 11px;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                    }
                    .sc-visualizer-mock {
                        display: flex; gap: 4px; justify-content: center; margin-bottom: 8px; height: 20px; align-items: flex-end;
                    }
                    .sc-bar {
                        width: 6px; background: #ffb7c5; border-radius: 3px;
                        animation: sc-equalizer 1s infinite ease-in-out;
                    }
                    .sc-bar:nth-child(2) { animation-delay: 0.1s; height: 60%; }
                    .sc-bar:nth-child(3) { animation-delay: 0.2s; height: 80%; }
                    .sc-bar:nth-child(4) { animation-delay: 0.3s; height: 50%; }
                    .sc-bar:nth-child(5) { animation-delay: 0.1s; height: 70%; }
                    @keyframes sc-equalizer {
                        0%, 100% { height: 30%; }
                        50% { height: 100%; }
                    }
                </style>

                <div class="sc-player-device">
                    <div class="sc-pattern"></div>
                    <div class="sc-content">
                        <!-- Header -->
                        <div class="sc-header">
                            <div class="sc-title-badge">KEEP ALIVE</div>
                            <div class="sc-win-actions">
                                <button id="keep-alive-audio-minimize" class="sc-win-btn sc-btn-min" title="æœ€å°åŒ–">
                                    <svg width="12" height="2" viewBox="0 0 12 2" fill="none"><rect width="12" height="2" rx="1" fill="white"/></svg>
                                </button>
                                <button id="keep-alive-audio-close" class="sc-win-btn sc-btn-close" title="å…³é—­">
                                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M2 2L10 10M10 2L2 10" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>
                                </button>
                            </div>
                        </div>

                        <!-- Screen Area -->
                        <div class="sc-screen">
                            <div style="width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span class="sc-screen-label">AUDIO VISUALIZER</span>
                                <span class="sc-screen-label" style="color: #ccc;">â— REC</span>
                            </div>
                            <div class="sc-visualizer-mock">
                                <div class="sc-bar"></div><div class="sc-bar"></div><div class="sc-bar"></div><div class="sc-bar"></div><div class="sc-bar"></div>
                            </div>
                            <div class="sc-audio-wrapper">
                                <audio id="keep-alive-audio-player" controls loop>
                                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
                                </audio>
                            </div>
                        </div>

                        <!-- Controls Panel -->
                        <div class="sc-control-panel">
                            <!-- File Upload -->
                            <div class="sc-input-row">
                                <label for="keep-alive-audio-file" class="sc-file-label">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                                    </svg>
                                    ä¸Šä¼ æœ¬åœ°éŸ³é¢‘
                                </label>
                                <input type="file" id="keep-alive-audio-file" accept="audio/*" style="display:none">
                            </div>

                            <!-- URL Load -->
                            <div class="sc-input-row sc-url-group">
                                <input type="text" id="keep-alive-audio-url" class="sc-url-input" placeholder="è¾“å…¥éŸ³é¢‘URL...">
                                <button id="keep-alive-audio-load-url" class="sc-load-btn">åŠ è½½</button>
                            </div>
                        </div>

                        <!-- Footer Hint -->
                        <div class="sc-hint">
                            <div class="sc-hint-icon">!</div>
                            <span>è‡ªåŠ¨å¾ªç¯æ’­æ”¾ â€¢ åå°ä¿æ´»ä¸­</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="settings-desc">
            å¼€å¯åä¼šä½¿ç”¨é™é»˜éŸ³é¢‘å’Œå®šæ—¶ä»»åŠ¡ç­‰æŠ€æœ¯ä¿æŒåº”ç”¨åœ¨åå°æŒç»­è¿è¡Œï¼Œå‡å°‘è¢«ç³»ç»Ÿæ¸…ç†çš„æ¦‚ç‡ã€‚
        </div>

        <!-- ç³»ç»Ÿçº§é€šçŸ¥ -->
        <div class="settings-header">ç³»ç»Ÿçº§é€šçŸ¥ <span style="font-size: 12px; color: #999; margin-left: 10px;">v1.0.9</span></div>
        <div class="settings-section">
            <!-- 1. ä¸»å¼€å…³ -->
            <div class="settings-item">
                <label>å¯ç”¨ç³»ç»Ÿçº§é€šçŸ¥</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="system-notification-enabled-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <!-- æƒé™çŠ¶æ€æ˜¾ç¤º -->
            <div class="settings-item" id="notification-permission-status" style="display:none;">
                <label>é€šçŸ¥æƒé™çŠ¶æ€</label>
                <div class="settings-right">
                    <span id="permission-status-text" style="color: #999;">æœªè¯·æ±‚</span>
                </div>
            </div>
            
            <!-- è¯¦ç»†è®¾ç½®åŒºåŸŸï¼ˆä¸»å¼€å…³å¼€å¯åæ˜¾ç¤ºï¼‰ -->
            <div id="system-notification-details" style="display:none;">
                
                <!-- 2. åº”ç”¨åç§° -->
                <div class="settings-item">
                    <label>åº”ç”¨æ˜¾ç¤ºåç§°</label>
                    <div class="settings-right">
                        <input type="text" id="system-notification-app-name" placeholder="EPhone" maxlength="20">
                    </div>
                </div>
                
                <!-- 3. æµ‹è¯•é€šçŸ¥æŒ‰é’® -->
                <button class="settings-full-btn" id="test-system-notification-btn">
                     å‘é€æµ‹è¯•é€šçŸ¥
                </button>
                
                <!-- 3.5 è°ƒè¯•æŒ‰é’® -->
                <button class="settings-full-btn" id="debug-system-notification-btn" style="background: #ff9500;">
                    è°ƒè¯•ç³»ç»Ÿé€šçŸ¥
                </button>
                
                <!-- 4. æœåŠ¡å™¨æ¨é€ï¼ˆé«˜çº§ï¼‰ -->
                <div class="settings-item">
                    <label>å¯ç”¨æœåŠ¡å™¨æ¨é€ï¼ˆé«˜çº§ï¼‰</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="push-server-enabled-switch">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div id="push-server-details" style="display:none;">
                    <div class="settings-item">
                        <label>æ¨é€æœåŠ¡å™¨åœ°å€</label>
                        <div class="settings-right">
                            <input type="text" id="push-server-url" placeholder="https://your-push-server.com">
                        </div>
                    </div>
                    
                    <div class="settings-item">
                        <label>API å¯†é’¥ï¼ˆå¯é€‰ï¼‰</label>
                        <div class="settings-right">
                            <input type="text" id="push-server-api-key" placeholder="your-api-key">
                        </div>
                    </div>
                </div>
                
                <!-- 5. æ¶ˆæ¯éœ‡åŠ¨ -->
                <div class="settings-item">
                    <label>æ¶ˆæ¯éœ‡åŠ¨</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="notification-vibration-enabled-switch">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div id="vibration-pattern-selector" style="display:none;">
                    <div class="settings-item">
                        <label>éœ‡åŠ¨æ¨¡å¼</label>
                        <div class="settings-right">
                            <select id="vibration-pattern-select">
                                <option value="short">çŸ­éœ‡ï¼ˆ1æ¬¡ï¼‰</option>
                                <option value="medium">ä¸­éœ‡ï¼ˆ2æ¬¡ï¼‰</option>
                                <option value="long">é•¿éœ‡ï¼ˆ3æ¬¡ï¼‰</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                
                <!-- 7. æç¤ºéŸ³ -->
                <div class="settings-item">
                    <label>è‡ªå®šä¹‰æç¤ºéŸ³</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="notification-sound-enabled-switch">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div id="notification-sound-details" style="display:none;">
                    <div class="settings-item">
                        <label>ä½¿ç”¨å…¨å±€æç¤ºéŸ³</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="use-global-sound-switch" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div id="custom-sound-input-wrapper" style="display:none;">
                        <div class="settings-item">
                            <label>è‡ªå®šä¹‰æç¤ºéŸ³ URL</label>
                            <div class="settings-right">
                                <input type="text" id="custom-notification-sound-url" placeholder="https://...">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 8. åœ¨èŠå¤©é¡µé¢ä¹Ÿå‘é€ç³»ç»Ÿçº§é€šçŸ¥ -->
                <div class="settings-item">
                    <label>
                        <span style="display: block;">åœ¨èŠå¤©é¡µé¢ä¹Ÿå‘é€é€šçŸ¥</span>
                        <span style="font-size: 12px; color: var(--text-secondary); display: block; margin-top: 4px;"></span>
                    </label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="notify-in-chat-page-switch">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <!-- 9. ç¦ç”¨å†…éƒ¨å¼¹çª— -->
                <div class="settings-item">
                    <label>
                        <span style="display: block;">ä»…ç³»ç»Ÿçº§é€šçŸ¥</span>
                        <span style="font-size: 12px; color: var(--text-secondary); display: block; margin-top: 4px;">å¼€å¯ååªæ˜¾ç¤ºç³»ç»Ÿçº§é€šçŸ¥ï¼Œä¸æ˜¾ç¤ºåº”ç”¨å†…å¼¹çª—</span>
                    </label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="disable-internal-notification-switch">
                        <span class="slider"></span>
                    </label>
                </div>
                
            </div>
        </div>
        <div class="settings-desc">
            ç³»ç»Ÿçº§é€šçŸ¥ä¼šåœ¨è®¾å¤‡é€šçŸ¥ä¸­å¿ƒæ˜¾ç¤ºï¼Œæ”¯æŒæ¨ªå¹…å¼¹çª—ã€‚éœ€è¦æˆäºˆé€šçŸ¥æƒé™ã€‚
        </div>

        <!-- æ•°æ®ç®¡ç† (å±é™©åŒºåŸŸ) -->
        <div class="settings-header">æ•°æ®ç®¡ç†</div>
        
        <div class="settings-section">
            <!-- 1. å›¾ç‰‡å ç”¨ + å‹ç¼©æŒ‰é’® (åŒä¸€è¡Œ) -->
            <div class="settings-item">
                <!-- å·¦ä¾§æ ‡é¢˜ -->
                <label style="flex-shrink: 0;">æœ¬åœ°å›¾ç‰‡å ç”¨</label>
                
                <!-- å³ä¾§åŒºåŸŸï¼šæ•°å€¼ + æŒ‰é’® -->
                <div class="data-row-right">
                    <!-- æ•°å€¼ (ç”±JSå¡«å……ï¼ŒCSSä¼šéšè—å¤šä½™æ–‡å­—åªç•™MB) -->
                    <span id="total-image-size-display">è®¡ç®—ä¸­...</span>
                    
                    <!-- å‹ç¼©æŒ‰é’® -->
                    <button id="compress-images-btn" class="settings-mini-btn">å‹ç¼©</button>
                </div>
            </div>
            
            <!-- åˆ—è¡¨æŒ‰é’®ï¼šé»‘è‰²å·¦å¯¹é½ -->
            <button class="settings-full-btn" id="clear-chat-images-btn">æ¸…ç©ºèŠå¤©çš„æœ¬åœ°å›¾ç‰‡</button>
            <button class="settings-full-btn" id="clear-api-history-btn">æ¸…ç©ºæ‰€æœ‰APIå†å²è®°å½•</button>
            <button class="settings-full-btn" id="clear-stickers-btn">ä¸€é”®æ¸…ç©ºè¡¨æƒ…åŒ…</button>
            <button class="settings-full-btn" id="view-data-distribution-btn" data-lang-key="apiViewDataDistributionBtn">æŸ¥çœ‹æ•°æ®åˆ†å¸ƒ</button>
            <button class="settings-full-btn" id="export-data-btn" data-lang-key="apiExportDataBtn">å¯¼å‡ºæ‰€æœ‰æ•°æ®</button>
            <button class="settings-full-btn" id="advanced-export-btn">é«˜çº§å¯¼å‡ºå¯¼å…¥</button>
            <button class="settings-full-btn" id="import-btn" data-lang-key="apiImportDataBtn">å¯¼å…¥å¤‡ä»½æ–‡ä»¶</button>
            <input id="advanced-import-input" type="file" accept="application/json" hidden>
            <input id="import-data-input" type="file" accept="application/json" hidden>
            
            <button class="settings-full-btn" id="cleanup-data-btn">æ¸…ç†å†—ä½™æ•°æ®</button>
            <button class="settings-full-btn" id="delete-world-books-btn">åˆ é™¤ä¸–ç•Œä¹¦</button>
            <button class="settings-full-btn" id="clear-specific-data-btn">é«˜çº§æ•°æ®æ¸…ç†</button>
            <button class="settings-full-btn" id="check-and-fix-data-btn">æ•°æ®æ£€æŸ¥ä¸ä¿®å¤</button>
            <button class="settings-full-btn" id="emergency-reset-appearance-btn" >é‡ç½®å½“å‰å¤–è§‚</button>
            <button class="settings-full-btn" id="factory-reset-btn" > åˆå§‹åŒ–æ‰€æœ‰å†…å®¹ (æ…ç”¨)</button>
        </div>

        <!-- æç¤ºè¯ç®¡ç† -->
        <div class="settings-header">æç¤ºè¯ç®¡ç†</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>è‡ªå®šä¹‰AIæç¤ºè¯</label>
                <div class="settings-right">
                    <button id="open-prompt-manager-btn" class="settings-mini-btn">ç®¡ç†æç¤ºè¯</button>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-item">
                <label>æŒä¹…åŒ–å­˜å‚¨ä¿æŠ¤</label>
                <div class="settings-right">
                    <button id="check-storage-persistence-btn" class="settings-mini-btn">æ£€æŸ¥çŠ¶æ€</button>
                </div>
            </div>
            <div id="storage-persistence-info" style="display:none; padding: 10px 15px; font-size: 13px; color: #666; line-height: 1.6;">
            </div>
        </div>
        
        <!-- æ£€æŸ¥æ›´æ–° -->
        <div class="settings-header">åº”ç”¨æ›´æ–°</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>æ£€æŸ¥å¹¶æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬</label>
                <div class="settings-right">
                    <button id="check-update-btn" class="settings-mini-btn" onclick="ForceUpdater.checkUpdate()">æ£€æŸ¥æ›´æ–°</button>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨å«é«˜ -->
        <div style="height: 60px;"></div>
      </div>
    </div>
<div id="import-options-modal" class="modal">
  <div class="modal-content" style="height: auto;">
    <div class="modal-header">
      <span>å‘ç°å¤‡ä»½æ–‡ä»¶</span>
    </div>
    <div class="modal-body">
      <p>åœ¨æ­¤å¤‡ä»½æ–‡ä»¶ä¸­æ‰¾åˆ°äº†ä»¥ä¸‹æ•°æ®ï¼š</p>
      <ul id="import-preview-list" style="text-align: left; margin-left: 20px; max-height: 200px; overflow-y: auto; background: #f9f9f9; padding: 10px; border-radius: 8px;">
        </ul>
      <hr style="opacity: 0.2; margin: 20px 0;">
      <p style="font-weight: bold;">è¯·é€‰æ‹©å¯¼å…¥æ–¹å¼ï¼š</p>
    </div>
    <div class="modal-footer" style="flex-direction: column; gap: 10px;">
      <button class="save btn-danger" id="confirm-full-import-btn" style="width: 100%; background-color: #ff3b30; border-color: #ff3b30;">
        <strong>å®Œå…¨å¯¼å…¥ (è¦†ç›–æ‰€æœ‰æ•°æ®)</strong>
        <small style="display: block; font-weight: normal; opacity: 0.8;">å°†åˆ é™¤æœ¬åœ°æ‰€æœ‰æ•°æ®ï¼Œå¹¶æ›¿æ¢ä¸ºå¤‡ä»½æ–‡ä»¶ä¸­çš„æ•°æ®ã€‚</small>
      </button>
      <button class="save" id="confirm-selective-import-btn" style="width: 100%;">
        <strong>é€‰æ‹©æ€§å¯¼å…¥ (åˆå¹¶æ•°æ®)</strong>
        <small style="display: block; font-weight: normal; opacity: 0.8;">å°†å¤‡ä»½æ–‡ä»¶ä¸­çš„æ•°æ®ã€æ·»åŠ ã€‘åˆ°æ‚¨ç°æœ‰çš„æ•°æ®ä¸­ã€‚</small>
      </button>
      <button class="cancel" id="cancel-import-options-btn" style="width: 100%; margin-top: 8px;" data-lang-key="cancel">å–æ¶ˆ</button>
    </div>
  </div>
</div>

<div id="selective-import-modal" class="modal">
  <div class="modal-content" style="height: 70%;">
    <div class="modal-header">
      <span>é€‰æ‹©è¦åˆå¹¶çš„æ•°æ®</span>
      <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;">
        <input type="checkbox" id="select-all-import-types"> å…¨é€‰
      </label>
    </div>
    <div class="modal-body" id="selective-import-list" style="padding: 0;">
      </div>
    <div class="modal-footer">
      <button class="cancel" id="cancel-selective-import-btn" data-lang-key="cancel">å–æ¶ˆ</button>
      <button class="save" id="confirm-merge-import-btn">ç¡®è®¤åˆå¹¶</button>
    </div>
  </div>
</div>
    <div id="data-clear-wizard-modal" class="modal">
      <div class="modal-content" style="height: 80%;">
        <div id="data-clear-step-1" class="wizard-step">
          <div class="modal-header"> <span>ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©è¦æ¸…ç†çš„è§’è‰²</span> <label> <input type="checkbox" id="select-all-chars-for-clear"> å…¨é€‰ </label> </div>
          <div class="modal-body" id="data-clear-char-list" style="padding: 0;"> </div>
          <div class="modal-footer"> <button class="cancel" id="cancel-clear-wizard-btn-step1"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="go-to-clear-step2-btn">ä¸‹ä¸€æ­¥</button> </div>
        </div>
        <div id="data-clear-step-2" class="wizard-step" style="display: none;">
          <div class="modal-header"> <span>ç¬¬äºŒæ­¥ï¼šé€‰æ‹©è¦æ¸…ç†çš„æ•°æ®ç±»å‹</span> <label> <input type="checkbox" id="select-all-types-for-clear"> å…¨é€‰ </label> </div>
          <div class="modal-body" id="data-clear-type-list" style="padding: 0;"> </div>
          <div class="modal-footer"> <button class="form-button-secondary" id="back-to-clear-step1-btn" style="width: 30%; margin:0;">ä¸Šä¸€æ­¥</button> <button class="cancel" id="cancel-clear-wizard-btn-step2" style="width: 30%; margin:0;"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save btn-danger"
              id="confirm-final-clear-btn" style="width: 30%; margin:0;">ç¡®è®¤æ¸…ç†</button> </div>
        </div>
      </div>
    </div>
    <div id="clear-chat-images-modal" class="modal">
      <div class="modal-content" style="height: 70%;">
        <div class="modal-header">
          <span>é€‰æ‹©è¦æ¸…ç©ºå›¾ç‰‡çš„è§’è‰²</span>
          <label>
            <input type="checkbox" id="select-all-chars-for-image-clear"> å…¨é€‰
          </label>
        </div>
        <div class="modal-body" id="clear-chat-images-list" style="padding: 0;">
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-clear-images-btn">å–æ¶ˆ</button>
          <button class="save btn-danger" id="confirm-clear-images-btn">ç¡®è®¤æ¸…ç©º</button>
        </div>
      </div>
    </div>
    <div id="chat-list-screen" class="screen">
      <div class="header" id="main-chat-list-header"> <span class="back-btn" onclick="showScreen('home-screen')">â€¹</span> <span id="chat-list-title"data-lang-key="chatListTitle">æ¶ˆæ¯</span>
        <div class="header-actions"> <span class="action-btn" id="add-group-chat-btn" title="åˆ›å»ºç¾¤èŠ"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M17.5 17.5C19.1569 17.5 20.5 16.1569 20.5 14.5C20.5 12.8431 19.1569 11.5 17.5 11.5C15.8431 11.5 14.5 12.8431 14.5 14.5C14.5 16.1569 15.8431 17.5 17.5 17.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M21 21L19 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M8.5 11.5C10.1569 11.5 11.5 10.1569 11.5 8.5C11.5 6.84315 10.1569 5.5 8.5 5.5C6.84315 5.5 5.5 6.84315 5.5 8.5C5.5 10.1569 6.84315 11.5 8.5 11.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M12.5 14.5H4.5C3.39543 14.5 2.5 15.3954 2.5 16.5V18.5H12.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg></span> <span class="action-btn" id="add-chat-btn">+</span> </div>
      </div>
      <div id="messages-view" class="chat-list-view active">
        <div id="chat-list"> </div>
      </div>
      <div id="qzone-screen" class="chat-list-view">
        <div class="qzone-header"> <span class="back-btn" id="qzone-back-btn">â€¹</span> <span data-lang-key="qzoneTitle">å¥½å‹åŠ¨æ€</span>
          <div class="header-actions"> <span class="action-btn" id="qzone-more-actions-btn" title="æ›´å¤šæ“ä½œ">â€¦</span> </div>
        </div>
        <div class="qzone-content">
          <div class="qzone-profile-header">
            <div id="qzone-banner-container" class="qzone-banner-container"> <img id="qzone-banner-img" src="https://files.catbox.moe/r5heyt.gif" alt="èƒŒæ™¯"> <input type="file" id="qzone-banner-input" accept="image/*" hidden> </div>
            <div class="qzone-user-info">
              <div id="qzone-avatar-container" class="qzone-avatar-container"> <img id="qzone-avatar-img" src="https://files.catbox.moe/q6z5fc.jpeg" alt="å¤´åƒ"> <input type="file" id="qzone-avatar-input" accept="image/*" hidden> </div> <span id="qzone-nickname">{{user}}</span>
            </div>
          </div>
          <div class="qzone-actions-bar">
            <div class="action-item" id="create-shuoshuo-btn"><span data-lang-key="qzoneActionShuoshuo">è¯´è¯´</span></div>
            <div class="action-item" id="create-post-btn"><span data-lang-key="qzoneActionPost">åŠ¨æ€</span></div>
            <div class="action-item" id="open-album-btn"><span data-lang-key="qzoneActionAlbum">ç›¸å†Œ</span></div>
          </div>
          <div id="qzone-posts-list"></div>
        </div>
      </div>
      <div id="favorites-view" class="chat-list-view">
        <div class="header"> <span class="back-btn" id="favorites-back-btn">â€¹</span> <span data-lang-key="navFavorites">æˆ‘çš„æ”¶è—</span> <span class="action-btn" id="favorites-edit-btn"data-lang-key="edit">ç¼–è¾‘</span> </div>
        <div class="search-bar-container"> <input type="search" id="favorites-search-input" placeholder="æœç´¢æ”¶è—çš„æ ‡é¢˜ã€å†…å®¹æˆ–ä½œè€…..."> <button id="favorites-search-clear-btn" class="search-clear-btn" style="display: none;">Ã—</button> </div>
        <div id="favorites-list" class="list-container"> </div>
        <div id="favorites-action-bar" style="display: none;"> <button id="favorites-delete-selected-btn" class="action-bar-btn">åˆ é™¤ (0)</button> </div>
      </div>
      <div id="memories-view" class="chat-list-view">
        <div class="header"> <span class="back-btn" id="memories-back-btn">â€¹</span> <span>æˆ‘ä»¬çš„å›å¿†</span> <span class="action-btn" id="add-countdown-btn">+</span> </div>
        <div id="memories-list" class="list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
      </div>
      <div id="npc-list-view" class="chat-list-view">
        <div class="header"> <span class="back-btn" id="npc-list-back-btn">â€¹</span> <span>NPC åˆ—è¡¨</span>
          <div class="header-actions"> <span class="action-btn" id="add-npc-btn">+</span> </div>
        </div>
        <div id="npc-list" class="list-container" style="padding: 0;"> </div>
      </div>
      <div id="chat-list-bottom-nav">
        <div class="nav-item active" data-view="messages-view"> <span data-lang-key="navMessages">æ¶ˆæ¯</span> </div>
        <div class="nav-item" data-view="qzone-screen"> <span data-lang-key="navQzone">åŠ¨æ€</span> </div>
        <div class="nav-item" data-view="memories-view"> <span data-lang-key="navMemories">å›å¿†</span> </div>
        <div class="nav-item" data-view="favorites-view"> <span data-lang-key="navFavorites">æ”¶è—</span> </div>
        <div class="nav-item" data-view="npc-list-view"> <span data-lang-key="navNpcList">NPC</span> </div>
      </div>
    </div>
    
    <!-- æ•°æ®åˆ†æç»Ÿè®¡ç•Œé¢ -->
    <div id="data-distribution-screen" class="screen">
      <div class="header">
        <span class="back-btn" id="data-distribution-back-btn">â€¹</span>
        <span>ğŸ“Š æ•°æ®åˆ†æç»Ÿè®¡</span>
        <span class="action-btn" id="refresh-distribution-btn" title="åˆ·æ–°æ•°æ®">ğŸ”„</span>
      </div>
      <div class="list-container" id="data-distribution-container" style="padding: 15px;">
        <p style="text-align: center; padding: 40px 0; color: var(--text-secondary);">æ­£åœ¨åŠ è½½æ•°æ®...</p>
      </div>
    </div>
    
    <div id="album-screen" class="screen">
      <div class="header"> <span class="back-btn" id="album-back-btn">â€¹</span> <span>æˆ‘çš„ç›¸å†Œ</span> <span class="action-btn" id="create-album-btn-page">+</span> </div>
      <div class="list-container">
        <div id="album-grid-page"> </div>
      </div>
    </div>
    <div id="album-photos-screen" class="screen">
      <div class="header"> <span class="back-btn" id="album-photos-back-btn">â€¹</span> <span id="album-photos-title">ç›¸å†Œåç§°</span> <span class="action-btn" id="album-upload-photo-btn">ä¸Šä¼ </span> </div>
      <div class="list-container">
        <div id="photos-grid-page"> </div>
        <div id="photo-viewer-modal" class="modal"> <button id="photo-viewer-close-btn">Ã—</button> <button id="photo-viewer-prev-btn" class="nav-arrow">â€¹</button>
          <div class="photo-viewer-content"> <img id="photo-viewer-image" src="" alt="å…¨å±ç…§ç‰‡é¢„è§ˆ"> </div> <button id="photo-viewer-next-btn" class="nav-arrow">â€º</button>
        </div>
      </div>
    </div>
    <div id="npc-editor-modal" class="modal">
      <div class="modal-content" style="height: 80%;">
        <div class="modal-header"> <span id="npc-editor-title"data-lang-key="add">æ·»åŠ  NPC</span> </div>
        <div class="modal-body">
          <div class="form-group"> <label>NPC å¤´åƒ</label>
            <div class="avatar-upload"> <img id="npc-avatar-preview" src="https://i.postimg.cc/VkQfgzGJ/1.jpg"> <button onclick="document.getElementById('npc-avatar-input').click()">ä¸Šä¼ å¤´åƒ</button> <input type="file" id="npc-avatar-input" accept="image/*" hidden> </div>
          </div>
          <div class="form-group"> <label for="npc-name-input">NPC æ˜µç§°</label> <input type="text" id="npc-name-input" placeholder="è¾“å…¥NPCçš„å¸¸ç”¨å"> </div>
          <div class="form-group"> <label for="npc-persona-input">NPC äººè®¾</label> <textarea id="npc-persona-input" rows="4" placeholder="è¯¦ç»†æè¿°è¿™ä¸ªNPCçš„æ€§æ ¼ã€èƒŒæ™¯ã€è¯´è¯æ–¹å¼ç­‰..."></textarea> </div>
<div class="form-group" id="npc-group-section">
            <label for="npc-group-select">NPC åˆ†ç»„ (ç”¨äºNPCé—´äº’è¯„)</label>
            <div style="display: flex; align-items: center; gap: 10px;">
              <select id="npc-group-select" style="flex-grow: 1;">
                <option value="">-- æœªåˆ†ç»„ --</option>
              </select>
              <button id="manage-npc-groups-btn" type="button" class="form-button-secondary" style="margin-top: 0; padding: 12px;">ç®¡ç†åˆ†ç»„</button>
            </div>
            <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
                åªæœ‰åœ¨åŒä¸€ä¸ªåˆ†ç»„å†…çš„NPCæ‰èƒ½äº’ç›¸çœ‹è§å’Œè¯„è®ºå¯¹æ–¹çš„åŠ¨æ€ã€‚
            </p>
          </div>
          <hr style="opacity: 0.2;">
          <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;"> <label for="npc-background-activity-switch" style="margin-bottom: 0;"> å¯ç”¨ç‹¬ç«‹åå°æ´»åŠ¨ <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
                å…è®¸è¯¥NPCåœ¨åå°ç‹¬ç«‹å‘è¡¨åŠ¨æ€è¯„è®ºã€‚éœ€åŒæ—¶å¼€å¯APIè®¾ç½®ä¸­çš„æ€»å¼€å…³ã€‚ </p> </label> <label class="toggle-switch"> <input type="checkbox" id="npc-background-activity-switch"> <span class="slider"></span> </label> </div>
          <div class="form-group"> <label for="npc-action-cooldown-input"> ç‹¬ç«‹è¡ŒåŠ¨å†·å´ (åˆ†é’Ÿ) <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> è¯¥NPCåœ¨åå°ä¸»åŠ¨è¡ŒåŠ¨çš„æœ€å°é—´éš”ã€‚ </p> </label> <input type="number" id="npc-action-cooldown-input" min="1" value="15"
              style="width: 80px; text-align: center;"> </div>
          <div class="form-group"> <label>å…³è”çš„è§’è‰² (NPCä¼šå»è¯„è®ºè¿™äº›è§’è‰²çš„åŠ¨æ€)</label>
            <div id="npc-association-list" style="max-height: 150px; overflow-y: auto; background: #f9f9f9; padding: 10px; border-radius: 8px;"> </div>
          </div>
        </div>
        <div class="modal-footer"> <button class="cancel" id="cancel-npc-editor-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="save-npc-btn">ä¿å­˜</button> </div>
      </div>
    </div>
    <div id="clear-posts-modal" class="modal">
      <div class="modal-content" style="height: 70%;">
        <div class="modal-header"> <span>é€‰æ‹©æ¸…ç©ºèŒƒå›´</span> </div>
        <div class="modal-body" id="clear-posts-list" style="padding: 0;"> </div>
        <div class="modal-footer"> <button class="cancel" id="cancel-clear-posts-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save btn-danger" id="confirm-clear-posts-btn">ç¡®è®¤æ¸…ç©º</button> </div>
      </div>
    </div> <input type="file" id="album-photo-input" accept="image/*" multiple hidden>
    <div id="chat-interface-screen" class="screen">
      <div id="gomoku-overlay">
        <div id="gomoku-content-wrapper"> <canvas id="gomoku-board"></canvas>
          <div id="gomoku-controls"> <button id="close-gomoku-btn">æ”¶èµ·æ£‹ç›˜</button> </div>
        </div>
      </div>
      <div id="reading-overlay">
        <div id="reading-restore-btn" style="display: none;">ğŸ“–</div>
        <div id="reading-window">
          <div class="reading-header"> <span id="reading-title">æœªé€‰æ‹©ä¹¦ç±</span>
            <div class="reading-controls"> <button id="toggle-reading-fullscreen-btn" title="åˆ‡æ¢å…¨å±">
        <svg class="icon-maximize" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
        </svg>
        <svg class="icon-minimize" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
            <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"></path>
        </svg>
    </button><button id="minimize-reading-btn" title="æœ€å°åŒ–" style="font-size: 20px; line-height: 1;"> <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round">
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg> </button> <button id="open-reading-library-btn" title="æ‰“å¼€ä¹¦åº“" style="font-size: 22px; line-height: 1;"> <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="3" y1="12" x2="21" y2="12"></line>
                  <line x1="3" y1="6" x2="21" y2="6"></line>
                  <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg></button> <button id="close-reading-btn" title="å…³é—­"> <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg> </button></div>
          </div>
          <div id="reading-content">
            <p>ç‚¹å‡»â€œå¯¼å…¥â€æŒ‰é’®ï¼Œ<br>ä»æœ¬åœ°.txtæ–‡ä»¶æˆ–ç½‘ç»œURLåŠ è½½ä¹¦ç±å†…å®¹ã€‚</p>
          </div>
          <div class="reading-footer"> <button id="prev-page-btn">ä¸Šä¸€é¡µ</button> <span id="page-indicator">0 / 0</span> <button id="next-page-btn">ä¸‹ä¸€é¡µ</button> </div>
        </div>
      </div><input type="file" id="book-upload-input" accept=".txt, text/plain" hidden>
      <div class="header">
        <div class="default-controls"> <span class="back-btn" id="back-to-list-btn">â€¹</span>
          <div id="global-lyrics-bar"></div>
          <div id="chat-header-title-wrapper"> <span id="chat-header-title">èŠå¤©å¯¹è±¡</span>
            <div id="chat-header-status"> <span class="status-dot"></span> <span class="status-text">åœ¨çº¿</span> </div>
          </div>
          <div class="header-actions"> <span class="action-btn" id="open-memory-screen-btn" title="é•¿æœŸè®°å¿†"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M16 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M12 6L9 9L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M21 5V19C21 20.1046 20.1046 21 19 21H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg> </span> <span class="action-btn" id="listen-together-btn" title="ä¸€èµ·å¬"><img src="https://i.postimg.cc/dV8sdNcx/210-20250618115221.png" alt="ä¸€èµ·å¬"></span> <span class="action-btn" id="chat-settings-btn" title="èŠå¤©è®¾ç½®"><img
                src="https://i.postimg.cc/bvPq64cv/CCA834-BA-5-A90-408-D-94-FA-7-EE156-B6-A765.png" alt="è®¾ç½®"></span> </div>
        </div>
        <div class="selection-controls"> 
          <!-- å–æ¶ˆæŒ‰é’® (æ›¿æ¢ä¸º X å›¾æ ‡) -->
          <span id="selection-cancel-btn" title="å–æ¶ˆ"> 
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
               <line x1="18" y1="6" x2="6" y2="18"></line>
               <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </span> 

          <span id="selection-count"></span>
          
          <div class="header-actions"> 
            <!-- å³ä¾§çš„å…¶ä»–æŒ‰é’®ä¿æŒä½ åˆšæ‰ä¿®æ”¹çš„ SVG ä¸å˜ -->
            <span id="selection-screenshot-btn" class="action-btn" title="é•¿æˆªå›¾"> 
               <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                  <circle cx="12" cy="13" r="4"></circle>
               </svg>
            </span> 
            <span id="selection-favorite-btn" class="action-btn" title="æ”¶è—"> 
               <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
               </svg>
            </span> 
            <span id="selection-forward-btn" class="action-btn" title="è½¬å‘" data-lang-key-title="chatSelectionForward"> 
               <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="17 11 12 6 7 11"></polyline>
                  <polyline points="17 18 12 13 7 18"></polyline>
               </svg>
            </span>
            <span id="selection-share-btn" class="action-btn" title="åˆ†äº«"> 
               <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="18" cy="5" r="3"></circle>
                  <circle cx="6" cy="12" r="3"></circle>
                  <circle cx="18" cy="19" r="3"></circle>
                  <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                  <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
               </svg>
            </span> 
            <span id="selection-soft-delete-btn" class="action-btn" title="åˆ é™¤(é€šçŸ¥AI)"> 
               <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
               </svg>
            </span>
            <span id="selection-erase-btn" class="action-btn" style="color: #ff3b30;" title="å½»åº•åˆ é™¤">
               <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M20 20H7L3 16C2 15 2 13 3 12L13 2L22 11L20 20Z"></path>
                  <path d="M17 17L7 7"></path>
               </svg>
            </span>
            
          </div>
        </div>
      </div>
      <div id="chat-messages">
        <div id="typing-indicator">å¯¹æ–¹æ­£åœ¨è¾“å…¥...</div>
      </div>
      <div id="chat-input-area">
        <div id="chat-at-mention-popup" class="at-mention-popup"></div>
        <div id="reply-preview-bar">
          <div class="reply-preview-content">
            <div class="sender">å›å¤ xxx:</div>
            <div class="text">è¢«å¼•ç”¨çš„æ¶ˆæ¯å†…å®¹...</div>
          </div> <span id="cancel-reply-btn">Ã—</span>
        </div>
        <div id="chat-input-actions-top"> <button id="open-sticker-panel-btn" class="chat-action-icon-btn action-button" title="è¡¨æƒ…é¢æ¿">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
        <line x1="9" y1="9" x2="9.01" y2="9"></line>
        <line x1="15" y1="9" x2="15.01" y2="9"></line>
    </svg>
</button> <button id="send-photo-btn" class="chat-action-icon-btn action-button" title="å‘é€ç…§ç‰‡"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
              <circle cx="12" cy="13" r="4"></circle>
            </svg></button> <button id="camera-capture-btn" class="chat-action-icon-btn action-button" title="æ‹ç…§">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path>
              <circle cx="12" cy="13" r="3"></circle>
            </svg>
          </button> <button id="upload-image-btn" class="chat-action-icon-btn action-button" title="ä¸Šä¼ å›¾ç‰‡"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 3.5H3C2.44772 3.5 2 3.94772 2 4.5V19.5C2 20.0523 2.44772 20.5 3 20.5H21C21.5523 20.5 22 20.0523 22 19.5V4.5C22 3.94772 21.5523 3.5 21 3.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
              <path d="M16.5 13.5C17.6046 13.5 18.5 12.6046 18.5 11.5C18.5 10.3954 17.6046 9.5 16.5 9.5C15.3954 9.5 14.5 10.3954 14.5 11.5C14.5 12.6046 15.3954 13.5 16.5 13.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
              <path d="M22 14.5L18 10.5L10.3333 18.5M12.5 16L9 12.5L2 19.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg> </button><button id="transfer-btn" class="chat-action-icon-btn action-button" title="è½¬è´¦">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="2" y="6" width="20" height="12" rx="2"></rect>
        <circle cx="12" cy="12" r="2"></circle>
        <path d="M6 12h.01M18 12h.01"></path>
    </svg>
</button><button id="voice-message-btn" class="chat-action-icon-btn action-button" title="å‘é€è¯­éŸ³"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
              <path d="M12 19v4"></path>
              <path d="M8 23h8"></path>
            </svg></button> <button id="voice-record-btn" class="chat-action-icon-btn action-button" title="å½•éŸ³">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="10" y="4" width="4" height="10" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                <path d="M6 12c0 3.314 2.686 6 6 6s6-2.686 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <line x1="12" y1="18" x2="12" y2="22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <line x1="9" y1="22" x2="15" y2="22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button> <button id="send-waimai-request-btn" class="chat-action-icon-btn action-button" title="å‘èµ·å¤–å–è¯·æ±‚"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <path d="M16 10a4 4 0 0 1-8 0"></path>
            </svg></button> <button id="video-call-btn" class="chat-action-icon-btn action-button" title="è§†é¢‘é€šè¯"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="23 7 16 12 23 17 23 7"></polygon>
              <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
            </svg></button> <button id="group-video-call-btn" class="chat-action-icon-btn action-button" title="ç¾¤è§†é¢‘é€šè¯"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg></button> <button id="voice-call-btn" class="chat-action-icon-btn action-button" title="è¯­éŸ³é€šè¯"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
            </svg></button> <button id="group-voice-call-btn" class="chat-action-icon-btn action-button" title="ç¾¤è¯­éŸ³é€šè¯"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
              <path d="M15.05 16a5 5 0 0 1 0-9.9"></path>
            </svg></button> <button id="send-poll-btn" class="chat-action-icon-btn action-button" title="å‘èµ·æŠ•ç¥¨"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M8 6h10"></path>
              <path d="M6 6h.01"></path>
              <path d="M8 12h10"></path>
              <path d="M6 12h.01"></path>
              <path d="M8 18h10"></path>
              <path d="M6 18h.01"></path>
            </svg></button> <button id="share-link-btn" class="chat-action-icon-btn action-button" title="åˆ†äº«é“¾æ¥"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"></path>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"></path>
            </svg></button> <button id="share-location-btn" class="chat-action-icon-btn action-button" title="å…±äº«ä½ç½®"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg></button> <button id="gomoku-btn" class="chat-action-icon-btn action-button" title="äº”å­æ£‹"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <circle cx="12" cy="12" r="4"></circle>
              <circle cx="12" cy="12" r="7"></circle>
            </svg> </button> <button id="open-shopping-btn" class="chat-action-icon-btn action-button" title="è´­ç‰©"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg> </button> <button id="pat-btn" class="chat-action-icon-btn action-button" title="æ‹ä¸€æ‹" style="display: none;"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M16 5.02c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M14.5 11.02c0 .83-.67 1.5-1.5 1.5v0c-.83 0-1.5-.67-1.5-1.5v-5c0-.83.67-1.5 1.5-1.5v0c.83 0 1.5.67 1.5 1.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M8 11.02c0 .83-.67 1.5-1.5 1.5v0c-.83 0-1.5-.67-1.5-1.5v-5c0-.83.67-1.5 1.5-1.5v0c.83 0 1.5.67 1.5 1.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
            </svg> </button> <button id="edit-last-response-btn" class="chat-action-icon-btn action-button" title="å¯¼æ¼”æ¨¡å¼ï¼šç¼–è¾‘AIä¸Šä¸€è½®çš„å®Œæ•´å“åº”"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M12 20h9"></path>
              <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
            </svg> </button> <button id="regenerate-btn" class="chat-action-icon-btn action-button" title="é‡æ–°ç”Ÿæˆå›å¤" style="display: flex;"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
              <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
            </svg> </button> <button id="propel-btn" class="chat-action-icon-btn action-button" title="æ¨è¿›å‰§æƒ…" style="display: flex;"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <polygon points="13 19 22 12 13 5 13 19"></polygon>
              <polygon points="2 19 11 12 2 5 2 19"></polygon>
            </svg> </button> <button id="show-announcement-board-btn" class="chat-action-icon-btn action-button" title="ç¾¤å…¬å‘Šæ¿" style="display: none;"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M21.782 6.132a1 1 0 0 0-1.053-.08l-4.729 2.489a1 1 0 0 0-.5.88v4.158a1 1 0 0 0 .5.88l4.729 2.489a1 1 0 0 0 1.053-.08a1 1 0 0 0 .499-.921V7.052a1 1 0 0 0-.499-.92zm-6 3.207L11 7.05v9.9l4.782-2.281V9.339zM10 6H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h6V6z" />
            </svg> </button><button id="werewolf-game-btn" class="chat-action-icon-btn action-button" title="ç‹¼äººæ€" style="display: none;"> <svg width="24" height="24" viewBox="0 0 512 512" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M332.6 128.5c-61.1 0-110.5 49.4-110.5 110.5 0 23.4 7.3 45.1 19.9 63.3-19.3 6.3-40.1 9.7-61.9 9.7-88.2 0-160-71.8-160-160s71.8-160 160-160c5.3 0 10.5.3 15.6.8C202.9 44.1 160 0 160 0s-53.3 44.1-45.9 92.5c-48.4 24.3-82.1 73.4-82.1 129.6 0 80.9 65.5 146.4 146.4 146.4 20.2 0 39.4-4.1 56.8-11.5 24.1 33.6 63.3 56.8 107.4 56.8 7.2 0 14.2-0.6 21-1.7 15.2 24.2 41.2 41.1 71.6 41.1 44.7 0 80.9-36.2 80.9-80.9 0-25.2-11.5-47.7-29.6-62.6 11.6-16.1 18.4-35.6 18.4-56.5C443.1 177.9 393.7 128.5 332.6 128.5zM180.1 85.8c-52.1 0-94.4 42.3-94.4 94.4s42.3 94.4 94.4 94.4 94.4-42.3 94.4-94.4S232.2 85.8 180.1 85.8zM332.6 170.9c-37.8 0-68.4 30.6-68.4 68.4s30.6 68.4 68.4 68.4 68.4-30.6 68.4-68.4S370.4 170.9 332.6 170.9z">
              </path>
            </svg></button><button id="read-together-btn" class="chat-action-icon-btn action-button" title="ä¸€èµ·è¯»ä¹¦"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
              <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg></button> <button id="open-nai-gallery-btn" class="chat-action-icon-btn action-button" title="NAIç”»å»Š">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 3l1.91 5.86L20 10.9l-5.86 1.91L12 18.6l-1.91-5.86L4 10.9l5.86-1.91L12 3z"/>
        <path d="M5 3l1.5 4.5L11 9l-4.5 1.5L5 12l-1.5-4.5L-1 6l4.5-1.5L5 3z"/>
        <path d="M19 15l-1.5 4.5L13 21l4.5-1.5L19 18l1.5 4.5L25 21l-4.5-1.5L19 15z"/>
    </svg>
</button>
<button id="open-quick-reply-btn" class="chat-action-icon-btn action-button" title="å¿«æ·å›å¤">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
              </svg>
            </button>
<button id="open-todo-list-btn" class="chat-action-icon-btn action-button" title="å¾…åŠäº‹é¡¹">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 11l3 3L22 4"></path>
        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
    </svg>
</button> <button id="open-truth-game-btn" class="chat-action-icon-btn action-button" title="çœŸå¿ƒè¯">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
    </svg>
</button> <button id="open-watch-together-btn" class="chat-action-icon-btn action-button" title="ä¸€èµ·çœ‹ç”µå½±">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect>
        <polyline points="17 2 12 7 7 2"></polyline>
    </svg>
</button> <button id="stop-api-call-btn" class="chat-action-icon-btn action-button" title="æš‚åœè°ƒç”¨" style="display: none;"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <rect x="9" y="8" width="2" height="8" rx="1" fill="currentColor"></rect>
              <rect x="13" y="8" width="2" height="8" rx="1" fill="currentColor"></rect>
            </svg> </button>
</div>
        <div id="chat-input-main-row"> <button id="chat-expand-btn" class="chat-action-icon-btn action-button" title="å±•å¼€åŠŸèƒ½">+</button><textarea id="chat-input" rows="1" placeholder="è¾“å…¥æ¶ˆæ¯..."></textarea>
          <div id="input-actions-wrapper"> <button id="wait-reply-btn" title="ç­‰å¾…å›å¤"><img src="https://i.postimg.cc/q72zq80N/ECE92-BBC-BE57-48-E9-BB2-C-345-B6019-C4-B2.png" alt="ç­‰å¾…å›å¤"></button> <button id="send-btn" class="action-button">å‘é€</button> </div>
        </div>
      </div>
      <div id="chat-lock-overlay">
        <div id="chat-lock-content"></div>
      </div>
<div id="nai-gallery-panel">
    <div id="nai-gallery-panel-header">
        <span class="panel-btn" id="close-nai-gallery-btn" data-lang-key="cancel">å–æ¶ˆ</span>
        
        <div id="nai-gallery-tabs">
            <div class="nai-gallery-tab active" data-tab-id="local">æœ¬åœ°</div>
            <div class="nai-gallery-tab" data-tab-id="cloud">å›¾åºŠ</div>
        </div>
        
        <div style="display: flex; gap: 10px;">
            <span class="panel-btn" id="manage-nai-gallery-btn">ç®¡ç†</span>
        </div>
    </div>
    
    <div id="nai-gallery-grid-container">
        <div id="nai-gallery-grid-local" class="nai-gallery-page active">
            </div>
        
        <div id="nai-gallery-grid-cloud" class="nai-gallery-page">
            </div>
    </div>
    
  
    
<div id="nai-gallery-action-bar">
    <label class="select-all-label" style="display: flex; align-items: center; gap: 5px;">
        <input type="checkbox" id="select-all-nai-gallery-checkbox"> å…¨é€‰
    </label>
    <button id="export-selected-nai-gallery-btn" class="action-bar-btn" style="background-color: #17a2b8; display: none; font-size: 14px; padding: 10px 15px;">å¯¼å‡º (0)</button>
    <button id="download-selected-nai-gallery-btn" class="action-bar-btn" style="background-color: #007bff; font-size: 14px; padding: 10px 15px;">ä¸‹è½½ (0)</button>
   <button id="upload-selected-nai-gallery-btn" class="action-bar-btn" style="background-color: #4cd964; display: none; font-size: 14px; padding: 10px 15px;">ä¸Šä¼  (0)</button>
    <button id="delete-selected-nai-gallery-btn" class="action-bar-btn" style="font-size: 14px; padding: 10px 15px;">åˆ é™¤ (0)</button>
</div>
</div>
      <div id="sticker-panel">
        <div id="sticker-panel-header"> <span class="panel-btn" id="close-sticker-panel-btn"data-lang-key="cancel">å–æ¶ˆ</span> <span class="title">æˆ‘çš„è¡¨æƒ…</span>
          <div style="display: flex; gap: 10px;"> <span class="panel-btn" id="manage-sticker-categories-btn">åˆ†ç±»</span> <span class="panel-btn" id="manage-stickers-btn">ç®¡ç†</span> <span class="panel-btn" id="add-sticker-batch-btn">æ‰¹é‡</span> <span class="panel-btn" id="upload-sticker-btn">ä¸Šä¼ </span> </div>
        </div>
        <div id="sticker-category-tabs"></div>
        <div id="sticker-search-container"> <input type="search" id="sticker-search-input" placeholder="æœç´¢è¡¨æƒ…åç§°..."></div>
        <div id="sticker-grid"></div>
        <div id="sticker-action-bar"> <label class="select-all-label" style="display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-stickers-checkbox"> å…¨é€‰ </label><button id="move-selected-stickers-btn" style="background-color: #ff9800; margin-left: 5px;">ç§»åŠ¨ (0)</button> <button id="export-selected-stickers-btn" style="background-color: #007bff;">å¯¼å‡º (0)</button><button id="delete-selected-stickers-btn">åˆ é™¤ (0)</button> </div>
      </div> <input type="file" id="sticker-upload-input" accept="image/*" style="display: none;"> <input type="file" id="image-upload-input" accept="image/*" style="display: none;"> <input type="file" id="camera-capture-input" accept="image/*" capture="environment" style="display: none;">
      <div id="music-player-overlay">
        <div class="music-player-window">
          <div class="music-player-top-actions">
            <div class="top-left-cluster"> <button id="music-return-btn">â€¹</button> <button id="music-exit-btn">Ã—</button> </div>
            <div style="display: flex; align-items: center; gap: 15px;"> <button id="toggle-fullscreen-btn" title="åˆ‡æ¢å…¨å±"> <svg class="icon-maximize" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3" />
                </svg> <svg class="icon-minimize" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3" />
                </svg> </button> <span id="music-playlist-btn">â˜°</span> </div>
          </div>
          <div id="music-player-avatar-display"> </div>
          <div id="music-info-top">
            <div style="display: flex; justify-content: center; align-items: center; gap: 10px;">
              <div id="music-time-counter">å·²ç»ä¸€èµ·å¬äº†0.0å°æ—¶</div> <button id="show-avatars-btn" title="æ˜¾ç¤º/éšè—å¤´åƒ"> <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg> </button>
            </div>
            <div id="music-player-song-title">è¯·æ·»åŠ æ­Œæ›²</div>
            <div id="music-player-artist">...</div>
          </div>
          <div id="music-visual-container">
            <div id="vinyl-view"> <img id="music-player-cover" src="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1757748720126_qdqqd_1jt5sv.jpeg" alt="Album Art"> </div>
            <div id="inline-lyrics-view">
              <div id="music-lyrics-container">
                <div id="music-lyrics-list"> </div>
              </div>
            </div>
          </div>
          <div id="single-lyric-display">â™ª â™ª â™ª</div>
          <div class="music-player-controls-wrapper">
            <div class="music-progress-bar-container">
              <div id="music-current-time" class="time-display">0:00</div>
              <div class="progress-bar">
                <div id="music-progress-fill" class="progress-bar-fill"></div>
              </div>
              <div id="music-total-time" class="time-display">0:00</div>
            </div>
            <div class="music-controls"> <button id="music-prev-btn">â—€</button> <button id="music-play-pause-btn" class="play-pause-btn">â–¶</button> <button id="music-next-btn">â–¶</button> <button id="music-mode-btn">é¡ºåº</button> <button id="toggle-blur-btn" title="åˆ‡æ¢èƒŒæ™¯æ¸…æ™°åº¦">æ¸…</button>
            </div>
          </div>
        </div>
      </div>
      <div id="music-playlist-panel">
        <div class="playlist-header">
          <div class="header-left-actions" style="display: flex; align-items: center; gap: 10px;">
            <span class="panel-btn" id="close-playlist-btn" data-lang-key="back">è¿”å›</span>
            <span class="panel-btn" id="manage-playlist-btn" data-lang-key="manage">ç®¡ç†</span>
          </div>
          
          <span data-lang-key="playlistTitle">æ’­æ”¾åˆ—è¡¨</span>
          
          <div>
            <span class="panel-btn" id="cleanup-songs-btn">æ¸…ç†</span> 
            <span class="panel-btn" id="add-song-local-btn">æœ¬åœ°</span> 
            <span class="panel-btn" id="add-song-url-btn">URL</span> 
            <span class="panel-btn" id="add-song-search-btn" data-lang-key="search">æœç´¢</span>
          </div>
        </div>
        <div class="playlist-body" id="playlist-body"></div>
       <div id="playlist-action-bar">
        <label class="select-all-label" style="display: flex; align-items: center; gap: 5px;">
            <input type="checkbox" id="select-all-playlist-checkbox"> å…¨é€‰
        </label>
        <button id="delete-selected-songs-btn" class="action-bar-btn" style="background-color: #ff3b30;">åˆ é™¤ (0)</button>
        <button id="upload-selected-to-catbox-btn" class="action-bar-btn" style="background-color: #007bff;">ä¸Šä¼ Catbox (0)</button>
      </div>
      </div> <input type="file" id="local-song-upload-input" accept="audio/*" multiple style="display: none;"> <input type="file" id="lrc-upload-input" accept=".lrc" style="display: none;">
    </div>
    
    <!-- æç¤ºè¯ç®¡ç†å±å¹• -->
    <div id="prompt-manager-screen" class="screen ios-settings-screen">
      <div class="header">
        <span class="back-btn" onclick="showScreen('api-settings-screen')">â€¹</span>
        <span>æç¤ºè¯ç®¡ç†</span>
        <span style="width: 30px;"></span>
      </div>
      
      <div class="settings-container ios-scroll-container">
        <!-- æ“ä½œæŒ‰é’®åŒº -->
        <div class="settings-section">
          <button id="prompt-export-btn" class="settings-full-btn">å¯¼å‡ºæç¤ºè¯</button>
          <button id="prompt-import-btn" class="settings-full-btn">å¯¼å…¥æç¤ºè¯</button>
          <button id="prompt-reset-btn" class="settings-full-btn">é‡ç½®é»˜è®¤</button>
        </div>
        
        <!-- åœºæ™¯åˆ—è¡¨ -->
        <div id="prompt-scenes-container"></div>
      </div>
      
      <input type="file" id="prompt-import-input" accept=".json" style="display: none;">
    </div>
    
    <!-- æç¤ºè¯ç¼–è¾‘å™¨æ¨¡æ€æ¡† -->
    <div id="prompt-editor-modal" class="modal" style="display: none;">
      <div class="modal-content" style="max-width: 90%; max-height: 90%; width: 800px;">
        <div class="modal-header">
          <h3 id="prompt-editor-title">ç¼–è¾‘æç¤ºè¯</h3>
          <span class="modal-close" onclick="closePromptEditor()">&times;</span>
        </div>
        <div class="modal-body" style="padding: 20px;">
          <textarea id="prompt-editor-textarea" style="width: 100%; min-height: 400px; font-family: monospace; font-size: 14px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; resize: vertical;"></textarea>
          <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end;">
            <button onclick="closePromptEditor()" class="form-button form-button-secondary">å–æ¶ˆ</button>
            <button onclick="savePromptEdit()" class="form-button">ä¿å­˜</button>
          </div>
        </div>
      </div>
    </div>
    
    <div id="wallpaper-screen" class="screen ios-settings-screen">
      <div class="header"> 
        <span class="back-btn" onclick="showScreen('home-screen')">â€¹</span> 
        <span data-lang-key="appearanceTitle">å¤–è§‚è®¾ç½®</span> 
        <!-- ä¿ç•™åŸæœ‰ä¿å­˜æŒ‰é’®é€»è¾‘ -->
        <span class="save-btn" id="save-wallpaper-btn" data-lang-key="save">å®Œæˆ</span> 
      </div>

      <div class="settings-container ios-scroll-container">

        <!-- 1. å£çº¸ä¸èƒŒæ™¯ -->
        <div class="settings-header">å£çº¸ä¸èƒŒæ™¯</div>
        <div class="settings-section">
            <!-- EPhone ä¸»å±å¹• -->
            <div class="settings-item">
                <label>ä¸»å±å¹•å£çº¸</label>
                <div class="settings-right">
                    <!-- é¢„è§ˆå›¾ -->
                    <div id="wallpaper-preview" class="wallpaper-thumbnail">é¢„è§ˆ</div>
                    <!-- æŒ‰é’®ç»„ -->
                    <div class="action-btn-group">
                        <button class="settings-mini-btn" onclick="document.getElementById('wallpaper-upload-input').click()">æœ¬åœ°</button>
                        <button id="upload-ephone-bg-url-btn" class="settings-mini-btn">URL</button>
                        <button id="reset-ephone-bg-btn" class="settings-mini-btn">é‡ç½®</button>
                    </div>
                    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
                    <input type="file" id="wallpaper-upload-input" accept="image/*" class="hidden-input">
                </div>
            </div>

            <!-- CPhone æ‰‹æœº -->
            <div class="settings-item">
                <label>CPhone å£çº¸</label>
                <div class="settings-right">
                    <div id="cphone-wallpaper-preview" class="wallpaper-thumbnail">é¢„è§ˆ</div>
                    <div class="action-btn-group">
                        <button class="settings-mini-btn" onclick="document.getElementById('cphone-wallpaper-upload-input').click()">æœ¬åœ°</button>
                        <button id="upload-cphone-bg-url-btn" class="settings-mini-btn">URL</button>
                        <button id="reset-cphone-bg-btn" class="settings-mini-btn">é‡ç½®</button>
                    </div>
                    <input type="file" id="cphone-wallpaper-upload-input" accept="image/*" class="hidden-input">
                </div>
            </div>

            <!-- MYphone æ‰‹æœº -->
            <div class="settings-item">
                <label>MYphone å£çº¸</label>
                <div class="settings-right">
                    <div id="myphone-wallpaper-preview" class="wallpaper-thumbnail">é¢„è§ˆ</div>
                    <div class="action-btn-group">
                        <button class="settings-mini-btn" onclick="document.getElementById('myphone-wallpaper-upload-input').click()">æœ¬åœ°</button>
                        <button id="upload-myphone-bg-url-btn" class="settings-mini-btn">URL</button>
                        <button id="reset-myphone-bg-btn" class="settings-mini-btn">é‡ç½®</button>
                    </div>
                    <input type="file" id="myphone-wallpaper-upload-input" accept="image/*" class="hidden-input">
                </div>
            </div>

            <!-- å…¨å±€èŠå¤©èƒŒæ™¯ -->
            <div class="settings-item">
                <label>èŠå¤©èƒŒæ™¯ (å…¨å±€)</label>
                <div class="settings-right">
                    <div id="global-bg-preview" class="wallpaper-thumbnail">é¢„è§ˆ</div>
                    <div class="action-btn-group">
                        <button class="settings-mini-btn" onclick="document.getElementById('global-bg-input').click()">æœ¬åœ°</button>
                        <button id="upload-global-bg-url-btn" class="settings-mini-btn">URL</button>
                        <button id="reset-global-bg-btn" class="settings-mini-btn">é‡ç½®</button>
                    </div>
                    <input type="file" id="global-bg-input" accept="image/*" class="hidden-input">
                </div>
            </div>
        </div>


        <!-- æ—¶é—´æˆ³æ˜¾ç¤ºæ ¼å¼ -->
        <div class="settings-header">æ—¶é—´æˆ³æ˜¾ç¤º</div>
        <div class="settings-section">
            <div class="settings-item">
                <div>
                    <div style="font-weight: 500;">æ˜¾ç¤ºç§’æ•°</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">å¼€å¯åï¼Œæ¶ˆæ¯æ—¶é—´æˆ³å°†æ˜¾ç¤ºä¸º"æ—¶:åˆ†:ç§’"æ ¼å¼</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="global-show-seconds-switch">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <!-- 2. æ˜¾ç¤ºä¸äº¤äº’ -->
        <div class="settings-header">æ˜¾ç¤ºä¸äº¤äº’</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>å¤œé—´æ¨¡å¼</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="theme-toggle-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-item">
                <label>é¡¶éƒ¨çŠ¶æ€æ </label>
                <label class="toggle-switch">
                    <input type="checkbox" id="status-bar-toggle-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-item">
                <div>
                    <label>æ‰‹æœºå¤–æ¡†</label>
                    <div class="settings-desc">æ²‰æµ¸å¼ä»¿çœŸè¾¹æ¡†</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="phone-frame-toggle-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-item">
                <div>
                    <label>åˆ†ç¦»çŠ¶æ€æ </label>
                    <div class="settings-desc">ä¸è¦†ç›–é¡¶éƒ¨åŒºåŸŸ (åˆ˜æµ·å±é€‚é…)</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="detach-status-bar-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-item">
                <div>
                    <label>éŸ³ä¹çµåŠ¨å²›</label>
                    <div class="settings-desc">å¬æ­Œæ—¶å§‹ç»ˆæ˜¾ç¤ºçµåŠ¨å²›UI</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="dynamic-island-music-toggle-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-item">
                <div>
                    <label>ç®€æ´èŠå¤©ç•Œé¢</label>
                    <div class="settings-desc">é»˜è®¤æŠ˜å èŠå¤©å·¥å…·æ </div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="minimal-chat-ui-switch">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <!-- 3. é”å±è®¾ç½® -->
        <div class="settings-header">é”å±å®‰å…¨</div>
        <div class="settings-section">
            <div class="settings-item">
                <label>å¯ç”¨é”å±å¯†ç </label>
                <label class="toggle-switch">
                    <input type="checkbox" id="lock-screen-toggle">
                    <span class="slider"></span>
                </label>
            </div>
            
            <!-- é”å±è¯¦æƒ… (JSæ§åˆ¶æ˜¾ç¤ºéšè—) -->
            <div id="lock-screen-settings-detail" style="display: none; background-color: #f9f9f9; border-top: 0.5px solid #ebedf0;">
                <div class="settings-item">
                    <label>4ä½æ•°å­—å¯†ç </label>
                    <div class="settings-right">
                        <input type="tel" id="lock-screen-password-input" maxlength="4" placeholder="1234" class="settings-num-input" style="width: 80px !important; letter-spacing: 2px;">
                    </div>
                </div>
                <div class="settings-item">
                    <label>é”å±å£çº¸</label>
                    <div class="settings-right">
                         <div id="lock-wallpaper-preview" class="wallpaper-thumbnail" style="margin-right: 10px;">æ— </div>
                         <div class="action-btn-group">
                             <button class="settings-mini-btn" onclick="document.getElementById('lock-wallpaper-input').click()">æœ¬åœ°</button>
                             <button id="upload-lock-wallpaper-url-btn" class="settings-mini-btn">URL</button>
                         </div>
                         <input type="file" id="lock-wallpaper-input" accept="image/*" class="hidden-input">
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. æç¤ºéŸ³ -->
        <div class="settings-header">å£°éŸ³</div>
        <div class="settings-section">
            <!-- é¢„è®¾é€‰æ‹©ä¸‹æ‹‰æ¡† -->
            <div class="settings-item-block">
                <label style="display:block; margin-bottom:8px;">é€‰æ‹©æˆ–åˆ‡æ¢é¢„è®¾</label>
                <div style="display: flex; gap: 8px;">
                    <select id="sound-preset-select" class="settings-textarea" style="flex-grow:1; min-height:36px; padding:8px;">
                        <option value="current">å½“å‰é…ç½® (æœªä¿å­˜)</option>
                    </select>
                    <button id="delete-sound-preset-btn" class="settings-mini-btn" style="width:auto; color: #ff3b30;">åˆ é™¤</button>
                </div>
            </div>
            
            <div class="settings-item-block" style="margin-top: 12px;">
                <label style="display:block; margin-bottom:8px;">æ¶ˆæ¯æç¤ºéŸ³ URL</label>
                <input type="text" id="notification-sound-url-input" placeholder="ç•™ç©ºä½¿ç”¨é»˜è®¤" class="settings-textarea" style="width:100%; min-height:36px; padding:8px; margin-bottom:8px;">
                <div style="display: flex; gap: 8px;">
                    <button id="test-sound-btn" class="settings-mini-btn" style="flex:1;">è¯•å¬</button>
                    <button id="reset-sound-btn" class="settings-mini-btn" style="flex:1;">é‡ç½®</button>
                    <button id="save-sound-preset-btn" class="settings-mini-btn" style="flex:1;">ä¿å­˜</button>
                </div>
            </div>
            
            <div class="settings-item-block" style="margin-top: 12px;">
                <label style="display:block; margin-bottom:8px;">æç¤ºéŸ³éŸ³é‡</label>
                <div style="display: flex; align-items: center; gap: 12px;">
                    <input type="range" id="notification-volume-slider" min="0" max="100" value="100" style="flex: 1; height: 6px;">
                    <span id="notification-volume-label" style="min-width: 45px; text-align: right; font-size: 14px; color: #8e8e93;">100%</span>
                </div>
            </div>
        </div>

        <!-- 5. å›¾æ ‡å®šåˆ¶ -->
        <div class="settings-header">å›¾æ ‡å®šåˆ¶</div>
        <div class="settings-section">
            <div class="settings-item-block">
                <label style="margin-bottom: 10px; display:block; font-weight:600;">EPhone ä¸»å±å¹•å›¾æ ‡</label>
                <div id="icon-settings-grid" class="settings-icon-grid">
                    <!-- JS å¡«å…… -->
                </div>
            </div>
            <div class="settings-item-block" style="border-top: 0.5px solid #c6c6c8;">
                <label style="margin-bottom: 10px; display:block; font-weight:600;">CPhone åº”ç”¨å›¾æ ‡</label>
                <div id="cphone-icon-settings-grid" class="settings-icon-grid">
                    <!-- JS å¡«å…… -->
                </div>
            </div>
            <div class="settings-item-block" style="border-top: 0.5px solid #c6c6c8;">
                <label style="margin-bottom: 10px; display:block; font-weight:600;">MYphone åº”ç”¨å›¾æ ‡</label>
                <div id="myphone-icon-settings-grid" class="settings-icon-grid">
                    <!-- JS å¡«å…… -->
                </div>
            </div>
        </div>

        <!-- 6. å·¥å…·æ æ’åº -->
        <div class="settings-header">èŠå¤©å·¥å…·æ </div>
        <div class="settings-section">
            <div class="settings-item-block">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <label>æŒ‰é’®æ’åº</label>
                    <button id="reset-button-order-btn" class="settings-mini-btn">æ¢å¤é»˜è®¤</button>
                </div>
                <div class="settings-desc" style="margin: 0 0 10px 0;">æ‹–åŠ¨ä¸‹æ–¹æŒ‰é’®è°ƒæ•´é¡ºåºï¼š</div>
                <div id="button-order-editor">
                    <!-- JS å¡«å…… -->
                </div>
            </div>
        </div>

        <!-- 7. é¢„è®¾ç®¡ç† (é«˜çº§) -->
        <div class="settings-header">é¢„è®¾ä¸é«˜çº§</div>
        <div class="settings-section">
            <!-- å¤–è§‚é¢„è®¾ -->
            <div class="settings-item">
                 <label>å¤–è§‚é¢„è®¾</label>
                 <div class="settings-right">
                     <select id="appearance-preset-select" class="settings-select" style="width:auto; flex-grow:1; margin-right:5px;"></select>
                     <!-- ä¿®æ”¹ç‚¹ï¼šæ”¹ä¸º settings-mini-btn -->
                     <button id="save-appearance-preset-btn" class="settings-mini-btn">ä¿å­˜</button>
                     <button id="delete-appearance-preset-btn" class="settings-mini-btn" style="color: #ff3b30;">åˆ é™¤</button>
                 </div>
            </div>
            <!-- CSS é¢„è®¾ -->
            <div class="settings-item">
                 <label>CSS é¢„è®¾</label>
                 <div class="settings-right">
                     <select id="css-preset-select" class="settings-select" style="width:auto; flex-grow:1; margin-right:5px;"></select>
                     <!-- ä¿®æ”¹ç‚¹ï¼šæ”¹ä¸º settings-mini-btn -->
                     <button id="save-css-preset-btn" class="settings-mini-btn">ä¿å­˜</button>
                     <button id="delete-css-preset-btn" class="settings-mini-btn" style="color: #ff3b30;">åˆ é™¤</button>
                 </div>
            </div>
            
            <!-- è‡ªå®šä¹‰ CSS -->
            <div class="settings-item-block">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                    <label>å…¨å±€è‡ªå®šä¹‰ CSS</label>
                    <!-- ä¿®æ”¹ç‚¹ï¼šæ”¹ä¸º settings-mini-btn -->
                    <button id="reset-global-css-btn" class="settings-mini-btn">é‡ç½®</button>
                </div>
                <textarea id="global-css-input" class="settings-textarea" placeholder="/*åœ¨æ­¤è¾“å…¥CSS*/"></textarea>
            </div>
            
            <!-- å¯¼å…¥ -->
            <button class="settings-full-btn" id="export-appearance-btn">å¯¼å‡ºå¤–è§‚é…ç½® (JSON)</button>

            <button class="settings-full-btn" id="import-appearance-btn">å¯¼å…¥å¤–è§‚é…ç½® (JSON/Word/Txt)</button>
            <input type="file" id="import-appearance-input" accept=".json,.txt,.docx" class="hidden-input">
        </div>

        <div style="height: 40px;"></div>
      </div>
    </div>
    <div id="browser-screen" class="screen">
      <div class="header"> <span class="back-btn" id="browser-back-btn">â€¹</span> <span id="browser-title"></span> <span style="width: 30px;"></span> </div>
      <div id="browser-content" class="list-container"> </div>
    </div>
    <div id="font-settings-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">â€¹</span> <span data-lang-key="fontSettingsTitle">å­—ä½“è®¾ç½®</span> <span style="width: 30px;"></span> </div>
      <div class="form-container">
        <h3 style="margin-top:0; border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="fontPresetManagement">å­—ä½“é¢„è®¾ç®¡ç†</h3>
        <div class="form-group"> <label for="font-preset-select"data-lang-key="apiPresetSelectLabel">é€‰æ‹©æˆ–åˆ‡æ¢é¢„è®¾</label>
          <div style="display: flex; gap: 10px; align-items: center;"> <select id="font-preset-select" style="flex-grow: 1;"></select> <button id="save-font-preset-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;"data-lang-key="save">ä¿å­˜</button> <button id="delete-font-preset-btn"
              class="form-button-secondary" style="margin-top: 0; padding: 12px; background-color: #ffebee; color: #d32f2f; border-color: #ffcdd2;"data-lang-key="delete">åˆ é™¤</button> </div>
        </div>
        <hr style="margin: 30px 0; opacity: 0.3;">
        <div class="form-group"> <label for="font-url-input"data-lang-key="fontFileUrlLabel">å­—ä½“æ–‡ä»¶URL (.ttf, .otf, .woffç­‰)</label> <input type="text" id="font-url-input" placeholder="https://..../font.ttf"> </div>
        <div class="form-group">
          <label>å­—ä½“å¤§å° <span id="font-size-value">16</span>px</label>
          <input type="range" id="font-size-slider" min="10" max="28" value="16" step="1" style="width:100%;">
        </div>
        <div class="form-group"> <label data-lang-key="fontPreviewLabel">å®æ—¶é¢„è§ˆ</label>
          <div id="font-preview">
            <p style="font-size: 20px; margin: 0 0 10px 0;">ä½ å¥½ä¸–ç•Œ Hello World</p>
            <p style="margin: 0;">è¿™æ˜¯å­—ä½“é¢„è§ˆæ•ˆæœï¼Œ12345ã€‚</p>
          </div>
        </div>
        <hr style="margin: 30px 0; opacity: 0.3;">
        <div class="form-group">
          <label>å­—ä½“åº”ç”¨èŒƒå›´</label>
          <div class="font-scope-container">
            <label class="font-scope-item font-scope-all">
              <input type="checkbox" id="font-scope-all" checked>
              <span>å…¨éƒ¨åº”ç”¨</span>
            </label>
            <div id="font-scope-list" class="font-scope-list" style="display:none;">
              <label class="font-scope-item"><input type="checkbox" data-scope="homeScreen" checked><span>ä¸»å±å¹•</span></label>
              <label class="font-scope-item"><input type="checkbox" data-scope="qq" checked><span>QQ (èŠå¤©)</span></label>
              <label class="font-scope-item"><input type="checkbox" data-scope="cphone" checked><span>Cphone</span></label>
              <label class="font-scope-item"><input type="checkbox" data-scope="myphone" checked><span>Myphone</span></label>
              <label class="font-scope-item"><input type="checkbox" data-scope="worldBook" checked><span>ä¸–ç•Œä¹¦</span></label>
              <label class="font-scope-item"><input type="checkbox" data-scope="douban" checked><span>è±†ç“£</span></label>
              <label class="font-scope-item"><input type="checkbox" data-scope="alipay" checked><span>æ”¯ä»˜å®</span></label>
              <label class="font-scope-item"><input type="checkbox" data-scope="settings" checked><span>è®¾ç½®é¡µé¢</span></label>
            </div>
          </div>
        </div>
        <button class="form-button" id="save-font-btn"data-lang-key="fontSaveAndApply">ä¿å­˜å¹¶åº”ç”¨</button>
        <button class="form-button form-button-secondary" id="reset-font-scope-btn">æŒ‰åŒºåŸŸæ¢å¤é»˜è®¤å­—ä½“</button>
        <button class="form-button form-button-secondary" id="reset-font-btn"data-lang-key="fontResetDefault">å…¨éƒ¨æ¢å¤é»˜è®¤å­—ä½“</button>
      </div>
    </div>
    <div id="contact-picker-screen" class="screen">
      <div class="header"> <span class="back-btn" id="cancel-contact-picker-btn"data-lang-key="cancel">å–æ¶ˆ</span> <span>é€‰æ‹©è”ç³»äºº</span> <span class="save-btn" id="confirm-contact-picker-btn"data-lang-key="done">å®Œæˆ(0)</span> </div>
      <div class="list-container" id="contact-picker-list"> </div>
    </div>
    <div id="member-management-screen" class="screen">
      <div class="header"> <span class="back-btn" id="back-from-member-management">â€¹</span> <span>ç¾¤æˆå‘˜ç®¡ç†</span> <span style="width: 30px;"></span> </div>
      <div class="list-container" id="member-management-list"> </div>
      <div id="member-management-actions"> <button id="add-existing-contact-btn">ä»å¥½å‹åˆ—è¡¨æ·»åŠ </button> <button id="create-new-member-btn">åˆ›å»ºç¾¤å†…æ–°æˆå‘˜</button> </div>
    </div>
    <div id="sticker-category-manager-modal" class="modal">
      <div class="modal-content" style="height: 60%;">
        <div class="modal-header"> <span>ç®¡ç†è¡¨æƒ…åˆ†ç±»</span> </div>
        <div class="modal-body">
          <div class="form-group"> <label>æ–°å»ºåˆ†ç±»</label>
            <div style="display: flex; gap: 10px;"> <input type="text" id="new-sticker-category-name-input" placeholder="è¾“å…¥åˆ†ç±»å..." style="flex-grow: 1;"> <button id="add-new-sticker-category-btn" class="form-button" style="width: auto; margin-top: 0; padding: 0 15px;"data-lang-key="add">æ·»åŠ </button> </div>
          </div>
          <hr style="opacity: 0.2;">
          <div id="existing-sticker-categories-list" style="display: flex; flex-direction: column; gap: 10px;"> </div>
        </div>
        <div class="modal-footer"> <button class="save" id="close-sticker-category-manager-btn" style="width: 100%;"data-lang-key="done">å®Œæˆ</button> </div>
      </div>
    </div>
    <div id="clear-stickers-modal" class="modal">
      <div class="modal-content" style="height: 70%;">
        <div class="modal-header"> <span>æ¸…ç©ºèŠå¤©ä¸­çš„è¡¨æƒ…åŒ…</span> </div>
        <div class="modal-body">
          <div style="margin-bottom: 15px; padding: 12px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ff9800;">
            <div style="font-weight: 600; color: #856404; margin-bottom: 8px;">ğŸ“Š èŠå¤©è¡¨æƒ…åŒ…å­˜å‚¨å ç”¨åˆ†æ</div>
            <div id="sticker-storage-stats" style="font-size: 13px; color: #856404; line-height: 1.6;">
              æ­£åœ¨è®¡ç®—...
            </div>
          </div>
          <div style="margin-bottom: 15px;">
            <label style="font-weight: 600; display: flex; align-items: center; gap: 8px; cursor: pointer;">
              <input type="checkbox" id="select-all-categories-checkbox" style="width: 18px; height: 18px; cursor: pointer;">
              <span>å…¨é€‰æ‰€æœ‰è§’è‰²</span>
            </label>
          </div>
          <div id="clear-stickers-category-list" style="display: flex; flex-direction: column; gap: 8px; max-height: 300px; overflow-y: auto;">
            <!-- è§’è‰²åˆ—è¡¨å°†åœ¨æ­¤å¤„åŠ¨æ€æ¸²æŸ“ -->
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-clear-stickers-btn" data-lang-key="cancel">å–æ¶ˆ</button>
          <button class="save" id="confirm-clear-stickers-btn" style="background: #dc3545;">æ¸…ç©ºé€‰ä¸­</button>
        </div>
      </div>
    </div>
    <div id="incoming-call-modal" class="modal">
      <div class="incoming-call-content"> <img id="caller-avatar" class="caller-avatar" src="">
        <div id="caller-name" class="caller-name"></div>
        <div class="caller-text">é‚€è¯·ä½ è§†é¢‘é€šè¯</div>
        <div class="incoming-call-actions">
          <div class="action-button-wrapper"> <button id="decline-call-btn" class="call-action-btn decline"></button> <span>æ‹’ç»</span> </div>
          <div class="action-button-wrapper"> <button id="accept-call-btn" class="call-action-btn accept"></button> <span>æ¥å¬</span> </div>
        </div>
      </div>
    </div>
    <div id="video-call-screen" class="screen">
     
<div class="video-call-top-bar">
    <button id="minimize-call-btn" title="æœ€å°åŒ–">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round">
            <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
    </button>
    <span id="call-timer">00:00</span> 
</div>

      <!-- è§†é¢‘ç”»é¢æ˜¾ç¤ºåŒº (ä¼˜åŒ–æ¨¡å¼) -->
      <div id="video-display-area" style="display: none;">
        <!-- å¤§å±ï¼šå¯¹æ–¹ç”»é¢ -->
        <div id="remote-video-large" class="video-large-screen">
          <img id="remote-video-img" src="" alt="å¯¹æ–¹è§†é¢‘">
        </div>
        <!-- å°å±ï¼šæˆ‘æ–¹ç”»é¢ -->
        <div id="local-video-small" class="video-small-screen">
          <img id="local-video-img" src="" alt="æˆ‘çš„è§†é¢‘" style="display: block;">
          <video id="local-camera-video" autoplay playsinline muted style="display: none; width: 100%; height: 100%; object-fit: cover;"></video>
        </div>
      </div>

      <div class="video-call-avatar-area">
        <div id="participant-avatars-grid"> </div>
      </div>
      <div id="video-call-main" class="video-call-main"> </div>
      <div class="video-call-controls"> <button id="user-speak-btn" class="control-btn speak-btn"></button> <button id="hang-up-btn" class="control-btn hangup-btn"></button> <button id="regenerate-call-btn" class="control-btn regenerate-btn"></button> <button id="join-call-btn"
          class="control-btn join-btn" style="display: none;"></button> </div>
    </div>
    
    <!-- è¯­éŸ³é€šè¯ç•Œé¢ -->
    <div id="voice-call-screen" class="screen">
      <div class="voice-call-top-bar">
        <button id="minimize-voice-call-btn" title="æœ€å°åŒ–">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round">
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
        </button>
        <span id="voice-call-timer">00:00</span> 
      </div>

      <div class="voice-call-avatar-area">
        <div id="voice-participant-avatars-grid"> </div>
      </div>
      <div id="voice-call-main" class="voice-call-main"> </div>
      <div class="voice-call-controls"> 
        <button id="voice-user-speak-btn" class="control-btn speak-btn"></button> 
        <button id="voice-hang-up-btn" class="control-btn hangup-btn"></button> 
        <button id="voice-regenerate-call-btn" class="control-btn regenerate-btn"></button> 
        <button id="voice-join-call-btn" class="control-btn join-btn" style="display: none;"></button> 
      </div>
    </div>
    <div id="outgoing-call-screen" class="screen">
      <div class="outgoing-call-content"> <img id="outgoing-call-avatar" class="caller-avatar" src="">
        <div id="outgoing-call-name" class="caller-name"></div>
        <div class="caller-text">æ­£åœ¨å‘¼å«...</div>
        <div class="outgoing-call-actions"> <button id="cancel-call-btn" class="call-action-btn decline"></button> <span data-lang-key="cancel">å–æ¶ˆ</span> </div>
      </div>
    </div>
    <div id="call-history-screen" class="screen">
      <div class="header"> <span class="back-btn" id="call-history-back-btn">â€¹</span> <span id="call-history-title">é€šè¯è®°å½•</span> <span style="width: 30px;"></span> </div>
      <div id="call-history-list" class="list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
    </div>
    <div id="douban-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">â€¹</span> <span>è±†ç“£å°ç»„</span>
        <div class="header-actions"> <span class="action-btn" id="douban-settings-btn" title="è±†ç“£è®¾ç½®"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path
                d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.44,0.17-0.48,0.41L9.12,4.84c-0.59,0.24-1.12,0.56-1.62,0.94L5.11,4.82c-0.22-0.08-0.47,0-0.59,0.22l-1.92,3.32 c-0.12,0.22-0.07,0.47,0.12,0.61l2.03,1.58C4.84,11.36,4.82,11.68,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.48,2.03 c0.04,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.48-0.41l0.48-2.03c0.59-0.24,1.12-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z">
              </path>
            </svg> </span> <span class="action-btn" id="douban-cast-select-btn" title="é€‰æ‹©å‚ä¸è§’è‰²"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg> </span> <span class="action-btn" id="regenerate-douban-btn" title="é‡æ–°ç”Ÿæˆå†…å®¹"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
              <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
            </svg> </span> </div>
      </div>
      <div id="douban-posts-list" class="list-container"> </div>
    </div>
    <div id="douban-post-detail-screen" class="screen">
      <div class="header"> <span class="back-btn" id="douban-detail-back-btn">â€¹</span> <span id="douban-post-detail-title">å¸–å­è¯¦æƒ…</span> <span style="width: 30px;"></span> </div>
      <div id="douban-detail-content-wrapper" class="list-container">
        <div id="douban-post-detail-body">
          <div class="douban-post-header"> <img id="douban-detail-avatar" class="douban-post-avatar">
            <div class="douban-author-info">
              <div id="douban-detail-author" class="douban-author-name"></div>
              <div id="douban-detail-group" class="douban-group-name"></div>
            </div>
          </div>
          <h2 id="douban-detail-post-title" class="douban-post-title"></h2>
          <div id="douban-detail-content" class="douban-detail-content"></div>
        </div>
        <div class="douban-comments-section">
          <h4>å›åº”</h4>
          <div id="douban-detail-comments-list"></div>
        </div>
      </div>
      <div id="douban-comment-footer" class="post-footer">
        <div class="comment-section"> <img id="douban-my-comment-avatar" src="" class="comment-avatar"> <input type="text" id="douban-comment-input" class="comment-input" placeholder="å†™å›åº”..."> </div> <button id="douban-wait-reply-btn" class="douban-feather-btn" title="è®©AIç»§ç»­è®¨è®º"> <svg
            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path>
            <line x1="16" y1="8" x2="2" y2="22"></line>
            <line x1="17.5" y1="15" x2="9" y2="15"></line>
          </svg> </button> <button id="douban-send-comment-btn" class="comment-send-btn">å‘é€</button>
      </div>
    </div>
    <div id="werewolf-game-screen" class="screen">
      <div class="header"> <span id="werewolf-game-title">ç‹¼äººæ€</span>
        <div class="header-actions"><span class="action-btn" id="werewolf-retry-btn" title="é‡è¯•ä¸Šä¸€æ­¥AIæ“ä½œ" style="display: none;"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
              <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
            </svg></span> <span class="action-btn" id="exit-werewolf-game-btn">é€€å‡º</span> </div>
      </div>
      <div id="werewolf-player-grid"></div>
      <div id="werewolf-log" class="list-container"></div>
      <div id="werewolf-action-bar">
        <div id="chat-input-main-row" style="width: 100%;"> <textarea id="werewolf-user-input" rows="1" placeholder="è½®åˆ°ä½ å‘è¨€äº†..."></textarea>
          <div id="input-actions-wrapper" style="gap: 5px;"> <button id="werewolf-wait-reply-btn" class="action-button" style="display: none; background-color: #007bff; height: 40px; padding: 0 10px; font-size: 13px;">ç­‰å¾…å›åº”</button> <button id="werewolf-finish-speech-btn" class="action-button"
              style="display: none; background-color: var(--accent-color); height: 40px; padding: 0 10px; font-size: 13px;">ç»“æŸå‘è¨€</button> <button id="werewolf-next-step-btn" class="form-button" style="margin-top:0; display: none;">ä¸‹ä¸€æ­¥</button> </div>
        </div>
      </div>
    </div>
    <div id="long-term-memory-screen" class="screen">
      <div class="header"> <span class="back-btn" id="memory-screen-back-btn">â€¹</span> <span data-lang-key="chatHeaderLongTermMemory">é•¿æœŸè®°å¿†</span>
        <div class="header-actions"> 
            <!-- ç²¾ç‚¼æŒ‰é’® (æ›¿æ¢ä¸º æ¼æ–—/è¿‡æ»¤ å›¾æ ‡) -->
            <span class="action-btn" id="refine-memory-btn-header" title="ç²¾ç‚¼ (æ•´åˆæ—§è®°å¿†)"> 
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                </svg>
            </span> 
            
            <!-- æ€»ç»“æŒ‰é’® (æ›¿æ¢ä¸º æ–‡æ¡£/åˆ—è¡¨ å›¾æ ‡) -->
            <span class="action-btn" id="summarize-recent-btn-header" title="æ€»ç»“ (æœ€è¿‘å¯¹è¯)"> 
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
            </span> 
            
            <!-- æ·»åŠ æŒ‰é’® (ç»Ÿä¸€æ›¿æ¢ä¸º SVG åŠ å·) -->
            <span class="action-btn" id="add-manual-memory-btn-header" title="æ‰‹åŠ¨æ·»åŠ ">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
            </span> 
        </div>
      </div>
      <div class="list-container" id="memory-list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px; background-color: #f0f2f5;">
        <!-- Tab åˆ‡æ¢æ ï¼ˆä»…åœ¨ç»“æ„åŒ–è®°å¿†å¼€å¯æ—¶æ˜¾ç¤ºï¼‰ -->
        <div id="memory-tab-bar" class="sm-tab-bar" style="display: none;">
          <button class="sm-tab active" data-tab="original" id="memory-tab-original">åŸå§‹è®°å¿†</button>
          <button class="sm-tab" data-tab="structured" id="memory-tab-structured">ç»“æ„åŒ–è¡¨æ ¼</button>
        </div>
        <!-- åŸå§‹è®°å¿†åˆ—è¡¨ -->
        <div id="original-memory-list"></div>
        <!-- ç»“æ„åŒ–è®°å¿†è¡¨æ ¼ -->
        <div id="structured-memory-container" style="display: none;"></div>
      </div>
    </div>
    
    <div id="chat-settings-screen" class="screen">
      <div class="header"> 
          <span class="back-btn" onclick="showScreen('chat-interface-screen')">â€¹</span> 
          <span>èŠå¤©è¯¦æƒ…</span> 
          <span class="save-btn" id="save-chat-settings-btn" data-lang-key="save">å®Œæˆ</span> 
      </div>
      
      <div class="settings-container">
        
        <!-- ç¬¬ä¸€ç»„ï¼šåŸºç¡€ä¿¡æ¯ -->
        <div class="settings-section">
            <div class="settings-item" id="chat-name-group">
                <label>å¤‡æ³¨å / ç¾¤å</label>
                <div class="settings-right">
                    <input type="text" id="chat-name-input" placeholder="æœªè®¾ç½®">
                </div>
            </div>
            
            <div class="settings-item" id="ai-original-name-group">
                <label>å¯¹æ–¹æœ¬å (AIè¯†åˆ«ç”¨)</label>
                <div class="settings-right">
                    <input type="text" id="ai-original-name-input" placeholder="å¿…å¡«">
                </div>
            </div>

            <div class="settings-item" id="my-nickname-group">
                <label>æˆ‘çš„æ˜µç§°</label>
                <div class="settings-right">
                    <input type="text" id="my-nickname-input" placeholder="æˆ‘">
                </div>
            </div>

            <div class="settings-item" id="character-country-group">
                <label>è§’è‰²å›½ç± (å½±å“è½¬è´¦è´§å¸)</label>
                <div class="settings-right">
                    <select id="character-country-select" class="settings-select">
                        <option value="China">ä¸­å›½ (Â¥ äººæ°‘å¸)</option>
                        <option value="USA">ç¾å›½ ($ ç¾å…ƒ)</option>
                        <option value="Japan">æ—¥æœ¬ (Â¥ æ—¥å…ƒ)</option>
                        <option value="UK">è‹±å›½ (Â£ è‹±é•‘)</option>
                        <option value="Europe">æ¬§æ´² (â‚¬ æ¬§å…ƒ)</option>
                        <option value="Austria">å¥¥åœ°åˆ© (â‚¬ æ¬§å…ƒ)</option>
                        <option value="Korea">éŸ©å›½ (â‚© éŸ©å…ƒ)</option>
                        <option value="Russia">ä¿„ç½—æ–¯ (â‚½ å¢å¸ƒ)</option>
                        <option value="India">å°åº¦ (â‚¹ å¢æ¯”)</option>
                        <option value="Canada">åŠ æ‹¿å¤§ (C$ åŠ å…ƒ)</option>
                        <option value="Australia">æ¾³å¤§åˆ©äºš (A$ æ¾³å…ƒ)</option>
                        <option value="Singapore">æ–°åŠ å¡ (S$ æ–°åŠ å¡å…ƒ)</option>
                        <option value="Thailand">æ³°å›½ (à¸¿ æ³°é“¢)</option>
                        <option value="Vietnam">è¶Šå— (â‚« è¶Šå—ç›¾)</option>
                        <option value="None">æ— å›½ç± (Â¥ äººæ°‘å¸)</option>
                    </select>
                </div>
            </div>

            <div class="settings-item" id="my-group-nickname-group">
                <label>æˆ‘çš„ç¾¤æ˜µç§°</label>
                <div class="settings-right">
                    <input type="text" id="my-group-nickname-input">
                </div>
            </div>
            
            <!-- å¤´åƒç›¸å…³ -->
            <div class="settings-item" id="ai-avatar-group">
                 <label>å¯¹æ–¹å¤´åƒ</label>
                 <div class="settings-right full-width">
                    <div class="avatar-action-wrapper">
                         <!-- å¤´åƒåœ¨å·¦ -->
                         <img id="ai-avatar-preview" class="settings-avatar">
                         <!-- æŒ‰é’®ç»„åœ¨å³ -->
                         <div class="avatar-btn-group">
                             <button class="settings-mini-btn" onclick="document.getElementById('ai-avatar-input').click()">æ›´æ¢</button>
                             <button class="settings-mini-btn" id="manage-ai-avatar-library-btn">å›¾åº“</button>
                             <button class="settings-mini-btn change-frame-btn" data-type="ai">æŒ‚ä»¶</button>
                             <input type="file" id="ai-avatar-input" accept="image/*" hidden>
                         </div>
                    </div>
                 </div>
            </div>

            <div class="settings-item" id="group-avatar-group">
                 <label>ç¾¤å¤´åƒ</label>
                 <div class="settings-right full-width">
                    <div class="avatar-action-wrapper">
                         <img id="group-avatar-preview" class="settings-avatar">
                         <div class="avatar-btn-group">
                             <button class="settings-mini-btn" onclick="document.getElementById('group-avatar-input').click()">æ›´æ¢</button>
                             <button class="settings-mini-btn" id="manage-group-avatar-library-btn">å›¾åº“</button>
                             <input type="file" id="group-avatar-input" accept="image/*" hidden>
                         </div>
                    </div>
                 </div>
            </div>

            <div class="settings-item" id="my-avatar-group">
                 <label>æˆ‘çš„å¤´åƒ</label>
                 <div class="settings-right full-width">
                    <div class="avatar-action-wrapper">
                         <img id="my-avatar-preview" class="settings-avatar">
                         <div class="avatar-btn-group">
                             <button class="settings-mini-btn" onclick="document.getElementById('my-avatar-input').click()">æ›´æ¢</button>
                             <button class="settings-mini-btn" id="manage-my-avatar-library-btn">å›¾åº“</button>
                             <button class="settings-mini-btn change-frame-btn" data-type="my">æŒ‚ä»¶</button>
                             <button class="settings-mini-btn" id="open-persona-library-btn">é¢„è®¾</button>
                             <input type="file" id="my-avatar-input" accept="image/*" hidden>
                         </div>
                    </div>
                 </div>
            </div>
            
            <div class="settings-item" id="assign-group-section" style="display: none;"> 
                <label>å¥½å‹åˆ†ç»„</label>
                <div class="settings-right"> 
                    <select id="assign-group-select" class="settings-select"></select> 
                    <button id="manage-groups-btn" class="settings-icon-btn">âš™ï¸</button> 
                </div>
            </div>
        </div>

        <!-- ç¬¬äºŒç»„ï¼šäººè®¾ä¸å‰§æƒ… (æ ¸å¿ƒ) -->
        <div class="settings-section">
            <div class="settings-item-block" id="ai-persona-group">
                <label>å¯¹æ–¹äººè®¾ (AI Persona)</label>
                <textarea id="ai-persona" rows="3" class="settings-textarea" placeholder="è¾“å…¥è¯¦ç»†çš„è§’è‰²è®¾å®š..."></textarea>
            </div>
            
            <div class="settings-item-block" id="my-persona-group">
                <label>æˆ‘çš„äººè®¾ (My Persona)</label>
                <textarea id="my-persona" rows="3" class="settings-textarea" placeholder="è¾“å…¥ä½ çš„è§’è‰²è®¾å®š..."></textarea>
            </div>
            
            <div class="settings-item-block" id="group-members-group">
                <label>ç¾¤æˆå‘˜ç®¡ç†</label>
                <div id="group-members-settings" class="horizontal-scroll-list"></div> 
                <button id="manage-members-btn" class="settings-full-btn">ç®¡ç†æ‰€æœ‰ç¾¤æˆå‘˜</button>
            </div>
            
            <div class="settings-item" id="switch-greeting-group" style="display: none;">
                 <label>å¼€åœºç™½</label>
                 <div class="settings-right">
                     <!-- å‡çº§ä¸ºå®ä½“æŒ‰é’®æ ·å¼ -->
                     <button id="switch-greeting-btn" class="settings-mini-btn">åˆ‡æ¢å¼€åœºæ•…äº‹</button>
                 </div>
            </div>
            
            <div class="settings-item-block" id="world-book-link-group"> 
                <label>å…³è”ä¸–ç•Œä¹¦</label>
                <div class="custom-multiselect" style="margin-top: 5px; position: relative;">
                    <div class="select-box"> <span class="selected-options-text">-- ç‚¹å‡»é€‰æ‹© --</span> <span class="arrow-down">â–¼</span> </div>
                    <div id="world-book-checkboxes-container" class="checkboxes-container"> </div>
                </div>
            </div>
        </div>

        <!-- ç¬¬ä¸‰ç»„ï¼šæ¨¡å‹ä¸æ™ºèƒ½è®¾ç½® -->
        <div class="settings-section">
            <!-- å•èŠç‹¬ç«‹åå° -->
            <div id="single-char-background-activity-group">
                
                <!-- æ³¨å…¥æœ€æ–°å¿ƒå£° -->
                <div class="settings-item" id="inject-thought-group" style="display: flex !important; justify-content: space-between !important; align-items: center !important; flex-direction: row !important;">
                    <div style="flex: 1; padding-right: 10px; display: flex; flex-direction: column; align-items: flex-start;">
                        <label style="margin-bottom: 2px;">æ³¨å…¥æœ€æ–°å¿ƒå£°</label>
                        <div class="settings-desc">å›å¤å‰æ³¨å…¥ä¸Šä¸€è½®çš„å†…å¿ƒç‹¬ç™½</div>
                    </div>
                    <label class="toggle-switch" style="margin: 0;"> 
                        <input type="checkbox" id="inject-thought-toggle"> 
                        <span class="slider"></span> 
                    </label>
                </div>
                
                <!-- å¯ç”¨ç‹¬ç«‹åå°æ´»åŠ¨ -->
                <div class="settings-item" style="display: flex !important; justify-content: space-between !important; align-items: center !important; flex-direction: row !important;">
                     <div style="flex: 1; padding-right: 10px; display: flex; flex-direction: column; align-items: flex-start;">
                        <label style="margin-bottom: 2px;">å¯ç”¨ç‹¬ç«‹åå°æ´»åŠ¨</label>
                        <div class="settings-desc">å…è®¸è§’è‰²åœ¨åå°ä¸»åŠ¨å‘æ¶ˆæ¯</div>
                    </div>
                    <label class="toggle-switch" style="margin: 0;"> 
                        <input type="checkbox" id="char-background-activity-switch"> 
                        <span class="slider"></span> 
                    </label>
                </div>

                <!-- å…è®¸è§’è‰²æ¸…ç©ºè´­ç‰©è½¦ -->
                <div class="settings-item" style="display: flex !important; justify-content: space-between !important; align-items: center !important; flex-direction: row !important;">
                     <div style="flex: 1; padding-right: 10px; display: flex; flex-direction: column; align-items: flex-start;">
                        <label style="margin-bottom: 2px;">å…è®¸è‡ªåŠ¨æ¸…ç©ºè´­ç‰©è½¦</label>
                        <div class="settings-desc">è§’è‰²å¯ç”¨è‡ªå·±çš„ä½™é¢å¸®ä½ æ¸…ç©ºè´­ç‰©è½¦</div>
                    </div>
                    <label class="toggle-switch" style="margin: 0;"> 
                        <input type="checkbox" id="char-auto-cart-clear-switch"> 
                        <span class="slider"></span> 
                    </label>
                </div>

            </div>

            <!-- ç¾¤èŠåå° -->
            <div class="settings-item" id="group-background-activity-group">
                 <div>
                    <label>å¯ç”¨ç¾¤å†…åå°æ´»åŠ¨</label>
                    <div class="settings-desc">å…è®¸AIåœ¨ç¾¤å†…è‡ªç”±äº’åŠ¨</div>
                </div>
                <label class="toggle-switch"> <input type="checkbox" id="group-background-activity-switch"> <span class="slider"></span> </label>
            </div>

            <!-- å†·å´æ—¶é—´ -->
            <div class="settings-item" id="ai-cooldown-group">
                <label>ç‹¬ç«‹è¡ŒåŠ¨å†·å´ (åˆ†é’Ÿ)</label>
                <div class="settings-right">
                     <input type="number" id="ai-action-cooldown-input" class="settings-num-input">
                </div>
            </div>
            <div class="settings-item" id="group-cooldown-group">
                <label>ç¾¤èŠè¡ŒåŠ¨å†·å´ (åˆ†é’Ÿ)</label>
                <div class="settings-right">
                     <input type="number" id="group-action-cooldown-input" class="settings-num-input">
                </div>
            </div>

            <!-- è®°å¿†è®¾ç½® -->
            <div class="settings-item">
                 <label>çŸ­æœŸè®°å¿†æ¡æ•°</label>
                 <div class="settings-right">
                    <input type="number" id="max-memory" class="settings-num-input">
                 </div>
            </div>
            <div class="settings-item">
                 <label>æŒ‚è½½è®°å¿†æ¡æ•°</label>
                 <div class="settings-right">
                    <input type="number" id="linked-memory-count" class="settings-num-input">
                 </div>
            </div>
            
            <div class="settings-item">
                 <div>
                    <label>è‡ªåŠ¨æ€»ç»“é•¿æœŸè®°å¿†</label>
                    <div class="settings-desc">å¯¹è¯è¾¾åˆ°ä¸€å®šé•¿åº¦è‡ªåŠ¨æç‚¼</div>
                </div>
                <label class="toggle-switch"> <input type="checkbox" id="auto-memory-toggle"> <span class="slider"></span> </label>
            </div>
            <div class="settings-item">
                 <label>è‡ªåŠ¨æ€»ç»“é—´éš” (æ¡)</label>
                 <div class="settings-right">
                    <input type="number" id="auto-memory-interval" class="settings-num-input">
                 </div>
            </div>
            
            <!-- æ—¥è®°æ¨¡å¼å¼€å…³ -->
            <div class="settings-item">
                <div>
                    <label>æ—¥è®°æ¨¡å¼</label>
                    <div class="settings-desc">å¼€å¯åæ‰‹åŠ¨æ€»ç»“å°†è‡ªåŠ¨æ€»ç»“ä¸Šæ¬¡æ€»ç»“ä¹‹åçš„æ‰€æœ‰æ¶ˆæ¯ï¼Œé€‚åˆæ¯å¤©å†™æ—¥è®°</div>
                </div>
                <label class="toggle-switch"> <input type="checkbox" id="diary-mode-toggle"> <span class="slider"></span> </label>
            </div>

            <!-- æ‰‹åŠ¨æ€»ç»“æŒ‰é’® -->
            <div class="settings-item">
                 <button id="manual-summary-btn" style="width: 100%; padding: 10px; background: var(--accent-color); color: white; border: none; border-radius: 8px; font-size: 14px; cursor: pointer;">
                    æ‰‹åŠ¨æ€»ç»“
                 </button>
            </div>

            <!-- ç»“æ„åŒ–åŠ¨æ€è®°å¿†å¼€å…³ -->
            <div class="settings-item">
                <div>
                    <label>ç»“æ„åŒ–åŠ¨æ€è®°å¿†ï¼ˆæµ‹è¯•ï¼‰</label>
                    <div class="settings-desc">ç”¨å‹ç¼©è¡¨æ ¼æ ¼å¼å­˜å‚¨è®°å¿†ï¼Œå¤§å¹…é™ä½tokenå ç”¨</div>
                </div>
                <label class="toggle-switch"> <input type="checkbox" id="structured-memory-toggle"> <span class="slider"></span> </label>
            </div>

            <!-- æŒ‚è½½èŠå¤© -->
            <div class="settings-item-block" id="linked-memory-group"> 
                 <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; height: 30px;">
                    <label for="link-memory-toggle" style="line-height: 30px;">æŒ‚è½½å…¶ä»–èŠå¤©è®°å¿†</label> 
                    <!-- ä¿®å¤ï¼šä½¿ç”¨ç¾åŒ–çš„ toggle-switch ç»“æ„æ›¿ä»£åŸç”Ÿ checkbox -->
                    <label class="toggle-switch"> 
                        <input type="checkbox" id="link-memory-toggle"> 
                        <span class="slider"></span> 
                    </label>
                 </div>
                 <div id="linked-memory-selection" style="display: none; position: relative;"> 
                    <div class="custom-multiselect">
                      <div class="select-box"> <span class="selected-options-text">-- é€‰æ‹©èŠå¤© --</span> <span class="arrow-down">â–¼</span> </div>
                      <div id="linked-chats-checkboxes-container" class="checkboxes-container" style="max-height: 150px;"> </div>
                    </div>
                 </div>
            </div>
            <div class="settings-item">
    <div>
       <label>æ˜¾ç¤ºéšè—å±‚æ¶ˆæ¯ (è°ƒè¯•)</label>
       <div class="settings-desc">æ˜¾ç¤ºç³»ç»Ÿæç¤ºã€å†…å¿ƒç‹¬ç™½ç­‰éšè—å†…å®¹ä»¥ä¾¿ç¼–è¾‘</div>
   </div>
   <label class="toggle-switch"> 
       <input type="checkbox" id="show-hidden-msg-toggle"> 
       <span class="slider"></span> 
   </label>
</div>

            <!-- è§’è‰²çŸ¥æ™“çª¥å±å¼€å…³ -->
            <div class="settings-item" id="phone-viewing-awareness-group" style="display: none;">
    <div>
       <label>è§’è‰²çŸ¥æ™“æ‰‹æœºçª¥å±</label>
       <div class="settings-desc">æ‰“å¼€åï¼ŒæŸ¥çœ‹è§’è‰²æ‰‹æœºçš„è¡Œä¸ºä¼šä½œä¸ºç³»ç»Ÿæ¶ˆæ¯è®°å½•åˆ°èŠå¤©ä¸­</div>
   </div>
   <label class="toggle-switch"> 
       <input type="checkbox" id="phone-viewing-awareness-toggle"> 
       <span class="slider"></span> 
   </label>
</div>

            <!-- Token ç»Ÿè®¡ -->
            <div class="settings-section">
                <div class="settings-item">
                    <label>å½“å‰å¯¹è¯æ¡æ•°</label>
                    <div class="settings-right">
                        <span id="message-count-value" style="color: #8a8a8a;">è®¡ç®—ä¸­...</span>
                    </div>
                </div>
                <div class="settings-item" id="token-detail-trigger" style="cursor: pointer;">
                    <label style="cursor: pointer;">é¢„ä¼°ä¸Šä¸‹æ–‡ Token</label>
                    <div class="settings-right" style="display: flex; align-items: center; gap: 4px;">
                        <span id="token-count-value" style="color: #8a8a8a;">è®¡ç®—ä¸­...</span>
                        <span style="font-size: 12px; color: #ccc;">â–¶</span>
                    </div>
                </div>
                <div class="settings-item">
                    <label>å·²æ’é™¤æ¶ˆæ¯æ•°</label>
                    <div class="settings-right">
                        <span id="excluded-count-value" style="color: var(--accent-color);">è®¡ç®—ä¸­...</span>
                    </div>
                </div>
                <div class="settings-item" style="justify-content: center;">
                    <button id="batch-exclude-manage-btn" style="width: 100%; padding: 10px; background: var(--accent-color); color: white; border: none; border-radius: 8px; font-size: 14px; cursor: pointer;">
                        æ‰¹é‡ç®¡ç†æ’é™¤æ¶ˆæ¯ (çœToken)
                    </button>
                </div>
                <div class="settings-item" style="justify-content: center;">
                    <button id="view-excluded-detail-btn" style="width: 100%; padding: 10px; background: var(--secondary-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px; cursor: pointer;">
                        æŸ¥çœ‹æ’é™¤è¯¦æƒ…
                    </button>
                </div>
            </div>
            
            <!-- AIè¡Œä¸ºæ§åˆ¶ (è§’è‰²å•ç‹¬è®¾ç½®) -->
            <div class="settings-item" id="ai-behavior-thoughts-item">
                <div>
                    <div style="font-weight: 500;">å¯ç”¨å¿ƒå£°åŠŸèƒ½</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">AIä¼šåœ¨æ¯æ¬¡å›å¤åç”Ÿæˆå†…å¿ƒç‹¬ç™½</div>
                </div>
                <select id="chat-enable-thoughts-select" style="padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--secondary-bg);">
                    <option value="null">ä½¿ç”¨å…¨å±€è®¾ç½®</option>
                    <option value="true">å¼€å¯</option>
                    <option value="false">å…³é—­</option>
                </select>
            </div>
            
            <div class="settings-item" id="ai-behavior-qzone-item">
                <div>
                    <div style="font-weight: 500;">å¯ç”¨åŠ¨æ€åŠŸèƒ½</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">AIå¯ä»¥ä¸»åŠ¨å‘åŠ¨æ€ã€è¯„è®ºã€ç‚¹èµ</div>
                </div>
                <select id="chat-enable-qzone-actions-select" style="padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--secondary-bg);">
                    <option value="null">ä½¿ç”¨å…¨å±€è®¾ç½®</option>
                    <option value="true">å¼€å¯</option>
                    <option value="false">å…³é—­</option>
                </select>
            </div>
            
            <div class="settings-item" id="ai-behavior-view-myphone-item">
                <div>
                    <div style="font-weight: 500;">æŸ¥çœ‹Useræ‰‹æœº</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">AIå¯ä»¥ä¸»åŠ¨æŸ¥çœ‹ä½ çš„æ‰‹æœºAPPï¼Œå¹¶ç»™å‡ºæ„Ÿæƒ³</div>
                </div>
                <select id="chat-enable-view-myphone-select" style="padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--secondary-bg);">
                    <option value="null">ä½¿ç”¨å…¨å±€è®¾ç½®</option>
                    <option value="true">å¼€å¯</option>
                    <option value="false">å…³é—­</option>
                </select>
            </div>
            
            <div class="settings-item" id="ai-behavior-status-item">
                <div style="font-size: 12px; color: #666; padding: 10px; background: #f5f5f5; border-radius: 6px; width: 100%;">
                    ğŸ’¡ å½“å‰å…¨å±€è®¾ç½®ï¼šå¿ƒå£°åŠŸèƒ½ <span id="global-thoughts-status">å…³é—­</span>ï¼ŒåŠ¨æ€åŠŸèƒ½ <span id="global-qzone-status">å…³é—­</span>ï¼ŒæŸ¥çœ‹æ‰‹æœº <span id="global-view-myphone-status">å…³é—­</span>
                </div>
            </div>
        </div>

<!-- å¤©æ°”è®¾ç½® (ä»…å•èŠæ˜¾ç¤º) - UI ä¼˜åŒ–ç‰ˆ -->
<div class="settings-section" id="weather-settings-section" style="display: none;">
    <!-- å¼€å…³è¡Œ -->
    <div class="settings-item">
        <label>å¯ç”¨å®æ—¶å¤©æ°”åŒæ­¥</label>
        <label class="toggle-switch">
            <input type="checkbox" id="enable-weather-switch">
            <span class="slider"></span>
        </label>
    </div>
    
    <!-- è¯¦æƒ…é…ç½®åŒºåŸŸ (ç”±JSæ§åˆ¶æ˜¾ç¤º/éšè—) -->
    <div id="weather-config-container" style="display: none;">
        
        <!-- æˆ‘çš„ä½ç½® -->
        <div class="settings-item-block">
            <label style="font-weight: 500;">æˆ‘çš„ä½ç½® (User)</label>
            <div class="weather-input-group">
                <input type="text" id="user-virtual-city" placeholder="è™šæ‹Ÿå (å¦‚: é¾™åŸ)" class="weather-input">
                <input type="text" id="user-real-city-search" placeholder="çœŸå®åŸå¸‚ (æ‹¼éŸ³/è‹±æ–‡)" class="weather-input">
                <button id="user-city-search-btn" class="settings-mini-btn" style="margin-left: 0;">æœç´¢</button>
            </div>
            <!-- éšè—åŸŸ -->
            <input type="hidden" id="user-city-lat">
            <input type="hidden" id="user-city-lon">
            <!-- ç»“æœå±•ç¤º -->
            <div id="user-city-result" class="weather-result-text">æœªè®¾ç½®æ˜ å°„</div>
        </div>

        <!-- å¯¹æ–¹ä½ç½® -->
        <div class="settings-item-block" style="border-bottom: none;">
            <label style="font-weight: 500;">å¯¹æ–¹ä½ç½® (Char)</label>
            <div class="weather-input-group">
                <input type="text" id="char-virtual-city" placeholder="è™šæ‹Ÿå (å¦‚: å“¥è°­)" class="weather-input">
                <input type="text" id="char-real-city-search" placeholder="çœŸå®åŸå¸‚ (æ‹¼éŸ³/è‹±æ–‡)" class="weather-input">
                <button id="char-city-search-btn" class="settings-mini-btn" style="margin-left: 0;">æœç´¢</button>
            </div>
            <!-- éšè—åŸŸ -->
            <input type="hidden" id="char-city-lat">
            <input type="hidden" id="char-city-lon">
            <!-- ç»“æœå±•ç¤º -->
            <div id="char-city-result" class="weather-result-text">æœªè®¾ç½®æ˜ å°„</div>
        </div>

    </div>
</div>

        <!-- è§†é¢‘é€šè¯ä¼˜åŒ–è®¾ç½® -->
        <div class="settings-section" id="video-call-optimization-section">
            <!-- å¼€å…³è¡Œ -->
            <div class="settings-item">
                <label>è§†é¢‘é€šè¯ä¼˜åŒ–</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="enable-video-optimization-switch">
                    <span class="slider"></span>
                </label>
            </div>
            
            <!-- è¯¦æƒ…é…ç½®åŒºåŸŸ (ç”±JSæ§åˆ¶æ˜¾ç¤º/éšè—) -->
            <div id="video-optimization-config-container" style="display: none;">
                
                <!-- å¯¹æ–¹è§†é¢‘å›¾ç‰‡ -->
                <div class="settings-item-block">
                    <label style="font-weight: 500;">å¯¹æ–¹è§†é¢‘ç”»é¢</label>
                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 8px;">
                        <img id="remote-video-preview" src="" 
                             style="width: 80px; height: 80px; border-radius: 8px; object-fit: cover; border: 2px solid #ddd; display: none;">
                        <div id="remote-video-placeholder" style="width: 80px; height: 80px; border-radius: 8px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #999;">æœªè®¾ç½®</div>
                    </div>
                    <div style="display: flex; gap: 8px; margin-top: 10px;">
                        <button class="settings-mini-btn" onclick="document.getElementById('remote-video-input').click()">æœ¬åœ°ä¸Šä¼ </button>
                        <button class="settings-mini-btn" id="remote-video-url-btn">URLä¸Šä¼ </button>
                        <button class="settings-mini-btn" id="remote-video-reset-btn" style="background: #ff3b30; color: white;">é‡ç½®</button>
                        <input type="file" id="remote-video-input" accept="image/*" hidden>
                    </div>
                    <input type="text" id="remote-video-url-input" placeholder="æˆ–è¾“å…¥å›¾ç‰‡URL" 
                           style="width: 100%; padding: 8px; margin-top: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px;">
                </div>

                <!-- æˆ‘æ–¹è§†é¢‘å›¾ç‰‡ -->
                <div class="settings-item-block" style="border-bottom: none;">
                    <label style="font-weight: 500;">æˆ‘æ–¹è§†é¢‘ç”»é¢</label>
                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 8px;">
                        <img id="local-video-preview" src="" 
                             style="width: 80px; height: 80px; border-radius: 8px; object-fit: cover; border: 2px solid #ddd; display: none;">
                        <div id="local-video-placeholder" style="width: 80px; height: 80px; border-radius: 8px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #999;">æœªè®¾ç½®</div>
                    </div>
                    <div style="display: flex; gap: 8px; margin-top: 10px;">
                        <button class="settings-mini-btn" onclick="document.getElementById('local-video-input').click()">æœ¬åœ°ä¸Šä¼ </button>
                        <button class="settings-mini-btn" id="local-video-url-btn">URLä¸Šä¼ </button>
                        <button class="settings-mini-btn" id="local-video-reset-btn" style="background: #ff3b30; color: white;">é‡ç½®</button>
                        <input type="file" id="local-video-input" accept="image/*" hidden>
                    </div>
                    <input type="text" id="local-video-url-input" placeholder="æˆ–è¾“å…¥å›¾ç‰‡URL" 
                           style="width: 100%; padding: 8px; margin-top: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px;">
                </div>

                <!-- çœŸå®æ‘„åƒå¤´è®¾ç½® -->
                <div class="settings-item-block" style="border-bottom: none; padding-top: 15px; border-top: 1px solid #e0e0e0; margin-top: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <label style="font-weight: 500;">ä½¿ç”¨çœŸå®æ‘„åƒå¤´</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="enable-real-camera-switch">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        å¯ç”¨åï¼Œæˆ‘æ–¹ç”»é¢å°†ä½¿ç”¨è®¾å¤‡æ‘„åƒå¤´ï¼ŒAIå¯ä»¥çœŸæ­£"çœ‹åˆ°"ä½ 
                    </div>
                    
                    <!-- æˆªå›¾é—´éš”è®¾ç½® -->
                    <div id="camera-interval-setting" style="display: none;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                            <label style="font-size: 13px; white-space: nowrap;">æˆªå›¾é—´éš”</label>
                            <input type="number" id="camera-capture-interval" 
                                   min="1" max="60" value="5" 
                                   style="width: 60px; padding: 6px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px;">
                            <span style="font-size: 13px; color: #666;">ç§’</span>
                        </div>
                        <div style="font-size: 11px; color: #999; margin-top: 5px;">
                            å®šæ—¶æˆªå–æ‘„åƒå¤´ç”»é¢å‘é€ç»™AIï¼Œé»˜è®¤5ç§’
                        </div>
                        
                        <!-- ä½¿ç”¨åç½®æ‘„åƒå¤´å¼€å…³ -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px;">
                            <label style="font-size: 13px;">ä½¿ç”¨åç½®æ‘„åƒå¤´</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="enable-rear-camera-switch">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div style="font-size: 11px; color: #999; margin-top: 5px;">
                            å¼€å¯åå°†åˆ‡æ¢ä¸ºåç½®æ‘„åƒå¤´ï¼ˆä»…ç§»åŠ¨è®¾å¤‡æœ‰æ•ˆï¼‰
                        </div>

                        <!-- æ‘„åƒå¤´çŠ¶æ€ -->
                        <div id="camera-status" style="margin-top: 10px; padding: 8px; background: #f9f9f9; border-radius: 6px; font-size: 12px; display: none;">
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <span id="camera-status-icon" style="width: 8px; height: 8px; border-radius: 50%; background: #ccc;"></span>
                                <span id="camera-status-text" style="color: #666;">æ‘„åƒå¤´æœªæ¿€æ´»</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ä»…è¯»å–å¯¹è¯å¼€å…³ -->
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <label style="font-weight: 500; font-size: 13px;">ä»…è¯»å–å¯¹è¯å†…å®¹</label>
                            <label class="toggle-switch" style="transform: scale(0.9);">
                                <input type="checkbox" id="tts-dialogue-only-switch">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div style="font-size: 11px; color: #666; line-height: 1.5;">
                            å¯ç”¨åï¼Œè¯­éŸ³æ’­æŠ¥åªè¯»å–å¼•å·å†…çš„å¯¹è¯ï¼Œä¸è¯»å–åŠ¨ä½œæå†™ç­‰æ—ç™½å†…å®¹
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- è®°å¿†åº“åŒºåŸŸ -->
        <div class="settings-section" id="memory-archive-section">
            <div class="settings-item">
                <label style="font-weight: 600; font-size: 16px;">è®°å¿†åº“</label>
            </div>
            
            <div id="memory-archive-container" style="padding: 0 15px;">
                <div style="margin-bottom: 15px; color: var(--text-secondary); font-size: 13px;">
                    ä¿å­˜å½“å‰èŠå¤©çš„æ‰€æœ‰è®°å½•å’Œè®¾ç½®ï¼ˆäººè®¾ã€å¤´åƒã€é•¿æœŸè®°å¿†ã€è¯­éŸ³ã€é¢„è®¾ç­‰ï¼‰ï¼Œæ–¹ä¾¿å¤šè·¯çº¿ç®¡ç†
                </div>
                
                <button id="save-memory-archive-btn" class="form-button" style="margin-bottom: 15px;">
                    ä¿å­˜å½“å‰çŠ¶æ€
                </button>
                
                <div id="memory-archive-list" style="display: flex; flex-direction: column; gap: 10px;">
                    <!-- å­˜æ¡£åˆ—è¡¨å°†åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- APIè°ƒç”¨å†å²åŒºåŸŸ -->
        <div class="settings-section" id="api-history-section">
            <div class="settings-item">
                <label style="font-weight: 600; font-size: 16px;">APIè°ƒç”¨å†å²</label>
            </div>
            
            <div style="padding: 0 15px;">
                <div style="margin-bottom: 15px; color: var(--text-secondary); font-size: 13px;">
                    æŸ¥çœ‹æ¯æ¬¡å‘é€ç»™AIçš„åŸå§‹æç¤ºè¯ã€è°ƒç”¨ä¿¡æ¯å’Œè¿”å›çš„åŸå§‹æ•°æ®
                </div>
                
                <button id="view-api-history-btn" class="form-button" style="margin-bottom: 15px;">
                    æŸ¥çœ‹è¿”å›çš„æç¤ºè¯
                </button>
            </div>
        </div>

        <!-- æ¶ˆæ¯å¯¼èˆªåŒºåŸŸ -->
        <div class="settings-section" id="message-navigation-section">
            <div class="settings-item">
                <label style="font-weight: 600; font-size: 16px;">æ¶ˆæ¯å¯¼èˆª</label>
            </div>
            
            <div style="padding: 0 15px;">
                <div style="margin-bottom: 15px; color: var(--text-secondary); font-size: 13px;">
                    å¿«é€Ÿè·³è½¬åˆ°èŠå¤©è®°å½•çš„å¼€å¤´æˆ–ç»“å°¾ã€‚å½“èŠå¤©è®°å½•è¾ƒå¤šæ—¶ï¼Œå¯èƒ½ä¼šæœ‰è½»å¾®å»¶è¿Ÿã€‚
                </div>
                
                <button id="scroll-to-first-message-btn" class="form-button" style="margin-bottom: 10px;">
                    å›åˆ°ç¬¬ä¸€æ¡æ¶ˆæ¯
                </button>
                
                <button id="scroll-to-last-message-btn" class="form-button" style="margin-bottom: 15px;">
                    å›åˆ°æœ€åä¸€æ¡æ¶ˆæ¯
                </button>
            </div>
        </div>

        <!-- ç¬¬å››ç»„ï¼šé«˜çº§åŠŸèƒ½ (TTS, NAI, çº¿ä¸‹æ¨¡å¼) -->
        <div class="settings-section">
             <!-- æ—¶é—´æˆ³æ˜¾ç¤ºæ ¼å¼ -->
             <div class="settings-item">
                 <div>
                     <div style="font-weight: 500;">æ˜¾ç¤ºç§’æ•°</div>
                     <div style="font-size: 12px; color: var(--text-secondary);">å¼€å¯åï¼Œæ­¤èŠå¤©çš„æ—¶é—´æˆ³å°†æ˜¾ç¤ºä¸º"æ—¶:åˆ†:ç§’"æ ¼å¼ï¼ˆè¦†ç›–å…¨å±€è®¾ç½®ï¼‰</div>
                 </div>
                 <label class="toggle-switch">
                     <input type="checkbox" id="chat-show-seconds-switch">
                     <span class="slider"></span>
                 </label>
             </div>
             
             <!-- è¯­éŸ³ -->
             <div class="settings-item" id="tts-enable-group">
                 <label>å¯ç”¨è¯­éŸ³åˆæˆ (TTS)</label>
                 <label class="toggle-switch"> <input type="checkbox" id="enable-tts-switch"> <span class="slider"></span> </label>
             </div>
             <div class="settings-item" id="ai-voice-id-group">
                 <label>è¯­éŸ³ ID</label>
                 <div class="settings-right">
                    <input type="text" id="ai-voice-id-input" placeholder="minimax voice_id">
                 </div>
             </div>
             <div class="settings-item" id="ai-voice-lang-group">
                <label>è¯­éŸ³è¯­è¨€/æ–¹è¨€</label>
                <div class="settings-right">
                  <select id="ai-voice-lang-select" class="settings-select" style="width: 100%; text-align: right;">
                    <option value=""> è‡ªåŠ¨è¯†åˆ« (Auto)</option>
                    <hr disabled>
                    <option value="zh-CN">ğŸ‡¨ğŸ‡³ å›½è¯­/æ™®é€šè¯ (Chinese)</option>
                    <option value="zh-HK">ğŸ‡­ğŸ‡° ç²¤è¯­/å¹¿ä¸œè¯ (Cantonese)</option>
                    <option value="en-US">ğŸ‡ºğŸ‡¸ è‹±è¯­ (English)</option>
                    <option value="ja-JP">ğŸ‡¯ğŸ‡µ æ—¥è¯­ (Japanese)</option>
                    <option value="ko-KR">ğŸ‡°ğŸ‡· éŸ©è¯­ (Korean)</option>
                    <hr disabled>
                    <option value="de-DE">ğŸ‡©ğŸ‡ª å¾·è¯­ (German)</option>
                    <option value="fr-FR">ğŸ‡«ğŸ‡· æ³•è¯­ (French)</option>
                    <option value="es-ES">ğŸ‡ªğŸ‡¸ è¥¿ç­ç‰™è¯­ (Spanish)</option>
                    <option value="it-IT">ğŸ‡®ğŸ‡¹ æ„å¤§åˆ©è¯­ (Italian)</option>
                    <option value="ru-RU">ğŸ‡·ğŸ‡º ä¿„è¯­ (Russian)</option>
                    <option value="pt-BR">ğŸ‡§ğŸ‡· è‘¡è„ç‰™è¯­ (Portuguese)</option>
                    <option value="nl-NL">ğŸ‡³ğŸ‡± è·å…°è¯­ (Dutch)</option>
                    <option value="pl-PL">ğŸ‡µğŸ‡± æ³¢å…°è¯­ (Polish)</option>
                    <option value="sv-SE">ğŸ‡¸ğŸ‡ª ç‘å…¸è¯­ (Swedish)</option>
                    <hr disabled>
                    <option value="tr-TR">ğŸ‡¹ğŸ‡· åœŸè€³å…¶è¯­ (Turkish)</option>
                    <option value="id-ID">ğŸ‡®ğŸ‡© å°å°¼è¯­ (Indonesian)</option>
                    <option value="ms-MY">ğŸ‡²ğŸ‡¾ é©¬æ¥è¯­ (Malay)</option>
                    <option value="vi-VN">ğŸ‡»ğŸ‡³ è¶Šå—è¯­ (Vietnamese)</option>
                    <option value="th-TH">ğŸ‡¹ğŸ‡­ æ³°è¯­ (Thai)</option>
                    <option value="hi-IN">ğŸ‡®ğŸ‡³ å°åœ°è¯­ (Hindi)</option>
                   <option value="ar-SA">ğŸ‡¸ğŸ‡¦ é˜¿æ‹‰ä¼¯è¯­ (Arabic)</option>
                 </select>
               </div>
            </div>
            <div class="settings-item" id="ai-voice-speed-group">
               <label>è¯­éŸ³é€Ÿåº¦</label>
               <div class="settings-right">
                 <input type="number" id="ai-voice-speed-input" min="0.5" max="2.0" step="0.1" value="1.0" style="width: 80px; text-align: right; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--secondary-bg); color: var(--text-color);">
                 <span style="margin-left: 5px; color: var(--text-secondary); font-size: 12px;">x</span>
               </div>
            </div>
 <div class="settings-item" id="synth-music-group">
    <div>
        <label>å¯ç”¨ä¹è°±åˆæˆ</label>
        <div class="settings-desc">å…è®¸è§’è‰²å‘é€ä¹è°±å¹¶è‡ªåŠ¨æ¼”å¥</div>
    </div>
    <label class="toggle-switch">
        <input type="checkbox" id="enable-synth-music-switch">
        <span class="slider"></span>
    </label>
</div>
<div class="settings-item" id="narrator-mode-group" style="display: flex; justify-content: space-between; align-items: center;">
    <div style="flex: 1; padding-right: 10px;">
        <label style="margin-bottom: 2px;">å¯ç”¨æ—ç™½æ¨¡å¼</label>
        <div class="settings-desc">AIæ¯è½®å›å¤éƒ½ä¼šé™„å¸¦ç¯å¢ƒæˆ–å¿ƒç†æå†™ (ç°è‰²ç³»ç»Ÿå­—)</div>
    </div>
    <label class="toggle-switch" style="margin: 0;"> 
        <input type="checkbox" id="narrator-mode-toggle"> 
        <span class="slider"></span> 
    </label>
</div>
<div class="settings-item" id="todo-list-setting-group">
    <div style="flex: 1; padding-right: 10px;">
        <label style="margin-bottom: 2px;">å¯ç”¨å¾…åŠäº‹é¡¹åŒæ­¥</label>
        <div class="settings-desc">å¼€å¯åï¼ŒAIå°†è¯»å–ã€ä»Šæ—¥ã€‘åŠã€æœªå®Œæˆã€‘çš„å¾…åŠäº‹é¡¹ã€‚</div>
    </div>
    <label class="toggle-switch" style="margin: 0;"> 
        <input type="checkbox" id="enable-todo-list-switch"> 
        <span class="slider"></span> 
    </label>
</div>
             <!-- è¡¨æƒ…åŒ…è¯†å›¾ -->
             <div class="settings-item" id="sticker-vision-group">
                 <div>
                    <label>å¯ç”¨è¡¨æƒ…åŒ…è¯†å›¾</label>
                    <div class="settings-desc">CHARå¯ä»¥çœ‹åˆ°USERè¡¨æƒ…åŒ…çš„å†…å®¹</div>
                 </div>
                 <label class="toggle-switch"> 
                    <input type="checkbox" id="enable-sticker-vision-checkbox"> 
                    <span class="slider"></span> 
                 </label>
             </div>
             
             <!-- çº¿ä¸‹æ¨¡å¼ -->
             <div id="offline-mode-group">
                 <div class="settings-item">
                     <div>
                        <label>çº¿ä¸‹æ¨¡å¼ (æå†™æ¨¡å¼)</label>
                        <div class="settings-desc">AIå°†è¾“å‡ºåŒ…å«åŠ¨ä½œ/å¿ƒç†çš„æå†™æ–‡æœ¬</div>
                     </div>
                     <label class="toggle-switch"> <input type="checkbox" id="offline-mode-toggle"> <span class="slider"></span> </label>
                 </div>
                 <div id="offline-mode-options" style="display: none; padding: 0 16px 16px 16px;">
                     <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                        <span style="font-size:13px; color:#666;">å­—æ•°èŒƒå›´:</span>
                        <input type="number" id="offline-min-length-input" class="settings-num-input" value="100">
                        <span>-</span>
                        <input type="number" id="offline-max-length-input" class="settings-num-input" value="300">
                     </div>
                     <label style="font-size:13px; color:#666;">æ–‡é£é¢„è®¾:</label>
                     <select id="offline-preset-select" class="settings-select" style="width:100%; margin-top:5px;"></select>
                     <div style="display:flex; align-items:center; justify-content:space-between; margin-top:12px;">
                        <div>
                           <span style="font-size:13px; color:#666;">è¿ç»­æ’ç‰ˆæ¨¡å¼</span>
                           <div style="font-size:11px; color:#999; margin-top:2px;">å¯¹è¯ä¸æå†™ä¸åˆ†æ®µï¼Œä¿æŒè‡ªç„¶æ®µè½</div>
                        </div>
                        <label class="toggle-switch"> <input type="checkbox" id="offline-continuous-layout-toggle"> <span class="slider"></span> </label>
                     </div>
                 </div>
             </div>

            <!-- æ—¶é—´æ„ŸçŸ¥ -->
            <div class="settings-item" id="time-perception-group">
                <label>æ—¶é—´æ„ŸçŸ¥</label>
                <label class="toggle-switch"> <input type="checkbox" id="time-perception-toggle"> <span class="slider"></span> </label>
            </div>
            <div class="settings-item-block" id="time-zone-group" style="display: none;">
                <label>æ—¶åŒºè®¾ç½®</label>
                <div style="margin-top: 10px; width: 100%;">
                    <input type="search" id="time-zone-search-input" placeholder="æœç´¢æ—¶åŒº..." class="settings-textarea" style="height: 36px; padding: 8px; margin-bottom: 8px;">
                    <select id="time-zone-select" class="settings-select" style="width: 100%; padding: 10px; background-color: #f5f5f7;"></select>
                </div>
            </div>

            <!-- è‡ªå®šä¹‰æ—¶é—´ -->
            <div class="settings-item" id="custom-time-group">
                <label>è‡ªå®šä¹‰æ—¶é—´</label>
                <label class="toggle-switch"> <input type="checkbox" id="custom-time-toggle"> <span class="slider"></span> </label>
            </div>
            <div class="settings-item-block" id="custom-time-settings-group" style="display: none;">
                <label>æ—¶é—´è®¾ç½®</label>
                <div style="margin-top: 10px; width: 100%;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <div>
                            <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">å¹´ä»½</label>
                            <input type="number" id="custom-year-input" class="settings-num-input" placeholder="2024" min="1900" max="2100" style="width: 100%;">
                        </div>
                        <div>
                            <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">æœˆä»½</label>
                            <input type="number" id="custom-month-input" class="settings-num-input" placeholder="1-12" min="1" max="12" style="width: 100%;">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <div>
                            <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">æ—¥æœŸ</label>
                            <input type="number" id="custom-day-input" class="settings-num-input" placeholder="1-31" min="1" max="31" style="width: 100%;">
                        </div>
                        <div>
                            <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">å°æ—¶</label>
                            <input type="number" id="custom-hour-input" class="settings-num-input" placeholder="0-23" min="0" max="23" style="width: 100%;">
                        </div>
                        <div>
                            <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">åˆ†é’Ÿ</label>
                            <input type="number" id="custom-minute-input" class="settings-num-input" placeholder="0-59" min="0" max="59" style="width: 100%;">
                        </div>
                    </div>
                    <div style="font-size: 12px; color: #999; margin-top: 5px;">
                        å½“å‰è®¾ç½®ï¼š<span id="custom-time-preview" style="color: #007AFF; font-weight: 500;">æœªè®¾ç½®</span>
                    </div>
                </div>
            </div>
             
             <!-- NAIè®¾ç½® (å•èŠ/ç¾¤èŠå¤ç”¨IDï¼ŒJSæ§åˆ¶) -->
             <div class="settings-item-block" id="nai-character-settings-group" style="display: none;">
                <label>NAI å‡ºå›¾è®¾ç½® (è§’è‰²ä¸“å±)</label>
                <div style="margin-top: 10px;">
                    <button id="character-nai-prompts-btn" class="settings-full-btn">é…ç½®ä¸“å±æç¤ºè¯</button>
                </div>
             </div>
             <div class="settings-item-block" id="group-nai-settings-group" style="display: none;">
                <label>NAI å‡ºå›¾è®¾ç½® (ç¾¤èŠä¸“å±)</label>
                <div style="margin-top: 10px;">
                    <button id="group-character-nai-prompts-btn" class="settings-full-btn">é…ç½®ä¸“å±æç¤ºè¯</button>
                </div>
             </div>
        </div>

        <!-- ç¬¬äº”ç»„ï¼šå¤–è§‚ä¸è§†è§‰ -->
        <div class="settings-section">
            <div class="settings-item">
                 <label>èŠå¤©èƒŒæ™¯</label>
                 <!-- å¢åŠ  full-width ç±»ä»¥ä¿æŒå³å¯¹é½ï¼Œå†…éƒ¨ä½¿ç”¨ avatar-btn-group ä¿æŒé—´è·ä¸€è‡´ -->
                 <div class="settings-right full-width">
                     <div class="avatar-btn-group" style="justify-content: flex-end; width: 100%;">
                         <!-- å‡çº§ä¸ºå®ä½“å°æŒ‰é’® -->
                         <button class="settings-mini-btn" onclick="document.getElementById('bg-input').click()">ä¸Šä¼ </button>
                         <button class="settings-mini-btn" id="remove-bg-btn">ç§»é™¤</button>
                         
                         <!-- ä¿æŒåŸæœ‰çš„éšè— input å’Œé¢„è§ˆå›¾é€»è¾‘ -->
                         <input type="file" id="bg-input" accept="image/*" hidden>
                         <img id="bg-preview" class="settings-bg-preview">
                     </div>
                 </div>
            </div>
            
            <div class="settings-item-block">
                <label>æ°”æ³¡ä¸»é¢˜</label>
                 <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <select id="theme-preset-select" class="settings-select" style="flex:1; margin-right:10px;"></select>
                    <div style="display:flex; gap:5px;">
                        <button id="save-theme-preset-btn" class="settings-icon-btn">ğŸ’¾</button>
                        <button id="delete-theme-preset-btn" class="settings-icon-btn" style="color:#ff3b30;">ğŸ—‘ï¸</button>
                    </div>
                 </div>
                 <!-- è¡¥å…¨æ‰€æœ‰ä¸»é¢˜é€‰é¡¹ -->
                 <div class="theme-selector" style="max-height: 120px; overflow-y: auto; display: flex; flex-wrap: wrap; gap: 12px; padding: 5px 0;">
                      <label><input type="radio" name="theme-select" value="default" id="theme-default"> é»˜è®¤</label>
                      <label><input type="radio" name="theme-select" value="pink_blue"> ç²‰è“</label> 
                      <label><input type="radio" name="theme-select" value="blue_white"> è“ç™½</label>
                      <label><input type="radio" name="theme-select" value="purple_yellow"> ç´«é»„</label>
                      <label><input type="radio" name="theme-select" value="black_white"> é»‘ç™½</label>
                      <label><input type="radio" name="theme-select" value="yellow_white"> é»„ç™½</label>
                      <label><input type="radio" name="theme-select" value="red_black"> çº¢é»‘</label>
                      <label><input type="radio" name="theme-select" value="blue_yellow"> è“é»„</label>
                      <label><input type="radio" name="theme-select" value="pink_yellow"> ç²‰é»„</label>
                      <label><input type="radio" name="theme-select" value="pink_purple"> ç²‰ç´«</label>
                      <label><input type="radio" name="theme-select" value="gray_white"> ç°ç™½</label>
                      <label><input type="radio" name="theme-select" value="blue_green"> è“ç»¿</label>
                      <label><input type="radio" name="theme-select" value="pink_white"> ç²‰ç™½</label>
                      <label><input type="radio" name="theme-select" value="pink_black"> ç²‰é»‘</label>
                      <label><input type="radio" name="theme-select" value="pink_green"> ç²‰ç»¿</label>
                      <label><input type="radio" name="theme-select" value="green_black"> ç»¿é»‘</label>
                      
                      <button id="reset-theme-btn" class="settings-text-btn" style="margin-left: auto;">é‡ç½®é»˜è®¤</button>
                 </div>
            </div>

            <div class="settings-item">
                 <label>å­—ä½“å¤§å° <span id="chat-font-size-value" style="color:#888; font-size:12px;">13px</span></label>
                 <div class="settings-right" style="width: 50%;">
                    <input type="range" id="chat-font-size-slider" min="12" max="20" step="1" style="width:100%;">
                 </div>
            </div>
            
            <div class="settings-item-block">
                 <label>è‡ªå®šä¹‰ CSS <button id="reset-custom-css-btn" style="float:right; font-size:12px;">é‡ç½®</button></label>
                 <textarea id="custom-css-input" rows="3" class="settings-textarea" placeholder="/* é’ˆå¯¹å½“å‰èŠå¤©çš„CSS */"></textarea>
            </div>

            <div class="settings-item-block">
                <label>æ•ˆæœé¢„è§ˆ</label>
                <div id="settings-preview-area" style="margin-top:10px;"></div>
            </div>
            
            <div class="settings-item-block" id="lyrics-position-group" style="display: none;">
                 <label>æ­Œè¯æ è®¾ç½®</label>
                 <div style="display:flex; gap:10px; margin-top:10px;">
                     <select id="lyrics-vertical-pos" class="settings-select"><option value="top">é¡¶éƒ¨</option><option value="bottom">åº•éƒ¨</option></select>
                     <select id="lyrics-horizontal-pos" class="settings-select"><option value="center">å±…ä¸­</option><option value="left">å±…å·¦</option><option value="right">å±…å³</option></select>
                     <input type="number" id="lyrics-offset-input" class="settings-num-input" value="10" placeholder="åç§»">
                 </div>
            </div>
        </div>

        <!-- ç¬¬å…­ç»„ï¼šæ•°æ®ä¸æ“ä½œ (åº•éƒ¨) -->
        <div class="settings-section">
             <div class="settings-item clickable" id="search-history-btn">
                 <label>æŸ¥æ‰¾èŠå¤©è®°å½•</label>
                 <div class="settings-right">â€º</div>
             </div>
             
             <div class="settings-item clickable" id="export-single-chat-btn">
                 <label>å¯¼å‡ºèŠå¤©è®°å½•</label>
                 <div class="settings-right">â€º</div>
             </div>
             
             <div class="settings-item clickable" id="import-single-chat-btn">
                 <label>å¯¼å…¥èŠå¤©è®°å½•</label>
                 <div class="settings-right">
                     â€º
                     <input type="file" id="import-single-chat-input" accept="application/json" hidden>
                 </div>
             </div>

             <div class="settings-item clickable" id="export-character-full-btn">
                 <label>å¯¼å‡ºè§’è‰²</label>
                 <div class="settings-right">â€º</div>
             </div>

             <div class="settings-item clickable" id="clear-chat-btn">
                 <label style="color: #ff3b30;">æ¸…ç©ºèŠå¤©è®°å½•</label>
                 <div class="settings-right">â€º</div>
             </div>
             
             <div class="settings-item clickable" id="block-chat-btn">
                 <label style="color: #ff3b30;">æ‹‰é»‘å¯¹æ–¹ / ç§»å‡ºç¾¤èŠ</label>
                 <div class="settings-right">â€º</div>
             </div>
        </div>
        
        <div style="height: 40px;"></div> <!-- åº•éƒ¨å«é«˜ -->
      </div>
    </div>
    <div id="rendering-rules-screen" class="screen">
      <div class="header"> 
        <span class="back-btn" onclick="showScreen('home-screen')">â€¹</span> 
        <span data-lang-key="homeAppRenderer">æ¸²æŸ“è§„åˆ™</span> 
        <div class="header-actions">
            <span class="action-btn" id="import-rules-btn" title="å¯¼å…¥è§„åˆ™">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
            </span>
            <span class="action-btn" id="manage-rules-btn" title="ç®¡ç†/å¤šé€‰">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
        <polyline points="9 11 12 14 22 4"></polyline>
    </svg>
</span>
            <span class="action-btn" id="add-new-rule-btn">+</span> 
        </div>
      </div>
      <div id="rules-tabs"> </div>
      <div id="rules-content-container" class="list-container"> </div>
      
      <div id="rules-action-bar" style="display: none; position: absolute; bottom: 0; left: 0; width: 100%; padding: 15px 20px; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-top: 1px solid #eee; box-sizing: border-box; justify-content: space-between; align-items: center; z-index: 10;">
          <label style="display:flex; align-items:center; gap:5px; font-size:16px;">
              <input type="checkbox" id="select-all-rules-checkbox"> å…¨é€‰
          </label>
          <div style="display:flex; gap:10px;">
              <button id="export-selected-rules-btn" class="settings-mini-btn" style="background-color: #007aff; color: white; border: none;">å¯¼å‡º (0)</button>
              <button id="delete-selected-rules-btn" class="settings-mini-btn" style="color: #ff3b30;">åˆ é™¤ (0)</button>
          </div>
      </div>
    </div>
    <input type="file" id="import-rules-input" accept=".json" style="display: none;">
    <div id="rule-editor-modal" class="modal">
      <div class="modal-content" style="height: 85%;">
        <div class="modal-header"> <span id="rule-editor-title">åˆ›å»ºæ–°è§„åˆ™</span> </div>
        <div class="modal-body" style="display: flex; flex-direction: column; gap: 15px;">
          <div class="form-group" style="flex-shrink: 0;"> <label for="rule-name-input">è§„åˆ™åç§°</label> <input type="text" id="rule-name-input" placeholder="ä¾‹å¦‚ï¼šç¾å›¢å¤–å–å¡ç‰‡"> </div>
          <div class="form-group" style="flex-shrink: 0;"> <label for="rule-chat-id-select">ç»‘å®šèŒƒå›´</label> <select id="rule-chat-id-select">
              <option value="global">å…¬ç”¨ (æ‰€æœ‰è§’è‰²)</option>
            </select> </div>
          <div class="form-group" style="flex-grow: 1; display: flex; flex-direction: column;"> <label for="rule-regex-input">æ­£åˆ™è¡¨è¾¾å¼ (ä½¿ç”¨gä½œä¸ºæ ‡å¿—)</label> <textarea id="rule-regex-input" rows="3" style="font-family: monospace; resize: vertical;" placeholder="ä¾‹å¦‚ï¼šMTR\[(.*?)\]\[(.*?)\|(.*?)\]"></textarea>
          </div>
          <div class="form-group" style="flex-grow: 2; display: flex; flex-direction: column;"> <label for="rule-template-input">HTML æ¨¡æ¿ (ç”¨ $1, $2 å¼•ç”¨)</label> <textarea id="rule-template-input" rows="6" style="font-family: monospace; resize: vertical;"
              placeholder="ä¾‹å¦‚ï¼š<div class=`waimai-card`>...<span>$2</span>...</div>"></textarea> </div>
          <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;"> <label for="rule-enabled-switch" style="margin-bottom: 0;">å¯ç”¨è§„åˆ™</label> <label class="toggle-switch"> <input type="checkbox" id="rule-enabled-switch" checked>
              <span class="slider"></span> </label> </div>
<div class="form-group" style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
    <label for="rule-do-not-send-switch" style="margin-bottom: 0;">
        æ¸²æŸ“æ—¶ä»ä¸Šä¸‹æ–‡ä¸­åˆ é™¤
        <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
            å¼€å¯åï¼ŒåŒ¹é…æ­¤è§„åˆ™çš„æ¶ˆæ¯å°†ä¸ä¼šè¢«å‘é€ç»™AIï¼Œä»…ç”¨äºå‰ç«¯æ˜¾ç¤ºã€‚
        </p>
    </label>
    <label class="toggle-switch">
        <input type="checkbox" id="rule-do-not-send-switch">
        <span class="slider"></span>
    </label>
</div>
        </div>
        <div class="modal-footer"> <button class="cancel" id="cancel-rule-editor-btn" data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="save-rule-btn"data-lang-key="save">ä¿å­˜è§„åˆ™</button> </div>
      </div>
    </div>
    <div id="search-history-screen" class="screen">
      <div class="header"> <span class="back-btn" id="search-history-back-btn">â€¹</span> <span>æœç´¢èŠå¤©è®°å½•</span> <span style="width: 30px;"></span> </div>
      <div id="search-bar" style="padding: 10px 15px; border-bottom: 1px solid var(--border-color); background-color: var(--secondary-bg); flex-shrink: 0;">
        <div style="display: flex; gap: 10px; margin-bottom: 10px;"> <input type="search" id="keyword-search-input" placeholder="è¾“å…¥å…³é”®è¯..." style="flex-grow: 1; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 16px;"> <input type="date" id="date-search-input"
            style="padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 16px;"> </div>
        <div style="display: flex; gap: 10px;"> <button id="execute-search-btn" class="form-button" style="margin-top: 0; flex-grow: 1;">æœç´¢</button> <button id="clear-search-btn" class="form-button form-button-secondary" style="margin-top: 0; flex-grow: 1;">é‡ç½®</button> </div>
      </div>
      <div id="chat-search-results-list" class="list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
    </div>
<!-- æ”¯ä»˜å®å±å¹• -->
<div id="alipay-screen" class="screen">
    <div class="alipay-header-area">
        <div class="alipay-nav">
            <span class="back-btn" onclick="showScreen('home-screen')">â€¹</span>
            <span class="alipay-title">æ”¯ä»˜å®</span>
            <span class="alipay-action" onclick="handleUserTopUp()">å……å€¼</span>
        </div>
    </div>
    
    <div class="alipay-card-container">
        <div class="alipay-balance-card">
            <div class="balance-label">
                <span>æ€»èµ„äº§(CNY)</span>
                </div>
            <div class="balance-amount" id="alipay-balance-display">0.00</div>
            <div class="balance-status-tag" id="alipay-status-tag">æ ‡å‡†ä¼šå‘˜</div>
        </div>

        <div class="alipay-grid-menu">
            <div class="alipay-menu-item" onclick="openFundScreen()">
                <div class="menu-icon">ğŸ“ˆ</div>
                <div class="menu-info">
                    <div class="menu-title">åŸºé‡‘ç†è´¢</div>
                    <div class="menu-trend" id="fund-market-trend-preview" style="font-size:12px;">+2.35%</div>
                </div>
                <div class="menu-arrow">â€º</div>
            </div>
            </div>
        
        </div>

    <div class="alipay-bill-container" style="margin: 0 12px; border-radius: 16px;">
        <div id="alipay-transaction-list">
            </div>
    </div>
</div>
<!-- åŸºé‡‘ç†è´¢å±å¹• (å·²å»æ‰äº†å†…è”é¢œè‰²ï¼Œæ”¹ä¸º class æ§åˆ¶) -->
<div id="fund-screen" class="screen" style="background-color: #f5f5f5;">
    <!-- å¤´éƒ¨ï¼šæ·»åŠ äº† class="fund-header-area" -->
    <div class="header fund-header-area">
        <span class="back-btn" onclick="showScreen('alipay-screen')" style="color: white;">â€¹</span>
        <span>ç†è´¢å¸‚åœº</span>
        <span class="action-btn" onclick="refreshFundMarket()" style="font-size: 14px; color: white;">åˆ·æ–°</span>
    </div>
    
    <!-- èµ„äº§å¡ç‰‡ï¼šæ·»åŠ äº† class="fund-asset-card" -->
    <div class="fund-asset-card">
        <div style="font-size: 13px; opacity: 0.8;">æŒæœ‰æ€»èµ„äº§ (CNY)</div>
        <div style="font-size: 32px; font-weight: 700; margin: 5px 0;" id="fund-total-assets">0.00</div>
        <div style="font-size: 13px; display: flex; gap: 15px;">
            <span>æ˜¨æ—¥æ”¶ç›Š <span id="fund-yesterday-profit">0.00</span></span>
            <span>æŒæœ‰æ”¶ç›Š <span id="fund-total-profit">0.00</span></span>
        </div>
    </div>

    <div class="list-container" style="padding: 20px 15px; padding-bottom: 80px; background-color: #f5f5f5; border-radius: 20px 20px 0 0; overflow-y: auto; margin-top: -20px;">
        <div class="frame-tabs" style="background: white; border-radius: 12px; padding: 5px; margin-bottom: 15px; border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
            <div id="tab-fund-market" class="frame-tab active" onclick="switchFundTab('market')" style="border-radius: 8px;">å¸‚åœºçƒ­é—¨</div>
            <div id="tab-fund-my" class="frame-tab" onclick="switchFundTab('my')" style="border-radius: 8px;">æˆ‘çš„æŒä»“</div>
        </div>

        <div id="fund-market-list" style="display: block;"></div>
        <div id="fund-my-list" style="display: none;"></div>
        
        <p style="font-size: 12px; color: #999; text-align: center; margin-top: 20px;">
            å¸‚åœºæœ‰é£é™©ï¼ŒæŠ•èµ„éœ€è°¨æ…<br>æ¨¡æ‹Ÿæ•°æ®ä»…ä¾›å¨±ä¹
        </p>
    </div>
</div>

<!-- åŸºé‡‘äº¤æ˜“å¼¹çª— -->
<div id="fund-trade-modal" class="modal">
    <div class="modal-content" style="width: 300px; height: auto;">
        <div class="modal-header">
            <span id="fund-trade-title">åŸºé‡‘äº¤æ˜“</span>
        </div>
        <div class="modal-body">
            <div style="margin-bottom: 15px; padding: 10px; background: #f9f9f9; border-radius: 8px;">
                <div id="fund-trade-name" style="font-weight: bold; font-size: 16px;"></div>
                <div id="fund-trade-code" style="font-size: 12px; color: #999;"></div>
                <div style="display: flex; justify-content: space-between; margin-top: 8px;">
                    <span style="font-size: 13px;">å½“å‰å‡€å€¼: <span id="fund-trade-nav" style="color: #1677ff; font-weight: bold;"></span></span>
                    <span style="font-size: 13px;">æ—¥æ¶¨è·Œ: <span id="fund-trade-change"></span></span>
                </div>
            </div>
            
            <div class="form-group">
                <label id="fund-trade-label">ä¹°å…¥é‡‘é¢ (ä½™é¢: Â¥<span id="fund-wallet-balance"></span>)</label>
                <!-- ä¿®å¤ï¼šå¼ºåˆ¶ type="number" -->
                <input type="number" id="fund-trade-amount" placeholder="è¯·è¾“å…¥é‡‘é¢" style="font-size: 24px; font-weight: bold; color: #1677ff; border-bottom: 2px solid #eee; padding: 10px 0;">
            </div>
            <p id="fund-trade-info" style="font-size: 12px; color: #666; margin-top: 5px;"></p>
        </div>
        <div class="modal-footer">
            <button class="cancel" onclick="document.getElementById('fund-trade-modal').classList.remove('visible')">å–æ¶ˆ</button>
            <!-- ä¿®å¤ï¼šç›´æ¥ç»‘å®š onclick å‡½æ•°ï¼Œä¸å†ä¾èµ– addEventListener -->
            <button class="save" id="fund-confirm-btn" onclick="handleFundTradeConfirm()">ç¡®è®¤</button>
        </div>
    </div>
</div>
<div id="auction-screen" class="screen" style="background-color: #121212; color: #e0e0e0;">
    <div class="header" style="background-color: #1c1c1e; color: #d4af37; border-bottom: 1px solid #333;">
    <span class="back-btn" onclick="showScreen('home-screen')" style="color: #d4af37;">â€¹</span>
    <span>é»‘å¸‚æ‹å–</span>
    <div class="header-actions">
        <span class="action-btn" onclick="generateNewAuctionItem()">æ–°æ‹å“</span>
        <span class="action-btn" onclick="openInventoryModal()">ğŸ“¦ ä»“åº“</span>
        
    </div>
   </div>
    
    <!-- æ‹å“å±•ç¤ºåŒº -->
    <div id="auction-main-display" style="padding: 20px; text-align: center; height: 45%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
        <div id="auction-item-image-container" style="width: 200px; height: 200px; border: 2px solid #d4af37; border-radius: 10px; overflow: hidden; box-shadow: 0 0 20px rgba(212, 175, 55, 0.3); background: #000; margin-bottom: 15px; position: relative;">
            <img id="auction-item-img" src="" style="width: 100%; height: 100%; object-fit: cover; display: none;">
            <div id="auction-loading" style="color: #666; margin-top: 90px;">ç­‰å¾…æ‹å“...</div>
        </div>
        <h2 id="auction-item-name" style="margin: 5px 0; font-size: 20px; color: #fff;">---</h2>
        <p id="auction-item-desc" style="font-size: 12px; color: #888; margin: 0; max-height: 40px; overflow: hidden;">---</p>
    </div>

    <!-- ç«ä»·ä¿¡æ¯åŒº -->
    <div style="background-color: #1c1c1e; padding: 15px; border-radius: 20px 20px 0 0; flex-grow: 1; display: flex; flex-direction: column; box-shadow: 0 -4px 20px rgba(0,0,0,0.5);">
        
        <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #333;">
            <div>
                <div style="font-size: 12px; color: #888;">å½“å‰æœ€é«˜ä»·</div>
                <div id="auction-current-price" style="font-size: 32px; font-weight: bold; color: #ff4d4f; font-family: monospace;">Â¥ 0</div>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 12px; color: #888;">å€’è®¡æ—¶</div>
                <div id="auction-timer" style="font-size: 24px; font-weight: bold; color: #d4af37;">--</div>
            </div>
        </div>

        <!-- å®æ—¶å‡ºä»·è®°å½• -->
        <div id="auction-log" style="flex-grow: 1; overflow-y: auto; font-size: 13px; margin-bottom: 15px; height: 100px;">
            <div style="color: #666; text-align: center;">ç­‰å¾…å¼€æ‹...</div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div id="auction-controls" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
            <button class="form-button-secondary" onclick="placeBid(1.1)" style="background: #333; color: white; border: 1px solid #555;">+10%</button>
            <button class="form-button-secondary" onclick="placeBid(1.5)" style="background: #333; color: white; border: 1px solid #555;">+50%</button>
            <button class="form-button" onclick="placeBid('custom')" style="background: linear-gradient(135deg, #d4af37, #f2d06b); color: black; font-weight: bold; border: none;">å‡ºä»·</button>
        </div>
    </div>
</div>
<div id="todo-list-screen" class="screen" style="background-color: #f2f2f7;">
    <div class="header">
        <span class="back-btn" id="todo-list-back-btn">â€¹</span>
        <span>å¾…åŠäº‹é¡¹</span>
        <span class="action-btn" id="add-todo-btn" style="font-size: 24px;">+</span>
    </div>
    
    <div class="todo-date-navigator">
        <button id="todo-prev-day-btn">â€¹</button>
        <div id="todo-current-date-display">ä»Šå¤©</div>
        <button id="todo-next-day-btn">â€º</button>
    </div>

    <div id="todo-list-container" class="list-container" style="padding: 15px;">
        </div>
</div>
<div id="green-river-screen" class="screen gr-theme">
    <div class="gr-header">
    <button class="gr-icon-btn" onclick="showScreen('home-screen')">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
    </button>
    
    <span class="gr-title">Green River</span>
    
    <div class="gr-header-actions">
        <button class="gr-icon-btn" onclick="openAuthorManager()" title="ä½œè€…ç®¡ç†">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
        </button>
        <button class="gr-icon-btn" onclick="createNewStory()" title="æ–°å»ºä½œå“">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        </button>
    </div>
</div>
    
    <div class="gr-content-area">
        <div class="gr-section-header">
            <span class="gr-section-title">ä¹¦æ¶ Library</span>
        </div>
        <div id="gr-book-list" class="gr-grid-list">
            </div>
    </div>
</div>

<div id="gr-author-screen" class="screen gr-theme">
    <div class="gr-header">
        <button class="gr-icon-btn" onclick="showScreen('green-river-screen')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
        </button>
        <span class="gr-title">Authors</span>
        <div class="gr-header-actions">
            <button class="gr-icon-btn" onclick="addAuthor()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            </button>
        </div>
    </div>
    <div class="gr-content-area" id="gr-author-list"></div>
</div>

<div id="gr-reader-screen" class="screen gr-theme">
    <div class="gr-header">
        <button class="gr-icon-btn" onclick="showScreen('green-river-screen')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
        </button>
        <div style="display:flex; flex-direction:column; align-items:center;">
             <span class="gr-title" id="gr-book-name-display" style="font-size:14px; opacity:0.7;">ä¹¦å</span>
             <span class="gr-title" id="gr-chapter-title-display" style="font-size:16px; font-weight:bold;">ç¬¬ä¸€ç« </span>
        </div>
        <button class="gr-icon-btn" onclick="openStorySettings()" title="è®¾å®š">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
        </button>
    </div>

    <div id="gr-sidebar-overlay" onclick="closeChapterList()"></div>
    <div id="gr-chapter-sidebar">
        <div class="gr-sidebar-header">
            <span>ç›®å½• Contents</span>
            <span id="gr-total-chapters" style="font-size:12px; color:#888;">å…± 0 ç« </span>
        </div>
        <div id="gr-chapter-list-content">
            </div>
    </div>
    
    <div class="gr-reader-content" id="gr-reader-content">
        </div>

    <div class="gr-control-panel">
        <div id="gr-pagination-controls" style="display:flex; justify-content:space-between; align-items:center; width:100%;">
            <button class="gr-text-btn" id="gr-prev-chapter-btn">ä¸Šä¸€ç« </button>
            <button class="gr-icon-btn" id="gr-menu-btn" onclick="openChapterList()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
            </button>
            <button class="gr-text-btn" id="gr-next-chapter-btn">ä¸‹ä¸€ç« </button>
        </div>

        <div id="gr-writing-controls" style="display:none; gap:10px; align-items:center; width:100%; margin-top:10px;">
             <div class="gr-input-group" style="flex-grow:1;">
                <input type="text" id="gr-direction-input" class="gr-input" placeholder="è¾“å…¥æœ¬ç« å‰§æƒ…èµ°å‘ (ä¾‹å¦‚ï¼šä¸¤äººå‘ç”Ÿäº‰åµ)...">
            </div>
            <button id="gr-reroll-btn" class="gr-main-btn" style="background-color:#F4F4F5; color:#666; border:1px solid #ddd; padding: 10px;" title="é‡å†™æœ¬ç« ">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
            </button>
            <button id="gr-generate-btn" class="gr-main-btn">
                
                <svg id="gr-gen-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>
    </div>
</div>
<!-- é‚®ç®±ä¸»ç•Œé¢ -->
<div id="email-screen" class="screen mail-theme">
    <div class="mail-header">
    <button class="mail-icon-btn" onclick="showScreen('home-screen')">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
        <span style="font-size: 16px; margin-left: -2px;">è¿”å›</span>
    </button>
    
    <div class="mail-header-actions">
        <button class="mail-icon-btn" onclick="openEmailSettings()" title="é‚®ç®±é…ç½®">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>
                <circle cx="12" cy="12" r="3"></circle>
            </svg>
        </button>

        <button class="mail-icon-btn" onclick="handleQuickReceiveMail()" title="ä¸€é”®æ¥æ”¶æ–°é‚®ä»¶">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                <path d="M22 7l-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
                <line x1="12" y1="19" x2="12" y2="15"></line>
                <line x1="10" y1="17" x2="14" y2="17"></line>
            </svg>
        </button>

        <button id="mail-edit-btn" class="mail-icon-btn" onclick="toggleEmailEditMode()" title="ç¼–è¾‘åˆ—è¡¨">
        ç¼–è¾‘
    </button>
    </div>
</div>

    <div style="flex-shrink: 0;">
        <h1 class="mail-large-title">æ”¶ä»¶ç®±</h1>
        <div class="mail-search-bar">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#8E8E93" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            <input type="text" placeholder="æœç´¢" id="mail-search-input">
        </div>
    </div>

    <div id="email-list" class="mail-list-container">
        </div>
     <div id="mail-action-bar" style="display: none;">
        <div class="select-all-btn" id="mail-select-all-btn">å…¨é€‰</div>
        <button id="mail-delete-selected-btn" class="mail-delete-action-btn">åˆ é™¤ (0)</button>
    </div>
</div>

<div id="email-detail-screen" class="screen mail-theme" style="background-color: #fff; display: flex; flex-direction: column;">
    <div class="mail-detail-header">
        <button class="mail-icon-btn" onclick="closeEmailDetail()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#007AFF" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
            <span style="color: #007AFF; font-size: 16px; margin-left: -2px;">æ”¶ä»¶ç®±</span>
        </button>
        
        <div class="mail-header-actions">
            <button class="mail-icon-btn" id="forward-email-btn" title="è½¬å‘åˆ°èŠå¤©">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#007AFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
            </button>
            <button class="mail-icon-btn" id="delete-email-btn" title="åˆ é™¤é‚®ä»¶" style="color: #ff3b30;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
            </button>
        </div>
    </div>
    
    <div class="mail-detail-content">
        <div class="mail-meta-header">
            <div class="mail-subject-line" id="mail-detail-subject">Subject</div>
            <div class="mail-meta-row">
                <div class="mail-sender-avatar" id="mail-detail-avatar"></div>
                <div class="mail-meta-info">
                    <div class="mail-from-row">
                        <span class="mail-from-name" id="mail-detail-from">Sender Name</span>
                        <span class="mail-time" id="mail-detail-time">Today</span>
                    </div>
                    <div class="mail-to-row">To: <span id="mail-detail-to">Me</span></div>
                </div>
            </div>
        </div>
        <div class="mail-body-text" id="mail-detail-body">
            </div>
    </div>
    </div>
    
</div>

<!-- é‚®ä»¶ç”Ÿæˆå™¨é…ç½®å¼¹çª— -->
<div id="email-generator-modal" class="modal">
    <div class="modal-content" style="height: 85%; background-color: #FAFAF9; border-radius: 20px;">
        <div class="mail-modal-header">
            <span>æ”¶ä»¶ç®±é…ç½®</span>
        </div>
        <div class="modal-body" style="padding: 20px;">
            
            <!-- 1. èº«ä»½è®¾å®š -->
            <div class="gr-form-group">
                <label>æ”¶ä»¶äººèº«ä»½ (User Persona)</label>
                
                <select id="mail-user-persona-select" class="gr-input" style="margin-bottom: 8px; padding: 8px; border:1px solid #ddd;">
                    <option value="">-- ä»…ä½¿ç”¨ä¸‹æ–¹å…³é”®è¯ --</option>
                </select>

                <input type="text" id="mail-user-mask" class="gr-input" placeholder="ä¾‹å¦‚ï¼šä¾¦æ¢ã€å…¬å¸é«˜ç®¡ã€ç¥ç§˜äºº..." value="æ™®é€šç”¨æˆ·">
                <p style="font-size:11px; color:#999; margin-top:5px;">é€‰æ‹©é¢„è®¾å¯æä¾›è¯¦ç»†èƒŒæ™¯ï¼Œä¸‹æ–¹è¾“å…¥æ¡†ç”¨äºå®šä¹‰å½“å‰å…·ä½“çš„ç¤¾ä¼šèº«ä»½ã€‚</p>
            </div>

            <!-- 2. ä¸–ç•Œè§‚è®¾å®š -->
            <div class="gr-form-group">
                <label>é‚®ä»¶ç³»ç»ŸèƒŒæ™¯ (World Context)</label>
                <textarea id="mail-world-context" class="gr-input" rows="3" placeholder="ä¾‹å¦‚ï¼šèµ›åšæœ‹å…‹é»‘å®¢è®ºå›é€šçŸ¥ã€ç»´å¤šåˆ©äºšæ—¶æœŸçš„ä¿¡ä»¶ã€ç°ä»£èŒåœºåƒåœ¾é‚®ä»¶..."></textarea>
            </div>

            <!-- 3. å‘ä»¶äººæ¥æº -->
            <div class="gr-form-group">
                <label>å‘ä»¶äººæ¥æº (å¤šé€‰)</label>
                <div class="gr-checkbox-list" id="mail-sender-list">
                    <!-- JS åŠ¨æ€å¡«å……è§’è‰²å’Œ NPC -->
                </div>
                <label style="margin-top:10px; display:flex; align-items:center;">
                    <input type="checkbox" id="mail-allow-random-npc" checked> å…è®¸ç”Ÿæˆéšæœºé™Œç”Ÿäºº/åƒåœ¾é‚®ä»¶
                </label>
            </div>

            <!-- 4. å…³è”ä¸Šä¸‹æ–‡ -->
            <div class="gr-form-group">
                <label>å…³è”è®°å¿†ä¸ä¸–ç•Œä¹¦</label>
                <div class="gr-checkbox-list" id="mail-context-list">
                    <!-- JS åŠ¨æ€å¡«å……ä¸–ç•Œä¹¦ -->
                </div>
            </div>
          <div class="gr-form-group">
                <label>ç”Ÿæˆæ•°é‡</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="number" id="mail-gen-count" class="gr-input" value="3" min="1" max="10" style="flex:1;">
                    <span style="font-size: 13px; color: #888;">å°</span>
                </div>
            </div>
        </div>
        <div class="modal-footer" style="border-top: 1px solid #E5E5E5; display:flex; gap:15px;">
            <button class="cancel" style="background:#F5F5F7; color:#000; border:none;" onclick="document.getElementById('email-generator-modal').classList.remove('visible')">å–æ¶ˆ</button>
            <button class="save" style="background:#007AFF; color:#fff; border:none;" id="start-generate-email-btn">æ¥æ”¶é‚®ä»¶</button>
        </div>
    </div>
</div>

    <div id="shopping-screen" class="screen">
      <div class="header">
        <div class="header-left-actions"> <span class="back-btn" id="shopping-back-btn">â€¹</span> <span class="action-btn" id="generate-shopping-items-btn" title="AIç”Ÿæˆå•†å“"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
              <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
            </svg> </span> <span class="action-btn" id="shopping-settings-btn" title="ç”Ÿæˆè®¾ç½®"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path
                d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.44,0.17-0.48,0.41L9.12,4.84c-0.59,0.24-1.12,0.56-1.62,0.94L5.11,4.82c-0.22-0.08-0.47,0-0.59,0.22l-1.92,3.32 c-0.12,0.22-0.07,0.47,0.12,0.61l2.03,1.58C4.84,11.36,4.82,11.68,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.48,2.03 c0.04,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.48-0.41l0.48-2.03c0.59-0.24,1.12-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z">
              </path>
            </svg> </span> <span class="action-btn" id="delete-current-category-btn" title="åˆ é™¤å½“å‰åˆ†ç±»" style="display: none; color: rgb(255, 59, 48);"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"></path>
              <line x1="18" y1="9" x2="12" y2="15"></line>
              <line x1="12" y1="9" x2="18" y2="15"></line>
            </svg> </span> </div> <span>è´­ç‰©ä¸­å¿ƒ</span>
        <div class="header-actions"> <span class="action-btn" id="manage-products-btn" title="ç®¡ç†å•†å“" style="color: var(--text-primary);"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
            </svg> </span> <span class="action-btn" id="add-new-product-btn" title="æ·»åŠ æ–°å•†å“"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="16"></line>
              <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg> </span> <span class="action-btn" id="go-to-cart-btn" title="æŸ¥çœ‹è´­ç‰©è½¦"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg> <span id="cart-count">0</span> </span> </div>
      </div>
      <div id="product-category-tabs"></div>
      <div id="product-grid" class="list-container"> </div>
      <div id="shopping-action-bar"> <label class="select-all-label"> <input type="checkbox" id="select-all-products-checkbox"> å…¨é€‰ </label> <button id="delete-selected-products-btn" class="action-bar-btn">åˆ é™¤ (0)</button> </div>
    </div>
    <div id="product-detail-screen" class="screen">
      <div class="header"> <span class="back-btn" id="product-detail-back-btn">â€¹</span> <span>å•†å“è¯¦æƒ…</span> <span style="width: 30px;"></span> </div>
      <div id="product-detail-content" class="list-container"> </div>
      <div id="product-detail-footer"> <button class="footer-btn add-to-cart-detail-btn">åŠ å…¥è´­ç‰©è½¦</button> <button class="footer-btn buy-now-btn">ç«‹å³è´­ä¹°</button> </div>
    </div>
    <div id="cart-screen" class="screen">
      <div class="header"> <span class="back-btn" id="cart-back-btn">â€¹</span> <span id="cart-title">è´­ç‰©è½¦(0)</span> <span class="action-btn" id="clear-cart-btn">æ¸…ç©º</span> </div>
      <div id="cart-items-list" class="list-container"> </div>
      <div id="cart-footer"> <label class="select-all-label"><input type="checkbox" id="select-all-cart-items"> å…¨é€‰</label>
        <div class="cart-summary">
          <div id="cart-total">åˆè®¡: Â¥0.00</div> <span class="cart-subtext">ä¸å«è¿è´¹</span>
        </div> <button id="checkout-btn">ç»“ç®—(0)</button>
      </div>
    </div>
    <div id="product-editor-modal" class="modal">
      <div class="modal-content" style="height: 85%;">
        <div class="modal-header"> <span id="product-editor-title">æ·»åŠ å•†å“</span> </div>
        <div class="modal-body">
          <div class="form-group"> <label>å•†å“å›¾ç‰‡</label>
            <div class="avatar-upload"> <img id="product-image-preview" src="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756206115802_qdqqd_0c99bh.jpeg"> <button onclick="document.getElementById('product-image-input').click()">ä¸Šä¼ å›¾ç‰‡</button> <input type="file" id="product-image-input"
                accept="image/*" hidden> </div>
          </div>
          <div class="form-group"> <label for="product-name-input">å•†å“åç§°</label> <input type="text" id="product-name-input"> </div>
          <div class="form-group"> <label for="product-category-select">å•†å“åˆ†ç±»</label>
            <div style="display: flex; align-items: center; gap: 10px;"> <select id="product-category-select" style="flex-grow: 1;"></select> <button id="manage-product-categories-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;">ç®¡ç†</button> </div>
          </div>
          <div class="form-group"> <label for="product-price-input">é»˜è®¤ä»·æ ¼ (å…ƒ)</label> <input type="number" id="product-price-input" min="0" step="0.01"> </div>
          <div class="form-group"> <label for="product-description-input">å•†å“æè¿°</label> <textarea id="product-description-input" rows="3" placeholder="è¯¦ç»†ä»‹ç»ä¸€ä¸‹è¿™ä¸ªå•†å“..."></textarea> </div>
          <hr style="opacity: 0.2; margin: 20px 0;">
          <div class="form-group"> <label>å•†å“æ¬¾å¼</label>
            <p style="font-size: 12px; color: #888; margin-top: -5px; margin-bottom: 10px;">å¦‚æœæ²¡æœ‰æ·»åŠ ä»»ä½•æ¬¾å¼ï¼Œå°†ä½¿ç”¨ä¸Šé¢çš„é»˜è®¤ä»·æ ¼ã€‚</p>
            <div id="product-variations-container" style="display: flex; flex-direction: column; gap: 15px;"> </div> <button id="add-product-variation-btn" class="form-button form-button-secondary" style="margin-top: 15px;">+ æ·»åŠ æ–°çš„ä¸€æ¬¾</button>
          </div>
        </div>
        <div class="modal-footer"> <button class="cancel" id="cancel-product-editor-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="save-product-btn"data-lang-key="save">ä¿å­˜</button> </div>
      </div>
    </div>
    <div id="gift-receipt-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header"> <span>è´­ç‰©å°ç¥¨</span> </div>
        <div class="modal-body" id="gift-receipt-body"> </div>
        <div class="modal-footer"> <button class="save" id="close-receipt-btn" style="width:100%;">å…³é—­</button> </div>
      </div>
    </div>
  </div>
  </div> <input type="file" id="import-card-input" accept=".json,.png" multiple style="display: none;"> <input type="file" id="import-world-book-input" accept=".json,.txt,.zip,.docx" multiple style="display: none;">
  <div id="persona-library-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span>æˆ‘çš„äººè®¾åº“</span>
        <div style="display: flex; gap: 10px;">
          <button id="import-tavern-persona-btn" class="action-button">å¯¼å…¥</button>
          <button id="add-persona-preset-btn" class="action-button" data-lang-key="add">æ·»åŠ </button>
          <button id="manage-persona-preset-btn" class="action-button" data-lang-key="manage">ç®¡ç†</button>
        </div>
      </div>
      <div class="modal-body">
        <div id="persona-library-grid"></div>
      </div>
      <div class="modal-footer">
        <button class="cancel" id="close-persona-library-btn">å…³é—­</button>
        <div id="persona-manage-actions" style="display: none; gap: 10px;">
          <button class="action-button" id="select-all-persona-btn">å…¨é€‰</button>
          <button class="action-button" id="delete-selected-persona-btn" style="background-color: #ff3b30;">åˆ é™¤</button>
          <button class="cancel" id="cancel-manage-persona-btn">å–æ¶ˆ</button>
        </div>
      </div>
    </div>
  </div>
  <input type="file" id="import-tavern-persona-input" accept=".json" style="display: none;">
  
  <!-- äººè®¾æ“ä½œé€‰æ‹©å¼¹çª— -->
  <div id="persona-action-modal" class="modal">
    <div class="modal-content" style="width: 350px; height: auto;">
      <div class="modal-header">
        <span id="persona-action-title">äººè®¾æ“ä½œ</span>
      </div>
      <div class="modal-body" style="padding: 20px;">
        <button class="form-button" id="apply-persona-direct-btn" style="width: 100%; margin-bottom: 15px; padding: 15px; font-size: 16px; background: #007AFF; color: white; border: none;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          ç›´æ¥åº”ç”¨
        </button>
        <button class="form-button" id="edit-persona-first-btn" style="width: 100%; padding: 15px; font-size: 16px; background: #f0f0f0; color: #333; border: none;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
          ç¼–è¾‘ååº”ç”¨
        </button>
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-persona-action-btn">å–æ¶ˆ</button>
      </div>
    </div>
  </div>
  
  <!-- æ‰¹é‡å¯¼å…¥è§’è‰²å¡é¢„è§ˆæ¨¡æ€æ¡† -->
  <div id="batch-import-preview-modal" class="modal">
    <div class="modal-content" style="height: 80%; max-width: 900px;">
      <div class="modal-header">
        <span>æ‰¹é‡å¯¼å…¥è§’è‰²å¡é¢„è§ˆ</span>
        <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;">
          <input type="checkbox" id="select-all-import-cards" checked> å…¨é€‰
        </label>
      </div>
      <div class="modal-body" id="batch-import-preview-list" style="padding: 0; overflow-y: auto;">
        <!-- è§’è‰²å¡é¢„è§ˆåˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-batch-import-btn">å–æ¶ˆ</button>
        <button class="save" id="confirm-batch-import-btn">ç¡®è®¤å¯¼å…¥</button>
      </div>
    </div>
  </div>
  
  <div id="tavern-persona-selector-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header">
        <span>é€‰æ‹©è¦å¯¼å…¥çš„é¢„è®¾</span>
      </div>
      <div class="modal-body" style="padding: 0;">
        <div id="tavern-persona-selector-list" style="overflow-y: auto; height: 100%;"></div>
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-tavern-import-btn">å–æ¶ˆ</button>
        <button class="save" id="confirm-tavern-import-btn">ç¡®è®¤å¯¼å…¥</button>
      </div>
    </div>
  </div>
  <div id="persona-editor-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><span id="persona-editor-title">æ·»åŠ äººè®¾é¢„è®¾</span></div>
      <div class="modal-body">
        <div class="form-group"><label>é¢„è®¾å¤´åƒ</label>
          <div class="avatar-upload"><img id="preset-avatar-preview"><button onclick="document.getElementById('preset-avatar-input').click()">ä¸Šä¼ å¤´åƒ</button><input type="file" id="preset-avatar-input" accept="image/*"></div>
        </div>
        <div class="form-group"><label for="preset-persona-input">é¢„è®¾äººè®¾</label><textarea id="preset-persona-input" rows="4" placeholder="åœ¨æ­¤è¾“å…¥è¿™ä¸ªäººè®¾çš„è¯¦ç»†è®¾å®š..."></textarea></div>
      </div>
      <div class="modal-footer"><button class="cancel" id="cancel-persona-editor-btn"data-lang-key="cancel">å–æ¶ˆ</button><button class="save" id="save-persona-preset-btn"data-lang-key="save">ä¿å­˜</button></div>
    </div>
  </div>
  <div id="member-settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><span data-lang-key="edit">ç¼–è¾‘ç¾¤æˆå‘˜</span></div>
      <div class="modal-body">
        <div class="form-group"><label for="member-name-input">åå­—</label><input type="text" id="member-name-input"></div>
        <div class="form-group"><label for="member-persona-input">äººè®¾</label><textarea id="member-persona-input" rows="4"></textarea></div>
        <div class="form-group"><label>å¤´åƒ</label>
          <div class="avatar-upload"><img id="member-avatar-preview"><button onclick="document.getElementById('member-avatar-input').click()">ä¸Šä¼ å¤´åƒ</button><button class="change-frame-btn" data-type="member">æ›´æ¢å¤´åƒæ¡†</button><input type="file" id="member-avatar-input" accept="image/*"></div>
        </div>
      </div>
      <div class="modal-footer"><button class="cancel" id="cancel-member-settings-btn"data-lang-key="cancel">å–æ¶ˆ</button><button class="save" id="save-member-settings-btn"data-lang-key="save">ä¿å­˜</button></div>
    </div>
  </div>
  <div id="custom-modal-overlay">
    <div id="custom-modal">
      <div class="custom-modal-header" id="custom-modal-title"></div>
      <div class="custom-modal-body" id="custom-modal-body"></div>
      <div class="custom-modal-footer"> <button id="custom-modal-cancel"data-lang-key="cancel">å–æ¶ˆ</button> <button id="custom-modal-confirm" class="confirm-btn"data-lang-key="confirm">ç¡®å®š</button> </div>
    </div>
  </div>
  
  <!-- æ‰‹åŠ¨æ€»ç»“å¼¹çª— -->
  <div id="manual-summary-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 400px; width: 90%;">
      <div class="modal-header">
        <span>æ‰‹åŠ¨æ€»ç»“é•¿æœŸè®°å¿†</span>
        <span class="close-btn" id="manual-summary-close-btn" style="cursor: pointer; font-size: 24px;">&times;</span>
      </div>
      <div class="modal-body" style="padding: 20px;">
        <div class="form-group" style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 8px; color: #333;">é€‰æ‹©æ¶ˆæ¯èŒƒå›´</label>
          <div style="display: flex; gap: 10px; align-items: center;">
            <div style="flex: 1;">
              <label style="font-size: 12px; color: #666;">ä»ç¬¬</label>
              <input type="number" id="manual-summary-start" min="1" value="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 4px;">
            </div>
            <span style="color: #666;">åˆ°</span>
            <div style="flex: 1;">
              <label style="font-size: 12px; color: #666;">ç¬¬</label>
              <input type="number" id="manual-summary-end" min="1" value="20" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 4px;">
            </div>
            <span style="color: #666;">æ¡</span>
          </div>
          <div style="margin-top: 8px; font-size: 12px; color: #999;">
            å½“å‰èŠå¤©å…±æœ‰ <span id="manual-summary-total-count">0</span> æ¡æ¶ˆæ¯
          </div>
        </div>
      </div>
      <div class="modal-footer" style="padding: 15px; display: flex; gap: 10px; justify-content: flex-end;">
        <button id="manual-summary-cancel-btn" style="padding: 8px 20px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;">å–æ¶ˆ</button>
        <button id="manual-summary-confirm-btn" style="padding: 8px 20px; border: none; background: var(--accent-color); color: white; border-radius: 4px; cursor: pointer;">å¼€å§‹æ€»ç»“</button>
      </div>
    </div>
  </div>
  
  <div id="preset-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="preset-action-edit" data-lang-key="edit">ç¼–è¾‘é¢„è®¾</button> <button id="preset-action-delete" class="btn-danger">åˆ é™¤é¢„è®¾</button> <button id="preset-action-cancel" style="margin-top: 8px; border-radius: 8px; background-color: #f0f0f0;"data-lang-key="cancel">å–æ¶ˆ</button> </div>
    </div>
  </div>
  <div id="transfer-modal">
    <div class="transfer-content">
      <div class="transfer-header">ç»™Taä¸€ä¸ªæƒŠå–œï¼</div>
      <div class="transfer-input-group"> <label for="transfer-amount">è½¬è´¦é‡‘é¢</label> <input type="number" id="transfer-amount" placeholder="0.00" min="0" step="0.01"> </div>
      <div class="transfer-input-group"> <label for="transfer-note">å¤‡æ³¨ (å¯é€‰)</label> <input type="text" id="transfer-note" placeholder="ç•™ä¸‹ä½ çš„å°å¿ƒæ€~" maxlength="20"> </div>
      <div class="transfer-actions"> <button id="transfer-cancel-btn" data-lang-key="cancel">å–æ¶ˆ</button> <button id="transfer-confirm-btn">ç¡®è®¤è½¬è´¦</button> </div>
    </div>
  </div>
  <div id="battery-alert-modal">
    <div class="battery-alert-content"> <img id="battery-alert-image" src="">
      <p id="battery-alert-text"></p>
    </div>
  </div>
  <div id="waimai-request-modal" class="modal">
    <div class="modal-content" style="width: 290px;">
      <div class="modal-header"> <span>å‘èµ·å¤–å–è®¢å•</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label for="waimai-product-info">å•†å“ä¿¡æ¯</label> <input type="text" id="waimai-product-info" placeholder="ä¾‹å¦‚ï¼šä¸€æ¯æ¨æç”˜éœ²"> </div>
        <div class="form-group"> <label for="waimai-amount">è®¢å•é‡‘é¢ (å…ƒ)</label> <input type="number" id="waimai-amount" placeholder="ä¾‹å¦‚ï¼š21" min="0" step="0.01"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="waimai-order-for-ai-btn">ä¸ºTAç‚¹å•</button> <button class="save" id="waimai-confirm-btn">å‘èµ·è¯·æ±‚</button> </div>
    </div>
  </div>
  <div id="create-countdown-modal" class="modal">
    <div class="modal-content" style="height: auto;">
      <div class="modal-header"> <span>æ–°å»ºçº¦å®š</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label for="countdown-title-input">çº¦å®šæ ‡é¢˜</label> <input type="text" id="countdown-title-input" placeholder="ä¾‹å¦‚ï¼šæˆ‘çš„ç”Ÿæ—¥"> </div>
        <div class="form-group"> <label for="countdown-date-input">çº¦å®šæ—¥æœŸä¸æ—¶é—´</label> <input type="datetime-local" id="countdown-date-input"> </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-create-countdown-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="confirm-create-countdown-btn"data-lang-key="save">ä¿å­˜çº¦å®š</button> </div>
    </div>
  </div>
  <div id="red-packet-modal" class="modal">
    <div class="modal-content" style="width: 300px; height: auto;">
      <div class="modal-header"> <span>å‘çº¢åŒ…</span> </div>
      <div class="modal-body" style="padding: 0;">
        <div class="frame-tabs">
          <div id="rp-tab-group" class="frame-tab active">æ‹¼æ‰‹æ°”çº¢åŒ…</div>
          <div id="rp-tab-direct" class="frame-tab">ä¸“å±çº¢åŒ…</div>
        </div>
        <div id="rp-content-group" class="frame-content" style="padding: 20px 15px;">
          <div class="form-group"> <label>æ€»é‡‘é¢ (å…ƒ)</label> <input type="number" id="rp-group-amount" placeholder="0.00"> </div>
          <div class="form-group"> <label>çº¢åŒ…ä¸ªæ•°</label> <input type="number" id="rp-group-count" placeholder="å¡«å†™çº¢åŒ…ä¸ªæ•°"> </div>
          <div class="form-group"> <label>ç¥ç¦è¯­</label> <input type="text" id="rp-group-greeting" placeholder="æ­å–œå‘è´¢ï¼Œå¤§å‰å¤§åˆ©ï¼"> </div>
          <p id="rp-group-total" style="text-align: center; font-size: 24px; font-weight: bold; margin: 10px 0;">Â¥ 0.00</p> <button id="send-group-packet-btn" class="form-button">å¡é’±è¿›çº¢åŒ…</button>
        </div>
        <div id="rp-content-direct" class="frame-content" style="display: none; padding: 20px 15px;">
          <div class="form-group"> <label>å‘é€ç»™</label> <select id="rp-direct-receiver"></select> </div>
          <div class="form-group"> <label>é‡‘é¢ (å…ƒ)</label> <input type="number" id="rp-direct-amount" placeholder="0.00"> </div>
          <div class="form-group"> <label>ç¥ç¦è¯­</label> <input type="text" id="rp-direct-greeting" placeholder="æ­å–œå‘è´¢ï¼Œå¤§å‰å¤§åˆ©ï¼"> </div>
          <p id="rp-direct-total" style="text-align: center; font-size: 24px; font-weight: bold; margin: 10px 0;">Â¥ 0.00</p> <button id="send-direct-packet-btn" class="form-button">å¡é’±è¿›çº¢åŒ…</button>
        </div>
      </div>
      <div class="modal-footer" style="justify-content: center;"> <button class="cancel" id="cancel-red-packet-btn" style="width: 100%;"data-lang-key="cancel">å–æ¶ˆ</button> </div>
    </div>
  </div>
  <div id="red-packet-details-modal" class="modal">
    <div class="modal-content" style="width: 280px; height: auto; background-color: #f7f7f7;">
      <div class="modal-header" style="background-color: #F96259; color: white; border-bottom: none; padding-bottom: 5px;">
        <div style="text-align: center; width: 100%;">
          <div id="rp-details-sender" style="font-size: 16px;"></div>
          <div style="font-size: 13px; opacity: 0.8;">çš„çº¢åŒ…</div>
        </div>
      </div>
      <div class="modal-body" style="padding: 15px;">
        <p id="rp-details-greeting" style="text-align: center; font-size: 20px; color: #333; margin: 0 0 20px 0;"></p>
        <div id="rp-details-my-amount" style="text-align: center; display: none; margin-bottom: 20px;"> <span style="font-size: 40px; font-weight: bold; color: #E44D44;">0.00</span> <span style="font-size: 18px; color: #E44D44;">å…ƒ</span> </div>
        <div id="rp-details-summary" style="font-size: 13px; color: #8a8a8a; border-top: 1px solid #e0e0e0; padding-top: 10px;"></div>
        <div id="rp-details-list" style="max-height: 150px; overflow-y: auto; margin-top: 10px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-rp-details-btn" style="width: 100%;">å…³é—­</button> </div>
    </div>
  </div>
  <div id="create-poll-modal" class="modal">
    <div class="modal-content" style="width: 300px; height: auto;">
      <div class="modal-header"> <span>å‘èµ·æŠ•ç¥¨</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label for="poll-question-input">æŠ•ç¥¨é—®é¢˜</label> <textarea id="poll-question-input" rows="2" placeholder="ä¾‹å¦‚ï¼šä»Šæ™šæˆ‘ä»¬çœ‹ä»€ä¹ˆç”µå½±ï¼Ÿ"></textarea> </div>
        <div class="form-group"> <label>æŠ•ç¥¨é€‰é¡¹ (è‡³å°‘2é¡¹)</label>
          <div id="poll-options-container" style="display: flex; flex-direction: column; gap: 8px;"> </div> <button id="add-poll-option-btn" class="form-button form-button-secondary" style="margin-top: 12px;">+ æ·»åŠ é€‰é¡¹</button>
        </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-create-poll-btn" data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="confirm-create-poll-btn">å‘èµ·æŠ•ç¥¨</button> </div>
    </div>
  </div>
  <div id="ai-avatar-library-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span id="ai-avatar-library-title">å¯¹æ–¹çš„å¤´åƒåº“</span>
        <div class="header-actions"> <button id="add-ai-avatar-batch-btn" class="action-button">æ‰¹é‡</button> <button id="add-ai-avatar-url-btn" class="action-button">URL</button> <button id="add-ai-avatar-upload-btn" class="action-button">ä¸Šä¼ </button> </div>
      </div>
      <div class="modal-body" style="padding: 15px;">
        <div id="ai-avatar-library-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-ai-avatar-library-btn" style="width: 100%;">å…³é—­</button> </div>
    </div>
  </div>
  <div id="my-avatar-library-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span id="my-avatar-library-title">æˆ‘çš„å¤´åƒåº“</span>
        <div class="header-actions"> <button id="add-my-avatar-batch-btn" class="action-button">æ‰¹é‡</button> <button id="add-my-avatar-url-btn" class="action-button">URL</button> <button id="add-my-avatar-upload-btn" class="action-button">ä¸Šä¼ </button> </div>
      </div>
      <div class="modal-body" style="padding: 15px;">
        <div id="my-avatar-library-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-my-avatar-library-btn" style="width: 100%;">å…³é—­</button> </div>
    </div>
  </div>
  <div id="group-avatar-library-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span id="group-avatar-library-title">ç¾¤å¤´åƒåº“</span>
        <div class="header-actions"> <button id="add-group-avatar-batch-btn" class="action-button">æ‰¹é‡</button> <button id="add-group-avatar-url-btn" class="action-button">URL</button> <button id="add-group-avatar-upload-btn" class="action-button">ä¸Šä¼ </button> </div>
      </div>
      <div class="modal-body" style="padding: 15px;">
        <div id="group-avatar-library-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-group-avatar-library-btn" style="width: 100%;">å…³é—­</button> </div>
    </div>
  </div>
  <div id="chat-list-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="chat-list-action-pin"></button> <button id="chat-list-action-delete" class="btn-danger">åˆ é™¤èŠå¤©</button> <button id="chat-list-action-cancel" style="margin-top: 8px; border-radius: 8px; background-color: #f0f0f0;"data-lang-key="cancel">å–æ¶ˆ</button> </div>
    </div>
  </div>
  <div id="share-link-modal" class="modal">
    <div class="modal-content" style="width: 300px; height: auto;">
      <div class="modal-header"> <span>åˆ†äº«é“¾æ¥</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label for="link-title-input">æ ‡é¢˜</label> <input type="text" id="link-title-input" placeholder="è¾“å…¥æ–‡ç« æˆ–é“¾æ¥çš„æ ‡é¢˜"> </div>
        <div class="form-group"> <label for="link-description-input">æ‘˜è¦ (å¯é€‰)</label> <textarea id="link-description-input" rows="2" placeholder="ç®€å•æè¿°ä¸€ä¸‹é“¾æ¥å†…å®¹"></textarea> </div>
        <div class="form-group"> <label for="link-source-input">æ¥æºåç§° (å¯é€‰)</label> <input type="text" id="link-source-input" placeholder="ä¾‹å¦‚ï¼šçŸ¥ä¹æ—¥æŠ¥ã€Bç«™"> </div>
        <div class="form-group"> <label for="link-content-input">å®Œæ•´å†…å®¹ (å¯é€‰ï¼Œç”¨äºæµè§ˆå™¨å†…æ˜¾ç¤º)</label> <textarea id="link-content-input" rows="4" placeholder="ç²˜è´´æˆ–è¾“å…¥å®Œæ•´çš„æ–‡ç« å†…å®¹"></textarea> </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-share-link-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="confirm-share-link-btn">åˆ†äº«</button> </div>
    </div>
  </div>
  <div id="transfer-actions-modal" class="modal">
    <div class="transfer-actions-content">
      <div class="transfer-actions-header">è¯·é€‰æ‹©æ“ä½œ</div>
      <div class="transfer-actions-body">
        <p>ä½ æ”¶åˆ°äº†æ¥è‡ª <strong id="transfer-sender-name"></strong> çš„ä¸€ç¬”è½¬è´¦ã€‚</p>
      </div>
      <div class="transfer-actions-footer"> <button id="transfer-action-decline" class="action-btn decline">æ®‹å¿æ‹’ç»</button> <button id="transfer-action-accept" class="action-btn accept">å¼€å¿ƒæ”¶ä¸‹</button> </div> <button id="transfer-action-cancel" class="cancel-btn">Ã—</button>
    </div>
  </div>
  <div id="call-transcript-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span id="transcript-modal-title">é€šè¯è¯¦æƒ…</span> </div>
      <div class="modal-body" id="call-transcript-modal-body" style="background-color: #f0f2f5;"> </div>
      <div class="modal-footer"> <button class="cancel" id="delete-transcript-btn" style="background-color: #ff3b30; color: white; border-color: #ff3b30;">åˆ é™¤è®°å½•</button> <button class="save" id="manual-summarize-btn" style="background-color: #ffc107; border-color: #ffc107;">æ‰‹åŠ¨æ€»ç»“</button>
        <button class="save" id="close-call-transcript-btn" style="width: 100%;">å…³é—­</button>
      </div>
    </div>
  </div>
  <div id="share-target-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>åˆ†äº«åˆ°...</span> </div>
      <div class="modal-body" id="share-target-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-share-target-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="confirm-share-target-btn">ç¡®è®¤åˆ†äº«</button> </div>
    </div>
  </div>
  <div id="forward-target-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>è½¬å‘åˆ°...</span> </div>
      <div class="modal-body" id="forward-target-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-forward-target-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="confirm-forward-target-btn">ç¡®è®¤è½¬å‘</button> </div>
    </div>
  </div>
  <div id="shared-history-viewer-modal" class="modal">
    <div class="modal-content" style="height: 80%;">
      <div class="modal-header"> <span id="shared-history-viewer-title">èŠå¤©è®°å½•</span> </div>
      <div class="modal-body" id="shared-history-viewer-content" style="background-color: #f0f2f5;"> </div>
      <div class="modal-footer"> <button class="save" id="close-shared-history-viewer-btn" style="width:100%;">å…³é—­</button> </div>
    </div>
  </div>
  <div id="world-book-category-manager-modal" class="modal">
    <div class="modal-content" style="height: 60%;">
      <div class="modal-header"> <span>ç®¡ç†ä¸–ç•Œä¹¦åˆ†ç±»</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label>æ–°å»ºåˆ†ç±»</label>
          <div style="display: flex; gap: 10px;"> <input type="text" id="new-category-name-input" placeholder="è¾“å…¥åˆ†ç±»å..." style="flex-grow: 1;"> <button id="add-new-category-btn" class="form-button" style="width: auto; margin-top: 0; padding: 0 15px;"data-lang-key="add">æ·»åŠ </button> </div>
        </div>
        <hr style="opacity: 0.2;">
        <div id="existing-categories-list" style="display: flex; flex-direction: column; gap: 10px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-category-manager-btn" style="width: 100%;"data-lang-key="done">å®Œæˆ</button> </div>
    </div>
  </div>
  <div id="announcement-board-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"> <span>ç¾¤å…¬å‘Šæ¿</span> </div>
      <div id="announcement-board-content"> </div>
      <div class="modal-footer"> <button class="save" id="close-announcement-board-btn" style="width: 100%;">å…³é—­</button> </div>
    </div>
  </div>
  <div id="announcement-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="announcement-action-pin">ç½®é¡¶å…¬å‘Š</button> <button id="announcement-action-delete" class="btn-danger">åˆ é™¤å…¬å‘Š</button> <button id="announcement-action-cancel" style="margin-top: 8px; border-radius: 8px; background-color: #f0f0f0;"data-lang-key="cancel">å–æ¶ˆ</button> </div>
    </div>
  </div>
  <div id="truth-game-modal" class="modal">
    <div class="modal-content" style="height: 85%; max-width: 600px; display: flex; flex-direction: column;">
      <div class="modal-header" style="position: relative; border-bottom: 1px solid #e0e0e0; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between;">
        <span style="font-size: 16px; font-weight: 500;">çœŸå¿ƒè¯</span>
        <div style="display: flex; gap: 10px; align-items: center;">
          <button id="truth-game-settings-btn" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #999; line-height: 1; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">âš™</button>
          <button id="minimize-truth-game-btn" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999; line-height: 1; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">âˆ’</button>
          <button id="close-truth-game-btn" style="background: none; border: none; font-size: 28px; cursor: pointer; color: #999; line-height: 1; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">Ã—</button>
        </div>
      </div>
      <div class="modal-body" style="flex: 1; overflow-y: auto; background-color: #f5f5f5; padding: 0; display: flex; flex-direction: column;">
        <div id="truth-game-messages" style="flex: 1; overflow-y: auto; padding: 15px;"></div>
      </div>
      <div id="truth-game-input-area" style="background: #fff; border-top: 1px solid #e0e0e0; padding: 10px 15px;">
        <div id="truth-rps-selector" style="display: none; gap: 8px; margin-bottom: 10px;">
          <button class="truth-rps-btn" data-choice="rock" style="flex: 1; padding: 10px; background: #fff; border: 1px solid #d0d0d0; border-radius: 4px; cursor: pointer; font-size: 14px; color: #333;">çŸ³å¤´</button>
          <button class="truth-rps-btn" data-choice="scissors" style="flex: 1; padding: 10px; background: #fff; border: 1px solid #d0d0d0; border-radius: 4px; cursor: pointer; font-size: 14px; color: #333;">å‰ªåˆ€</button>
          <button class="truth-rps-btn" data-choice="paper" style="flex: 1; padding: 10px; background: #fff; border: 1px solid #d0d0d0; border-radius: 4px; cursor: pointer; font-size: 14px; color: #333;">å¸ƒ</button>
        </div>
        <div style="display: flex; gap: 10px; align-items: flex-end; flex-wrap: wrap;">
          <textarea id="truth-input" rows="1" placeholder="è¾“å…¥æ¶ˆæ¯..." style="flex: 1 1 100%; padding: 10px; border: 1px solid #d0d0d0; border-radius: 4px; resize: none; font-size: 14px; min-height: 40px; max-height: 100px; min-width: 0;"></textarea>
          <div id="truth-game-buttons" style="display: flex; gap: 8px; flex: 1 1 100%;">
            <button id="truth-start-game-btn" style="flex: 1; padding: 10px 12px; background: #ff9500; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; color: white; white-space: nowrap;">å¼€å§‹æ¸¸æˆ</button>
            <button id="truth-call-api-btn" style="flex: 1; padding: 10px 12px; background: #fff; border: 1px solid #d0d0d0; border-radius: 4px; cursor: pointer; font-size: 14px; color: #333; white-space: nowrap;">è°ƒç”¨API</button>
            <button id="truth-send-btn" style="flex: 1; padding: 10px 12px; background: #07c160; border: none; border-radius: 4px; cursor: pointer; color: white; font-size: 14px; white-space: nowrap;">å‘é€</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="truth-game-settings-modal" class="modal">
    <div class="modal-content" style="width: 350px; height: auto;">
      <div class="modal-header">
        <span>çœŸå¿ƒè¯è®¾ç½®</span>
      </div>
      <div class="modal-body" style="padding: 20px;">
        <div class="form-group">
          <label>AIå‚è€ƒå†å²è½®æ•°</label>
          <input type="number" id="truth-history-limit-input" min="1" value="5" style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
          <p style="font-size: 12px; color: #999; margin-top: 5px;">é™åˆ¶AIå‚è€ƒçš„å†å²è½®æ•°ï¼Œé¿å…tokenè¿‡å¤§ã€‚å»ºè®®è®¾ç½®ä¸º5-20è½®ï¼Œè®¾ç½®è¿‡å¤§ä¼šæ¶ˆè€—æ›´å¤štokenã€‚å®Œæ•´è®°å½•ä»ä¼šä¿å­˜åˆ°èŠå¤©å†å²ã€‚</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-truth-settings-btn">å–æ¶ˆ</button>
        <button class="save" id="save-truth-settings-btn">ä¿å­˜</button>
      </div>
    </div>
  </div>
  <div id="truth-game-float-ball" style="display: none;">
    <img id="truth-game-float-avatar" src="" alt="è§’è‰²å¤´åƒ">
    <div id="truth-game-float-indicator"></div>
  </div>
  <div id="watch-together-modal" class="modal">
    <div id="watch-together-container">
      <div id="watch-together-header">
        <span style="font-size: 16px; font-weight: 500;">ä¸€èµ·çœ‹ç”µå½±</span>
        <div style="display: flex; gap: 10px; align-items: center;">
          <button id="watch-together-playlist-btn" style="font-size: 16px;">æ’­æ”¾åˆ—è¡¨</button>
          <button id="watch-together-settings-btn" style="font-size: 16px;">è®¾ç½®</button>
          <button id="watch-together-upload-btn" style="font-size: 20px; font-weight: bold;">+</button>
          <button id="close-watch-together-btn" style="font-size: 24px;">Ã—</button>
        </div>
      </div>
      <div id="watch-together-main">
        <div id="watch-together-video-container">
          <video id="watch-together-video" controls></video>
          <div id="watch-together-placeholder">
            <p>ç‚¹å‡»å³ä¸Šè§’"+"ä¸Šä¼ è§†é¢‘å¼€å§‹è§‚çœ‹</p>
          </div>
        </div>
        <div id="watch-together-chat-float">
          <div id="watch-together-chat-header">
            <span id="watch-together-chat-name"></span>
            <button id="watch-together-chat-toggle">-</button>
          </div>
          <div id="watch-together-chat-messages"></div>
          <div id="watch-together-chat-input-area">
            <textarea id="watch-together-chat-input" rows="1" placeholder="è¾“å…¥æ¶ˆæ¯..."></textarea>
            <button id="watch-together-call-api-btn">è°ƒç”¨API</button>
            <button id="watch-together-chat-send">å‘é€</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="watch-together-upload-modal" class="modal" style="z-index: 10001;">
    <div class="modal-content" style="width: 400px; height: auto;">
      <div class="modal-header">
        <span>ä¸Šä¼ è§†é¢‘</span>
      </div>
      <div class="modal-body" style="padding: 20px;">
        <div style="display: flex; flex-direction: column; gap: 15px;">
          <button id="watch-together-upload-local" style="padding: 15px; background: #fff; border: 1px solid #d0d0d0; border-radius: 4px; cursor: pointer; font-size: 14px;">æœ¬åœ°ä¸Šä¼ </button>
          <button id="watch-together-upload-url" style="padding: 15px; background: #fff; border: 1px solid #d0d0d0; border-radius: 4px; cursor: pointer; font-size: 14px;">URLä¸Šä¼ </button>
          <button id="watch-together-search-online" style="padding: 15px; background: #fff; border: 1px solid #d0d0d0; border-radius: 4px; cursor: pointer; font-size: 14px;">åœ¨çº¿æœç´¢å½±è§†</button>
        </div>
        <input type="file" id="watch-together-file-input" accept="video/*" style="display: none;">
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-watch-together-upload-btn">å–æ¶ˆ</button>
      </div>
    </div>
  </div>
  <div id="watch-together-url-modal" class="modal" style="z-index: 10001;">
    <div class="modal-content" style="width: 450px; height: auto;">
      <div class="modal-header">
        <span>è¾“å…¥è§†é¢‘URL</span>
      </div>
      <div class="modal-body" style="padding: 20px;">
        <input type="text" id="watch-together-url-input" placeholder="è¾“å…¥è§†é¢‘URL..." style="width: 100%; padding: 10px; border: 1px solid #d0d0d0; border-radius: 4px; font-size: 14px;">
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-watch-together-url-btn">å–æ¶ˆ</button>
        <button class="save" id="confirm-watch-together-url-btn">ç¡®å®š</button>
      </div>
    </div>
  </div>
  <div id="watch-together-search-modal" class="modal" style="z-index: 10002;">
    <div class="modal-content" style="width: 800px; height: 600px; max-width: 90vw; max-height: 90vh;">
      <div class="modal-header">
        <span>åœ¨çº¿æœç´¢å½±è§†</span>
      </div>
      <div class="modal-body" style="padding: 20px; display: flex; flex-direction: column; height: calc(100% - 100px);">
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
          <input type="text" id="watch-together-search-input" placeholder="è¾“å…¥å½±ç‰‡åç§°æœç´¢..." style="flex: 1; padding: 10px; border: 1px solid #d0d0d0; border-radius: 4px; font-size: 14px;">
          <button id="watch-together-search-btn" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 500;">æœç´¢</button>
        </div>
        <div id="watch-together-search-status" style="margin-bottom: 10px; color: #666; font-size: 13px; min-height: 20px;"></div>
        <div id="watch-together-search-results" style="flex: 1; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 4px; padding: 10px;">
          <div style="text-align: center; color: #999; padding: 40px;">åœ¨ä¸Šæ–¹è¾“å…¥å½±ç‰‡åç§°å¼€å§‹æœç´¢</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-watch-together-search-btn">å–æ¶ˆ</button>
      </div>
    </div>
  </div>
  <div id="watch-together-playlist-modal" class="modal" style="z-index: 10001;">
    <div class="modal-content" style="width: 600px; max-width: 90vw; height: 70vh;">
      <div class="modal-header">
        <span>æ’­æ”¾åˆ—è¡¨</span>
        <button id="close-watch-together-playlist-btn" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">Ã—</button>
      </div>
      <div class="modal-body" style="padding: 15px; overflow-y: auto;">
        <div id="watch-together-playlist-list" style="display: flex; flex-direction: column; gap: 10px;">
          <p style="text-align: center; color: #999; padding: 40px;">æš‚æ— è§†é¢‘ï¼Œä¸Šä¼ è§†é¢‘åå¯ä¿å­˜åˆ°åˆ—è¡¨</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-watch-together-playlist-btn">å…³é—­</button>
      </div>
    </div>
  </div>
  <div id="watch-together-save-video-modal" class="modal" style="z-index: 10002;">
    <div class="modal-content" style="width: 400px; height: auto;">
      <div class="modal-header">
        <span>ä¿å­˜è§†é¢‘åˆ°æ’­æ”¾åˆ—è¡¨</span>
      </div>
      <div class="modal-body" style="padding: 20px;">
        <div class="form-group">
          <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">è§†é¢‘åç§°</label>
          <input type="text" id="watch-together-video-name-input" placeholder="è¾“å…¥è§†é¢‘åç§°..." style="width: 100%; padding: 10px; border: 1px solid #d0d0d0; border-radius: 4px; font-size: 14px;">
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-save-video-btn">å–æ¶ˆ</button>
        <button class="save" id="confirm-save-video-btn">ä¿å­˜</button>
      </div>
    </div>
  </div>
  <div id="watch-together-settings-modal" class="modal" style="z-index: 10001;">
    <div class="modal-content" style="width: 450px; height: auto;">
      <div class="modal-header">
        <span>è§‚å½±è®¾ç½®</span>
      </div>
      <div class="modal-body" style="padding: 20px;">
        <div class="form-group" style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">èŠå¤©æ¨¡å¼</label>
          <select id="watch-together-mode-select" style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
            <option value="online">çº¿ä¸Šæ¨¡å¼ï¼ˆAIå¯å‘é€å¤šæ¡æ¶ˆæ¯ï¼‰</option>
            <option value="offline">çº¿ä¸‹æ¨¡å¼ï¼ˆå•æ¡é•¿æ–‡æœ¬ï¼‰</option>
          </select>
          <p style="font-size: 12px; color: #999; margin-top: 5px;">çº¿ä¸Šæ¨¡å¼ç±»ä¼¼æ™®é€šèŠå¤©ï¼ŒAIå¯ä»¥å‘é€å¤šæ¡æ¶ˆæ¯ï¼›çº¿ä¸‹æ¨¡å¼AIåªå‘é€ä¸€æ¡å®Œæ•´å›å¤</p>
        </div>
        <div class="form-group" style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">æˆªå›¾é—´éš” (ç§’)</label>
          <input type="number" id="watch-together-interval-input" min="1" max="60" value="5" style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
          <p style="font-size: 12px; color: #999; margin-top: 5px;">å®šæ—¶æˆªå–è§†é¢‘ç”»é¢å‘é€ç»™AIï¼Œå¸®åŠ©AIç†è§£è§†é¢‘å†…å®¹</p>
        </div>
        <div class="form-group" style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">è¯­éŸ³è¯†åˆ«</label>
          <select id="watch-together-speech-api-select" style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
            <option value="none">ä¸è¯†åˆ«è§†é¢‘éŸ³é¢‘</option>
            <option value="whisper">Whisper API</option>
          </select>
        </div>
        <div id="watch-together-whisper-config" style="display: none;">
          <div class="form-group" style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">Whisper API Key</label>
            <input type="text" id="watch-together-whisper-key" placeholder="sk-..." style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
          </div>
          <div class="form-group" style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">Whisper API URL</label>
            <input type="text" id="watch-together-whisper-url" placeholder="https://api.openai.com/v1/audio/transcriptions" style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
          </div>
        </div>
        <div class="form-group" style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">è®°ä½å†å²æˆªå›¾æ•°é‡</label>
          <input type="number" id="watch-together-max-screenshots" min="1" max="50" value="10" style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
          <p style="font-size: 12px; color: #999; margin-top: 5px;">AIèƒ½è®°ä½çš„å†å²æˆªå›¾æ•°é‡ï¼Œè¶…å‡ºéƒ¨åˆ†å°†è¢«åˆ é™¤</p>
        </div>
        <div class="form-group" style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">è®°ä½å†å²å£°éŸ³æ•°é‡</label>
          <input type="number" id="watch-together-max-audios" min="1" max="50" value="10" style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
          <p style="font-size: 12px; color: #999; margin-top: 5px;">AIèƒ½è®°ä½çš„å†å²è¯­éŸ³è¯†åˆ«æ•°é‡ï¼Œè¶…å‡ºéƒ¨åˆ†å°†è¢«åˆ é™¤</p>
        </div>
        <div class="form-group" style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-size: 14px; color: #333;">è®°ä½æœ€è¿‘å¯¹è¯æ¡æ•°</label>
          <input type="number" id="watch-together-max-messages" min="5" max="100" value="20" style="width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px;">
          <p style="font-size: 12px; color: #999; margin-top: 5px;">AIèƒ½è®°ä½çš„æœ€è¿‘å¯¹è¯è®°å½•æ•°é‡ï¼Œè¶…å‡ºéƒ¨åˆ†å°†è¢«åˆ é™¤</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-watch-together-settings-btn">å–æ¶ˆ</button>
        <button class="save" id="save-watch-together-settings-btn">ä¿å­˜</button>
      </div>
    </div>
  </div>
  <div id="group-management-modal" class="modal">
    <div class="modal-content" style="height: 60%;">
      <div class="modal-header"> <span>ç®¡ç†å¥½å‹åˆ†ç»„</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label>æ–°å»ºåˆ†ç»„</label>
          <div style="display: flex; gap: 10px;"> <input type="text" id="new-group-name-input" placeholder="è¾“å…¥åˆ†ç»„å..." style="flex-grow: 1;"> <button id="add-new-group-btn" class="form-button" style="width: auto; margin-top: 0; padding: 0 15px;"data-lang-key="add">æ·»åŠ </button> </div>
        </div>
        <hr style="opacity: 0.2;">
        <div id="existing-groups-list" style="display: flex; flex-direction: column; gap: 10px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-group-manager-btn" style="width: 100%;"data-lang-key="done">å®Œæˆ</button> </div>
    </div>
  </div>
  <div id="message-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="edit-message-btn" data-lang-key="edit">ç¼–è¾‘æ¶ˆæ¯</button> <button id="copy-message-btn">å¤åˆ¶æ–‡æœ¬</button> <button id="copy-timestamp-btn">å¤åˆ¶æ—¶é—´æˆ³</button> <button id="recall-message-btn">æ’¤å›</button> <button id="publish-to-announcement-btn" style="display: none;">å‘å¸ƒåˆ°å…¬å‘Šæ¿</button>
        <button id="translate-message-btn">ç¿»è¯‘</button> <button id="quote-message-btn">å¼•ç”¨</button> <button id="forward-message-btn">è½¬å‘</button> <button id="select-message-btn">è¿›å…¥å¤šé€‰</button> <button id="cancel-message-action-btn" style="margin-top: 8px; border-radius: 8px; background-color: #f0f0f0;"data-lang-key="cancel">å–æ¶ˆ</button> </div>
    </div>
  </div>
  <div id="post-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="edit-post-btn" data-lang-key="edit">ç¼–è¾‘åŠ¨æ€</button> <button id="copy-post-btn">å¤åˆ¶å†…å®¹</button> <button id="cancel-post-action-btn"data-lang-key="cancel">å–æ¶ˆ</button> </div>
    </div>
  </div>
  <div id="message-editor-modal" class="modal">
    <div class="modal-content" style="height: 75%;">
      <div class="modal-header"> <span data-lang-key="edit">ç¼–è¾‘ä¸æ‹†åˆ†æ¶ˆæ¯</span> </div>
      <div class="modal-body" id="message-editor-body">
        <div id="message-editor-container"></div> <button id="add-message-editor-block-btn" class="form-button form-button-secondary" style="margin-top: 15px;"> [+] æ·»åŠ ä¸‹ä¸€æ¡æ¶ˆæ¯ </button>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-advanced-editor-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="save-advanced-editor-btn"data-lang-key="save">ä¿å­˜æ›´æ”¹</button> </div>
    </div>
  </div>
  <div id="ai-response-editor-modal" class="modal">
    <div class="modal-content" style="height: 80%;">
      <div class="modal-header"> <span>å¯¼æ¼”å‰ªè¾‘å®¤ (AIä¸Šä¸€è½®å“åº”)</span> </div>
      <div class="modal-body" id="ai-response-editor-body">
        <div id="ai-response-editor-container" style="display: flex; flex-direction: column; gap: 15px;"></div> <button id="add-ai-response-block-btn" class="form-button form-button-secondary" style="margin-top: 15px;"> [+] æ·»åŠ ä¸€ä¸ªæ–°åŠ¨ä½œ </button>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-ai-response-editor-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="save-ai-response-editor-btn">åº”ç”¨ä¿®æ”¹</button> </div>
    </div>
  </div>
  <div id="repost-modal" class="modal">
    <div id="custom-modal" style="width: 280px;">
      <div class="custom-modal-header">è½¬å‘åŠ¨æ€</div>
      <div class="custom-modal-body"> <textarea id="repost-comment-input" placeholder="è¯·è¾“å…¥è½¬å‘è¯„è®º (å¯é€‰)" style="width: 100%; min-height: 60px; resize: vertical; border: 1px solid #ccc; border-radius: 6px; padding: 8px; font-size: 16px; box-sizing: border-box;"></textarea> </div>
      <div class="custom-modal-footer"> <button id="repost-cancel-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button id="repost-confirm-btn" class="confirm-btn"data-lang-key="confirm">ç¡®å®š</button> </div>
    </div>
  </div>
  <div id="call-message-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="edit-call-message-btn"data-lang-key="edit">ç¼–è¾‘</button> <button id="delete-call-message-btn" class="btn-danger">åˆ é™¤</button> <button id="cancel-call-message-action-btn" style="margin-top: 8px; border-radius: 8px; background-color: #f0f0f0;"data-lang-key="cancel">å–æ¶ˆ</button> </div>
    </div>
  </div> <audio id="audio-player" style="display:none;"></audio>
  <!-- æ‰¹é‡ç®¡ç†æ’é™¤æ¶ˆæ¯å¼¹çª— -->
  <div id="batch-exclude-modal" class="modal">
    <div class="modal-content" style="height: 85%;">
      <div class="modal-header">
        <span>æ‰¹é‡ç®¡ç†æ’é™¤æ¶ˆæ¯</span>
      </div>
      <div style="padding: 8px 15px; display: flex; gap: 8px; flex-wrap: wrap; align-items: center; border-bottom: 1px solid var(--border-color, #eee);">
        <button id="batch-exclude-select-all" style="padding: 5px 10px; border: 1px solid #ccc; border-radius: 6px; background: #f5f5f5; font-size: 12px; cursor: pointer;">å…¨é€‰</button>
        <button id="batch-exclude-deselect-all" style="padding: 5px 10px; border: 1px solid #ccc; border-radius: 6px; background: #f5f5f5; font-size: 12px; cursor: pointer;">å–æ¶ˆå…¨é€‰</button>
        <button id="batch-exclude-select-range" style="padding: 5px 10px; border: 1px solid #ccc; border-radius: 6px; background: #f5f5f5; font-size: 12px; cursor: pointer;">æŒ‰èŒƒå›´é€‰æ‹©</button>
        <span id="batch-exclude-selected-count" style="font-size: 12px; color: #8a8a8a; margin-left: auto;">å·²é€‰ 0 æ¡</span>
      </div>
      <div class="modal-body" id="batch-exclude-list" style="padding: 0; overflow-y: auto;">
        <!-- æ¶ˆæ¯åˆ—è¡¨åŠ¨æ€ç”Ÿæˆ -->
      </div>
      <div class="modal-footer" style="flex-wrap: wrap; gap: 6px;">
        <button class="cancel" id="batch-exclude-cancel-btn">å…³é—­</button>
        <button id="batch-exclude-action-btn" style="background: var(--accent-color); color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer;">æ’é™¤é€‰ä¸­</button>
        <button id="batch-include-action-btn" style="background: #34c759; color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer;">æ¢å¤é€‰ä¸­</button>
      </div>
    </div>
  </div>
  <!-- æ’é™¤è¯¦æƒ…å¼¹çª— -->
  <div id="excluded-detail-modal" class="modal">
    <div class="modal-content" style="height: 75%;">
      <div class="modal-header">
        <span>æ’é™¤è¯¦æƒ…</span>
      </div>
      <div class="modal-body" id="excluded-detail-list" style="padding: 0; overflow-y: auto;">
      </div>
      <div class="modal-footer">
        <button class="cancel" id="excluded-detail-close-btn">å…³é—­</button>
      </div>
    </div>
  </div>
  <!-- Tokenè¯¦æƒ…å¼¹çª— -->
  <div id="token-breakdown-modal" class="modal">
    <div class="modal-content" style="height: auto; max-height: 80%;">
      <div class="modal-header">
        <span>Token å ç”¨è¯¦æƒ…</span>
      </div>
      <div class="modal-body" id="token-breakdown-body" style="padding: 0; overflow-y: auto;">
      </div>
      <div class="modal-footer">
        <button class="cancel" id="token-breakdown-close-btn">å…³é—­</button>
      </div>
    </div>
  </div>
  <div id="create-post-modal" class="modal">
    <div class="modal-content" style="height: auto; max-height: 90%;">
      <div class="modal-header"> <span>å‘å¸ƒåŠ¨æ€</span> </div>
      <div class="modal-body">
        <div class="form-group"> <textarea id="post-public-text" rows="3" placeholder="åˆ†äº«æ–°é²œäº‹...ï¼ˆéå¿…å¡«çš„å…¬å¼€æ–‡å­—ï¼‰"></textarea> </div>
        <div class="post-mode-switcher"> <button id="switch-to-image-mode" class="mode-btn active">ä¸Šä¼ å›¾ç‰‡</button> <button id="switch-to-text-image-mode" class="mode-btn">ä½¿ç”¨æ–‡å­—å›¾</button> </div>
        <div class="form-group"> <label>å¯è§èŒƒå›´</label>
          <div id="post-visibility-options" style="display: flex; gap: 15px; margin-bottom: 10px;"> <label><input type="radio" name="visibility" value="public" checked> å…¬å¼€</label> <label><input type="radio" name="visibility" value="include"> æŒ‡å®šåˆ†ç»„å¯è§</label> </div>
          <div id="post-visibility-groups" style="display: none; max-height: 120px; overflow-y: auto; background: #f9f9f9; padding: 10px; border-radius: 8px;"> </div>
        </div>
        <div id="image-mode-content" class="post-mode-content active">
          <div class="form-group">
            <div id="post-image-preview-container" class="post-image-preview-container"> <img id="post-image-preview" src="" alt="å›¾ç‰‡é¢„è§ˆ"> <button id="post-remove-image-btn">Ã—</button> </div>
            <div class="post-image-upload-options"> <button id="post-upload-local-btn" class="form-button-secondary">æœ¬åœ°ä¸Šä¼ </button> <button id="post-use-url-btn" class="form-button-secondary">ç½‘ç»œURL</button> <input type="file" id="post-local-image-input" accept="image/*" hidden> </div>
          </div>
          <div id="post-image-desc-group" class="form-group" style="display: none;"> <label>å›¾ç‰‡æè¿° (å¿…å¡«ï¼Œç»™AIçœ‹)</label> <input type="text" id="post-image-description" placeholder="ç®€å•æè¿°å›¾ç‰‡å†…å®¹ï¼Œå¸®åŠ©AIç†è§£"> </div>
        </div>
        <div id="text-image-mode-content" class="post-mode-content">
          <div class="form-group"> <label>æ–‡å­—å›¾ (ç»™AIç†è§£ç”¨çš„æè¿°ï¼Œç‚¹å‡»å›¾ç‰‡åå¯è§)</label> <textarea id="post-hidden-text" rows="4" placeholder="åœ¨è¿™é‡Œå†™ä¸‹å›¾ç‰‡æè¿°..."></textarea> </div>
        </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-create-post-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="confirm-create-post-btn">å‘å¸ƒ</button> </div>
    </div>
  </div> <input type="file" id="ai-avatar-upload-input" accept="image/*" hidden> <input type="file" id="group-avatar-upload-input" accept="image/*" hidden>
  <div id="qzone-sticker-panel">
    <div id="qzone-sticker-grid"></div>
  </div>
  <div id="avatar-frame-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"> <span>é€‰æ‹©å¤´åƒæ¡†</span>
        <div class="header-actions"> <button id="manage-frames-btn" class="action-button">ç®¡ç†</button> <button id="upload-custom-frame-btn" class="action-button">ä¸Šä¼ </button> <button id="batch-import-frames-btn" class="action-button">æ‰¹é‡</button> </div>
      </div>
      <div class="modal-body">
        <div class="frame-tabs">
          <div id="ai-frame-tab" class="frame-tab active">å¯¹æ–¹çš„</div>
          <div id="my-frame-tab" class="frame-tab">æˆ‘çš„</div>
        </div>
        <div id="ai-frame-content" class="frame-content">
          <div id="ai-frame-grid" class="frame-grid"> </div>
        </div>
        <div id="my-frame-content" class="frame-content" style="display: none;">
          <div id="my-frame-grid" class="frame-grid"> </div>
        </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-frame-settings-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="save-frame-settings-btn"data-lang-key="save">ä¿å­˜</button> </div>
      <div id="frame-action-bar" style="display: none;"> <label class="select-all-label" style="display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-frames-checkbox"> å…¨é€‰ </label> <button id="delete-selected-frames-btn" class="action-bar-btn">åˆ é™¤ (0)</button>
      </div>
    </div>
  </div><input type="file" id="custom-frame-upload-input" accept="image/*" hidden>
  <div id="character-profile-modal" class="modal">
    <div class="character-profile-content"> <div style="position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 10;">
        <button id="profile-edit-btn" title="ç¼–è¾‘å½“å‰å¿ƒå£°" class="profile-history-icon-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
        </button>
        <button id="profile-history-icon-btn" title="æŸ¥çœ‹å†å²å¿ƒå£°" class="profile-history-icon-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
          </svg>
        </button>
      </div>
      <div id="profile-main-content">
        <div id="profile-timestamp" class="thought-header"></div>
        <div class="thought-content">
          <div class="voice">
            <div class="label"> <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
              </svg> å¿ƒå£° </div>
            <p id="profile-heartfelt-voice" class="text"></p>
          </div>
          <div class="jottings">
            <div class="label"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                <path d="M2 2l7.586 7.586"></path>
              </svg> æ•£è®° </div>
            <p id="profile-random-jottings" class="text"></p>
          </div>
        </div>
      </div>
      <div id="profile-thoughts-history-view">
        <div class="profile-header"> <span>å¿ƒå£°è®°å½•</span> <button id="history-back-btn" title="è¿”å›"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg> </button> </div>
        <div id="thoughts-history-list"></div>
      </div>
    </div>
  </div> <input type="file" id="my-avatar-upload-input" accept="image/*" hidden>
  <div id="gift-recipient-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>é€‰æ‹©æ”¶ç¤¼äºº</span> <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-recipients"> å…¨é€‰ </label> </div>
      <div class="modal-body" id="gift-recipient-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-gift-recipient-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="confirm-gift-recipient-btn">ç¡®è®¤é€å‡º</button> </div>
    </div>
  </div> <audio id="notification-sound-player" preload="auto"></audio>
  <div id="music-search-results-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>æœç´¢ç»“æœ</span> <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-music-search"> å…¨é€‰ </label> </div>
      <div class="modal-body" id="search-results-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-music-search-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="add-selected-music-btn"data-lang-key="add">æ·»åŠ é€‰ä¸­</button> </div>
    </div>
  </div>
  <div id="cleaned-songs-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>è¢«æ¸…ç†çš„æ­Œæ›²</span> <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-cleaned-songs"> å…¨é€‰ </label> </div>
      <div class="modal-body" id="cleaned-songs-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="close-cleaned-songs-btn">å…³é—­</button> <button class="save" id="research-selected-songs-btn">é‡æ–°æœç´¢é€‰ä¸­</button> </div>
    </div>
  </div>
  <div id="douban-settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"> <span>è±†ç“£è®¾ç½®</span> </div>
      <div class="modal-body">
        <div class="form-group douban-settings-item"> <label for="douban-min-posts-input"> æ¯æ¬¡ç”Ÿæˆå¸–å­æ•°èŒƒå›´ <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> è®¾ç½®AIåœ¨è±†ç“£é¡µé¢ä¸€æ¬¡æ€§ç”Ÿæˆå¸–å­çš„æœ€å°å’Œæœ€å¤§æ•°é‡ã€‚ </p> </label>
          <div class="douban-settings-controls"> <input type="number" id="douban-min-posts-input" min="1" value="12"> <span>åˆ°</span> <input type="number" id="douban-max-posts-input" min="1" value="20"> <span>ç¯‡</span> </div>
        </div>
        <hr style="opacity: 0.2; margin: 15px 0;">
        <div class="form-group douban-settings-item">
          <label> å¸–å­ç®¡ç† <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> å¯ä»¥é€‰æ‹©æ€§åˆ é™¤å·²ç”Ÿæˆçš„è±†ç“£å¸–å­ã€‚ </p> </label>
        </div>
        <button class="save" id="manage-douban-posts-btn" style="width: calc(100% - 40px); margin: 0 20px 15px 20px; padding: 10px; font-size: 14px;">ç®¡ç†è±†ç“£å¸–å­</button>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-douban-settings-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="save-douban-settings-btn"data-lang-key="save">ä¿å­˜</button> </div>
    </div>
  </div><audio id="char-audio-player" preload="auto"></audio>
  <div id="douban-cast-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>é€‰æ‹©å‚ä¸è±†ç“£çš„è§’è‰²</span> </div>
      <div class="modal-body" id="douban-cast-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-douban-cast-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="save-douban-cast-btn"data-lang-key="save">ä¿å­˜å¹¶åˆ·æ–°</button> </div>
    </div>
  </div>
  <div id="delete-douban-posts-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>é€‰æ‹©è¦åˆ é™¤çš„è±†ç“£å¸–å­</span> <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-douban-posts"> å…¨é€‰ </label> </div>
      <div class="modal-body" id="delete-douban-posts-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-delete-douban-posts-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save btn-danger" id="confirm-delete-douban-posts-btn">ç¡®è®¤åˆ é™¤</button> </div>
    </div>
  </div><input type="file" id="import-preset-input" accept=".json" hidden>
  <div id="update-notice-modal">
    <div class="update-notice-content">
      <div class="update-notice-body" id="update-notice-body"> </div>
      <div class="update-notice-footer"> <button id="update-notice-confirm-btn">æˆ‘çŸ¥é“äº†</button> <button id="update-notice-dismiss-btn">ä¸å†æç¤º</button> </div>
    </div>
  </div>
  <div id="delete-world-books-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>é€‰æ‹©è¦åˆ é™¤çš„ä¸–ç•Œä¹¦</span> <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-world-books-for-clear"> å…¨é€‰ </label> </div>
      <div class="modal-body" id="delete-world-books-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-delete-world-books-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save btn-danger" id="confirm-delete-world-books-btn">ç¡®è®¤åˆ é™¤</button> </div>
    </div>
  </div>
  <div id="werewolf-kill-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>ç‹¼äººè¯·é€‰æ‹©åˆ€äººå¯¹è±¡</span></div>
      <div class="modal-body" id="werewolf-kill-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="cancel" id="cancel-wolf-kill-btn">æ”¾å¼ƒ</button> <button class="save btn-danger" id="confirm-wolf-kill-btn">ç¡®è®¤åˆ€äºº</button> </div>
    </div>
  </div>
  <div id="werewolf-lobby-modal" class="modal">
    <div class="modal-content" style="height: 80%;">
      <div class="modal-header"> <span>é€‰æ‹©ç©å®¶å¼€å§‹ç‹¼äººæ€</span> </div>
      <div class="modal-body" id="werewolf-player-selection-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-werewolf-lobby-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="start-werewolf-game-btn">å¼€å§‹æ¸¸æˆ</button> </div>
    </div>
  </div>
  <div id="werewolf-role-modal" class="modal">
    <div class="modal-content" style="width: 280px; height: auto; text-align: center; padding: 20px;">
      <h3 id="werewolf-role-title" style="margin-top: 0;">ä½ çš„èº«ä»½æ˜¯</h3>
      <div id="werewolf-role-card" style="margin: 15px 0;">
        <h2 id="werewolf-role-name" style="margin: 0 0 10px 0;"></h2>
        <p id="werewolf-role-description" style="font-size: 14px; line-height: 1.6; color: #555; margin: 0;"></p>
      </div> <button id="werewolf-role-confirm-btn" class="form-button">æˆ‘å‡†å¤‡å¥½äº†</button>
    </div>
  </div>
  <div id="werewolf-prophet-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>é¢„è¨€å®¶è¯·é€‰æ‹©æŸ¥éªŒå¯¹è±¡</span></div>
      <div class="modal-body" id="werewolf-prophet-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save" id="confirm-prophet-check-btn">ç¡®è®¤æŸ¥éªŒ</button> </div>
    </div>
  </div>
  <div id="werewolf-hunter-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>çŒäººè¯·é€‰æ‹©å¼€æªå¯¹è±¡</span></div>
      <div class="modal-body" id="werewolf-hunter-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save btn-danger" id="confirm-hunter-shot-btn">ç¡®è®¤å¼€æª</button> </div>
    </div>
  </div>
  <div id="werewolf-vote-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>è¯·æŠ•ç¥¨æ”¾é€ä¸€åç©å®¶</span></div>
      <div class="modal-body" id="werewolf-vote-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save" id="confirm-vote-btn">ç¡®è®¤æŠ•ç¥¨</button> </div>
    </div>
  </div>
  <div id="werewolf-guard-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>å®ˆå«è¯·é€‰æ‹©ä»Šæ™šè¦å®ˆæŠ¤çš„ç©å®¶</span></div>
      <div class="modal-body" id="werewolf-guard-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save" id="confirm-guard-selection-btn">ç¡®è®¤å®ˆæŠ¤</button> </div>
    </div>
  </div>
  <div id="werewolf-witch-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span id="witch-modal-title">å¥³å·«è¯·ççœ¼</span></div>
      <div class="modal-body" id="werewolf-witch-selection-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="witch-do-nothing-btn">ä»€ä¹ˆéƒ½ä¸åš</button> <button class="save btn-danger" id="confirm-witch-poison-btn" style="display: none;">ç¡®è®¤ç”¨æ¯’</button> </div>
    </div>
  </div>
  <div id="werewolf-hunter-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>çŒäººè¯·é€‰æ‹©å¼€æªå¯¹è±¡</span></div>
      <div class="modal-body" id="werewolf-hunter-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save btn-danger" id="confirm-hunter-shot-btn">ç¡®è®¤å¼€æª</button> </div>
    </div>
  </div>
  <div id="werewolf-vote-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>è¯·æŠ•ç¥¨æ”¾é€ä¸€åç©å®¶</span></div>
      <div class="modal-body" id="werewolf-vote-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save" id="confirm-vote-btn">ç¡®è®¤æŠ•ç¥¨</button> </div>
    </div>
  </div>
  <div id="werewolf-game-over-modal" class="modal">
    <div class="modal-content" style="width: 300px; height: auto; text-align: center; padding: 20px;">
      <h2 id="werewolf-game-over-title">æ¸¸æˆç»“æŸ</h2>
      <p id="werewolf-game-over-reason" style="font-size: 16px; margin: 20px 0;"></p>
      <div id="werewolf-role-reveal-list" style="max-height: 250px; overflow-y: auto; margin: 20px 0; border-top: 1px solid #444; padding-top: 10px;"> </div> <button id="werewolf-game-over-close-btn" class="form-button">è¿”å›å¤§å…</button> <button id="manual-werewolf-summary-btn"
        class="form-button form-button-secondary" style="margin-top: 10px;">æ‰‹åŠ¨æ€»ç»“è®°å¿†</button>
    </div>
  </div>
  <div id="reading-library-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>æˆ‘çš„ä¹¦åº“</span>
        <div class="header-actions"> <span class="action-btn" id="import-new-book-btn-header" title="å¯¼å…¥æ–°ä¹¦"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg> </span> <span class="action-btn" id="close-reading-library-btn-header" title="å…³é—­"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg> </span> </div>
      </div>
      <div id="reading-library-search-container"> <input type="search" id="reading-library-search-input" placeholder="æœç´¢ä¹¦å..."> </div>
      <div class="modal-body" style="padding: 0; flex-grow: 1; overflow-y: auto;">
        <div id="reading-library-list"> </div>
      </div>
    </div>
  </div>
  <div id="product-category-manager-modal" class="modal">
    <div class="modal-content" style="height: 60%;">
      <div class="modal-header"> <span>ç®¡ç†å•†å“åˆ†ç±»</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label>æ–°å»ºåˆ†ç±»</label>
          <div style="display: flex; gap: 10px;"> <input type="text" id="new-product-category-name-input" placeholder="è¾“å…¥åˆ†ç±»å..." style="flex-grow: 1;"> <button id="add-new-product-category-btn" class="form-button" style="width: auto; margin-top: 0; padding: 0 15px;"data-lang-key="add">æ·»åŠ </button> </div>
        </div>
        <hr style="opacity: 0.2;">
        <div id="existing-product-categories-list" style="display: flex; flex-direction: column; gap: 10px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-product-category-manager-btn" style="width: 100%;"data-lang-key="done">å®Œæˆ</button> </div>
    </div>
  </div>
  <div id="variation-selection-modal" class="modal">
    <div class="modal-content" style="width: 320px; height: auto;">
      <div class="modal-header" style="padding-bottom: 0;"> </div>
      <div class="modal-body">
        <div id="variation-product-info" style="display: flex; align-items: flex-start; gap: 12px; margin-bottom: 15px;"> <img id="variation-product-image" style="width: 80px; height: 80px; border-radius: 6px; object-fit: cover;">
          <div>
            <p id="variation-product-name" style="font-weight: 500; margin: 0;"></p>
            <p id="variation-selected-price" style="color: #ff5722; font-weight: bold; font-size: 18px; margin: 8px 0 0;"></p>
          </div>
        </div>
        <div class="form-group"> <label>é€‰æ‹©æ¬¾å¼</label>
          <div id="variation-options-container" style="display: flex; flex-wrap: wrap; gap: 8px;"> </div>
        </div>
        <div class="form-group"> <label>è´­ä¹°æ•°é‡</label>
          <div class="quantity-control" style="justify-content: flex-start;"> <button class="quantity-btn" id="variation-decrease-qty">-</button> <span class="quantity-display" id="variation-quantity-display">1</span> <button class="quantity-btn" id="variation-increase-qty">+</button>
          </div>
        </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-variation-selection-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="confirm-variation-selection-btn">åŠ å…¥è´­ç‰©è½¦</button> </div>
    </div>
  </div>
  <div id="shopping-settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"> <span>è´­ç‰©ä¸­å¿ƒç”Ÿæˆè®¾ç½®</span> </div>
      <div class="modal-body">
        <div class="form-group douban-settings-item"> <label for="shopping-category-count-input"> ç”Ÿæˆåˆ†ç±»æ•°é‡ <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> è®¾ç½®AIä¸€æ¬¡æ€§ç”Ÿæˆå¤šå°‘ä¸ªå•†å“åˆ†ç±»ã€‚ </p> </label>
          <div class="douban-settings-controls"> <input type="number" id="shopping-category-count-input" min="1" max="10" value="3"> <span>ä¸ª</span> </div>
        </div>
        <div class="form-group douban-settings-item"> <label for="shopping-product-count-input"> æ¯ä¸ªåˆ†ç±»å•†å“æ•°é‡ <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> è®¾ç½®æ¯ä¸ªåˆ†ç±»ä¸‹ç”Ÿæˆå¤šå°‘ä¸ªå•†å“ã€‚ </p> </label>
          <div class="douban-settings-controls"> <input type="number" id="shopping-product-count-input" min="2" max="10" value="8"> <span>ä¸ª</span> </div>
        </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-shopping-settings-btn"data-lang-key="cancel">å–æ¶ˆ</button> <button class="save" id="save-shopping-settings-btn"data-lang-key="save">ä¿å­˜</button> </div>
    </div>
  </div>
  <div id="sticker-binding-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header">
        <span>ç»‘å®šåˆ†ç±»åˆ°èŠå¤©</span>
      </div>
      <div class="modal-body" id="sticker-binding-chat-list" style="padding: 0;">
        <!-- èŠå¤©åˆ—è¡¨å°†åœ¨æ­¤å¤„åŠ¨æ€æ¸²æŸ“ -->
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-sticker-binding-btn"data-lang-key="cancel">å–æ¶ˆ</button>
        <button class="save" id="save-sticker-binding-btn"data-lang-key="save">ä¿å­˜</button>
      </div>
    </div>
  </div>
<!-- â–¼â–¼â–¼ NovelAI ç”Ÿæˆè®¾ç½®å¼¹çª— â–¼â–¼â–¼ -->
<div id="novelai-settings-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px; width: 90%; max-height: 85vh; overflow-y: auto;">
        <div class="modal-header">
            <span>NovelAI ç”Ÿæˆè®¾ç½®</span>
            <span class="close" id="close-novelai-settings" style="cursor: pointer; float: right; font-size: 28px; font-weight: bold;">&times;</span>
        </div>
        <div class="modal-body" style="padding: 20px;">
           <div class="settings-section" style="background-color: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
    <div style="font-weight: 600; margin-bottom: 10px; color: #333;">ğŸ¨ é£æ ¼é¢„è®¾ä¸ç»‘å®š</div>
    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
        <select id="nai-preset-select" class="settings-select" style="flex-grow: 1; border: 1px solid #ccc; padding: 8px; border-radius: 6px;">
            <option value="">-- å½“å‰ä¸´æ—¶è®¾ç½® --</option>
        </select>
    </div>
    
    <div style="display: flex; gap: 8px; align-items: center; justify-content: flex-end;">
    <button id="save-nai-preset-btn" class="settings-mini-btn">æ–°å¢</button>
    
    <button id="update-nai-preset-btn" class="settings-mini-btn" style="display:none;">æ›´æ–°</button>
    
    <button id="bind-nai-preset-btn" class="settings-mini-btn" style="display:none; background-color: #e3f2fd; color: #1976d2; border-color: #bbdefb;">ğŸ”—ç»‘å®š</button>
    
    <button id="delete-nai-preset-btn" class="settings-mini-btn" style="color: #ff3b30; border-color: #ff3b30; display:none;">åˆ é™¤</button>
</div>
    
    <p style="font-size: 12px; color: #888; margin-top: 8px; margin-bottom: 0;">* ç»‘å®šåï¼Œè¯¥è§’è‰²ç”Ÿå›¾æ—¶å°†å¼ºåˆ¶ä½¿ç”¨æ­¤é¢„è®¾ã€‚</p>
</div>
            <div class="form-group">
                <label style="color: #333;">å›¾åƒå°ºå¯¸ï¼ˆopluså¯æ— é™å‡ºå°å›¾ï¼‰</label>
                <select id="nai-resolution" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                    <optgroup label="å°">
                        <option value="512x768">çºµå‘ (512x768)</option>
                        <option value="768x512">æ¨ªå‘ (768x512)</option>
                        <option value="640x640">æ­£æ–¹å½¢ (640x640)</option>
                    </optgroup>
                    <optgroup label="æ­£å¸¸">
                        <option value="832x1216">ç«–å›¾ (832x1216)</option>
                        <option value="1216x832">æ¨ªå›¾ (1216x832)</option>
                        <option value="1024x1024" selected>æ–¹å›¾ (1024x1024)</option>
                    </optgroup>
                    <optgroup label="å£çº¸">
                        <option value="1088x1920">çºµå‘ (1088x1920)</option>
                        <option value="1920x1088">é£æ™¯ (1920x1088)</option>
                    </optgroup>
                </select>
                <small style="color: #666;">å»ºè®®ä½¿ç”¨å®˜æ–¹æ”¯æŒçš„æ ‡å‡†å°ºå¯¸ä»¥è·å¾—æœ€ä½³æ•ˆæœ</small>
            </div>

            <div class="form-group">
                <label style="color: #333;">é‡‡æ ·æ­¥æ•° (Steps)</label>
                <input type="number" id="nai-steps" value="28" min="1" max="50" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                <small style="color: #666;">æ¨èå€¼: 28 (å€¼è¶Šé«˜è´¨é‡è¶Šå¥½ä½†è€—æ—¶è¶Šé•¿)</small>
            </div>

            <div class="form-group">
                <label style="color: #333;">æç¤ºè¯ç›¸å…³æ€§ (CFG Scale)</label>
                <input type="number" id="nai-cfg-scale" value="5" min="1" max="20" step="0.5" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                <small style="color: #666;">æ¨èå€¼: 5 (æ§åˆ¶å›¾åƒä¸æç¤ºè¯çš„ç›¸å…³ç¨‹åº¦)</small>
            </div>

            <div class="form-group">
                <label style="color: #333;">é‡‡æ ·å™¨ (Sampler)</label>
                <select id="nai-sampler" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                    <option value="k_euler">Euler</option>
                    <option value="k_euler_ancestral" selected>Euler Ancestral</option>
                    <option value="k_dpmpp_2s_ancestral">DPM++ 2S Ancestral</option>
                    <option value="k_dpmpp_2m">DPM++ 2M</option>
                    <option value="k_dpmpp_sde">DPM++ SDE</option>
                    <option value="ddim">DDIM</option>
                </select>
            </div>

            <div class="form-group">
                <label style="color: #333;">éšæœºç§å­ (Seed)</label>
                <input type="number" id="nai-seed" value="-1" min="-1" max="9999999999" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                <small style="color: #666;">-1 è¡¨ç¤ºéšæœºï¼Œå›ºå®šç§å­å¯å¤ç°ç›¸åŒå›¾åƒ</small>
            </div>

            <div class="form-group">
                <label style="color: #333;">è´Ÿé¢æç¤ºè¯é¢„è®¾ (UC Preset)</label>
                <select id="nai-uc-preset" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                    <option value="0">Preset 0 - Heavy</option>
                    <option value="1" selected>Preset 1 - Light</option>
                    <option value="2">Preset 2 - Human Focus</option>
                    <option value="3">Preset 3 - None</option>
                </select>
            </div>

            <div class="form-group">
                <label style="color: #333;">è´¨é‡æ ‡ç­¾</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="nai-quality-toggle" checked style="width: auto;">
                    <span style="color: #666; font-size: 14px;">è‡ªåŠ¨æ·»åŠ è´¨é‡æå‡æ ‡ç­¾</span>
                </div>
            </div>

            <div class="form-group">
                <label style="color: #333;">SMEA (æå‡ç»†èŠ‚)</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="nai-smea" checked style="width: auto;">
                    <span style="color: #666; font-size: 14px;">å¯ç”¨SMEAå¢å¼º</span>
                </div>
            </div>

            <div class="form-group">
                <label style="color: #333;">SMEA DYN (åŠ¨æ€ä¼˜åŒ–)</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="nai-smea-dyn" style="width: auto;">
                    <span style="color: #666; font-size: 14px;">å¯ç”¨åŠ¨æ€SMEA</span>
                </div>
            </div>

            <div class="form-group">
                <label style="color: #333;">é»˜è®¤æ­£é¢æç¤ºè¯</label>
                <textarea id="nai-default-positive" rows="3" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px; resize: vertical;" placeholder="masterpiece, best quality, 1girl, beautiful...">masterpiece, best quality, 1girl, beautiful, detailed face, detailed eyes, long hair, anime style</textarea>
                <small style="color: #666;">æ­¤æç¤ºè¯å°†åœ¨ç”Ÿæˆæ—¶è‡ªåŠ¨ä½¿ç”¨ï¼ˆå¦‚æœæµ‹è¯•å¼¹çª—ä¸­æœªå¡«å†™ï¼‰</small>
            </div>

            <div class="form-group">
                <label style="color: #333;">é»˜è®¤è´Ÿé¢æç¤ºè¯</label>
                <textarea id="nai-default-negative" rows="3" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px; resize: vertical;" placeholder="lowres, bad anatomy, bad hands, text, error...">lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry</textarea>
            </div>

            <div class="form-group" style="border-top: 1px solid #ddd; padding-top: 15px; margin-top: 15px;">
                <label style="color: #333;">ğŸŒ CORS ä»£ç†è®¾ç½®</label>
                <select id="nai-cors-proxy" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                    <option value="">âŒ ç›´è¿ï¼ˆæ— ä»£ç†ï¼‰</option>
                    <option value="https://corsproxy.io/?" selected>âœ… corsproxy.ioï¼ˆæ¨èï¼‰</option>
                    <option value="https://api.allorigins.win/raw?url=">allorigins.win</option>
                    <option value="https://cors-anywhere.herokuapp.com/">cors-anywhereï¼ˆéœ€æ¿€æ´»ï¼‰</option>
                    <option value="custom">ğŸ”§ è‡ªå®šä¹‰ä»£ç†</option>
                </select>
                <small style="color: #e74c3c; display: block; margin-top: 8px;">
                    âš ï¸ æœ¬åœ°è¿è¡Œä¼šé‡åˆ°CORSè·¨åŸŸé—®é¢˜ï¼Œéœ€ä½¿ç”¨ä»£ç†ã€‚æ¨èä½¿ç”¨ corsproxy.io
                </small>
            </div>

            <div id="nai-custom-proxy-group" class="form-group" style="display: none;">
                <label style="color: #333;">è‡ªå®šä¹‰ä»£ç†åœ°å€</label>
                <input type="text" id="nai-custom-proxy-url" placeholder="https://your-proxy.com/?" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                <small style="color: #666;">ä»£ç†URLåº”ä»¥ / æˆ– ? ç»“å°¾ï¼Œä¾‹å¦‚ï¼šhttps://proxy.com/?</small>
            </div>
        </div>
        <div class="modal-footer">
            <button id="reset-nai-settings-btn" class="form-button form-button-secondary" style="margin-right: 10px;">æ¢å¤é»˜è®¤</button>
            <button id="save-nai-settings-btn" class="form-button form-button-secondary"data-lang-key="save">ä¿å­˜è®¾ç½®</button>
        </div>
    </div>
</div>
<!-- â–²â–²â–² NovelAI ç”Ÿæˆè®¾ç½®å¼¹çª—ç»“æŸ â–²â–²â–² -->

<!-- â–¼â–¼â–¼ NovelAI æµ‹è¯•ç”Ÿæˆå¼¹çª— â–¼â–¼â–¼ -->
<div id="novelai-test-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 700px; width: 90%; max-height: 90vh; overflow-y: auto;">
        <div class="modal-header">
            <span>ğŸ–¼ï¸ NovelAI æµ‹è¯•ç”Ÿæˆ</span>
            <span class="close" id="close-novelai-test" style="cursor: pointer; float: right; font-size: 28px; font-weight: bold;">&times;</span>
        </div>
        <div class="modal-body" style="padding: 20px;">
            <div class="form-group">
                <label style="color: #333;">æ­£é¢æç¤ºè¯ï¼ˆæ­¤å¤„æç¤ºè¯ä»…ç”¨äºè¯¥å¼¹çª—æµ‹è¯•ï¼‰</label>
                <textarea id="nai-test-prompt" rows="4" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px; width: 100%; border-radius: 4px; resize: vertical;" placeholder="1girl, solo, long hair, blue eyes, smile...">1girl, solo, long hair, blue eyes, smile, outdoors, cherry blossoms, spring</textarea>
            </div>

            <div class="form-group">
                <label style="color: #333;">è´Ÿé¢æç¤ºè¯ï¼ˆå¯é€‰ï¼Œç•™ç©ºä½¿ç”¨é»˜è®¤ï¼‰</label>
                <textarea id="nai-test-negative" rows="3" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px; width: 100%; border-radius: 4px; resize: vertical;" placeholder="ç•™ç©ºå°†ä½¿ç”¨è®¾ç½®ä¸­çš„é»˜è®¤è´Ÿé¢æç¤ºè¯"></textarea>
            </div>

            <div style="text-align: center; margin: 20px 0;">
                <button id="nai-generate-btn" style="background-color: #007bff; color: white; border: none; padding: 12px 30px; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold;">
                    ç”Ÿæˆå›¾åƒ
                </button>
            </div>

            <div id="nai-test-status" style="text-align: center; color: #666; margin: 15px 0; display: none;">
                æ­£åœ¨ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™...
            </div>

            <div id="nai-test-result" style="display: none; margin-top: 20px;">
                <div style="font-weight: bold; color: #333; margin-bottom: 10px;">ç”Ÿæˆç»“æœï¼š</div>
                <div style="text-align: center; background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef;">
                    <img id="nai-result-image" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                </div>
                <div style="margin-top: 10px; text-align: center;">
                    <button id="nai-download-btn" class="form-button-secondary" style="margin: 0;">ä¸‹è½½å›¾åƒ</button>
                </div>
            </div>

            <div id="nai-test-error" style="display: none; margin-top: 15px; padding: 12px; background: #f8d7da; color: #721c24; border-radius: 6px; border: 1px solid #f5c6cb;"></div>
        </div>
        <div class="modal-footer">
            <button id="close-nai-test-btn" class="form-button">å…³é—­</button>
        </div>
    </div>
</div>
<!-- â–²â–²â–² NovelAI æµ‹è¯•ç”Ÿæˆå¼¹çª—ç»“æŸ â–²â–²â–² -->

<!-- â–¼â–¼â–¼ è§’è‰²ä¸“å±NAIå‡ºå›¾è®¾ç½®å¼¹çª— â–¼â–¼â–¼ -->
<div id="character-nai-prompts-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <span>è§’è‰²ä¸“å±NAIæç¤ºè¯é…ç½®</span>
            <span class="close" id="close-character-nai-prompts" style="cursor: pointer; float: right; font-size: 28px; font-weight: bold;">&times;</span>
        </div>
        <div class="modal-body">
            <p style="font-size: 13px; color: #666; margin-bottom: 20px; background-color: #f0f8ff; padding: 12px; border-radius: 6px; border-left: 3px solid #007bff;">
                ğŸ’¡ è¿™é‡Œé…ç½®çš„æç¤ºè¯ä»…ç”¨äºå½“å‰è§’è‰²çš„NAIå‡ºå›¾ï¼Œä¸å½±å“å…¶ä»–è§’è‰²æˆ–ç³»ç»Ÿè®¾ç½®
            </p>
            
            <div class="form-group">
                <label for="character-nai-positive" style="color: #333; font-weight: 600;">
                    æ­£é¢æç¤ºè¯ (Positive Prompt)
                </label>
                <textarea id="character-nai-positive" rows="4" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px; width: 100%; border-radius: 4px; resize: vertical; font-size: 13px;" placeholder="ä¾‹å¦‚: masterpiece, best quality, 1girl, beautiful, detailed face, detailed eyes, long hair, anime style"></textarea>
                <small style="display: block; color: #666; font-size: 12px; margin-top: 5px;">
                    æè¿°ä½ å¸Œæœ›ç”Ÿæˆçš„å›¾åƒé£æ ¼ï¼Œå¯å¡«å…¥ç”»å¸ˆä¸²
                </small>
            </div>

            <div class="form-group">
                <label for="character-nai-negative" style="color: #333; font-weight: 600;">
                    è´Ÿé¢æç¤ºè¯ (Negative Prompt)
                </label>
                <textarea id="character-nai-negative" rows="4" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px; width: 100%; border-radius: 4px; resize: vertical; font-size: 13px;" placeholder="ä¾‹å¦‚: lowres, bad anatomy, bad hands, text, error, missing fingers"></textarea>
                <small style="display: block; color: #666; font-size: 12px; margin-top: 5px;">
                    æè¿°ä½ å¸Œæœ›é¿å…çš„å…ƒç´ 
                </small>
            </div>
        </div>
        <div class="modal-footer">
            <button id="reset-character-nai-prompts-btn" class="form-button form-button-secondary" style="margin-right: 10px;">æ¸…ç©ºé…ç½®</button>
            <button id="save-character-nai-prompts-btn" class="form-button form-button-secondary"data-lang-key="save">ä¿å­˜</button>
        </div>
    </div>
</div>
<!-- â–²â–²â–² è§’è‰²ä¸“å±NAIå‡ºå›¾è®¾ç½®å¼¹çª—ç»“æŸ â–²â–²â–² -->
<div id="npc-group-manager-modal" class="modal">
  <div class="modal-content" style="height: 60%;">
    <div class="modal-header"> <span>ç®¡ç†NPCåˆ†ç»„</span> </div>
    <div class="modal-body">
      <div class="form-group"> <label>æ–°å»ºåˆ†ç»„</label>
        <div style="display: flex; gap: 10px;"> <input type="text" id="new-npc-group-name-input" placeholder="è¾“å…¥åˆ†ç»„å (ä¾‹å¦‚: å®¶äººç»„, æœ‹å‹ç»„)..." style="flex-grow: 1;"> <button id="add-new-npc-group-btn" class="form-button" style="width: auto; margin-top: 0; padding: 0 15px;"data-lang-key="add">æ·»åŠ </button> </div>
      </div>
      <hr style="opacity: 0.2;">
      <div id="existing-npc-groups-list" style="display: flex; flex-direction: column; gap: 10px;"> </div>
    </div>
    <div class="modal-footer"> <button class="save" id="close-npc-group-manager-btn" style="width: 100%;"data-lang-key="done">å®Œæˆ</button> </div>
  </div>
</div>
<div id="pin-modal-overlay" class="modal">
    <div id="pin-modal-content" class="modal-content" style="width: 300px; height: auto;">
        <div class="modal-header">
            <span>åŠŸèƒ½æ¿€æ´»</span>
        </div>
        <div class="modal-body" style="text-align: left;">
            <p>æ­¤åŠŸèƒ½éœ€è¦æ¿€æ´»ç  (PIN) æ‰èƒ½ä½¿ç”¨ã€‚</p>
            
            <div class="form-group">
                <label for="pin-device-id-display">æ‚¨çš„è®¾å¤‡ID (è¯·å»å°¾å·´é•‡è§’è‰²å¡ä¸­è·å–ï¼Œè¿˜æœ‰è§£å¯†æ²¡ç›´æ¥ç»™ç½‘å€ï¼ŒæŒ‰ç…§è¦æ±‚å»æœç´¢å°±å¥½äº†ï¼Œä»¥ä¸‹æ•°å­—å³ä¸ºä½ çš„è®¾å¤‡ç )</label>
                <input type="text" id="pin-device-id-display" readonly style="background: #eee; cursor: text; -webkit-user-select: text; user-select: text;">
            </div>
            
            <div class="form-group">
                <label for="pin-input">è¯·è¾“å…¥æ¿€æ´»ç  (PIN)</label>
                <input type="text" id="pin-input" placeholder="åœ¨æ­¤è¾“å…¥æ¿€æ´»ç ...">
            </div>
        </div>
        <div class="modal-footer">
            <button class="cancel" id="pin-modal-cancel-btn">å–æ¶ˆ</button>
            <button class="save" id="pin-modal-confirm-btn">ç¡®è®¤æ¿€æ´»</button>
        </div>
    </div>
</div>
<div id="quick-reply-modal" class="modal">
    <div class="modal-content" style="height: 70%; position: relative;"> <div class="modal-header">
            <span>å¿«æ·å›å¤</span>
            <div class="header-actions">
                <button id="batch-quick-reply-btn" class="action-button" style="font-size: 14px; margin-right: 10px;">æ‰¹é‡</button>
                <button id="manage-quick-reply-categories-btn" class="action-button" style="font-size: 14px; margin-right: 10px;">åˆ†ç±»</button>
                <button id="add-quick-reply-btn" class="action-button" style="font-size: 26px; color: var(--accent-color); font-weight: 300; cursor: pointer; background: none; border: none; padding: 0 5px;">+</button>
            </div>
        </div>
        
        <div id="quick-reply-tabs" style="display: flex; overflow-x: auto; padding: 0 15px; flex-shrink: 0; border-bottom: 1px solid var(--border-color); background-color: var(--secondary-bg); -ms-overflow-style: none; scrollbar-width: none;">
        </div>

        <div class="modal-body" id="quick-reply-list" style="padding: 0; display: flex; flex-direction: column; padding-bottom: 60px;"> </div>

        <div id="quick-reply-action-bar" style="display: none; position: absolute; bottom: 0; left: 0; width: 100%; padding: 10px 15px; background: rgba(255,255,255,0.95); border-top: 1px solid #eee; box-sizing: border-box; justify-content: space-between; align-items: center; z-index: 10;">
            <label style="display: flex; align-items: center; gap: 5px;">
                <input type="checkbox" id="select-all-quick-replies-checkbox"> å…¨é€‰
            </label>
            <div style="display: flex; gap: 8px;">
                <button id="move-selected-quick-replies-btn" class="settings-mini-btn" style="background-color: #ff9800; color: white; border: none;">ç§»åŠ¨ (0)</button>
                <button id="delete-selected-quick-replies-btn" class="settings-mini-btn" style="background-color: #ff3b30; color: white; border: none;">åˆ é™¤ (0)</button>
            </div>
        </div>

        <div class="modal-footer" id="quick-reply-normal-footer">
            <button class="cancel" id="cancel-quick-reply-btn" style="width: 100%;">å…³é—­</button>
        </div>
    </div>
</div>
<div id="quick-reply-category-manager-modal" class="modal">
    <div class="modal-content" style="height: 60%;">
        <div class="modal-header"> <span>ç®¡ç†å›å¤åˆ†ç±»</span> </div>
        <div class="modal-body">
            <div class="form-group"> <label>æ–°å»ºåˆ†ç±»</label>
                <div style="display: flex; gap: 10px;"> 
                    <input type="text" id="new-quick-reply-category-name-input" placeholder="è¾“å…¥åˆ†ç±»å..." style="flex-grow: 1;"> 
                    <button id="add-new-quick-reply-category-btn" class="form-button" style="width: auto; margin-top: 0; padding: 0 15px;" data-lang-key="add">æ·»åŠ </button> 
                </div>
            </div>
            <hr style="opacity: 0.2;">
            <div id="existing-quick-reply-categories-list" style="display: flex; flex-direction: column; gap: 10px;"> 
                </div>
        </div>
        <div class="modal-footer"> 
            <button class="save" id="close-quick-reply-category-manager-btn" style="width: 100%;" data-lang-key="done">å®Œæˆ</button> 
        </div>
    </div>
</div>
<div id="char-music-restore-btn" style="display: none;">
  <img src="https://static.eeo.cn/upload/images/20251114/78d48a9f1d73b2bc6003.png" alt="Restore Music" style="width: 100%; height: 100%; ">
  </div>
<div id="video-call-restore-btn" style="display: none;">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polygon points="23 7 16 12 23 17 23 7"></polygon>
        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
    </svg>
</div>
<div id="voice-call-restore-btn" style="display: none;">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
    </svg>
</div>
<div id="char-music-player-modal" class="modal">
        <div class="modal-content">
          <button id="minimize-char-music-btn" class="char-player-minimize-btn" title="æœ€å°åŒ–">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round">
    <line x1="5" y1="12" x2="19" y2="12"></line>
  </svg>
</button>
          <div class="char-player-body">
            <div class="char-player-song-info">
              <p id="char-music-player-title">æ­Œæ›²åç§°</p>
              <p id="char-music-artist">æ­Œæ‰‹</p>
            </div>
            <div id="char-vinyl-container"> <img id="char-music-cover" src=""> </div>
            <div id="char-music-lyrics"> </div>
            <div class="char-player-footer">
              <div class="char-player-progress-bar-container"> <span id="char-music-current-time" class="time-display">0:00</span>
                <div id="char-music-progress-bar" class="char-player-progress-bar">
                  <div id="char-music-progress-fill"></div>
                </div> <span id="char-music-total-time" class="time-display">0:00</span>
              </div>
              <div class="char-player-controls"> <button id="char-music-prev-btn" class="control-btn"> <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"></path>
                  </svg> </button> <button id="char-music-play-pause-btn" class="control-btn play"> <svg viewBox="0 0 24 24" width="32" height="32" fill="currentColor">
                    <path d="M8 5v14l11-7z"></path>
                  </svg> </button> <button id="char-music-next-btn" class="control-btn"> <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M16 6h2v12h-2zm-3.5 6l-8.5 6V6z"></path>
                  </svg> </button> <button id="char-music-mode-btn" class="control-btn mode">é¡ºåº</button> </div>
            </div>
          </div> <button id="close-char-music-player-btn" class="char-player-close-btn">Ã—</button>
        </div>
      </div>
<!-- æ–°å¢ï¼šäº²å±å¡èµ é€ä¸“å±å¼¹çª— -->
<div id="kinship-creation-modal" class="modal">
  <div class="modal-content" style="height: 70%; display: flex; flex-direction: column;">
    <div class="modal-header">
      <span>èµ é€äº²å±å¡</span>
    </div>
    
    <!-- ä¸­é—´éƒ¨åˆ†ï¼šåˆ†ä¸ºä¸Šé¢çš„è§’è‰²åˆ—è¡¨å’Œä¸‹é¢çš„é‡‘é¢è¾“å…¥ -->
    <div class="modal-body" style="padding: 0; flex-grow: 1; display: flex; flex-direction: column; overflow: hidden;">
      
      <!-- æç¤ºè¯­ -->
      <div style="padding: 10px 15px; background-color: #f5f5f7; color: #666; font-size: 13px; border-bottom: 1px solid var(--border-color);">
        è¯·é€‰æ‹©èµ äºˆå¯¹è±¡ (å•é€‰)
      </div>

      <!-- è§’è‰²åˆ—è¡¨åŒºåŸŸ (å¤ç”¨æ¸…ç†æ•°æ®çš„æ ·å¼) -->
      <div id="kinship-char-list" style="flex-grow: 1; overflow-y: auto;">
        <!-- JS åŠ¨æ€å¡«å…… -->
      </div>

      <!-- é‡‘é¢è¾“å…¥åŒºåŸŸ -->
      <div style="padding: 20px; background-color: #fff; border-top: 1px solid var(--border-color); box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 2;">
        <div class="form-group" style="margin-bottom: 0;">
          <label for="kinship-limit-input" style="font-weight: 600;">æ¯æœˆæ¶ˆè´¹é¢åº¦</label>
          <div style="position: relative; display: flex; align-items: center;">
             <span style="font-size: 20px; font-weight: bold; margin-right: 5px;">Â¥</span>
             <input type="number" id="kinship-limit-input" value="5200" placeholder="è¯·è¾“å…¥é‡‘é¢" 
                    style="font-size: 24px; font-weight: bold; color: #ff1744; border: none; border-bottom: 1px solid #ddd; border-radius: 0; padding: 5px 0; background: transparent;">
          </div>
          <p style="font-size: 12px; color: #999; margin-top: 8px;">ä¼˜å…ˆæ‰£é™¤äº²å±å¡é¢åº¦ï¼Œè¶…å‡ºéƒ¨åˆ†ç”±å¯¹æ–¹è‡ªä»˜ã€‚</p>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="cancel" id="cancel-kinship-creation-btn" data-lang-key="cancel">å–æ¶ˆ</button>
      <button class="save" id="confirm-kinship-creation-btn" style="background: linear-gradient(135deg, #ff5252, #ff1744); border: none;">ç¡®è®¤èµ é€</button>
    </div>
  </div>
</div>
<div id="inventory-modal" class="modal">
    <div class="modal-content" style="height: 70%; background-color: #1c1c1e; color: #e0e0e0; border: 1px solid #333;">
        <div class="modal-header" style="border-bottom: 1px solid #333; color: #d4af37;">
            <span>æˆ‘çš„è—å“</span>
            <span class="action-btn" onclick="closeInventoryModal()" style="font-size: 20px;">Ã—</span>
        </div>
        <div class="modal-body" id="inventory-list" style="padding: 15px; overflow-y: auto;">
            </div>
    </div>
</div>
<div id="todo-editor-modal" class="modal">
    <div class="modal-content" style="height: auto;">
        <div class="modal-header">
            <span id="todo-editor-title">æ·»åŠ äº‹é¡¹</span>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>å†…å®¹</label>
                <input type="text" id="todo-content-input" placeholder="ä¾‹å¦‚ï¼šè®°å¾—åƒè¯ã€ä¸‹åˆå¼€ä¼š">
            </div>
            <div class="form-group">
                <label>ç±»å‹/æ ‡ç­¾</label>
                <div class="todo-type-selector" id="todo-type-options">
                    <span class="todo-type-option active" data-value="æ—¥å¸¸" style="--tag-color: #8e8e93;">æ—¥å¸¸</span>
                    <span class="todo-type-option" data-value="å·¥ä½œ" style="--tag-color: #007aff;">å·¥ä½œ</span>
                    <span class="todo-type-option" data-value="é‡è¦" style="--tag-color: #ff3b30;">é‡è¦</span>
                    <span class="todo-type-option" data-value="ç”Ÿæ´»" style="--tag-color: #34c759;">ç”Ÿæ´»</span>
                    <span class="todo-type-option" data-value="çº¦ä¼š" style="--tag-color: #af52de;">çº¦ä¼š</span>
                    <span class="todo-type-option" data-value="è®°è´¦" style="--tag-color: #ffc107;">è®°è´¦</span>
                </div>
            </div>
            <div class="form-group">
                <label>æ—¥æœŸ</label>
                <input type="date" id="todo-date-input">
            </div>
            <div class="form-group">
                <label>å…·ä½“æ—¶é—´ (å¯é€‰)</label>
                <input type="time" id="todo-time-input">
            </div>
        </div>
        <div class="modal-footer">
            <button class="cancel" id="cancel-todo-editor-btn">å–æ¶ˆ</button>
            <button class="save" id="save-todo-btn">ä¿å­˜</button>
        </div>
    </div>
</div>
<div id="gr-settings-modal" class="modal">
    <div class="modal-content" style="height: 85%; background-color: #FAFAF9;">
        <div class="gr-header" style="background: transparent; padding: 15px;">
            <span class="gr-title" style="color: #1B4F3E;">ä½œå“è®¾å®š</span>
        </div>
        <div class="modal-body" style="padding: 0 20px;">
            <div class="gr-form-group">
                <label>ä¹¦å</label>
                <input type="text" id="gr-story-title" class="gr-input" placeholder="è¯·è¾“å…¥ä¹¦å">
            </div>
            <div class="gr-form-group">
    <label>å®å¤§ä¸–ç•Œè§‚ / IFçº¿è®¾å®š (Macro World View)</label>
    <textarea id="gr-macro-world-view" class="gr-input" rows="3" placeholder="åœ¨æ­¤è¾“å…¥æ ¸å¿ƒè®¾å®šã€‚ä¾‹å¦‚ï¼š'æ°‘å›½å†›é˜€èƒŒæ™¯ï¼ŒCharæ˜¯å°‘å¸…ï¼ŒUseræ˜¯è¿›æ­¥å­¦ç”Ÿ'ï¼Œæˆ–è€… 'ABOè®¾å®šï¼ŒCharæ˜¯Enigma'ã€‚æ­¤è®¾å®šä¼˜å…ˆçº§æœ€é«˜ã€‚"></textarea>
</div>
            <div class="gr-form-group">
                <label>æŒ‡å®šä½œè€… (æ–‡é£)</label>
                <select id="gr-author-select" class="gr-select"></select>
            </div>

            <div class="gr-form-group">
                <label>ç™»åœºè§’è‰² (Chat/NPC/ç¾¤èŠ)</label>
                <div class="gr-checkbox-list" id="gr-char-list"></div>
            </div>

            <div class="gr-form-group">
                <label>ä¸–ç•Œè§‚ (World Book)</label>
                <div class="gr-checkbox-list" id="gr-worldbook-list"></div>
            </div>
            
             <div class="gr-form-group">
                <label>æˆ‘çš„èº«ä»½ (User Persona)</label>
                <select id="gr-user-persona-select" class="gr-select">
                     <option value="">ä½¿ç”¨é»˜è®¤</option>
                </select>
            </div>

            <div class="gr-form-group">
                <label>å•æ¬¡ç”Ÿæˆå­—æ•° (Token)</label>
                <input type="number" id="gr-output-length" class="gr-input" value="500">
            </div>
             <div class="gr-form-group">
                <label>ä¸Šä¸‹æ–‡å¼•ç”¨æ¡æ•° (History)</label>
                <input type="number" id="gr-context-limit" class="gr-input" value="20">
            </div>

            <!-- ä½œè€…è¿½æ›´åŠŸèƒ½ -->
            <div class="gr-form-group" style="border-top: 2px solid #E5E5E5; padding-top: 15px; margin-top: 15px;">
                <label style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;">
                    <span style="font-size: 16px; font-weight: 600; color: #1B4F3E;">
                        ğŸ“– ä½œè€…è¿½æ›´åŠŸèƒ½
                        <span style="font-size: 12px; color: #999; font-weight: normal; display: block; margin-top: 5px;">
                            å¼€å¯åï¼Œå¯å®šæ—¶ä½¿ç”¨æŒ‡å®šä½œè€…æ–‡é£æˆ–è§’è‰²è§†è§’è‡ªåŠ¨æ›´æ–°ç« èŠ‚
                        </span>
                    </span>
                    <input type="checkbox" id="gr-auto-update-enabled" style="width: 44px; height: 24px; cursor: pointer;">
                </label>
            </div>

            <div id="gr-auto-update-settings" style="display: none;">
                <div class="gr-form-group">
                    <label>è¿½æ›´æ–¹å¼</label>
                    <select id="gr-auto-update-type" class="gr-select">
                        <option value="author">ä½¿ç”¨ä½œè€…æ–‡é£</option>
                        <option value="character">ä½¿ç”¨è§’è‰²è§†è§’</option>
                    </select>
                </div>

                <div class="gr-form-group" id="gr-update-author-select-group">
                    <label>é€‰æ‹©ä½œè€…</label>
                    <select id="gr-update-author-select" class="gr-select"></select>
                </div>

                <div class="gr-form-group" id="gr-update-character-select-group" style="display: none;">
                    <label>é€‰æ‹©è§’è‰²</label>
                    <select id="gr-update-character-select" class="gr-select"></select>
                </div>

                <div class="gr-form-group">
                    <label>æ›´æ–°é¢‘ç‡</label>
                    <select id="gr-update-frequency" class="gr-select">
                        <option value="manual">æ‰‹åŠ¨æ›´æ–°ï¼ˆä¸è‡ªåŠ¨ï¼‰</option>
                        <option value="daily">æ¯å¤©ä¸€æ›´</option>
                        <option value="weekly">æ¯å‘¨ä¸€æ›´</option>
                        <option value="custom">è‡ªå®šä¹‰é—´éš”</option>
                    </select>
                </div>

                <!-- æ¯å¤©ä¸€æ›´æ—¶é—´é€‰æ‹© -->
                <div class="gr-form-group" id="gr-daily-time-group" style="display: none;">
                    <label>æ¯å¤©æ›´æ–°æ—¶é—´</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <select id="gr-daily-update-hour" class="gr-select" style="flex: 1;">
                            <option value="0">00:00 (å‡Œæ™¨12ç‚¹)</option>
                            <option value="1">01:00 (å‡Œæ™¨1ç‚¹)</option>
                            <option value="2">02:00 (å‡Œæ™¨2ç‚¹)</option>
                            <option value="3">03:00 (å‡Œæ™¨3ç‚¹)</option>
                            <option value="4">04:00 (å‡Œæ™¨4ç‚¹)</option>
                            <option value="5">05:00 (å‡Œæ™¨5ç‚¹)</option>
                            <option value="6">06:00 (æ—©ä¸Š6ç‚¹)</option>
                            <option value="7">07:00 (æ—©ä¸Š7ç‚¹)</option>
                            <option value="8">08:00 (æ—©ä¸Š8ç‚¹)</option>
                            <option value="9">09:00 (æ—©ä¸Š9ç‚¹)</option>
                            <option value="10">10:00 (ä¸Šåˆ10ç‚¹)</option>
                            <option value="11">11:00 (ä¸Šåˆ11ç‚¹)</option>
                            <option value="12" selected>12:00 (ä¸­åˆ12ç‚¹)</option>
                            <option value="13">13:00 (ä¸‹åˆ1ç‚¹)</option>
                            <option value="14">14:00 (ä¸‹åˆ2ç‚¹)</option>
                            <option value="15">15:00 (ä¸‹åˆ3ç‚¹)</option>
                            <option value="16">16:00 (ä¸‹åˆ4ç‚¹)</option>
                            <option value="17">17:00 (ä¸‹åˆ5ç‚¹)</option>
                            <option value="18">18:00 (ä¸‹åˆ6ç‚¹)</option>
                            <option value="19">19:00 (æ™šä¸Š7ç‚¹)</option>
                            <option value="20">20:00 (æ™šä¸Š8ç‚¹)</option>
                            <option value="21">21:00 (æ™šä¸Š9ç‚¹)</option>
                            <option value="22">22:00 (æ™šä¸Š10ç‚¹)</option>
                            <option value="23">23:00 (æ™šä¸Š11ç‚¹)</option>
                        </select>
                    </div>
                </div>

                <!-- æ¯å‘¨ä¸€æ›´æ—¶é—´é€‰æ‹© -->
                <div class="gr-form-group" id="gr-weekly-time-group" style="display: none;">
                    <label>æ¯å‘¨æ›´æ–°æ—¶é—´</label>
                    <div style="display: flex; gap: 10px;">
                        <select id="gr-weekly-update-day" class="gr-select" style="flex: 1;">
                            <option value="1" selected>æ˜ŸæœŸä¸€</option>
                            <option value="2">æ˜ŸæœŸäºŒ</option>
                            <option value="3">æ˜ŸæœŸä¸‰</option>
                            <option value="4">æ˜ŸæœŸå››</option>
                            <option value="5">æ˜ŸæœŸäº”</option>
                            <option value="6">æ˜ŸæœŸå…­</option>
                            <option value="0">æ˜ŸæœŸæ—¥</option>
                        </select>
                        <select id="gr-weekly-update-hour" class="gr-select" style="flex: 1;">
                            <option value="0">00:00</option>
                            <option value="1">01:00</option>
                            <option value="2">02:00</option>
                            <option value="3">03:00</option>
                            <option value="4">04:00</option>
                            <option value="5">05:00</option>
                            <option value="6">06:00</option>
                            <option value="7">07:00</option>
                            <option value="8">08:00</option>
                            <option value="9">09:00</option>
                            <option value="10">10:00</option>
                            <option value="11">11:00</option>
                            <option value="12" selected>12:00</option>
                            <option value="13">13:00</option>
                            <option value="14">14:00</option>
                            <option value="15">15:00</option>
                            <option value="16">16:00</option>
                            <option value="17">17:00</option>
                            <option value="18">18:00</option>
                            <option value="19">19:00</option>
                            <option value="20">20:00</option>
                            <option value="21">21:00</option>
                            <option value="22">22:00</option>
                            <option value="23">23:00</option>
                        </select>
                    </div>
                </div>

                <div class="gr-form-group" id="gr-custom-frequency-group" style="display: none;">
                    <label>è‡ªå®šä¹‰æ›´æ–°é—´éš”ï¼ˆå°æ—¶ï¼‰</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="gr-custom-frequency-hours" class="gr-input" value="24" min="1" max="168" style="flex: 1;">
                        <span style="font-size: 13px; color: #888;">å°æ—¶</span>
                    </div>
                </div>

                <!-- ä¸Šæ¬¡æ›´æ–°æ—¶é—´æ˜¾ç¤º -->
                <div class="gr-form-group" id="gr-last-update-display" style="display: none;">
                    <div style="background: #f5f5f5; padding: 10px; border-radius: 4px; font-size: 13px; color: #666;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>ä¸Šæ¬¡æ›´æ–°ï¼š</span>
                            <span id="gr-last-update-time" style="color: #333; font-weight: 500;">ä»æœªæ›´æ–°</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
                            <span>ä¸‹æ¬¡æ›´æ–°ï¼š</span>
                            <span id="gr-next-update-time" style="color: #1B4F3E; font-weight: 500;">--</span>
                        </div>
                    </div>
                </div>

                <div class="gr-form-group">
                    <label style="font-size: 12px; color: #666;">
                        ğŸ’¡ æç¤ºï¼šå¯ç”¨è¿½æ›´åï¼Œç³»ç»Ÿå°†æŒ‰ç…§è®¾å®šçš„é¢‘ç‡å’Œæ—¶é—´è‡ªåŠ¨ç”Ÿæˆæ–°ç« èŠ‚ã€‚æ¯æ¬¡æ›´æ–°éƒ½ä¼šä½¿ç”¨é€‰æ‹©çš„ä½œè€…æ–‡é£æˆ–è§’è‰²è§†è§’ã€‚
                    </label>
                </div>
            </div>
        </div>
        <div class="modal-footer" style="border-top: 1px solid #E5E5E5;">
            <button class="cancel" id="gr-cancel-settings-btn" style="color: #666;">å–æ¶ˆ</button>
            <button class="save" id="gr-save-story-btn" style="background: #1B4F3E; border: none;">å¼€å§‹åˆ›ä½œ</button>
        </div>
    </div>
</div>
<div id="gr-author-editor-modal" class="modal">
  <div class="modal-content" style="height: auto;">
    <div class="modal-header">
      <span id="gr-author-editor-title">ç¼–è¾‘ä½œè€…</span>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>ä½œè€…åç§°</label>
        <input type="text" id="gr-author-name-input" placeholder="ä¾‹å¦‚ï¼šé²è¿…é£æ ¼">
      </div>
      <div class="form-group">
        <label>æ–‡é£æè¿°</label>
        <textarea id="gr-author-style-input" rows="5" placeholder="åœ¨æ­¤æè¿°è¯¥ä½œè€…çš„ç”¨è¯ä¹ æƒ¯ã€å¥å¼ç‰¹ç‚¹..."></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="cancel" onclick="document.getElementById('gr-author-editor-modal').classList.remove('visible')">å–æ¶ˆ</button>
      <button class="save" id="gr-save-author-btn">ä¿å­˜</button>
    </div>
  </div>
</div>
<div id="nai-binding-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
        <div class="modal-header">
            <span>ç»‘å®šé¢„è®¾åˆ°è§’è‰²</span>
        </div>
        <div class="modal-body" id="nai-binding-list" style="padding: 0;">
            </div>
        <div class="modal-footer">
            <button class="cancel" id="cancel-nai-binding-btn" data-lang-key="cancel">å–æ¶ˆ</button>
            <button class="save" id="save-nai-binding-btn" data-lang-key="save">ä¿å­˜ç»‘å®š</button>
        </div>
    </div>
</div>
<audio id="silent-audio-player" loop preload="auto" style="display:none;">
    <source src="https://phoebeboo.github.io/mewoooo/1-second-of-silence.mp3" type="audio/mpeg">
  </audio><audio id="tts-audio-player" style="display:none;"></audio>

    <!-- ========== è¿æ¥APPç‹¬ç«‹ç•Œé¢ ========== -->
    <div id="online-app-screen" class="screen">
      <!-- èŠå¤©åˆ—è¡¨è§†å›¾ -->
      <div id="online-app-list-view" class="online-app-view active">
        <div class="header">
          <span class="back-btn" onclick="showScreen('home-screen')">â€¹</span>
          <span>è¿æ¥</span>
          <div class="header-actions">
            <span class="action-btn" id="online-app-settings-btn" title="è”æœºè®¾ç½®">âš™</span>
            <span class="action-btn" id="online-app-add-btn" title="æ·»åŠ å¥½å‹">+</span>
          </div>
        </div>
        <!-- è¿æ¥çŠ¶æ€æ  -->
        <div id="online-app-status-bar">
          <span id="online-app-status-dot" class="status-dot-offline"></span>
          <span id="online-app-status-text">æœªè¿æ¥</span>
        </div>
        <div id="online-app-chat-list">
          <div class="online-app-empty-hint">
            <p>æš‚æ— è”æœºå¥½å‹</p>
            <p style="font-size: 12px; color: #999;">ç‚¹å‡»å³ä¸Šè§’ âš™ é…ç½®è”æœºï¼Œç‚¹å‡» + æ·»åŠ å¥½å‹</p>
          </div>
        </div>
      </div>
      <!-- èŠå¤©ç•Œé¢è§†å›¾ -->
      <div id="online-app-chat-view" class="online-app-view">
        <div class="header">
          <span class="back-btn" id="online-app-back-to-list">â€¹</span>
          <div id="online-app-chat-title-wrapper">
            <span id="online-app-chat-title">èŠå¤©</span>
            <div id="online-app-chat-status">
              <span class="status-dot"></span>
              <span class="status-text">åœ¨çº¿</span>
            </div>
          </div>
          <div class="header-actions">
            <span class="action-btn" id="online-app-group-info-btn" title="ç¾¤ä¿¡æ¯" style="display:none;">â„¹</span>
          </div>
        </div>
        <div id="online-app-messages"></div>
        <!-- è”æœºè¡¨æƒ…é¢æ¿ -->
        <div id="online-sticker-panel" style="display:none;">
          <div id="online-sticker-panel-header">
            <span id="online-sticker-close-btn" style="cursor:pointer;color:#007aff;">å–æ¶ˆ</span>
            <span style="font-weight:600;">è¡¨æƒ…åŒ…</span>
            <span id="online-sticker-add-btn" style="cursor:pointer;color:#007aff;">æ·»åŠ </span>
          </div>
          <div id="online-sticker-tabs"></div>
          <div id="online-sticker-grid"></div>
        </div>
        <div id="online-app-input-area">
          <button id="online-app-sticker-btn" title="è¡¨æƒ…åŒ…" style="background:none;border:none;font-size:24px;cursor:pointer;padding:4px 2px;flex-shrink:0;">ğŸ˜€</button>
          <textarea id="online-app-chat-input" placeholder="è¾“å…¥æ¶ˆæ¯..." rows="1"></textarea>
          <button id="online-app-ai-call-btn" style="display:none;" onclick="onlineChatManager.triggerAiCharacterResponse()">è°ƒç”¨AI</button>
          <button id="online-app-send-btn">å‘é€</button>
        </div>
        <input type="file" id="online-sticker-upload-input" accept="image/*" hidden>
      </div>
      <!-- è®¾ç½®è§†å›¾ -->
      <div id="online-app-settings-view" class="online-app-view">
        <div class="header">
          <span class="back-btn" id="online-app-settings-back">â€¹</span>
          <span>è”æœºè®¾ç½®</span>
          <span style="width:30px;"></span>
        </div>
        <div class="online-app-settings-body">
          <div class="settings-section">
            <div class="settings-item">
              <label>å¯ç”¨çœŸäººè”æœº</label>
              <label class="toggle-switch">
                <input type="checkbox" id="online-app-enable-switch">
                <span class="slider"></span>
              </label>
            </div>
          </div>
          <div id="online-app-settings-details" style="display:none;">
            <div class="settings-section">
              <div class="settings-item">
                <label>æˆ‘çš„ID</label>
                <div class="settings-right">
                  <input type="text" id="online-app-my-id" placeholder="è®¾ç½®å”¯ä¸€ID" maxlength="20">
                </div>
              </div>
              <div class="settings-item">
                <label>æˆ‘çš„æ˜µç§°</label>
                <div class="settings-right">
                  <input type="text" id="online-app-my-nickname" placeholder="è®¾ç½®æ˜¾ç¤ºæ˜µç§°" maxlength="20">
                </div>
              </div>
              <div class="settings-item">
                <label>æˆ‘çš„å¤´åƒ</label>
                <div class="settings-right">
                  <div style="display: flex; align-items: center; gap: 10px; width: 100%;">
                    <img id="online-app-avatar-preview" src="https://i.postimg.cc/y8xWzCqj/anime-boy.jpg"
                         style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid #ddd;">
                    <button id="online-app-upload-avatar-btn" class="settings-mini-btn">ä¸Šä¼ </button>
                    <button id="online-app-reset-avatar-btn" class="settings-mini-btn">é‡ç½®</button>
                    <input type="file" id="online-app-avatar-input" accept="image/*" hidden>
                  </div>
                </div>
              </div>
              <div class="settings-item">
                <label>æœåŠ¡å™¨åœ°å€</label>
                <div class="settings-right">
                  <input type="text" id="online-app-server-url" placeholder="wss://your-server.com/ws">
                </div>
              </div>
              <div class="settings-item">
                <label>è¿æ¥çŠ¶æ€</label>
                <div class="settings-right">
                  <span id="online-app-conn-status" style="color: #999;">æœªè¿æ¥</span>
                </div>
              </div>
              <div class="settings-item" style="justify-content: center;">
                <button id="online-app-connect-btn" class="settings-mini-btn" style="width: 45%;">è¿æ¥æœåŠ¡å™¨</button>
                <button id="online-app-disconnect-btn" class="settings-mini-btn" style="width: 45%; display: none;">æ–­å¼€è¿æ¥</button>
              </div>

              <!-- æ•™ç¨‹åŒºåŸŸ -->
              <div style="background: #f8f9fa; padding: 15px; border-radius: 12px; margin: 15px 0; border: 1px solid #e0e0e0;">
                <div style="color: #333; font-weight: bold; font-size: 16px; margin-bottom: 12px; text-align: center;">å¸®åŠ©ä¸æ•™ç¨‹</div>
                <button class="settings-full-btn" id="online-app-deploy-tutorial-btn" style="background: #007aff; color: white; font-weight: 500; margin-bottom: 8px;">æœåŠ¡å™¨éƒ¨ç½²æ•™ç¨‹</button>
                <button class="settings-full-btn" id="online-app-guide-tutorial-btn" style="background: #007aff; color: white; font-weight: 500; margin-bottom: 8px;">è”æœºåŠŸèƒ½æ“ä½œæŒ‡å—</button>
                <button class="settings-full-btn" id="online-app-explain-tutorial-btn" style="background: #007aff; color: white; font-weight: 500; margin-bottom: 0;">è”æœºåŠŸèƒ½è§£é‡Šè¯´æ˜</button>
              </div>

              <button class="settings-full-btn" id="online-app-friend-requests-btn">
                å¥½å‹ç”³è¯· <span id="online-app-friend-badge" style="display:none; background: #ff3b30; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px; margin-left: 8px;">0</span>
              </button>
              <button class="settings-full-btn" id="online-app-search-btn">æœç´¢å¹¶æ·»åŠ å¥½å‹</button>
              <button class="settings-full-btn" id="online-app-create-group-btn">åˆ›å»ºç¾¤èŠ</button>

              <button class="settings-full-btn" id="online-app-clear-cache-btn" style="color: #ff9500;">æ¸…ç†æ‰€æœ‰æ—§æ•°æ®</button>
              <button class="settings-full-btn" id="online-app-reset-btn" style="color: #ff3b30;">é‡ç½®è”æœºæ•°æ®</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- è”æœºå¥½å‹åˆ—è¡¨å¼¹çª— -->
    <div id="online-friends-modal" class="modal">
      <div class="modal-content" style="height: 70%;">
        <div class="modal-header">
          <span>è”æœºå¥½å‹</span>
          <span class="close-btn" onclick="closeOnlineFriendsModal()">Ã—</span>
        </div>
        <div class="modal-body" style="padding: 0;">
          <div id="online-friends-list" style="padding: 15px;">
            <!-- JSåŠ¨æ€å¡«å……å¥½å‹åˆ—è¡¨ -->
            <div style="text-align: center; color: #999; padding: 40px 20px;">
              æš‚æ— è”æœºå¥½å‹
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- å¥½å‹ç”³è¯·å¼¹çª— -->
    <div id="friend-requests-modal" class="modal">
      <div class="modal-content" style="height: 70%;">
        <div class="modal-header">
          <span>å¥½å‹ç”³è¯·</span>
          <span class="close-btn" onclick="closeFriendRequestsModal()">Ã—</span>
        </div>
        <div class="modal-body" style="padding: 0;">
          <div id="friend-requests-list" style="padding: 15px;">
            <!-- JSåŠ¨æ€å¡«å……å¥½å‹ç”³è¯·åˆ—è¡¨ -->
            <div style="text-align: center; color: #999; padding: 40px 20px;">
              æš‚æ— å¥½å‹ç”³è¯·
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- æœç´¢å¥½å‹å¼¹çª— -->
    <div id="search-friend-modal" class="modal">
      <div class="modal-content" style="height: 50%;">
        <div class="modal-header">
          <span>æœç´¢å¥½å‹</span>
          <span class="close-btn" onclick="document.getElementById('search-friend-modal').classList.remove('visible')">Ã—</span>
        </div>
        <div class="modal-body" style="padding: 0;">
          <div style="padding: 15px;">
            <div style="display:flex;gap:8px;margin-bottom:15px;">
              <input type="text" id="online-app-search-id" placeholder="è¾“å…¥å¥½å‹ID" 
                     style="flex:1;padding:10px 12px;border:1px solid #ddd;border-radius:8px;font-size:14px;box-sizing:border-box;">
              <button id="online-app-search-do-btn" 
                      style="padding:10px 18px;background:#007aff;color:white;border:none;border-radius:8px;font-size:14px;cursor:pointer;white-space:nowrap;">æœç´¢</button>
            </div>
            <div id="online-app-search-result" style="padding:0;">
              <div style="text-align:center;color:#999;padding:30px 20px;">è¾“å…¥å¯¹æ–¹çš„IDè¿›è¡Œæœç´¢</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- åˆ›å»ºç¾¤èŠå¼¹çª— -->
    <div id="create-group-modal" class="modal">
      <div class="modal-content" style="height: 75%;">
        <div class="modal-header">
          <span>åˆ›å»ºç¾¤èŠ</span>
          <span class="close-btn" onclick="closeCreateGroupModal()">Ã—</span>
        </div>
        <div class="modal-body" style="padding: 0;">
          <div style="padding: 15px;">
            <input type="text" id="group-name-input" placeholder="è¾“å…¥ç¾¤åç§°" 
                   style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; box-sizing: border-box; margin-bottom: 10px;">
            <div style="font-size: 13px; color: #999; margin-bottom: 10px;">é€‰æ‹©è¦æ‹‰å…¥ç¾¤èŠçš„å¥½å‹ï¼š</div>
            <div id="create-group-friend-list" style="max-height: 300px; overflow-y: auto;">
              <!-- JSåŠ¨æ€å¡«å…… -->
            </div>
            <button id="confirm-create-group-btn" class="settings-full-btn" style="margin-top: 15px; background: #007aff; color: white; border: none;"
                    onclick="onlineChatManager.confirmCreateGroup()">åˆ›å»ºç¾¤èŠ</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ç¾¤èŠä¿¡æ¯å¼¹çª— -->
    <div id="group-info-modal" class="modal">
      <div class="modal-content" style="height: 65%;">
        <div class="modal-header">
          <span>ç¾¤èŠä¿¡æ¯</span>
          <span class="close-btn" onclick="closeGroupInfoModal()">Ã—</span>
        </div>
        <div class="modal-body" style="padding: 0;">
          <div id="group-info-content">
            <!-- JSåŠ¨æ€å¡«å…… -->
          </div>
        </div>
      </div>
    </div>

    <!-- MyPhone æ·»åŠ è”ç³»äººé€‰æ‹©å¼¹çª— -->
    <div id="myphone-add-choice-modal" class="modal">
      <div class="modal-content" style="width: 300px; height: auto;">
        <div class="modal-header">
          <span>æ·»åŠ è”ç³»äºº</span>
        </div>
        <div class="modal-body" style="padding: 20px;">
          <button id="myphone-manual-create-btn" class="form-button" style="width: 100%; margin-bottom: 15px; background-color: #333; color: #fff; border: none; padding: 15px; border-radius: 8px; font-size: 16px;">æ‰‹åŠ¨åˆ›å»ºè§’è‰²</button>
          <button id="myphone-import-from-main-btn" class="form-button" style="width: 100%; background-color: #333; color: #fff; border: none; padding: 15px; border-radius: 8px; font-size: 16px;">å¯¼å…¥ä¸»å±å¹•QQå¯¹è¯</button>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-add-choice-btn">å–æ¶ˆ</button>
        </div>
      </div>
    </div>

    <!-- MyPhone å¯¼å…¥è§’è‰²å¼¹çª— -->
    <div id="myphone-import-characters-modal" class="modal">
      <div class="modal-content" style="height: 70%;">
        <div class="modal-header">
          <span>å¯¼å…¥ä¸»å±å¹•è§’è‰²</span>
          <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;">
            <input type="checkbox" id="select-all-myphone-import">
            å…¨é€‰
          </label>
        </div>
        <div class="modal-body" id="myphone-import-list" style="padding: 0;">
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-import-btn">å–æ¶ˆ</button>
          <button class="save" id="confirm-myphone-import-btn">å¯¼å…¥é€‰ä¸­</button>
        </div>
      </div>
    </div>

    <!-- MyPhone ç›¸å†Œæ·»åŠ å¼¹çª— -->
    <div id="myphone-add-album-modal" class="modal">
      <div class="modal-content" style="height: auto;">
        <div class="modal-header">
          <span>æ·»åŠ ç…§ç‰‡</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>å›¾ç‰‡æè¿°</label>
            <textarea id="myphone-album-description-input" rows="4" placeholder="æè¿°è¿™å¼ ç…§ç‰‡çš„å†…å®¹..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-album-btn">å–æ¶ˆ</button>
          <button class="save" id="save-myphone-album-btn">ä¿å­˜</button>
        </div>
      </div>
    </div>

    <!-- MyPhone æµè§ˆå™¨æ·»åŠ å¼¹çª— -->
    <div id="myphone-add-browser-modal" class="modal">
      <div class="modal-content" style="height: auto;">
        <div class="modal-header">
          <span>æ·»åŠ æµè§ˆè®°å½•</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>æ ‡é¢˜</label>
            <input type="text" id="myphone-browser-title-input" placeholder="ç½‘é¡µæ ‡é¢˜">
          </div>
          <div class="form-group">
            <label>å†…å®¹</label>
            <textarea id="myphone-browser-content-input" rows="5" placeholder="ç½‘é¡µå†…å®¹..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-browser-btn">å–æ¶ˆ</button>
          <button class="save" id="save-myphone-browser-btn">ä¿å­˜</button>
        </div>
      </div>
    </div>

    <!-- MyPhone æ·˜å®æ·»åŠ å¼¹çª— -->
    <div id="myphone-add-taobao-modal" class="modal">
      <div class="modal-content" style="height: auto; max-height: 80%;">
        <div class="modal-header">
          <span>æ·»åŠ è´­ç‰©è®°å½•</span>
        </div>
        <div class="modal-body" style="max-height: calc(80vh - 120px); overflow-y: auto;">
          <div class="form-group">
            <label>å•†å“åç§°</label>
            <input type="text" id="myphone-taobao-name-input" placeholder="å•†å“åç§°">
          </div>
          <div class="form-group">
            <label>å•†å“æè¿°</label>
            <textarea id="myphone-taobao-description-input" rows="3" placeholder="æè¿°è¿™ä¸ªå•†å“..."></textarea>
          </div>
          <div class="form-group">
            <label>è´­ä¹°æƒ³æ³•</label>
            <textarea id="myphone-taobao-thought-input" rows="3" placeholder="ä¸ºä»€ä¹ˆä¹°è¿™ä¸ªå•†å“ï¼Ÿæœ‰ä»€ä¹ˆæƒ³æ³•ï¼Ÿ"></textarea>
          </div>
          <div class="form-group">
            <label>å•†å“ä»·æ ¼</label>
            <input type="number" id="myphone-taobao-price-input" placeholder="ä»·æ ¼" value="99">
          </div>
          <div class="form-group">
            <label>ç‰©æµçŠ¶æ€</label>
            <input type="text" id="myphone-taobao-status-input" placeholder="ä¾‹å¦‚ï¼šå·²ç­¾æ”¶ã€é€è¾¾ä¸­ã€å¾…å‘è´§" value="å·²ç­¾æ”¶">
          </div>
          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="checkbox" id="myphone-taobao-ai-image-checkbox">
              <span>ä½¿ç”¨å…è´¹AIç”Ÿæˆå•†å“å›¾</span>
            </label>
            <p style="font-size: 12px; color: #888; margin: 5px 0 0 0;">å¦‚æœä¸å‹¾é€‰ï¼Œå°†ä½¿ç”¨é»˜è®¤å›¾ç‰‡</p>
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-taobao-btn">å–æ¶ˆ</button>
          <button class="save" id="save-myphone-taobao-btn">ä¿å­˜</button>
        </div>
      </div>
    </div>

    <!-- MyPhone æ—¥è®°æ·»åŠ å¼¹çª— -->
    <div id="myphone-add-diary-modal" class="modal">
      <div class="modal-content" style="height: auto; max-height: 80%;">
        <div class="modal-header">
          <span>æ·»åŠ æ—¥è®°</span>
        </div>
        <div class="modal-body" style="max-height: calc(80vh - 120px); overflow-y: auto;">
          <div class="form-group">
            <label>æ—¥æœŸ</label>
            <input type="date" id="myphone-diary-date-input">
          </div>
          <div class="form-group">
            <label>å¤©æ°”</label>
            <input type="text" id="myphone-diary-weather-input" placeholder="ä¾‹å¦‚ï¼šæ™´å¤©ã€å¤šäº‘">
          </div>
          <div class="form-group">
            <label>æ—¥è®°æ ‡é¢˜</label>
            <input type="text" id="myphone-diary-title-input" placeholder="ä»Šå¤©çš„æ ‡é¢˜">
          </div>
          <div class="form-group">
            <label>å‰è¨€</label>
            <textarea id="myphone-diary-preface-input" rows="2" placeholder="ä»Šå¤©çš„å¿ƒæƒ…ã€æ„Ÿå—..."></textarea>
          </div>
          <div class="form-group">
            <label>æ—¥è®°å†…å®¹</label>
            <textarea id="myphone-diary-content-input" rows="6" placeholder="å†™ä¸‹ä»Šå¤©å‘ç”Ÿçš„äº‹æƒ…..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-diary-btn">å–æ¶ˆ</button>
          <button class="save" id="save-myphone-diary-btn">ä¿å­˜</button>
        </div>
      </div>
    </div>

    <!-- MyPhone å¤‡å¿˜å½•æ·»åŠ å¼¹çª— -->
    <div id="myphone-add-memo-modal" class="modal">
      <div class="modal-content" style="height: auto;">
        <div class="modal-header">
          <span>æ·»åŠ å¤‡å¿˜å½•</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>æ ‡é¢˜</label>
            <input type="text" id="myphone-memo-title-input" placeholder="å¤‡å¿˜å½•æ ‡é¢˜">
          </div>
          <div class="form-group">
            <label>å†…å®¹</label>
            <textarea id="myphone-memo-content-input" rows="6" placeholder="å†™ä¸‹ä½ çš„å¤‡å¿˜å†…å®¹..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-memo-btn">å–æ¶ˆ</button>
          <button class="save" id="save-myphone-memo-btn">ä¿å­˜</button>
        </div>
      </div>
    </div>

    <!-- MyPhone é«˜å¾·åœ°å›¾æ·»åŠ å¼¹çª— -->
    <div id="myphone-add-amap-modal" class="modal">
      <div class="modal-content" style="height: auto;">
        <div class="modal-header">
          <span>æ·»åŠ è¶³è¿¹</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>åœ°ç‚¹</label>
            <input type="text" id="myphone-amap-location-input" placeholder="å»äº†å“ªé‡Œï¼Ÿ">
          </div>
          <div class="form-group">
            <label>åœ°å€</label>
            <input type="text" id="myphone-amap-address-input" placeholder="è¯¦ç»†åœ°å€ï¼ˆå¯é€‰ï¼‰">
          </div>
          <div class="form-group">
            <label>å½“æ—¶çš„æƒ³æ³•</label>
            <textarea id="myphone-amap-thought-input" rows="4" placeholder="åœ¨è¿™é‡Œæœ‰ä»€ä¹ˆæ„Ÿå—ã€æƒ³æ³•ï¼Ÿ"></textarea>
          </div>
          <div class="form-group">
            <label>ä»€ä¹ˆæ—¶å€™</label>
            <input type="text" id="myphone-amap-time-input" placeholder="ä¾‹å¦‚ï¼š10å°æ—¶å‰ã€18å°æ—¶å‰ã€2å¤©å‰">
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-amap-btn">å–æ¶ˆ</button>
          <button class="save" id="save-myphone-amap-btn">ä¿å­˜</button>
        </div>
      </div>
    </div>

    <!-- MyPhone APPä½¿ç”¨è®°å½•æ·»åŠ å¼¹çª— -->
    <div id="myphone-add-usage-modal" class="modal">
      <div class="modal-content" style="height: auto;">
        <div class="modal-header">
          <span>æ·»åŠ ä½¿ç”¨è®°å½•</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>åº”ç”¨åç§°</label>
            <input type="text" id="myphone-usage-app-input" placeholder="ä¾‹å¦‚ï¼šå¾®ä¿¡ã€æŠ–éŸ³ã€åŸç¥">
          </div>
          <div class="form-group">
            <label>åº”ç”¨åˆ†ç±»</label>
            <input type="text" id="myphone-usage-category-input" placeholder="ä¾‹å¦‚ï¼šç¤¾äº¤ã€æ¸¸æˆã€å½±éŸ³">
          </div>
          <div class="form-group">
            <label>åº”ç”¨å›¾æ ‡URLï¼ˆå¯é€‰ï¼‰</label>
            <input type="text" id="myphone-usage-icon-input" placeholder="å›¾æ ‡é“¾æ¥ï¼Œç•™ç©ºåˆ™ä½¿ç”¨é»˜è®¤å›¾æ ‡">
          </div>
          <div class="form-group">
            <label>ä½¿ç”¨æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</label>
            <input type="number" id="myphone-usage-duration-input" placeholder="ä½¿ç”¨äº†å¤šä¹…ï¼Ÿ" value="30">
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-usage-btn">å–æ¶ˆ</button>
          <button class="save" id="save-myphone-usage-btn">ä¿å­˜</button>
        </div>
      </div>
    </div>

    <!-- MyPhone éŸ³ä¹æ·»åŠ å¼¹çª— -->
    <div id="myphone-add-music-modal" class="modal">
      <div class="modal-content" style="height: auto;">
        <div class="modal-header">
          <span>æ·»åŠ æ­Œæ›²</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>æ·»åŠ æ–¹å¼</label>
            <select id="myphone-music-source-select" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--secondary-bg); color: var(--text-color);">
              <option value="local">æœ¬åœ°æ–‡ä»¶</option>
              <option value="url">ç½‘ç»œURL</option>
              <option value="yiqiting">ä»ä¸€èµ·å¬å¯¼å…¥</option>
            </select>
          </div>
          
          <!-- ä¸€èµ·å¬æ­Œæ›²é€‰æ‹©åˆ—è¡¨ -->
          <div id="myphone-yiqiting-list-group" style="display: none;">
            <div class="form-group">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <label style="margin: 0;">é€‰æ‹©è¦å¯¼å…¥çš„æ­Œæ›²</label>
                <label style="margin: 0; font-size: 14px; color: var(--text-secondary); cursor: pointer;">
                  <input type="checkbox" id="myphone-yiqiting-select-all" style="margin-right: 5px;">å…¨é€‰
                </label>
              </div>
              <div id="myphone-yiqiting-song-list" style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 6px; padding: 10px; background: var(--bg-color);">
                <!-- æ­Œæ›²åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
              </div>
            </div>
          </div>
          
          <!-- æœ¬åœ°æ–‡ä»¶ä¸Šä¼  -->
          <div class="form-group" id="myphone-music-file-group">
            <label>é€‰æ‹©éŸ³é¢‘æ–‡ä»¶</label>
            <input type="file" id="myphone-music-file-input" accept="audio/*" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px;">
          </div>
          
          <!-- æ‰‹åŠ¨è¾“å…¥ä¿¡æ¯ï¼ˆæœ¬åœ°æ–‡ä»¶å’ŒURLæ¨¡å¼ï¼‰ -->
          <div id="myphone-music-manual-inputs">
            <div class="form-group">
              <label>æ­Œæ›²æ ‡é¢˜</label>
              <input type="text" id="myphone-music-title-input" placeholder="æ­Œæ›²å">
            </div>
            <div class="form-group">
              <label>æ­Œæ‰‹</label>
              <input type="text" id="myphone-music-artist-input" placeholder="æ­Œæ‰‹å">
            </div>
            <div class="form-group" id="myphone-music-url-group">
              <label>éŸ³ä¹é“¾æ¥</label>
              <input type="text" id="myphone-music-url-input" placeholder="éŸ³ä¹æ–‡ä»¶URL">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="cancel-myphone-music-btn">å–æ¶ˆ</button>
          <button class="save" id="save-myphone-music-btn">ä¿å­˜</button>
        </div>
      </div>
    </div>

    <!-- APIè°ƒç”¨å†å²æŸ¥çœ‹å™¨æ¨¡æ€çª—å£ -->
    <div id="api-history-modal" class="modal">
      <div class="modal-content" style="height: 90%; max-width: 900px;">
        <div class="modal-header">
          <span>APIè°ƒç”¨å†å² - æç¤ºè¯å’Œè¿”å›æ•°æ®</span>
        </div>
        <div class="modal-body" style="padding: 0; height: calc(100% - 100px); overflow: hidden; display: flex; flex-direction: column;">
          <div style="padding: 15px; border-bottom: 1px solid var(--border-color); background: var(--bg-secondary);">
            <div style="color: var(--text-secondary); font-size: 13px; margin-bottom: 10px;">
              è®°å½•äº†æ¯æ¬¡APIè°ƒç”¨çš„å®Œæ•´è¯·æ±‚å’Œå“åº”æ•°æ®ï¼ŒåŒ…æ‹¬å‘é€çš„æç¤ºè¯ã€ç³»ç»Ÿæç¤ºã€å†å²æ¶ˆæ¯ä»¥åŠAIè¿”å›çš„åŸå§‹æ•°æ®
            </div>
            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
              <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 13px;">
                <input type="checkbox" id="api-history-select-all" style="cursor: pointer;">
                å…¨é€‰
              </label>
              <button id="api-history-delete-btn" class="form-button-secondary" style="padding: 8px 15px;">
                åˆ é™¤é€‰ä¸­
              </button>
              <button id="api-history-export-btn" class="form-button" style="padding: 8px 15px;">
                å¯¼å‡ºä¸ºJSON
              </button>
            </div>
          </div>
          <div id="api-history-list" style="flex: 1; overflow-y: auto; padding: 15px;">
            <!-- APIè°ƒç”¨å†å²åˆ—è¡¨å°†åŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel" id="close-api-history-btn">å…³é—­</button>
        </div>
      </div>
    </div>

<!-- â–¼â–¼â–¼ ä½ ç”»æˆ‘çŒœåŠŸèƒ½ â–¼â–¼â–¼ -->
<div id="draw-guess-screen" class="screen">
    <div class="header">
        <span class="back-btn" onclick="showScreen('home-screen')">â€¹</span>
        <span>ä½ ç”»æˆ‘çŒœ</span>
        <div style="display: flex; gap: 10px;">
            <span class="action-btn" id="draw-guess-settings-btn">è®¾ç½®</span>
            <span class="action-btn" id="draw-guess-select-char-btn">é€‰æ‹©</span>
        </div>
    </div>

    <div class="list-container" id="draw-guess-content">
        <!-- æ¸¸æˆäº¤äº’åŒºåŸŸ -->
        <div id="draw-guess-interactive-area" style="display: none;">
            <div class="player-avatars-container">
                <div class="player-info">
                    <img id="draw-guess-user-avatar" src="" class="player-avatar">
                    <span id="draw-guess-user-name" class="player-name"></span>
                </div>
                <div class="player-info">
                    <img id="draw-guess-char-avatar" src="" class="player-avatar">
                    <span id="draw-guess-char-name" class="player-name"></span>
                </div>
            </div>
            <div id="draw-guess-dialogue-box"></div>
            <div class="draw-guess-input-area">
                <div id="draw-guess-action-bar" style="display:none;">
                    <button class="action-bar-btn" data-action="reply">å›å¤</button>
                    <button class="action-bar-btn" data-action="delete">åˆ é™¤</button>
                    <button class="action-bar-btn" data-action="edit">ç¼–è¾‘</button>
                    <button class="action-bar-btn" data-action="resay">é‡è¯´</button>
                </div>
                <div class="draw-guess-input-row">
                    <input type="text" id="draw-guess-input" placeholder="è¾“å…¥ä½ çš„çŒœæµ‹æˆ–å¯¹è¯...">
                    <button id="draw-guess-send-btn">å‘é€</button>
                </div>
            </div>
        </div>

        <div id="draw-guess-main-area">
            <p id="draw-guess-welcome-text">è¯·å…ˆç‚¹å‡»å³ä¸Šè§’"é€‰æ‹©"æŒ‰é’®<br>é‚€è¯·ä¸€ä½ä¼™ä¼´æ¥ç©å§ï¼</p>

            <div id="draw-guess-studio" style="display: none;">
                <canvas id="drawing-canvas"></canvas>
            
                <div id="draw-guess-tool-bar">
                    <div class="drawing-tools left">
                        <div class="color-palette">
                            <div class="color-dot active" style="background-color: #000000;" data-color="#000000"></div>
                            <div class="color-dot" style="background-color: #ff3b30;" data-color="#ff3b30"></div>
                            <div class="color-dot" style="background-color: #ff9500;" data-color="#ff9500"></div>
                            <div class="color-dot" style="background-color: #ffcc00;" data-color="#ffcc00"></div>
                            <div class="color-dot" style="background-color: #4cd964;" data-color="#4cd964"></div>
                            <div class="color-dot" style="background-color: #007aff;" data-color="#007aff"></div>
                            <div class="color-dot" style="background-color: #5856d6;" data-color="#5856d6"></div>
                            <div class="color-dot" style="background-color: #af52de;" data-color="#af52de"></div>
                            <div class="color-dot" style="background-color: #ffffff; border: 1px solid #ddd;" data-color="#ffffff"></div>
                        </div>
                        <div id="custom-color-picker-container" class="custom-color-picker">
                            <input type="color" id="custom-color-input" value="#000000">
                        </div>
                        <div class="tool-buttons">
                            <button class="tool-btn active" data-tool="pen">ç¬”</button>
                            <button class="tool-btn" data-tool="eraser">æ©¡çš®</button>
                            <button class="tool-btn" data-tool="undo">æ’¤å›</button>
                            <button id="clear-canvas-btn" class="tool-btn" data-tool="clear">æ¸…ç©º</button>
                        </div>
                    </div>
            
                    <div id="brush-settings" style="display: none; width: 100%; max-width: 150px;">
                        <div id="pen-settings">
                            <label for="pen-type-select">ç±»å‹</label>
                            <select id="pen-type-select">
                                <option value="pen">é’¢ç¬”</option>
                                <option value="pencil">é“…ç¬”</option>
                                <option value="watercolor">æ°´ç¬”</option>
                                <option value="brush">ç”»ç¬”</option>
                                <option value="calligraphy">æ¯›ç¬”</option>
                            </select>
                        </div>
                        <div class="size-control">
                            <label for="brush-size-slider">å¤§å°</label>
                            <input type="range" id="brush-size-slider" min="1" max="50" value="5">
                            <input type="number" id="brush-size-input" min="1" value="5">
                        </div>
                    </div>
                    
                    <div class="game-controls-group">
                        <button class="game-control-btn" id="draw-guess-get-topic-btn">AIå‡ºé¢˜</button>
                        <button class="game-control-btn" id="draw-guess-ai-turn-btn">è½®åˆ°ä»–äº†</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="draw-guess-bottom-bar" style="display: none;">
            <button id="start-draw-guess-game-btn" class="form-button">å¼€å§‹æ¸¸æˆ</button>
        </div>
    </div>
</div>

<div id="draw-guess-message-manager-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
        <div class="modal-header">
            <span id="draw-guess-manager-title">ç®¡ç†æ¶ˆæ¯</span>
            <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;">
                <input type="checkbox" id="draw-guess-manager-select-all"> å…¨é€‰
            </label>
        </div>
        <div class="modal-body" id="draw-guess-manager-list" style="padding: 0;"></div>
        <div class="modal-footer">
            <button class="cancel" id="draw-guess-manager-cancel-btn">å–æ¶ˆ</button>
            <button class="save" id="draw-guess-manager-confirm-btn">ç¡®è®¤</button>
        </div>
    </div>
</div>

<!-- ä½ ç”»æˆ‘çŒœè®¾ç½®å¼¹çª— -->
<div id="draw-guess-settings-modal" class="modal">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
            <span>æ¸¸æˆæ¨¡å¼è®¾ç½®</span>
        </div>
        <div class="modal-body">
            <div class="setting-item">
                <label style="font-weight: 500; margin-bottom: 8px; display: block;">é€‰æ‹©æ¸¸æˆæ¨¡å¼</label>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary);">
                        <input type="radio" name="draw-guess-mode" value="online" id="draw-guess-mode-online" checked>
                        <div>
                            <div style="font-weight: 500;">çº¿ä¸Šæ¨¡å¼</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">æ¨¡æ‹Ÿçº¿ä¸ŠèŠå¤©ï¼Œè§’è‰²å¯å‘å¤šæ¡ç®€çŸ­æ¶ˆæ¯</div>
                        </div>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary);">
                        <input type="radio" name="draw-guess-mode" value="offline" id="draw-guess-mode-offline">
                        <div>
                            <div style="font-weight: 500;">çº¿ä¸‹æ¨¡å¼</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">æ¨¡æ‹Ÿé¢å¯¹é¢åœºæ™¯ï¼ŒåŒ…å«åŠ¨ä½œå’Œåœºæ™¯æå†™</div>
                        </div>
                    </label>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="cancel" id="draw-guess-settings-cancel-btn">å–æ¶ˆ</button>
            <button class="save" id="draw-guess-settings-save-btn">ä¿å­˜</button>
        </div>
    </div>
</div>
<!-- â–²â–²â–² ä½ ç”»æˆ‘çŒœHTMLç»“æŸ â–²â–²â–² -->

<!-- ç§»åŠ¨ç«¯æ§åˆ¶å° -->
<div id="mobile-console" style="display: none;">
    <div id="mobile-console-header">
        <span>æ§åˆ¶å°</span>
        <div id="mobile-console-actions">
            <button id="console-clear-btn">æ¸…ç©º</button>
            <button id="console-close-btn">å…³é—­</button>
        </div>
    </div>
    <div id="mobile-console-tabs">
        <button class="console-tab active" data-tab="all">å…¨éƒ¨</button>
        <button class="console-tab" data-tab="log">æ—¥å¿—</button>
        <button class="console-tab" data-tab="warn">è­¦å‘Š</button>
        <button class="console-tab" data-tab="error">é”™è¯¯</button>
    </div>
    <div id="mobile-console-content"></div>
</div>

<script>
// ==================== æ—¶é—´æ„ŸçŸ¥ä¸è‡ªå®šä¹‰æ—¶é—´ç³»ç»Ÿ ====================
(function() {
  'use strict';

  // è·å–å…ƒç´ 
  const timePerceptionToggle = document.getElementById('time-perception-toggle');
  const timeZoneGroup = document.getElementById('time-zone-group');
  const customTimeToggle = document.getElementById('custom-time-toggle');
  const customTimeSettingsGroup = document.getElementById('custom-time-settings-group');
  
  const customYearInput = document.getElementById('custom-year-input');
  const customMonthInput = document.getElementById('custom-month-input');
  const customDayInput = document.getElementById('custom-day-input');
  const customHourInput = document.getElementById('custom-hour-input');
  const customMinuteInput = document.getElementById('custom-minute-input');
  const customTimePreview = document.getElementById('custom-time-preview');

  // ä»localStorageåŠ è½½è®¾ç½®
  function loadSettings() {
    const timePerceptionEnabled = localStorage.getItem('time-perception-enabled') === 'true';
    const customTimeEnabled = localStorage.getItem('custom-time-enabled') === 'true';
    
    timePerceptionToggle.checked = timePerceptionEnabled;
    customTimeToggle.checked = customTimeEnabled;
    
    // æ˜¾ç¤º/éšè—ç›¸åº”çš„è®¾ç½®é¢æ¿
    if (timePerceptionEnabled) {
      timeZoneGroup.style.display = 'block';
    }
    if (customTimeEnabled) {
      customTimeSettingsGroup.style.display = 'block';
    }
    
    // åŠ è½½è‡ªå®šä¹‰æ—¶é—´å€¼
    customYearInput.value = localStorage.getItem('custom-time-year') || '';
    customMonthInput.value = localStorage.getItem('custom-time-month') || '';
    customDayInput.value = localStorage.getItem('custom-time-day') || '';
    customHourInput.value = localStorage.getItem('custom-time-hour') || '';
    customMinuteInput.value = localStorage.getItem('custom-time-minute') || '';
    
    updatePreview();
  }

  // æ›´æ–°æ—¶é—´é¢„è§ˆ
  function updatePreview() {
    const year = customYearInput.value;
    const month = customMonthInput.value;
    const day = customDayInput.value;
    const hour = customHourInput.value;
    const minute = customMinuteInput.value;
    
    if (year && month && day && hour !== '' && minute !== '') {
      const monthStr = String(month).padStart(2, '0');
      const dayStr = String(day).padStart(2, '0');
      const hourStr = String(hour).padStart(2, '0');
      const minuteStr = String(minute).padStart(2, '0');
      customTimePreview.textContent = `${year}å¹´${monthStr}æœˆ${dayStr}æ—¥ ${hourStr}:${minuteStr}`;
    } else {
      customTimePreview.textContent = 'æœªè®¾ç½®';
    }
  }

  // ä¿å­˜è‡ªå®šä¹‰æ—¶é—´è®¾ç½®
  function saveCustomTimeSettings() {
    localStorage.setItem('custom-time-year', customYearInput.value);
    localStorage.setItem('custom-time-month', customMonthInput.value);
    localStorage.setItem('custom-time-day', customDayInput.value);
    localStorage.setItem('custom-time-hour', customHourInput.value);
    localStorage.setItem('custom-time-minute', customMinuteInput.value);
    updatePreview();
  }

  // æ—¶é—´æ„ŸçŸ¥å¼€å…³äº‹ä»¶
  timePerceptionToggle.addEventListener('change', function() {
    const isEnabled = this.checked;
    localStorage.setItem('time-perception-enabled', isEnabled);
    
    if (isEnabled) {
      // æ˜¾ç¤ºæ—¶åŒºè®¾ç½®
      timeZoneGroup.style.display = 'block';
      
      // å…³é—­è‡ªå®šä¹‰æ—¶é—´
      if (customTimeToggle.checked) {
        customTimeToggle.checked = false;
        customTimeSettingsGroup.style.display = 'none';
        localStorage.setItem('custom-time-enabled', 'false');
      }
    } else {
      timeZoneGroup.style.display = 'none';
    }
  });

  // è‡ªå®šä¹‰æ—¶é—´å¼€å…³äº‹ä»¶
  customTimeToggle.addEventListener('change', function() {
    const isEnabled = this.checked;
    localStorage.setItem('custom-time-enabled', isEnabled);
    
    if (isEnabled) {
      // æ˜¾ç¤ºè‡ªå®šä¹‰æ—¶é—´è®¾ç½®
      customTimeSettingsGroup.style.display = 'block';
      
      // å…³é—­æ—¶é—´æ„ŸçŸ¥
      if (timePerceptionToggle.checked) {
        timePerceptionToggle.checked = false;
        timeZoneGroup.style.display = 'none';
        localStorage.setItem('time-perception-enabled', 'false');
      }
      
      // å¦‚æœæ²¡æœ‰è®¾ç½®å€¼ï¼Œä½¿ç”¨å½“å‰æ—¶é—´ä½œä¸ºé»˜è®¤å€¼
      if (!customYearInput.value) {
        const now = new Date();
        customYearInput.value = now.getFullYear();
        customMonthInput.value = now.getMonth() + 1;
        customDayInput.value = now.getDate();
        customHourInput.value = now.getHours();
        customMinuteInput.value = now.getMinutes();
        saveCustomTimeSettings();
      }
    } else {
      customTimeSettingsGroup.style.display = 'none';
    }
  });

  // ç›‘å¬è‡ªå®šä¹‰æ—¶é—´è¾“å…¥å˜åŒ–
  [customYearInput, customMonthInput, customDayInput, customHourInput, customMinuteInput].forEach(input => {
    input.addEventListener('input', saveCustomTimeSettings);
    input.addEventListener('change', saveCustomTimeSettings);
  });

  // è·å–å½“å‰æ—¶é—´ï¼ˆè€ƒè™‘è‡ªå®šä¹‰æ—¶é—´ï¼‰
  window.getCustomTime = function() {
    const customTimeEnabled = localStorage.getItem('custom-time-enabled') === 'true';
    
    if (customTimeEnabled) {
      const year = localStorage.getItem('custom-time-year');
      const month = localStorage.getItem('custom-time-month');
      const day = localStorage.getItem('custom-time-day');
      const hour = localStorage.getItem('custom-time-hour');
      const minute = localStorage.getItem('custom-time-minute');
      
      if (year && month && day && hour !== null && minute !== null) {
        return {
          enabled: true,
          year: parseInt(year),
          month: parseInt(month),
          day: parseInt(day),
          hour: parseInt(hour),
          minute: parseInt(minute),
          formatted: `${year}å¹´${String(month).padStart(2, '0')}æœˆ${String(day).padStart(2, '0')}æ—¥ ${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`
        };
      }
    }
    
    // è¿”å›å½“å‰å®é™…æ—¶é—´
    const now = new Date();
    return {
      enabled: false,
      year: now.getFullYear(),
      month: now.getMonth() + 1,
      day: now.getDate(),
      hour: now.getHours(),
      minute: now.getMinutes(),
      formatted: `${now.getFullYear()}å¹´${String(now.getMonth() + 1).padStart(2, '0')}æœˆ${String(now.getDate()).padStart(2, '0')}æ—¥ ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`
    };
  };

  // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
  loadSettings();

  console.log('æ—¶é—´æ„ŸçŸ¥ä¸è‡ªå®šä¹‰æ—¶é—´ç³»ç»Ÿå·²åˆå§‹åŒ–');
})();
</script>

<script>
// ==================== EPhone éªŒè¯ç³»ç»Ÿ ====================
(function() {
  'use strict';

  const AUTH_KEY = 'ephone_auth';
  const introScreen = document.getElementById('intro-screen');
  const authScreen = document.getElementById('ephone-auth-screen');
  const phoneScreen = document.getElementById('phone-screen');
  const accountInput = document.getElementById('ephone-account');
  const passwordInput = document.getElementById('ephone-password');
  const loginBtn = document.getElementById('ephone-login-btn');
  const errorDiv = document.getElementById('ephone-auth-error');

  // éªŒè¯å‡½æ•°
  async function ephoneVerify() {
    const account = accountInput.value.trim();
    const password = passwordInput.value.trim();

    // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯ä¿¡æ¯
    errorDiv.textContent = '';

    if (!account || !password) {
      errorDiv.textContent = 'Please enter account and password';
      return;
    }

    // ç¦ç”¨æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤æäº¤
    loginBtn.disabled = true;
    loginBtn.textContent = 'Unlocking...';

    try {
      const res = await fetch('https://puppy-subscription-api.zeabur.app/api/verify', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ account: account, password: password })
      });

      const data = await res.json();

      if (data.success) {
        // éªŒè¯æˆåŠŸ
        localStorage.setItem(AUTH_KEY, 'true');
        errorDiv.style.color = '#27ae60';
        errorDiv.textContent = 'Unlocked!';
        
        // æ·»åŠ æ·¡å‡ºåŠ¨ç”»
        authScreen.classList.add('fade-out');
        
        // ç­‰å¾…åŠ¨ç”»å®Œæˆåéšè—éªŒè¯ç•Œé¢
        setTimeout(() => {
          authScreen.classList.add('hidden');
          phoneScreen.style.display = 'block';
        }, 500);
      } else {
        // éªŒè¯å¤±è´¥
        errorDiv.style.color = '#ff6b81';
        errorDiv.textContent = 'Failed: ' + (data.message || 'Wrong Account or Password');
        loginBtn.disabled = false;
        loginBtn.textContent = 'Unlock!';
      }
    } catch (error) {
      console.error('éªŒè¯è¯·æ±‚å¤±è´¥:', error);
      errorDiv.style.color = '#ff6b81';
      errorDiv.textContent = 'Network Error';
      loginBtn.disabled = false;
      loginBtn.textContent = 'Unlock!';
    }
  }

  // æ£€æŸ¥éªŒè¯çŠ¶æ€
  function checkAuthStatus() {
    const isAuthenticated = localStorage.getItem(AUTH_KEY) === 'true';
    
    if (isAuthenticated) {
      // å·²éªŒè¯ï¼Œéšè—æ‰€æœ‰éªŒè¯ç›¸å…³ç•Œé¢
      introScreen.style.display = 'none';
      authScreen.classList.add('hidden');
      phoneScreen.style.display = 'block';
    } else {
      // æœªéªŒè¯ï¼Œæ˜¾ç¤ºå¼€åœºåŠ¨ç”»ï¼Œéšè—ä¸»ç•Œé¢
      introScreen.classList.remove('hidden');
      authScreen.classList.add('hidden');
      phoneScreen.style.display = 'none';
      
      // ç»‘å®šå¼€åœºåŠ¨ç”»ç‚¹å‡»äº‹ä»¶
      introScreen.addEventListener('click', () => {
        introScreen.classList.add('hidden');
        setTimeout(() => {
            introScreen.style.display = 'none';
            authScreen.classList.remove('hidden');
        }, 500);
      });
    }
  }

  // ç»‘å®šäº‹ä»¶
  loginBtn.addEventListener('click', ephoneVerify);

  // æ”¯æŒå›è½¦é”®æäº¤
  passwordInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      ephoneVerify();
    }
  });

  accountInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      passwordInput.focus();
    }
  });

  // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥éªŒè¯çŠ¶æ€
  checkAuthStatus();

  // å¯é€‰ï¼šæ·»åŠ é€€å‡ºç™»å½•åŠŸèƒ½ï¼ˆå¯ä»¥åœ¨è®¾ç½®ä¸­è°ƒç”¨ï¼‰
  window.ephoneLogout = function() {
    localStorage.removeItem(AUTH_KEY);
    location.reload();
  };

  console.log('EPhone éªŒè¯ç³»ç»Ÿå·²åˆå§‹åŒ–');
})();
</script>

</body>
</html>






































